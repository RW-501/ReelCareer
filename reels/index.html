<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Explore video resumes from job seekers. Browse candidates' video profiles and interact with them.">
  
  <meta name="keywords" content="career blog, job search tips, career advice, job market insights, employment tips, career growth, resume tips, interview advice, professional development, job seekers">
  <meta name="author" content="ReelCareer">
  <meta name="robots" content="index, follow">
  <meta name="language" content="en">
  <meta name="geo.region" content="US-TX">
  <meta name="geo.placename" content="Dallas, Texas">

  <!-- Title optimized for Video Reel page -->
  <title>Video Reel - Job Board | ReelCareer</title>

  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Video Reel - Job Board | ReelCareer">
  <meta property="og:description" content="Browse job seekers' video resumes, interact with candidates, and find the right fit for your company.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.reelcareer.co/reels">
  <meta property="og:image" content="https://www.reelcareer.co/images/sq_logo_n_BG_tie_reelx.png">
  <meta property="og:site_name" content="ReelCareer">
  <meta property="og:locale" content="en_US">

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@ReelCareer">
  <meta name="twitter:title" content="Video Reel - Job Board | ReelCareer">
  <meta name="twitter:description" content="Explore video resumes from job seekers and find the perfect candidate for your role on ReelCareer.">
  <meta name="twitter:image" content="https://www.reelcareer.co/images/sq_logo_n_BG_tie_reelx.png">

  <!-- Canonical Tag for SEO -->
  <link rel="canonical" href="https://www.reelcareer.co/reels">

  <!-- Standard Favicon -->
  <link rel="icon" type="image/x-icon" href="https://www.ReelCareer.co/images/favicons/favicon.ico">

  <!-- 32x32 Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://www.ReelCareer.co/images/favicons/favicon-32x32.png">

  <!-- 16x16 Favicon -->
  <link rel="icon" type="image/png" sizes="16x16" href="https://www.ReelCareer.co/images/favicons/favicon-16x16.png">

  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" sizes="180x180" href="https://www.ReelCareer.co/images/favicons/apple-touch-icon.png">

  <!-- Android Favicon (192x192) -->
  <link rel="icon" type="image/png" sizes="192x192" href="https://www.ReelCareer.co/images/favicons/android-chrome-192x192.png">

  <!-- Chrome Favicon (512x512) -->
  <link rel="icon" type="image/png" sizes="512x512" href="https://www.ReelCareer.co/images/favicons/android-chrome-512x512.png">

   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<!--
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
-->
  
   <!-- Bootstrap CSS -->
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <script src="https://reelcareer.co/public/js/scripts.js"></script>
    <script src="https://reelcareer.co/public/js/loadScripts.js"></script>
   
     
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">

    <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
  />

   
    <link rel="stylesheet" href="https://reelcareer.co/public/css/styles.css">
   
   
   
   <style>
    
/* Responsive Design */
@media (max-width: 768px) {
  .video-reel-container {
    padding: 10px;
  }

  .video-card {
    width: 100%;
  }

  .user-info {
    flex-direction: column;
    align-items: flex-start;
  }

  .user-name {
    font-size: 1.3rem;
  }

  .job-title {
    font-size: 1rem;
  }

  .message-button, .add-user-button, .connect-button, .share-btn, .comments-btn {
    font-size: 0.9rem;
    padding: 8px 12px;
  }

  .video-container {
    display: block;
  }
}

@media (max-width: 480px) {
  .video-card {
    padding: 10px;
  }
}
/* Base styles */

.user-info {
    display: flex;
    flex-wrap: nowrap;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.5rem;
    flex-direction: row;
}

.user-info-left {
  display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    gap: .5rem;
    width: 50%;
}



.user-info {
  display: flex;
  padding: 10px;
  gap: 10px;
  align-items: center;
}
.badge {
  align-items: center;

  font-size: 0.8rem;
  font-weight: bold;

  text-transform: uppercase;
}

.badge-verified {
  color: #555;

}

.badge-verified i {
  margin-right: 4px;
  font-size: 1rem;
}

.profile-img {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  object-fit: cover;
}

.user-details {
  display: flex;
  flex-direction: column;
}

.user-name {
  font-size: 1.1rem;
  font-weight: 700;
}
.name-badge {
  display: flex;
}
.job-title {
  font-size: 0.9rem;
  color: #555;
}


.user-info-right {
    display: block;
    width: 50%;
}




/* Video Reel Container */
.video-reel-container {
    width: 100%;
    max-width: 640px;
    margin: 0 auto;
    background-color: transparent;
    position: relative;
    padding: 10px;
    border-radius: 10px;
    display: grid;
    gap: 1rem;
}




.video-player {
    width: 100%;
    height: 100%;
    border-radius: 10px;
}

.video-reel-container .video-card .video-title {
  padding: 10px;
  font-weight: bold;
  background-color: rgb(143, 192, 220);
  color: #fff;
  text-align: center;
  font-size: 16px;
}

/* Video Card Styles */


.video-card {
    background-color: #e3ebf0;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    transition: transform 0.3s ease;
    /* padding: 0.5rem; */
    border: aliceblue solid;

    width: 100%;
    height: auto;
    margin: 0;
    padding: 0;
    overflow: hidden;
}

.video-post {
  width: 400px;
    height: auto;
    margin: auto;
}


.video-card:hover {
  transform: scale(1.02);
}

.video-container {
    position: relative;
    width: 400px;
    height: 650px;
}
.video-element {
    width: 400px;
    height: 650px;
    background-color: #000;
    margin: auto;
    position: relative;
}


.tags-container {
display: block;

}


.tags-container {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: flex-start;
    align-items: baseline;
    margin: .2rem;
    align-content: flex-end;
    gap: .2rem;
}

.interaction-buttons {
    display: flex;
    justify-content: space-between;
    gap: .2rem;
    padding: .2rem;
}


.video-tags {
display: block;

}






.controls-container {
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-top: 10px;
    bottom: 0;
    position: absolute;
    left: 0;
    right: 0;
    width: 100%;
    flex-wrap: nowrap;
    justify-content: space-evenly;
}

.actions {
    display: flex;
    justify-content: space-between;
    width: 100%;
    padding: 10px;
}

.action-btn {
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 10px;
}

.action-btn:hover {
  color: #84bbd9;
}

.video-details {
    display: flex;
    justify-content: space-between;
    width: 100%;
    margin-bottom: 10px;
    padding: .5rem;
    color: #84bbd9;
}
.video-details p {
    margin: 0;
    font-size: 14px;
}

.video-upload-section {
    display: flex;
    justify-content: center;
    width: 100%;
    margin-top: 10px;
}








.caption-container {
  padding: 10px;
  font-size: 1rem;
  color: #333;
}

.video-caption {
  margin: 0;
}










/* Play Overlay */
.play-overlay {
    position: absolute;
    top: 0;
    left: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 80px;
    height: 80px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
    color: #fff;
    font-size: 2rem;
    cursor: pointer;
    transition: opacity 0.3s;
    right: 0;
    bottom: 0;
    margin: auto;
}
.play-overlay:hover {
  color: #84bbd9;
}


.realCareerVidLogo {
    color: #639ad4;
    font-size: 1.5rem;
    font-weight: 700;
    -webkit-text-stroke: thin;
    font-size: 1rem;
    font-variant: small-caps;
    margin: .5rem;
    opacity: .5;
}


.reportVideoBtn {
    position: absolute;
    top: 10px;
    background-color: rgba(0, 0, 0, 0.6);
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    cursor: pointer;
    right: 0;
    left: 0;
    margin: auto;
}

.reportVideoBtn:hover {
  color: #ad1b33;
}

/* Mute & Full-Screen Buttons */
.mute-toggle, .fullscreen-toggle {
  position: absolute;
  top: 10px;
  background-color: rgba(0, 0, 0, 0.6);
  color: #fff;
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  cursor: pointer;
}

.mute-toggle {
  left: 10px;
}

.fullscreen-toggle {
  right: 10px;
}

.mute-toggle:hover, .fullscreen-toggle:hover {
  background-color: rgba(0, 0, 0, 0.8);
}

/* Views Icon */
.video-details {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px;
  background-color: #f8f9fa;
  font-size: 0.9rem;
}

.video-details p {
  margin: 0;
  display: flex;
  align-items: center;
  gap: 5px;
}

.fa-play-circle, .fa-clock {
  color: #007bff;
}


#Main-Nav_bar {
  display: none;
  visibility: hidden;
}



.comment-section {
    font-family: Arial, sans-serif;
    margin: .5rem;
}

.comment-input-container,
.reply-input-container {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
}

.comment-input-container input,
.reply-input-container input {
    flex: 1;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 5px;
}

.comment-input-container button, .reply-input-container button {
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    flex-direction: row;
    flex-wrap: nowrap;
    align-content: center;
    justify-content: center;
    height: max-content;
    margin: auto;
}
.comment-container .comment-item {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
}

.comment-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
}

.comment-content {
    flex: 1;
    padding: .5rem;
    width: 100%;
    margin: .5rem;
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    justify-content: flex-end;
}

.reply-text-area {
    border-radius: 10px;
    min-height: min-content;
    background-color: #ffffff;
    width: 100%;
    padding: .5rem;
}

.comment-name {
    font-weight: bold;
    text-decoration: none;
    color: #333;
}

.reply-btn {
    background: none;
    border: none;
    color: #abcee2;
    cursor: pointer;
    font-size: 0.9em;
    margin-top: 5px;
}
.reply-to-container {
    font: status-bar;
}
.reply-commenter-area {
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    justify-content: space-between;
    align-items: center;
}
.comments-container {
  display: none;
}

.reply-input-area {
  display: none;
}
.reply-btn-area {
display: grid;
}

.reply-send-area {
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    justify-content: space-between;
    align-items: center;
    gap: .5rem;
}
/* General Styling */
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(45deg, rgb(143, 192, 220), rgb(178, 209, 227)) rgb(132, 173, 234);
  color: #333;
  margin: 0;
  padding: 0;
}

#main-content {
  padding: 20px;

  border-radius: 10px;
}

/* Search Area Styling */
.search-area {
  margin-bottom: 20px;
  text-align: center;
}

#search-input {
  padding: 10px;
  width: 100%;
  max-width: 500px;
  border-radius: 5px;
  border: 1px solid #ccc;
  font-size: 16px;
}

#search-input:focus {
  outline: none;
  border-color: rgb(132, 173, 234);
}


/* Modal Styling */
.modal-content {
  background: linear-gradient(45deg, rgb(143, 192, 220), rgb(178, 209, 227)) rgb(132, 173, 234);
  border-radius: 10px;
}

.modal-header {
  background-color: rgb(132, 173, 234);
  color: #fff;
}

.modal-header .close {
  color: #fff;
  font-size: 24px;
}

.modal-body {
  padding: 20px;
  background-color: #fff;
  border-radius: 10px;
}

/* Form Styling */
#sendMessageForm {
  display: flex;
  flex-direction: column;
}

#sendMessageForm .message-input-area {
  border: 1px solid #ccc;
  border-radius: 5px;
  min-height: 150px;
  padding: 10px;
  font-size: 14px;
}



/* Report Modal Styling */
#reportJobModal {
  background-color: rgba(0, 0, 0, 0.5);
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  display: none;
}

#reportJobModal .modal-content {
    height: 90%;
    width: 80%;
    max-width: 600px;
    padding: 20px;
    border-radius: 10px;
    background: linear-gradient(45deg, rgb(143, 192, 220), rgb(178, 209, 227)) rgb(132, 173, 234);
}

#reportForm .checkbox-group {
  margin-bottom: 15px;
}

#reportForm input[type="checkbox"] {
  margin-right: 10px;
}

#reportForm textarea {
    width: 100%;
    height: 80px;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
}

#reportForm .btn {
  margin-top: 10px;
  padding: 10px;
  background-color: rgb(132, 173, 234);
  color: white;
  border-radius: 5px;
}

#reportForm .btn:hover {
  background-color: rgb(143, 192, 220);
}

#closeReportModalButton {
  background-color: #777;
  color: white;
  padding: 8px 15px;
  border-radius: 5px;
  margin-top: 10px;
}

#closeReportModalButton:hover {
  background-color: #555;
}

/* Modal Success/Failure Message Styling */
#reportStatusMessage {
  margin-top: 20px;
  color: green; /* For success messages */
}

</style>



</head>


<body>
    <script src="https://reelcareer.co/public/js/bodyload.js"></script>
    <nav></nav>

    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
          <li id="lastBreadcrumb_home" class="breadcrumb-item"><a id="homeBreadcrumb_a" href="https://reelcareer.co">Home</a></li>
         
          <li id="lastBreadcrumb_profile" class="breadcrumb-item"><a  href="https://reelcareer.co/u">Profile</a></li>
          <li id="lastBreadcrumb_messages" class="breadcrumb-item"><a href="https://reelcareer.co/u/messaging">Messages</a></li>
         
          <li id="lastBreadcrumb_create" class="breadcrumb-item"><a  href="https://reelcareer.co/u/create">Create Reel</a></li>
          <li id="lastBreadcrumb_join" class="breadcrumb-item"><a  href="https://reelcareer.co/views/auth">Join us</a></li>
          <li id="breadcrumb-active-title" class="breadcrumb-item active" aria-current="page">User</li>
        </ol>
    </nav>



      <main id="main-content">
      
     
        
          <div class="search-area">
            <input type="text" id="search-input" placeholder="Search videos by tag..." />
        </div>
        

          <section id="video-reel-container" class="video-reel-container">
            <!-- Repeat similar structure for other video cards -->

     
            
          </div>





      
    </main>

    <div id="currentVideoId" hidden></div>



    <div class="modal fade" id="sendMessageModal" tabindex="-1" aria-labelledby="sendMessageModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header border-0">
            <h5 class="modal-title" id="sendMessageModalLabel">
              <span id="recipient-name">Send Message</span>
            </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="sendMessageForm">
              <!-- Editable Message Area -->
              <div class="message-input-attachment-btn-wrap">
                <label for="message-content-editable">Message</label>

                <div class="message-input-area">
                <div
                  id="message-content-editable"
                  class="message-content-area"
                  contenteditable="true"
                  data-placeholder="Type your message here..."
                ></div>



                </div>

    
              </div>







                <!-- Hidden Textarea to Sync Content -->
                <textarea id="message-content" class="d-none"></textarea>
  
    
   
    
            </form>
          </div>
        </div>
      </div>
    </div>
    
    <div id="reportJobModal" class="modal" role="dialog" aria-labelledby="reportJobTitle"> 
      <div class="modal-content">
        <span class="close" aria-label="Close" onclick="closeReportModal()">&times;</span>
        <form id="reportForm">
          <h2 id="reportTitle">Report Video</h2>
          <p>Please select the reason(s) for reporting this video:</p>
    
          <div class="checkbox-group">
            <input type="checkbox" id="spam" name="reason" value="Spam">
            <label for="spam">Spam or misleading content</label><br>
    
            <input type="checkbox" id="scam" name="reason" value="Scam">
            <label for="scam">Fraudulent or scam content</label><br>
    
            <input type="checkbox" id="offensive" name="reason" value="Offensive Content">
            <label for="offensive">Offensive, harmful, or abusive content</label><br>
    
            <input type="checkbox" id="violence" name="reason" value="Violence or Hate Speech">
            <label for="violence">Violence, hate speech, or harassment</label><br>
    
            <input type="checkbox" id="illegal" name="reason" value="Illegal Content">
            <label for="illegal">Illegal content</label><br>
    
            <input type="checkbox" id="nudity" name="reason" value="Explicit Content">
            <label for="nudity">Explicit or adult content</label><br>
    
            <input type="checkbox" id="other" name="reason" value="Other">
            <label for="other">Other (please specify below)</label><br>
          </div>
    
          <textarea id="reportMessage" class="form-control mt-3" rows="4" placeholder="Additional details..."></textarea>
    
          <button type="button" class="btn btn-primary mt-3" onclick="submitReport()">Submit Report</button>
        </form>
    
        <!-- Success/Error message placeholder -->
        <div id="reportStatusMessage" class="mt-3"></div>
    
        <!-- Close button, initially hidden -->
        <button id="closeReportModalButton" type="button" class="btn btn-secondary mt-3" style="display: none;" onclick="closeReportJobModal()">Close</button>
      </div>
    </div>
    



    <!-- Footer -->
    <footer id="dynamic-footer"></footer>
    
    <!-- Firebase configuration/ Login& Out -->
    <script type="module" src="https://reelcareer.co/public/js/main.js"></script> 

   
    

    <!-- Firebase JS SDK and Custom Scripts -->

    <script type="module">
    import {
        db, getStorage, ref, uploadBytes, getDownloadURL, limit,
  doc, arrayUnion, RecaptchaVerifier, increment, getDoc, arrayRemove, signInWithPhoneNumber,
  query, updateDoc, setDoc, addDoc, signInAnonymously, orderBy, onAuthStateChanged,
  uploadBytesResumable, signInWithPopup, FacebookAuthProvider, GoogleAuthProvider, startAfter,
  OAuthProvider, signOut, deleteDoc, getFirestore, serverTimestamp,
  createUserWithEmailAndPassword, signInWithEmailAndPassword, deleteObject,
  where, getDocs, storage, getAuth, collection, auth, analytics,
  googleProvider,onSnapshot ,
  facebookProvider,
  getUserId // Export the function
    } from 'https://reelcareer.co/js/module.js';





    let userId = '';

    document.addEventListener('DOMContentLoaded', () => {

    async function initializeUserId() {
        try {
            // Wait for the Firebase Auth state to initialize
            await auth.onAuthStateChanged((user) => {
                if (user) {
                     userId = user.uid; // Access the user ID
                    console.log("User ID:", userId);

                    // You can call your functions that require userId here
                } else {
                    console.error("No user is signed in.");
                    // Handle the case where the user is not signed in
                }
            });
        } catch (error) {
            console.error("Error initializing user ID:", error);
        }
    }

    initializeUserId(); // Call the function to initialize user ID

  });


  let postsPerPage = 10;
let lastVisibleDoc = null;
let searchingByTag = false; // Track if search mode is active
document.addEventListener("DOMContentLoaded", () => {
    console.log("DOMContentLoaded event fired");

 

    // Search videos by tag
    const searchInput = document.getElementById("search-input");
    searchInput.addEventListener("input", (e) => {
        const searchQuery = e.target.value.trim().toLowerCase();
        console.log("Search input changed:", searchQuery);

        if (searchQuery) {
            searchingByTag = true;
            console.log("Searching by tag:", searchQuery);
            fetchVideoResumes(1, searchQuery);
        } else {
            searchingByTag = false;
            console.log("Not searching by tag");
            fetchVideoResumes();
        }
    });

    // Infinite Scroll
    window.addEventListener("scroll", () => {
       // console.log("Window scrolled:", window.innerHeight + window.scrollY);
        if (
            window.innerHeight + window.scrollY >= document.body.offsetHeight - 500 &&
            !searchingByTag
        ) {
            console.log("Fetching more videos due to scroll");
         //   fetchVideoResumes();
        }
    });
});

// Fetch Video Resumes with optional tag filter
async function fetchVideoResumes(page = 1, tagFilter = "") {
    const videoContainer = document.getElementById("video-reel-container");

    console.log("Fetching video resumes with page:", page, "and tag filter:", tagFilter);

    try {
        let videosQuery;
        const videosRef = collection(db, "VideoResumes");

        if (searchingByTag && tagFilter) {
            console.log("Querying by tag:", tagFilter);
            videosQuery = query(
                videosRef,
                where("tags", "array-contains", tagFilter),
                orderBy("timestamp", "desc"),
                limit(postsPerPage)
            );
        } else if (lastVisibleDoc) {
            console.log("Querying after last visible document");
            videosQuery = query(
                videosRef,
                where("status", "==", "posted"),
                orderBy("timestamp", "desc"),
                startAfter(lastVisibleDoc),
                limit(postsPerPage)
            );
        } else {
            console.log("Querying for first batch of videos");
            videosQuery = query(
                videosRef,
                where("status", "==", "posted"),
                orderBy("timestamp", "desc"),
                limit(postsPerPage)
            );
        }

        const querySnap = await getDocs(videosQuery);

        if (!querySnap.empty) {
            console.log("Videos found:", querySnap.docs.length);
            lastVisibleDoc = querySnap.docs[querySnap.docs.length - 1];
            renderVideos(querySnap.docs, videoContainer);
        } else if (page === 1) {
            console.log("No videos available");
            videoContainer.innerHTML = "<p>No video resumes available.</p>";
        }
    } catch (error) {
        console.error("Error fetching video resumes: ", error);
        videoContainer.innerHTML = "<p>Error loading videos. Please refresh the page or try again later.</p>";
    }

    console.log("fetchVideoResumes called. Page:", page);

}




     let page = 1;
let currentPage = 1;
let totalPosts = 0; // Track total number of posts
let firstVisibleDoc = null; // For backward navigation



// Fetch Video Resumes from Firestore
// Render Video Posts
function renderVideos(docs, container) {

  console.log("Rendering videos:", docs.length);

    docs.forEach((doc) => {
            const docId = doc.id; // Firestore Document ID
        // Check if this video is already in the container
        if (container.querySelector(`[data-doc-id="${docId}"]`)) {
            console.log(`Video with docId ${docId} already rendered. Skipping.`);
            return; // Skip rendering this video
        }

        const videoData = doc.data();

            console.log("docId   ",docId);
            console.log("videoData   ",videoData);

            
            let reelUserID = videoData.userID || '';
            let profilePicture = videoData.profilePicture || '';
            let displayName = videoData.displayName || '';

            // Build the video card dynamically with real data
            const videoCard = document.createElement("div");
            videoCard.className = "video-post";
            videoCard.dataset.docId = docId; // Add dataset attribute
            videoCard.dataset.timestamp = videoData.timestamp;
            videoCard.dataset.tags = videoData.tags || ''; // For search functionality
            videoCard.dataset.displayName = videoData.displayName || '';
            videoCard.dataset.position = videoData.position || '';
            videoCard.dataset.location = videoData.location || '';
            videoCard.dataset.verified = videoData.verified || '';
            videoCard.dataset.reelUserID = videoData.createdByID || '';
            videoCard.dataset.profilePicture = videoData.profilePicture || '';
            videoCard.dataset.duration = videoData.duration || 0;
            videoCard.dataset.likes = videoData.likes || 0;
            videoCard.dataset.loves = videoData.loves || 0;
            videoCard.dataset.createdByID = videoData.createdByID || '';
            videoCard.dataset.views = videoData.views || '';
            videoCard.dataset.profileURL = videoData.profileURL || '';
            generateVideoSchema(videoData, docId);

let videoDuration = parseFloat(videoData.duration.toFixed(2));
videoCard.innerHTML = `
  <div id="videoCard_${docId}" class="video-card">
    <div class="user-info">
      <div class="user-info-left">
        <img src="${videoData.profilePicture || 'https://reelcareer.co/images/sq_logo_n_BG_sm.png'}"
             alt="${videoData.displayName}" 
             class="profile-img lazy-image">
        <div class="user-details">
          <div class="name-badge">
          <a href="${videoData.profileURL}" aria-label="View ${videoData.displayName}'s profile">
            <h3 class="user-name">
              ${videoData.displayName || 'Anonymous'}
            </h3>
          </a>
<small class="badge ${videoData.verified ? 'badge-verified' : ''}">
  ${videoData.verified ? '<i class="fa fa-check-circle"></i>' : ''}
</small>
          </div>

          <p class="job-title">${videoData.position || ''}</p>
        </div>
      </div>
      <div class="user-info-right">

           
      <div class="interaction-buttons">
        <button class="message-button" data-doc-id="${docId}" aria-label="Message User">
          <i class="fa fa-envelope"></i> Message
        </button>
        <button class="connect-button" data-doc-id="${docId}" aria-label="Connect with User">
          <i class="fa fa-user-plus"></i> Connect
        </button>

      </div>
    

  
 
      </div>
    </div>

    <div class="video-container">
      <video class="video-element" poster="${videoData.thumbnailURL || ''}">
        <source src="${videoData.videoResumeURL}" type="video/mp4">
        Your browser does not support the video tag.
      </video>

      <!-- Custom Controls -->
      <button class="mute-toggle" data-doc-id="${docId}" aria-label="Mute or Unmute">
        <i class="fa fa-volume-up"></i>
      </button>

        <button class="reportVideoBtn " data-doc-id="${docId}" aria-label="Report Video">
          <i class="fa fa-flag"></i> 
        </button>
      <button class="fullscreen-toggle" aria-label="Enter Full Screen">
        <i class="fa fa-expand"></i>
      </button>
      <div class="play-overlay">
        <i class="fa fa-play"></i>
      </div>

          <div class="controls-container">
      <div class="actions">
        <button class="action-btn like-btn" data-doc-id="${docId}" aria-label="Like Video">
          <i class="fa fa-thumbs-up"></i> ${videoData.likes || 0}
        </button>


<div class="realCareerVidLogo action-btn "> ReelCareer</div>
      </div>
    </div>

    </div>



    <div class="caption-container">
      <p class="video-caption">${videoData.videoResumeCaptions || ''}</p>
    </div>
    <div class="tags-container">
    </div>

    <div class="video-details">
      <p class="views-count" aria-label="${videoData.views || 0} views">
        <i class="fa fa-play-circle"></i> ${videoData.views || 0} views
      </p>
            <p class="video-duration" aria-label="Video duration ${videoDuration || '--:--'}">
        <i class="fa fa-clock"></i> ${videoDuration || '--:--'}
      </p>
              <button class="add-user-button" data-doc-id="${docId}"  aria-label="Add to Shortlist">
          <i class="fa fa-plus"></i> Shortlist
        </button>

        <button class="share-btn" data-doc-id="${docId}" aria-label="Share Video">
          <i class="fa fa-share-alt"></i> 
        </button>
        <button class="comments-btn" data-doc-id="${docId}" aria-label="Video Comments">
          <i class="fas fa-comment"></i> </i> 
        </button>

    </div>



    <!-- Comment Section -->
<div id="comment-section-${docId}" class="comment-section">
    <div class="comment-input-container">
        <input type="text" id="comment-input-${docId}" placeholder="Add a comment..." aria-label="Add a comment" />
        <button class="btn btn-primary add-comment-btn" onclick="addComment('${docId}')" aria-label="Post Comment">
            <i class="fa fa-paper-plane"></i> 
        </button>
    </div>
    <div id="comments-container-${docId}" class="comments-container"></div>
</div>

  </div>
`;


container.appendChild(videoCard);


//console.log("Rendering video doc:", doc.data());




        // Add tags
        const tagsContainer = videoCard.querySelector(".tags-container");
        if (videoData.tags && Array.isArray(videoData.tags)) {
            videoData.tags.forEach((tag) => {
                const tagButton = document.createElement("button");
                tagButton.textContent = tag;
                tagButton.onclick = () => fetchVideoResumes(1, tag);
                tagsContainer.appendChild(tagButton);
            });
        }


        

            // Add event listeners for buttons
            const muteButton = videoCard.querySelector(".mute-toggle");
            const fullscreenButton = videoCard.querySelector(".fullscreen-toggle");
            const playButton = videoCard.querySelector(".play-overlay");

            const messageButton = videoCard.querySelector(".message-button");
            const connectButton = videoCard.querySelector(".connect-button");

            const addUserButton = videoCard.querySelector(".add-user-button");
            const likeButton = videoCard.querySelector(".like-btn");
            const reportVideoBtn = videoCard.querySelector(".reportVideoBtn");


            // Mute toggle functionality
            reportVideoBtn.addEventListener("click", () => openReportModal(docId));

            // Other button actions
            addUserButton.addEventListener("click", () => addToShortlist(docId));

  
            connectButton.addEventListener("click", () => handleConnect(docId, connectButton, profilePicture,reelUserID ,displayName));
            messageButton.addEventListener("click", () => sendMessage(docId , profilePicture,reelUserID, displayName,connectButton));
 
            



// After appending videoCard to container
const shareButton = videoCard.querySelector(".share-btn");
const commentButton = videoCard.querySelector(".add-comment-btn");
const commentsBtn = videoCard.querySelector(".comments-btn");

// Event Listeners
commentsBtn.addEventListener("click", () => handleComments(docId, commentsBtn));
likeButton.addEventListener("click", () => handleLike(docId, likeButton));
shareButton.addEventListener("click", () => handleShare(docId, videoData.videoResumeURL));
commentButton.addEventListener("click", () => addComment(docId));

// Increment view count when video is played
const videoElement = videoCard.querySelector(".video-element");
videoElement.addEventListener("play", () => incrementViewCount(docId));

const videos = document.querySelectorAll(".video-element"); 

videos.forEach((video) => {
  const container = video.parentElement;
  const muteButton = container.querySelector(".mute-toggle");
  const fullscreenButton = container.querySelector(".fullscreen-toggle");
  const playOverlay = container.querySelector(".play-overlay");

  // Play Overlay Click
  container.addEventListener("click", () => togglePlay(video, playOverlay));

  // Mute/Unmute
  muteButton.addEventListener("click", () => toggleMute(video, muteButton));

  // Fullscreen Toggle
  fullscreenButton.addEventListener("click", () => toggleFullscreen(video));
});

fetchComments(docId);

    });


}

function handleComments(docId, commentsBtn){

  const inputContainer = document.getElementById(`comments-container-${docId}`);
  inputContainer.classList.toggle("hidden");

}


function renderTags(tags, videoTags) {
        videoTags.innerHTML = ''; // Clear previous tags
        // Check if tags is defined and is an array
        if (!tags || tags.length === 0) {
            tags = videoTags;
        }
        if (Array.isArray(tags) && tags.length > 0) {
          tags.forEach(tag => {
            // Create a button element for each tag
            const button = document.createElement('button');
            button.className = 'btn btn-secondary m-1 tags'; // Bootstrap button styling
            button.textContent = tag;
            // Add a click event to redirect to job-listings with the selected tag
            button.onclick = () => {
showToast(`Tag ${tag} was clicked`);
            };
            // Append the button to the jobTags container
            videoTags.appendChild(button);
          });
        } else {
          // Optionally, display a message if no tags are available
          const noTagsMessage = document.createElement('span');
          noTagsMessage.textContent = 'No tags available.';
          noTagsMessage.className = 'text-muted'; // Optional styling
          videoTags.appendChild(noTagsMessage);
        }
      }
window.renderTags = renderTags;

// Function to handle Play/Pause with overlay
function togglePlay(video, playOverlay) {
  if (video.paused) {
    video.play();
    playOverlay.style.display = "none";
  } else {
    video.pause();
    playOverlay.style.display = "flex";
  }
}

// Function to toggle Mute/Unmute
function toggleMute(video, muteButton) {
  video.muted = !video.muted;
  muteButton.innerHTML = video.muted
    ? '<i class="fa fa-volume-mute"></i>'
    : '<i class="fa fa-volume-up"></i>';
}

// Function to handle Fullscreen
function toggleFullscreen(video, fullscreenButton) {
  if (video.requestFullscreen) {
    video.requestFullscreen();
  } else if (video.webkitRequestFullscreen) {
    video.webkitRequestFullscreen();
  } else if (video.msRequestFullscreen) {
    video.msRequestFullscreen();
  }
}









function handleJoinUsBtn(docId) {
    // Add further functionality as needed

    window.location = "https://reelcareer.co/views/auth";

}


function addToShortlist(docId, currentUid) {
  const userID = auth.currentUser.uid;

  // Example: Add the video to the user's shortlist (if they are logged in)
  if (userId) {
    const shortlistRef = collection(db, "Users",userId,"Shortlists");
    addDoc(shortlistRef, {
      userID: currentUid,
      videoID: docId,
      timestamp: new Date(),
    })
      .then(() => {
        showToast("Video added to your shortlist.");
      })
      .catch((error) => {
        console.error("Error adding to shortlist: ", error);
        showToast("Error adding video to shortlist.");
      });
  } else {
    showToast("Please log in to add to shortlist.");
  }
}



// Function to increment view count
async function incrementViewCount(docId) {
    const videoRef = doc(db, "VideoResumes", docId);

    try {
        await updateDoc(videoRef, {
            views: increment(1) // Firestore increment
        });
        console.log("View count incremented");
    } catch (error) {
        console.error("Error updating view count: ", error);
    }
}

// Function to handle likes
async function handleLike(docId, likeButton) {
    const videoRef = doc(db, "VideoResumes", docId);

    try {
        await updateDoc(videoRef, {
            likes: increment(1) // Firestore increment
        });

        // Update UI instantly
        let likesCount = parseInt(likeButton.textContent) || 0;
        likesCount++;
        likeButton.innerHTML = `<i class="fa fa-thumbs-up"></i> ${likesCount}`;
    } catch (error) {
        console.error("Error updating like count: ", error);
    }
}
async function handleShareCount(docId, shareButton) {
    const videoRef = doc(db, "VideoResumes", docId);

    try {
        await updateDoc(videoRef, {
            share: increment(1) // Firestore increment
        });

        // Update UI instantly
        let likesCount = parseInt(shareButton.textContent) || 0;
        shareButton++;
        shareButton.innerHTML = `<i class="fa fa-thumbs-up"></i> ${shareButton}`;
    } catch (error) {
        console.error("Error updating like count: ", error);
    }
}
// Function to format video duration to HH:MM:SS
function formatDuration(duration) {
  const seconds = Math.floor(duration % 60);
  const minutes = Math.floor((duration / 60) % 60);
  const hours = Math.floor(duration / 3600);

  return [
    hours > 0 ? hours.toString().padStart(2, "0") : "00",
    minutes.toString().padStart(2, "0"),
    seconds.toString().padStart(2, "0"),
  ]
    .filter((part) => part !== "00") // Remove leading zeros if hours are zero
    .join(":");
}


// Native Share Function
function handleShare(docId, videoUrl) {
    if (navigator.share) {
        navigator
            .share({
                title: "Check out this video resume!",
                text: "Watch this professional video resume on ReelCareer.",
                url: videoUrl
            })
            .then(() => showToast("Video shared successfully"), handleShareCount(docId, shareButton))
            .catch((error) => console.error("Error sharing video: ", error));
    } else {
        alert("Sharing not supported on this device.");
    }
}

// Add Comment Functionality
async function addComment(docId, parentCommentId = null) {
    const inputId = parentCommentId
        ? `reply-input-${parentCommentId}` 
        : `comment-input-${docId}`;
    const commentInput = document.getElementById(inputId);
    const commentText = commentInput.value.trim();
    const userDataSaved = getUserData() || [];
    const userID = auth.currentUser.uid;

    if (commentText) {
        const commentsRef = collection(db, "VideoResumes", docId, "comments");

        try {
            await addDoc(commentsRef, {
                text: commentText,
                commenterID: userID || userDataSaved.userId,
                commenterName: userDataSaved.displayName || "User",
                commenterProfileURL: `https://reelcareer.co/u/?u=${userID}`,
                commenterProfilePicture: userDataSaved.profilePicture || "https://reelcareer.co/images/sq_logo_n_BG_sm.png'",
                parentCommentId: parentCommentId || null, // Track parent comment
                timestamp: serverTimestamp()
            });

            // Clear input and refresh comments
            commentInput.value = "";
            fetchComments(docId);
        } catch (error) {
            console.error("Error adding comment: ", error);
        }
    }
}

window.addComment = addComment;


// Fetch and Display Comments
const loadedComments = new Set(); // Keeps track of loaded docIds

async function fetchComments(docId) {
    // Check if comments for this video have already been loaded
    if (loadedComments.has(docId)) {
        console.log(`Comments for ${docId} already loaded`);
        return; // Stop fetching to prevent duplication
    }

    loadedComments.add(docId); // Mark this docId as loaded

    const commentsRef = collection(db, "VideoResumes", docId, "comments");
    const querySnap = await getDocs(query(commentsRef, orderBy("timestamp", "asc")));

    const commentsContainer = document.getElementById(`comments-container-${docId}`);
    commentsContainer.innerHTML = ""; // Clear previous comments (if any)

    const commentsMap = {}; // For organizing comments by parent

    // Group comments by parentCommentId
    querySnap.forEach((doc) => {
        const comment = { id: doc.id, ...doc.data() };
        if (comment.parentCommentId) {
            commentsMap[comment.parentCommentId] = commentsMap[comment.parentCommentId] || [];
            commentsMap[comment.parentCommentId].push(comment);
        } else {
            commentsMap[comment.id] = commentsMap[comment.id] || [];
            commentsMap[comment.id].unshift(comment); // Main comment
        }
    });

    // Render comments
    Object.values(commentsMap).forEach((group) => {
        group.forEach((comment) => {
            if (!comment.parentCommentId) {
                renderComment(comment, docId, commentsMap, commentsContainer);
            }
        });
    });
}

/*
loadedComments.delete(docId); // To reload comments for a single video
loadedComments.clear();       // To reload comments for all videos
*/

const renderedComments = new Set(); // To keep track of rendered comments

function renderComment(comment, docId, commentsMap, container) {
    // Avoid rendering the same comment multiple times
    if (renderedComments.has(comment.id)) return;
    renderedComments.add(comment.id);

    const commentElement = document.createElement("div");
    commentElement.classList.add("comment-item");
    commentElement.innerHTML = `
        <div class="comment-main">

                      <div class="reply-commenter-area">
            <img src="${comment.commenterProfilePicture || `https://reelcareer.co/images/sq_logo_n_BG_sm.png` }" alt="${comment.commenterName}" class="comment-avatar lazy-image">
            <a href="${comment.commenterProfileURL}" class="comment-name">${comment.commenterName}</a>
            </div>

            <div class="comment-content">
            <div class="reply-text-area">${comment.text}</div>

            <div class="reply-btn-area">
                <button class="reply-btn" onclick="showReplyInput('${comment.id}', '${docId}','${comment.commenterName}')">
                    <i class="fa fa-reply"></i> Reply
                </button>
                </div>

                <div id="replies-container-${comment.id}"></div>
            </div>
        </div>

<hr>
<div  id="reply-input-area-${comment.id}" class="reply-input-area">
          <div id="reply-input-container-${comment.id}" class="reply-input-container" >
            <small id="reply-to-container-${comment.id}" class="reply-to-container">Reply to: ${comment.commenterName}</small> 
        </div>

            <div class="reply-send-area">
            <input type="text" id="reply-input-${comment.id}" placeholder="Write a reply..." />
            <button onclick="addComment('${docId}', '${comment.id}')" aria-label="Post Reply">
                <i class="fa fa-paper-plane"></i>
            </button>
            </div>

        </div>
    `;

    container.appendChild(commentElement);

    // Render replies (if any)
    if (commentsMap[comment.id]) {
        const repliesContainer = document.getElementById(`replies-container-${comment.id}`);
        commentsMap[comment.id].forEach((reply) => {
            renderComment(reply, docId, commentsMap, repliesContainer);
        });
    }
}




function showReplyInput(commentId, docID, commenterName ) {
  const replyInputArea = document.getElementById(`reply-input-area-${commentId}`);
 // replyInputArea.style.display = "block";

  replyInputArea.classList.toggle("hidden");

}

window.showReplyInput = showReplyInput;

  
  async function submitReport() {
    const selectedReasons = [];
    document.querySelectorAll('#reportJobForm input[type="checkbox"]:checked').forEach((checkbox) => {
        selectedReasons.push(checkbox.value);
    });

    const userDataSaved = getUserData() || [];
    const message = document.getElementById('reportMessage').value;
    const statusMessage = document.getElementById('reportStatusMessage');
    const closeButton = document.getElementById('closeReportModalButton');

    // Clear any previous messages
    statusMessage.innerHTML = '';
    statusMessage.className = '';

    if (selectedReasons.length === 0 && !message) {
        statusMessage.innerHTML = 'Please select a reason or enter a message before submitting.';
        statusMessage.className = 'text-danger';
        return;
    }
    // Report Data to Firebase
    const reportData = {
        videoId: document.getElementById('currentVideoId').innerText,
        jobTitle: document.title,
        reasons: selectedReasons,
        message: message,
        URL: window.location.href,
        submittedAt: new Date().toISOString(),
        timestamp: serverTimestamp(),
        submittedBy: "user",
        submittedByUserID: userID,
        submittedByUserName: userDataSaved.displayName || "User",
        type: "User Report",
        pageTitle: document.title,
        status: "submitted"
    };

    // Create content for the follow-up message
    const reasonsContent = selectedReasons.length > 0 ? `Reasons: ${selectedReasons.join(', ')}` : '';
    const followUpMessageContent = `
        Thank you for reporting this issue. Our support team will follow up shortly. 

        ${reasonsContent}

        From ReelCareer
    `;

    // Follow-up Message Data
    const followUpMessage = {
        recipientID: userID,
        recipientName: userDataSaved.displayName || "User",
        recipientProfileURL: `https://reelcareer.co/u/?u=${userID}`,
        recipientProfilePicture: "",
        recipientRead: false,
        participants: ["000000", userID],
        senderID: "000000", // Support account ID
        senderName: "Support",
        senderProfilePicture: "https://reelcareer.co/Images/logo.png",
        senderProfileURL: "https://reelcareer.co/support",
        group: "main",
        messageType: "support",
        contactLocation: "platform",
        conversationID: `conversation_${jobID}_${userID}`,
        content: followUpMessageContent.trim(),
        connectedBool: true,
        createdAt: new Date(),
        timestamp: serverTimestamp(),
        contentType: "notification",
        status: "unread",
        attachments: ""
    };

    try {

      
        // Submit the report
        const reportRef = await addDoc(collection(db, 'SupportTickets'), reportData);
        showToast(`Report submitted with ID: ${reportRef.id}`);

        // Send the follow-up message
        await addDoc(collection(db, "Messages"), followUpMessage);
        console.log("Follow-up message sent successfully!");

        // Show success message to user
        statusMessage.innerHTML = 'Your report has been submitted. Thank you for your feedback.';
        statusMessage.className = 'text-success';
        closeButton.style.display = 'block';

        // Disable submit button after success
        document.querySelector('#reportJobForm button[type="button"]').disabled = true;

    } catch (error) {
        console.error("Error submitting report or follow-up message:", error);

        statusMessage.innerHTML = 'There was an error submitting your report. Please try again later.';
        statusMessage.className = 'text-danger';
    } finally {

    }
}
function openReportModal(videoId) {
  document.getElementById('currentVideoId').innerText = videoId;
    document.getElementById('reportJobModal').style.display = 'block'; // No need for !important
}

// Close the report job modal
function closeReportModal() {
    document.getElementById('reportJobModal').style.display = 'none'; // No need for !important
}

// Attach the modal open/close functions to the global window object
window.openReportModal = openReportModal;
window.closeReportModal = closeReportModal;


// Get elements for modal interactions
const closeModal = document.querySelector('.close');
const cancelBtn = document.getElementById('closeReportModalButton');
const modal = document.getElementById('applicationModal');

// Close modal on clicking the close button (X)
if (closeModal) {
    closeModal.addEventListener('click', function() {
        modal.style.display = 'none'; // No need for !important
    });
}

// Close modal on clicking the cancel button
if (cancelBtn) {
    cancelBtn.addEventListener('click', function() {
        modal.style.display = 'none'; // No need for !important
    });
}
window.closeReportModal = closeReportModal;

window.submitReport = submitReport;






   
function generateVideoSchema(videoData, docId) {
    // Convert Firebase Timestamp to JavaScript Date
    const uploadDate = videoData.createdAt 
        ? new Date(videoData.createdAt.seconds * 1000) // Convert seconds to milliseconds
        : new Date(); // Fallback to current date if createdAt is missing

    return {
        "@context": "https://schema.org",
        "@type": "VideoObject",
        "name": videoData.name || "Video Resume",
        "description": videoData.videoResumeCaptions || "",
        "thumbnailUrl": videoData.thumbnailURL || "",
        "contentUrl": videoData.videoResumeURL,
        "uploadDate": uploadDate.toISOString(), // Call toISOString on a valid Date object
        "duration": videoData.duration || "",
        "interactionStatistic": {
            "@type": "InteractionCounter",
            "interactionType": { "@type": "http://schema.org/WatchAction" },
            "userInteractionCount": videoData.views || 0
        }
    };
}


















        function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }  
    

    

    

// Retrieve and populate form inputs for tabs
window.onload = async function () {
    try {
        userId = await getUserId(); // Attempt to fetch user ID
        if (!userId) {
         //   throw new Error("User ID is null or undefined.");
        }
    } catch (error) {
      //  console.error("Error fetching user ID:", error);
        userId = null; // Explicitly set userId to null if it fails
    }

    const userDataSaved = getUserData() || [];

    setTimeout(() => {
        console.log("Module User We outside:", userId);
        console.log("userDataSaved We outside:", userDataSaved);

   

        // DOM elements
        const lastBreadcrumb_last = document.getElementById("lastBreadcrumb_last");
   
        
        const breadcrumbTitleActive = document.getElementById("breadcrumb-active-title");

        const lastBreadcrumb_messages = document.getElementById("lastBreadcrumb_messages");
        const lastBreadcrumb_profile = document.getElementById("lastBreadcrumb_profile");
        const lastBreadcrumb_last_create = document.getElementById("lastBreadcrumb_create");
        const lastBreadcrumb_join = document.getElementById("lastBreadcrumb_join");

  
        

        if (!userId) {
            console.log("No user.");
            lastBreadcrumb_messages.style.display = "none";
            lastBreadcrumb_profile.style.display = "none";
            lastBreadcrumb_last_create.style.display = "none";
            lastBreadcrumb_join.style.display = "block";

            breadcrumbTitleActive.style.display = "none";

            fetchVideoResumes(1, ''); // Call with empty userId
        }else{
          document.title = `ReelCareer.co | Welcome ${userDataSaved.displayName || "User"}`;

          lastBreadcrumb_messages.style.display = "block";
          lastBreadcrumb_profile.style.display = "block";
          lastBreadcrumb_last_create.style.display = "block";
          lastBreadcrumb_join.style.display = "none";

          breadcrumbTitleActive.style.display = "block";
          breadcrumbTitleActive.innerText = userDataSaved.displayName || "User";

        // Fetch video resumes for valid userId
        fetchVideoResumes(1, userId);
        }






    }, 300);
};

      
    

async function handleConnect(docId, connectButton , viewProfilePicture, viewUserID, viewDisplayName) {
    showToast(`connectButton post ID: ${docId}`);

    



  try {
    // Fetch required data
    const userID = auth.currentUser.uid;

  //  const userId = getUserId(); // Logged-in user
    const userDataSaved = await getUserData() || {};
    const toName = viewDisplayName;
    const toProfilePicture = viewProfilePicture;

    // Validate inputs
    if (!userID || !viewUserID) {
      showToast('User information is incomplete.');
      return;
    }

    if (userID === viewUserID) {
      showToast('You cannot connect with yourself.');
      return;
    }

    // Construct document ID
    const docId = `${viewUserID}_${userId}`;
    const connectionRef = doc(db, 'Connections', docId);

    // Update button state
    connectButton.disabled = true;
    connectButton.innerText = 'Sending...';

    // Prepare and save connection data
    const connectionData = {
    from: userId,
    to: viewUserID,
    toProfilePicture: toProfilePicture || 'https://reelcareer.co/images/sq_logo_n_BG_tie_reel.png',
    toName: toName,
    toProfileURL: `https://reelcareer.co/u/?u=${viewUserID}`,
    toGroup: 'Networking',

    acceptDate: '',
    participants: [userId, viewUserID], // Add this array
    status: 'pending',
    createdAt: new Date(),
    fromGroup: 'Networking',
    fromNote: '',
    fromName: userDataSaved.displayName,
    fromProfilePicture: userDataSaved.profilePicture || 'https://reelcareer.co/images/sq_logo_n_BG_tie_reel.png',
    fromProfileURL: `https://reelcareer.co/u/?/u=${userId}`
};

await setDoc(connectionRef, connectionData);


    // Update button and notify user
    connectButton.innerText = 'Pending';
    showToast('Connection request sent!');
  } catch (error) {
    console.error('Error sending connection request:', error);

    connectButton.innerText = 'Connect';
    showToast('Error sending connection request. Please try again.');
  } finally {
    connectButton.disabled = false;
  }
};



// Utility Function: Update Button State
function updateButtonState(button, text, disable = false) {
    button.innerText = text;
    button.disabled = disable;
}








function sendMessage(docId , profilePicture,reelUserID, recipientName,connectBtn) {

  
    

  
    
  

    setRecipientName(recipientName);

    

    const senderID = auth.currentUser.uid;

   console.log("recipientName: ", recipientName);
   console.log("reelUserID: ", reelUserID);


    console.log("senderID: ", senderID);

    if (senderID !== reelUserID) {
        document.getElementById('recipient-id').value = reelUserID; // Set recipient ID

 
        $('#sendMessageModal').modal('show'); // Show modal
    } else {
        showToast('You cannot send a message to yourself.');
    }













};


// Sync content from editable div to hidden textarea
document.getElementById('message-content-editable').addEventListener('keyup', function () {
  const content = this.innerText.trim();
  document.getElementById('message-content').value = content;
  toggleSendButton(content);
});



// Show recipient's name
function setRecipientName(recipientName) {
  document.getElementById('recipient-name').textContent = `Message to: ${recipientName}`;
}





// Enable/disable Send button
function toggleSendButton(content) {
  const attachment = document.getElementById('message-attachments').files[0];
  const sendButton = document.querySelector('#sendMessageForm button[type="submit"]');
  sendButton.disabled = !(content || attachment);
}



// Your form submission logic
document.getElementById('sendMessageForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    // Gather recipient and sender data

    const recipientID = document.getElementById('recipient-id').value;
    const senderID = auth.currentUser.uid;
    const content = document.getElementById('message-content').value.trim();
    const connectBtn = document.getElementById('connect-btn');

    const userDataSaved = getUserData() || {};
    const connectedBool = connectBtn.innerText === "Connected";

   
  // Get the video card by its ID    
  const currentVideoId = document.getElementById('currentVideoId').innerText;
const videoCard = document.getElementById(`videoCard_${currentVideoId}`);

// Access the dataset attributes
const docId = videoCard.dataset.docId;
const timestamp = videoCard.dataset.timestamp;
const tags = videoCard.dataset.tags;
const displayName = videoCard.dataset.displayName;
const position = videoCard.dataset.position;
const location = videoCard.dataset.location;
const verified = videoCard.dataset.verified;
const reelUserID = videoCard.dataset.reelUserId; // Note: 'reel-user-i-d' translates to 'reelUserId'
const profilePicture = videoCard.dataset.profilePicture;
const duration = videoCard.dataset.duration;
const likes = videoCard.dataset.likes;
const loves = videoCard.dataset.loves;
const userID = videoCard.dataset.userId; // 'user-i-d' becomes 'userId'
const views = videoCard.dataset.views;

// Log the retrieved data
console.log({
  docId,
  timestamp,
  tags,
  displayName,
  position,
  location,
  verified,
  reelUserID,
  profilePicture,
  duration,
  likes,
  loves,
  userID,
  views
});


    console.log("senderID: ", senderID);

    // Construct message data
    const messageData = {
        recipientID,
        recipientName,
        recipientProfilePicture,
        recipientProfileURL: `https://reelcareer.co/u?u=${recipientID}`,
        senderID: userDataSaved.userID || senderID,
        senderName: userDataSaved.displayName,
        senderProfilePicture: userDataSaved.profilePicture,
        senderProfileURL: `https://reelcareer.co/u?u=${userDataSaved.userID}`,
        group: 'main',
        messageType: 'contact',
        contactLocation: 'video reel',
        participants: [userDataSaved.userID || senderID, recipientID],
        conversationID: recipientID,
        content,
        connectedBool,
        createdAt: new Date(),
        timestamp: serverTimestamp(),
        contentType: "text",
        status: 'unread',
        attachments:  '',
        attachmentUrl,
        isDeleted: false,
    };

    try {
        const messagesCollection = collection(db, 'Messages');
        await addDoc(messagesCollection, messageData);

        showToast('Message sent successfully!');
        $('#sendMessageModal').modal('hide');
        document.getElementById('message-content').value = '';
    } catch (error) {
        console.error('Error sending message:', error);
        showToast('Failed to send message. Please try again.');
    }
});





    </script>


    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
