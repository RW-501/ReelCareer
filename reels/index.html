<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Explore video resumes from job seekers. Browse candidates' video profiles and interact with them.">
  
  <meta name="keywords" content="career blog, job search tips, career advice, job market insights, employment tips, career growth, resume tips, interview advice, professional development, job seekers">
  <meta name="author" content="ReelCareer">
  <meta name="robots" content="index, follow">
  <meta name="language" content="en">
  <meta name="geo.region" content="US-TX">
  <meta name="geo.placename" content="Dallas, Texas">

  <!-- Title optimized for Video Reel page -->
  <title>Video Reel - Job Board | ReelCareer</title>

  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Video Reel - Job Board | ReelCareer">
  <meta property="og:description" content="Browse job seekers' video resumes, interact with candidates, and find the right fit for your company.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.reelcareer.co/reels">
  <meta property="og:image" content="https://www.reelcareer.co/images/sq_logo_n_BG_tie_reelx.png">
  <meta property="og:site_name" content="ReelCareer">
  <meta property="og:locale" content="en_US">

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@ReelCareer">
  <meta name="twitter:title" content="Video Reel - Job Board | ReelCareer">
  <meta name="twitter:description" content="Explore video resumes from job seekers and find the perfect candidate for your role on ReelCareer.">
  <meta name="twitter:image" content="https://www.reelcareer.co/images/sq_logo_n_BG_tie_reelx.png">

  <!-- Canonical Tag for SEO -->
  <link rel="canonical" href="https://www.reelcareer.co/reels">

  <!-- Standard Favicon -->
  <link rel="icon" type="image/x-icon" href="https://www.ReelCareer.co/images/favicons/favicon.ico">

  <!-- 32x32 Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://www.ReelCareer.co/images/favicons/favicon-32x32.png">

  <!-- 16x16 Favicon -->
  <link rel="icon" type="image/png" sizes="16x16" href="https://www.ReelCareer.co/images/favicons/favicon-16x16.png">

  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" sizes="180x180" href="https://www.ReelCareer.co/images/favicons/apple-touch-icon.png">

  <!-- Android Favicon (192x192) -->
  <link rel="icon" type="image/png" sizes="192x192" href="https://www.ReelCareer.co/images/favicons/android-chrome-192x192.png">

  <!-- Chrome Favicon (512x512) -->
  <link rel="icon" type="image/png" sizes="512x512" href="https://www.ReelCareer.co/images/favicons/android-chrome-512x512.png">

   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<!--
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
-->
  
   <!-- Bootstrap CSS -->
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <script src="https://reelcareer.co/public/js/scripts.js"></script>
    <script src="https://reelcareer.co/public/js/loadScripts.js"></script>
   
     
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">

    <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
  />

   
    <link rel="stylesheet" href="https://reelcareer.co/public/css/styles.css">
   
   
   
   <style>
    
/* Base styles */



.sticky-header {
  position: sticky;
  top: 0;
  background-color: #ffffff;
  padding: 1rem;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.sticky-header nav ul {
  display: flex;
  justify-content: space-around;
  list-style: none;
}

.sticky-header nav ul li a {
  font-size: 1.2rem;
  font-weight: 500;
}

.sticky-footer {
  background-color: #222;
  color: white;
  text-align: center;
  padding: 1rem;
  position: fixed;
  bottom: 0;
  width: 100%;
}

.video-reel-container {
  display: flex;
  flex-direction: column;
  gap: 20px;
  padding: 20px;
}

/* Video Card Styles */
.video-card {
    background-color: #e3ebf0;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    transition: transform 0.3s ease;
    /* padding: 0.5rem; */
    border: aliceblue solid;
}



.video-card:hover {
  transform: scale(1.02);
}

.user-info {
  display: flex;
  padding: 10px;
  gap: 10px;
  align-items: center;
}

.profile-img {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  object-fit: cover;
}

.user-details {
  display: flex;
  flex-direction: column;
}

.user-name {
  font-size: 1.1rem;
  font-weight: 700;
}

.job-title {
  font-size: 0.9rem;
  color: #555;
}

.video-container {
  position: relative;
}

.video-element {
  width: 100%;
  height: auto;
  max-height: 400px;
  background-color: #000;
}

.mute-toggle {
  position: absolute;
  top: 10px;
  right: 10px;
  background-color: rgba(0, 0, 0, 0.5);
  color: white;
  border: none;
  padding: 5px 10px;
  border-radius: 5px;
  cursor: pointer;
}

.mute-toggle:hover {
  background-color: rgba(0, 0, 0, 0.7);
}

.caption-container {
  padding: 10px;
  font-size: 1rem;
  color: #333;
}

.video-caption {
  margin: 0;
}

.interaction-buttons {
  display: flex;
  gap: 15px;
  justify-content: space-between;
  padding: 10px;
}

.message-button, .add-user-button {
  background-color: #007bff;
  color: white;
  border: none;
  padding: 10px 15px;
  font-size: 1rem;
  cursor: pointer;
  border-radius: 5px;
  transition: background-color 0.3s;
}

.message-button:hover, .add-user-button:hover {
  background-color: #0056b3;
}

/* Responsive Design */
@media (max-width: 768px) {
  .video-reel-container {
    padding: 10px;
  }

  .video-card {
    width: 100%;
  }

  .user-info {
    flex-direction: column;
    align-items: flex-start;
  }

  .user-name {
    font-size: 1.3rem;
  }

  .job-title {
    font-size: 1rem;
  }

  .message-button, .add-user-button {
    font-size: 0.9rem;
    padding: 8px 12px;
  }

  .video-container {
    max-height: 300px;
  }
}

@media (max-width: 480px) {
  .video-card {
    padding: 10px;
  }
}
/*
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++


*/
    
.video-reel-container {
    width: 100%;
    max-width: 640px;
    margin: 0 auto;
    background-color: transparent;
 
    padding: 10px;
    border-radius: 10px;
}

.video-player-container {
    width: 100%;
    height: 360px;
    margin-bottom: 10px;
    background-color: #333;
    border-radius: 10px;
}

.video-player {
    width: 100%;
    height: 100%;
    border-radius: 10px;
}

.controls-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 10px;
}

.actions {
    display: flex;
    justify-content: space-around;
    width: 100%;
    margin-bottom: 10px;
}

.action-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
}

.action-btn:hover {
    color: #1d72b8;
}

.video-details {
    display: flex;
    justify-content: space-between;
    width: 100%;
    margin-bottom: 10px;
    padding: .5rem;
    color: #84bbd9;
}
.video-details p {
    margin: 0;
    font-size: 14px;
}

.video-upload-section {
    display: flex;
    justify-content: center;
    width: 100%;
    margin-top: 10px;
}

#uploadButton {
    background-color: #1d72b8;
    color: white;
    border: none;
    padding: 10px;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
}

#uploadButton:hover {
    background-color: #155a8a;
}

        </style>
        
        </style>
</head>


<body>
    <script src="https://reelcareer.co/public/js/bodyload.js"></script>
    <nav></nav>

    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
          <li id="lastBreadcrumb_profile" class="breadcrumb-item"><a id="homeBreadcrumb_a" href="https://reelcareer.co">Home</a></li>
          <li id="lastBreadcrumb_messages" class="breadcrumb-item"><a href="https://reelcareer.co/u/messaging">Messages</a></li>
          <li id="lastBreadcrumb_last" class="breadcrumb-item"><a id="lastBreadcrumb_a" href="https://reelcareer.co/u/create">Create Reel</a></li>
          <li id="breadcrumb-active-title" class="breadcrumb-item active" aria-current="page">User</li>
        </ol>
    </nav>



      <main id="main-content">
      
          <header class="sticky-header" hidden>
            <nav>
              <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/jobs">Jobs</a></li>
                <li><a href="/reels/">Video Reel</a></li>
                <li><a href="/u/">Profile</a></li>
              </ul>
            </nav>
          </header>
        


          <section id="video-reel-container" class="video-reel-container">
            <!-- Repeat similar structure for other video cards -->

            <div class="video-card" id="video1">
              <div class="user-info">
                <img src="https://reelcareer.co/images/sq_logo_n_BG_sm.png" alt="User 1" class="profile-img">
                <div class="user-details">
                  <h3 class="user-name">John Doe</h3>
                  <p class="job-title">Software Engineer</p>
                </div>
              </div>
        
              <div class="video-container">
                <video controls class="video-element" poster="https://reelcareer.co/images/sq_logo_n_BG_sm.png">
                  <source src="https://reelcareer.co/images/intro.MP4" type="video/mp4">
                  Your browser does not support the video tag.
                </video>
                <button class="mute-toggle">Mute</button>
              </div>
        
              <div class="video-details">
                <p class="views-count"><i class="fa fa-eye"></i> 5000 views</p>
                <p class="video-duration"><i class="fa fa-clock"></i> 3:20</p>
            </div>

              <div class="caption-container">
                <p class="video-caption">Experienced software engineer with a passion for building innovative applications. #JavaScript #React #SoftwareEngineer</p>
              </div>
        
              <div class="interaction-buttons">
                <button class="message-button">Message</button>
                <button class="add-user-button">Add to Shortlist</button>
              </div>
              <div class="controls-container">
                <div class="actions">
                    <button class="action-btn" id="likeButton"><i class="fa fa-thumbs-up"></i></button>
                    <button class="action-btn" id="commentButton"><i class="fa fa-comment"></i></button>
                    <button class="action-btn" id="shareButton"><i class="fa fa-share-alt"></i></button>
                    <button class="action-btn" id="downloadButton" disabled><i class="fa fa-download"></i></button>
                </div>
                </div>

            </div>

          </section>



            <div  class="video-reel-container" hidden>
              <div class="video-player-container">
                  <video id="videoPlayer" class="video-player" controls></video>
              </div>
          
              <div class="controls-container">
                  <div class="actions">
                      <button class="action-btn" id="likeButton"><i class="fa fa-thumbs-up"></i></button>
                      <button class="action-btn" id="commentButton"><i class="fa fa-comment"></i></button>
                      <button class="action-btn" id="shareButton"><i class="fa fa-share-alt"></i></button>
                      <button class="action-btn" id="downloadButton" disabled><i class="fa fa-download"></i></button>
                  </div>
          
                  <div class="video-details">
                      <p class="views-count"><i class="fa fa-eye"></i> 5000 views</p>
                      <p class="video-duration"><i class="fa fa-clock"></i> 3:20</p>
                  </div>
          
                  <div class="video-upload-section">
                      <input type="file" id="videoInput" accept="video/*" style="display:none;">
                      <button id="uploadButton"><i class="fa fa-upload"></i> Upload</button>
                  </div>
              </div>
          </div>





          <div class="modal fade" id="sendMessageModal" tabindex="-1" aria-labelledby="sendMessageModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <div class="modal-header border-0">
                  <h5 class="modal-title" id="sendMessageModalLabel">
                    <span id="recipient-name">Send Message</span>
                  </h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <form id="sendMessageForm">
                    <!-- Editable Message Area -->
                    <div class="message-input-attachment-btn-wrap">
                      <label for="message-content-editable">Message</label>
    
                      <div class="message-input-area">
                      <div
                        id="message-content-editable"
                        class="message-content-area"
                        contenteditable="true"
                        data-placeholder="Type your message here..."
                      ></div>
    
    
               <!-- Attachment Preview -->
               <div id="attachment-preview" class="mt-3 d-none">
                <div class="attachment-area align-items-center">
                  <video id="attachmentVideo" class="d-none attachment-thumbnail" controls src=""></video>
                  <img id="attachment-thumbnail" class="d-none attachment-thumbnail" src="" alt="Attachment preview" width="50" class="mr-2">
                  <button type="button" id="remove-attachment" class="btn btn-sm btn-danger">X</button>
              </div>
              </div>
    
                      </div>
    
                <!-- Attachment Section -->
                <div class="attachment-container">
                  <div class="mt-3">
                  <button type="button" id="attachment-btn" class="btn btn-outline-primary">
                    <i class="fas fa-paperclip"></i> Choose File
                  </button>
                </div>
    
               <!-- Submit Button -->
               <div class="mt-3">
                <button type="submit" class="btn btn-primary mt-3">Send</button>
              </div>
    
    
                </div>
                    </div>
    
    
    
    
    
    
                    <span id="attachment-name" class="mr-2" hidden></span>
    
                    <input type="hidden" id="recipient-id" value="">
                    <input type="file" id="message-attachments" class="d-none" />
    
                      <!-- Hidden Textarea to Sync Content -->
                      <textarea id="message-content" class="d-none"></textarea>
        
          
         
          
                  </form>
                </div>
              </div>
            </div>
          </div>
          


      
        
    </main>

    <!-- Footer -->
    <footer id="dynamic-footer"></footer>
    
    <!-- Firebase configuration/ Login& Out -->
    <script type="module" src="https://reelcareer.co/public/js/main.js"></script> 

   
    

    <!-- Firebase JS SDK and Custom Scripts -->

    <script type="module">
    import {
        db, getStorage, ref, uploadBytes, getDownloadURL, limit,
  doc, arrayUnion, RecaptchaVerifier, increment, getDoc, arrayRemove, signInWithPhoneNumber,
  query, updateDoc, setDoc, addDoc, signInAnonymously, orderBy, onAuthStateChanged,
  uploadBytesResumable, signInWithPopup, FacebookAuthProvider, GoogleAuthProvider, startAfter,
  OAuthProvider, signOut, deleteDoc, getFirestore, serverTimestamp,
  createUserWithEmailAndPassword, signInWithEmailAndPassword, deleteObject,
  where, getDocs, storage, getAuth, collection, auth, analytics,
  googleProvider,onSnapshot ,
  facebookProvider,
  getUserId // Export the function
    } from 'https://reelcareer.co/js/module.js';







        let page = 1;
let postsPerPage = 10; // Define your posts per page
let currentPage = 1;
let totalPosts = 0; // Track total number of posts
let lastVisibleDoc = null; // For pagination tracking (Firestore pagination)
let firstVisibleDoc = null; // For backward navigation



// Fetch Video Resumes from Firestore
async function fetchVideoResumes(page, user) {
    try {
        const videoContainer = document.getElementById("video-reel-container");
        videoContainer.innerHTML = ""; // Clear existing posts

        let videosQuery;
        const videosRef = collection(db, "VideoResumes");

        // Handle Firestore pagination
        if (page > 1 && lastVisibleDoc) {
            videosQuery = query(
                videosRef,
                where("status", "==", "posted"),
                startAfter(lastVisibleDoc),
                limit(postsPerPage)
            );
        } else {
            videosQuery = query(videosRef, where("status", "==", "posted"), limit(postsPerPage));
        }

        const querySnap = await getDocs(videosQuery);
        if (querySnap.empty) {
            videoContainer.innerHTML = "<p>No video resumes available.</p>";
            return;
        }

        const querySnapshot = querySnap.docs;
        firstVisibleDoc = querySnapshot[0];
        lastVisibleDoc = querySnapshot[querySnapshot.length - 1];

        querySnapshot.forEach((doc) => {
            const videoData = doc.data();
            const docId = doc.id; // Firestore Document ID

            console.log("docId   ",docId);
            console.log("videoData   ",videoData);

            let reelUserID = videoData.userID || '';
            let profilePicture = videoData.profilePicture || '';
            let displayName = videoData.displayName || '';

            // Build the video card dynamically with real data
            const videoCard = document.createElement("div");
            videoCard.className = "video-post";
            videoCard.dataset.docId = docId; // Add dataset attribute
            videoCard.dataset.tags = videoData.tags || ''; // For search functionality
            videoCard.dataset.displayName = videoData.displayName || '';
            videoCard.dataset.position = videoData.position || '';
            videoCard.dataset.location = videoData.location || '';
            videoCard.dataset.verified = videoData.verified || '';
            videoCard.dataset.reelUserID = videoData.userID || '';
            videoCard.dataset.profilePicture = videoData.profilePicture || '';
            generateVideoSchema(videoData, docId);


            videoCard.innerHTML = `
                <div id="videoCard_${docId}" class="video-card">
                    <div class="user-info">
                        <img src="${videoData.profilePicture || 'https://reelcareer.co/images/sq_logo_n_BG_sm.png'}"
                             alt="${videoData.displayName}" 
                             class="profile-img lazy-load-image">
                        <div class="user-details">
                            <h3 class="user-name">${videoData.displayName || 'Anonymous'} 
                              <small class="badge">${videoData.verified}</small </h3>
                            <p class="job-title">${videoData.position || 'Not Specified'}</p>
                        </div>
                    </div>

                    <div class="video-container">
                        <video controls class="video-element" poster="${videoData.thumbnailURL || ''}">
                            <source src="${videoData.videoResumeURL}" type="${videoData.fileType || 'video/mp4'}">
                            Your browser does not support the video tag.
                        </video>
                        <button class="mute-toggle" data-doc-id="${docId}">Mute</button>
                    </div>

                    <div class="video-details">
                        <p class="views-count"><i class="fa fa-eye"></i> ${videoData.views || 0} views</p>
                        <p class="video-duration"><i class="fa fa-clock"></i> ${videoData.duration || '--:--'}</p>
                    </div>

                    <div class="caption-container">
                        <p class="video-caption">${videoData.videoResumeCaptions || ''}</p>
                    </div>
 ${user ? ` 
                    <div class="interaction-buttons">
                      <button class="message-button" data-doc-id="${docId}">Message</button>
                        <button class="connect-button" data-doc-id="${docId}">Connect</button>
                        <button class="add-user-button" data-doc-id="${docId}" hidden>Add to Shortlist</button>
                    </div>
` : `                  <div class="interaction-buttons">
                      <button class="join-us-button" data-doc-id="${docId}">Join Us</button>

                    </div>
                    
                    `}
                    <div class="controls-container">
                        <div class="actions">
                            <button class="action-btn like-btn" data-doc-id="${docId}">
                                <i class="fa fa-thumbs-up"></i> ${videoData.likes || 0}
                            </button>
                            <button class="action-btn comment-btn" data-doc-id="${docId}">
                                <i class="fa fa-comment"></i> Comment
                            </button>
                            <button class="action-btn share-btn" data-doc-id="${docId}">
                                <i class="fa fa-share-alt"></i> Share
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for buttons
            const muteButton = videoCard.querySelector(".mute-toggle");
            const messageButton = videoCard.querySelector(".message-button");
            const connectButton = videoCard.querySelector(".connect-button");
            const joinUsButton = videoCard.querySelector(".join-us-button");
            const addUserButton = videoCard.querySelector(".add-user-button");
            const likeButton = videoCard.querySelector(".like-btn");
if(user){
            // Mute toggle functionality
            muteButton.addEventListener("click", () => toggleMute(docId));

            // Other button actions
            addUserButton.addEventListener("click", () => addToShortlist(docId));
            likeButton.addEventListener("click", () => handleLike(docId, likeButton));

  
            connectButton.addEventListener("click", () => handleConnect(docId, connectButton, profilePicture,reelUserID ,displayName));
            messageButton.addEventListener("click", () => sendMessage(docId , profilePicture,reelUserID, displayName));
}else{
  joinUsButton.addEventListener("click", () => handleJoinUsBtn(docId));


}

            videoContainer.appendChild(videoCard);
        });

   
        

    } catch (error) {
        console.error("Error fetching video resumes: ", error);
        document.getElementById("video-reel-container").innerHTML = "<p>Error fetching video resumes. Please try again later.</p>";
    }
}

// Functions for button actions
function toggleMute(docId) {
    const videoElement = document.querySelector(`#videoCard_${docId} .video-element`);
    if (videoElement) {
        videoElement.muted = !videoElement.muted;
    }
}
function handleJoinUsBtn(docId) {
    // Add further functionality as needed

    window.location = "https://reelcareer.co/views/auth";

}


function addToShortlist(docId) {
    alert(`Added to shortlist for post ID: ${docId}`);
    // Add further functionality as needed
}

function handleLike(docId, likeButton) {
    alert(`Liked post ID: ${docId}`);
    // Example: Increment likes count visually
    let likesCount = parseInt(likeButton.textContent) || 0;
    likesCount++;
    likeButton.innerHTML = `<i class="fa fa-thumbs-up"></i> ${likesCount}`;
}


function generateVideoSchema(videoData, docId) {
    // Convert Firebase Timestamp to JavaScript Date
    const uploadDate = videoData.createdAt 
        ? new Date(videoData.createdAt.seconds * 1000) // Convert seconds to milliseconds
        : new Date(); // Fallback to current date if createdAt is missing

    return {
        "@context": "https://schema.org",
        "@type": "VideoObject",
        "name": videoData.name || "Video Resume",
        "description": videoData.videoResumeCaptions || "",
        "thumbnailUrl": videoData.thumbnailURL || "",
        "contentUrl": videoData.videoResumeURL,
        "uploadDate": uploadDate.toISOString(), // Call toISOString on a valid Date object
        "duration": videoData.duration || "",
        "interactionStatistic": {
            "@type": "InteractionCounter",
            "interactionType": { "@type": "http://schema.org/WatchAction" },
            "userInteractionCount": videoData.views || 0
        }
    };
}


















        function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }  
    

    let userId;

// Retrieve and populate form inputs for tabs
window.onload = async function () {
    try {
        userId = await getUserId(); // Attempt to fetch user ID
        if (!userId) {
         //   throw new Error("User ID is null or undefined.");
        }
    } catch (error) {
      //  console.error("Error fetching user ID:", error);
        userId = null; // Explicitly set userId to null if it fails
    }

    const userDataSaved = getUserData() || [];

    setTimeout(() => {
        console.log("Module User We outside:", userId);
        console.log("userDataSaved We outside:", userDataSaved);

        if (!userId) {
            console.log("No user.");
            fetchVideoResumes(1, ''); // Call with empty userId
            return;
        }

        // DOM elements
        const lastBreadcrumb_last = document.getElementById("lastBreadcrumb_last");
        const lastBreadcrumb_a = document.getElementById("lastBreadcrumb_a");
        const homeBreadcrumb_a = document.getElementById("homeBreadcrumb_a");
        const breadcrumbTitleActive = document.getElementById("breadcrumb-active-title");
        const lastBreadcrumb_messages = document.getElementById("lastBreadcrumb_messages");

        // Breadcrumb visibility
        lastBreadcrumb_last.style.display = "block";
        lastBreadcrumb_messages.style.display = "block";

        // Update breadcrumb links and titles
        homeBreadcrumb_a.href = `https://reelcareer.co/u/`;
        lastBreadcrumb_a.innerText = "Profile";
        breadcrumbTitleActive.innerText = userDataSaved.displayName || "User";
        document.title = `ReelCareer.co | Welcome ${userDataSaved.displayName || "User"}`;
        breadcrumbTitleActive.style.display = "block";

        // Fetch video resumes for valid userId
        fetchVideoResumes(1, userId);
    }, 300);
};

      
    

async function handleConnect(docId, connectButton , viewProfilePicture, viewUserID, viewDisplayName) {
    alert(`connectButton post ID: ${docId}`);

    



  try {
    // Fetch required data
    const userID = auth.currentUser.uid;

  //  const userId = getUserId(); // Logged-in user
    const userIdFromURL = viewUserID;
    const userDataSaved = await getUserData() || {};
    const toName = viewDisplayName;
    const toProfilePicture = viewProfilePicture;

    // Validate inputs
    if (!userId || !userIdFromURL) {
      showToast('User information is incomplete.');
      return;
    }

    if (userID === userid) {
      showToast('You cannot connect with yourself.');
      return;
    }

    // Construct document ID
    const docId = `${userid}_${userId}`;
    const connectionRef = doc(db, 'Connections', docId);

    // Update button state
    connectButton.disabled = true;
    connectButton.innerText = 'Sending...';

    // Prepare and save connection data
    const connectionData = {
    from: userId,
    to: userId,
    toProfilePicture: toProfilePicture || 'https://reelcareer.co/images/sq_logo_n_BG_tie_reel.png',
    toName: toName,
    toProfileURL: `https://reelcareer.co/u?u=${userIdFromURL}`,
    toGroup: 'Networking',

    acceptDate: '',
    participants: [userId, userIdFromURL], // Add this array
    status: 'pending',
    createdAt: new Date(),
    fromGroup: 'Networking',
    fromNote: '',
    fromName: userDataSaved.displayName,
    fromProfilePicture: userDataSaved.profilePicture || 'https://reelcareer.co/images/sq_logo_n_BG_tie_reel.png',
    fromProfileURL: `https://reelcareer.co/u?u=${userId}`
};

await setDoc(connectionRef, connectionData);


    // Update button and notify user
    connectButton.innerText = 'Pending';
    showToast('Connection request sent!');
  } catch (error) {
    console.error('Error sending connection request:', error);

    connectButton.innerText = 'Connect';
    showToast('Error sending connection request. Please try again.');
  } finally {
    connectButton.disabled = false;
  }
};



// Utility Function: Update Button State
function updateButtonState(button, text, disable = false) {
    button.innerText = text;
    button.disabled = disable;
}








function sendMessage(docId , profilePicture,reelUserID, senderdisplayName) {

  
    

    const userId = getUserId(); // Logged-in user

    
    let recipientName = senderdisplayName;
    let currentUserId = userId;
    let userPageId = reelUserID;

    setRecipientName(recipientName);
   // console.log("USERID: ", USERID);

   /*
    console.log("userId: ", userId);
    console.log("currentUserId: ", currentUserId);
    console.log("userIdFromURL: ", userIdFromURL);
    console.log("userPageId: ", userPageId);
*/

    const userDataSaved = getUserData() || [];
    const senderID = auth.currentUser.uid;

   // console.log("UserData: ", UserData);
   // console.log("UserID: ", UserID);
   // console.log("UserId: ", UserId);
    console.log("senderID: ", senderID);
    console.log("userDataSaved: ", userDataSaved);

    if (senderID !== userIdFromURL) {
        document.getElementById('recipient-id').value = userIdFromURL; // Set recipient ID
        $('#sendMessageModal').modal('show'); // Show modal
    } else {
        showToast('You cannot send a message to yourself.');
    }
};


// Sync content from editable div to hidden textarea
document.getElementById('message-content-editable').addEventListener('keyup', function () {
  const content = this.innerText.trim();
  document.getElementById('message-content').value = content;
  toggleSendButton(content);
});

// Remove attachment
document.getElementById('remove-attachment').addEventListener('click', function () {
  document.getElementById('message-attachments').value = '';
  document.getElementById('attachment-preview').classList.add('d-none');
  document.getElementById('attachment-thumbnail').classList.add('d-none');
  document.getElementById('attachment-name').innerText = '';
  toggleSendButton(document.getElementById('message-content').value.trim());
});

// Show recipient's name
function setRecipientName(recipientName) {
  document.getElementById('recipient-name').textContent = `Message to: ${recipientName}`;
}

// Trigger file picker
document.getElementById('attachment-btn').addEventListener('click', function () {
  document.getElementById('message-attachments').click();
});

// Handle attachment preview
document.getElementById('message-attachments').addEventListener('change', function () {
  const file = this.files[0];
  if (file) {
    document.getElementById('attachment-name').innerText = file.name;
    const preview = document.getElementById('attachment-thumbnail');
    
    if (file.type.startsWith('image/')) {
      preview.src = URL.createObjectURL(file);
      preview.classList.remove('d-none');
      preview.className = 'lazy-image';

    } else {
      preview.classList.add('d-none');
    }
    document.getElementById('attachment-preview').classList.remove('d-none');
  }
  toggleSendButton(document.getElementById('message-content').value.trim());
});

// Enable/disable Send button
function toggleSendButton(content) {
  const attachment = document.getElementById('message-attachments').files[0];
  const sendButton = document.querySelector('#sendMessageForm button[type="submit"]');
  sendButton.disabled = !(content || attachment);
}
async function uploadAttachment(conversationID, file) {
    try {
        // Ensure 'storage' is properly initialized
        const storageInstance = getStorage(); // Use Firebase's getStorage method

        // Create a storage reference dynamically based on conversationID and file name
        const fileRef = ref(storageInstance, `messages/${conversationID}/${file.name}`);

        // Upload the file to Firebase Storage
        const snapshot = await uploadBytes(fileRef, file);

        // Get the download URL for the uploaded file
        return await getDownloadURL(snapshot.ref);
    } catch (error) {
        console.error("Error uploading attachment:", error);
        throw new Error('Failed to upload attachment.'); // Handle this in calling function
    }
}

// Your form submission logic
document.getElementById('sendMessageForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    // Gather recipient and sender data
    const recipientProfilePicture = document.getElementById('profilePic').src;
    const recipientName = document.getElementById('user-name').innerText;
    const recipientID = document.getElementById('recipient-id').value;
    const senderID = auth.currentUser.uid;
    const content = document.getElementById('message-content').value.trim();
    const attachmentFile = document.getElementById('message-attachments').files[0];
    const connectBtn = document.getElementById('connect-btn');

    const userDataSaved = getUserData() || {};
    const connectedBool = connectBtn.innerText === "Connected";

    // Determine contentType
    let contentType = 'text';
    if (attachmentFile) {
        const fileExtension = attachmentFile.name.split('.').pop().toLowerCase();
        const typeMapping = {
            image: ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'],
            video: ['mp4', 'avi', 'mov', 'mkv', 'webm'],
            audio: ['mp3', 'wav', 'aac', 'ogg', 'flac'],
            document: ['pdf', 'doc', 'docx', 'ppt', 'pptx', 'xls', 'xlsx'],
            archive: ['zip', 'rar', '7z', 'tar', 'gz'],
        };

        for (const [type, extensions] of Object.entries(typeMapping)) {
            if (extensions.includes(fileExtension)) {
                contentType = type;
                break;
            }
        }
    }

    let attachmentUrl = '';
    if (attachmentFile) {
        try {
            // Upload the attachment and get its URL
            attachmentUrl = await uploadAttachment(recipientID, attachmentFile);
        } catch (error) {
            console.error('Attachment upload failed:', error);
            showToast('Failed to upload attachment. Please try again.');
            return; // Stop form submission on failure
        }
    }

    // Construct message data
    const messageData = {
        recipientID,
        recipientName,
        recipientProfilePicture,
        recipientProfileURL: `https://reelcareer.co/u?u=${recipientID}`,
        senderID: userDataSaved.userID || senderID,
        senderName: userDataSaved.displayName,
        senderProfilePicture: userDataSaved.profilePicture,
        senderProfileURL: `https://reelcareer.co/u?u=${userDataSaved.userID}`,
        group: 'main',
        messageType: 'contact',
        contactLocation: 'Profile',
        participants: [userDataSaved.userID || senderID, recipientID],
        conversationID: recipientID,
        content,
        connectedBool,
        createdAt: new Date(),
        timestamp: serverTimestamp(),
        contentType,
        status: 'unread',
        attachments: attachmentFile ? attachmentFile.name : '',
        attachmentUrl,
        isDeleted: false,
    };

    try {
        const messagesCollection = collection(db, 'Messages');
        await addDoc(messagesCollection, messageData);

        showToast('Message sent successfully!');
        $('#sendMessageModal').modal('hide');
    } catch (error) {
        console.error('Error sending message:', error);
        showToast('Failed to send message. Please try again.');
    }
});





    </script>


    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
