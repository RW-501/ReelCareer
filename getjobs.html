<style> 
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
    h1 { text-align: center; }
    #jobTableContainer { margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
    th { cursor: pointer; background-color: #f4f4f4; }
    .selected { background-color: #dff0d8; }
    #messageArea { display: none; margin-top: 10px; padding: 10px; background: lightgray; }
    .error { background: lightcoral; color: white; }
    #loading { display: none; text-align: center; margin-top: 20px; }
    #autoAddProgress { height: 20px; background: blue; color: white; text-align: center; width: 0%; transition: width 0.5s; }
    #stopAutoAddButton.hidden { display: none; }
</style>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <!-- Bootstrap CSS -->
    <script src="https://reelcareer.co/public/js/scripts.js"></script>
    <script src="https://reelcareer.co/public/js/loadScripts.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="https://reelcareer.co/public/css/styles.css">
<style>

#jobTableContainer {
    min-height: 500px;
}


</style>
</head>


<body>
    <script src="https://reelcareer.co/public/js/bodyload.js"></script>
    

       <!-- Bootstrap JS and dependencies -->
       <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
       <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    
    <nav>

    </nav>


    <h1>Job Fetcher and Uploader</h1>
    <input type="text" id="query" placeholder="Enter job query" value="software developer" />

    <select id="query2">
        <option value="remote " selected>remote </option>
        <option value="full time">full time</option>
        <option value="part time">part time</option>
        <option value="manager">Manager</option>
        <option value="assistant"> Assistant</option>
        <option value="host">Host</option>
        <option value="hostess">Hostess</option>
        <option value="greeter">Greeter</option>
        <option value="worker"> Worker</option>
        <option value="handler">Handler</option>
        <option value="crs">crs</option>
        <option value="parking lot attendant">Parking Lot Attendant</option>
        <option value="fast food cashier">Fast Food Cashier</option>
        <option value="bellhop">Bellhop</option>
        <option value="cleaning staff">Cleaning Staff</option>
        <option value="laundry worker">Laundry Worker</option>
        <option value="home health aide">Home Health Aide</option>
        <option value="caregiver">Caregiver</option>
        <option value="food packer">Food Packer</option>
        <option value="produce stocker">Produce Stocker</option>
        <option value="meat cutter">Meat Cutter</option>
        <option value="delivery helper">Delivery Helper</option>
        <option value="cafeteria worker">Cafeteria Worker</option>
        <option value="school bus driver">School Bus Driver</option>
        <option value="crossing guard">Crossing Guard</option>
        <option value="daycare worker">Daycare Worker</option>
        <option value="street vendor">Street Vendor</option>
        <option value="gas station attendant">Gas Station Attendant</option>
        <option value="night security guard">Night Security Guard</option>
        <option value="ticket collector">Ticket Collector</option>
        <option value="concession worker">Concession Worker</option>
        <option value="ride operator">Ride Operator</option>
        <option value="carnival worker">Carnival Worker</option>
        <option value="cash register clerk">Cash Register Clerk</option>
        <option value="bagger">Bagger</option>
        <option value="ticket seller">Ticket Seller</option>
        <option value="office clerk">Office Clerk</option>
        <option value="line worker">Line Worker</option>
        <option value="registered nurse">Registered Nurse</option>
        <option value="teacher">Teacher</option>
        <option value="construction worker">Construction Worker</option>
        <option value="electrician">Electrician</option>
        <option value="plumber">Plumber</option>
        <option value="pharmacist">Pharmacist</option>
        <option value="bus driver">Bus Driver</option>
        <option value="delivery driver">Delivery Driver</option>
        <option value="graphic designer">Graphic Designer</option>
        <option value="waiter">Waiter</option>
        <option value="chef">Chef</option>
        <option value="barista">Barista</option>
        <option value="mechanic">Mechanic</option>
        <option value="dentist">Dentist</option>
        <option value="dental hygienist">Dental Hygienist</option>
        <option value="warehouse worker">Warehouse Worker</option>
        <option value="forklift operator">Forklift Operator</option>
        <option value="it specialist">IT Specialist</option>
        <option value="data analyst">Data Analyst</option>
        <option value="project manager">Project Manager</option>
        <option value="software developer" selected>Software Developer</option>
        <option value="data scientist">Data Scientist</option>
        <option value="web developer">Web Developer</option>
        <option value="product manager">Product Manager</option>
        <option value="personal assistant">Personal Assistant</option>
        <option value="host">Host</option>
        <option value="hostess">Hostess</option>
        <option value="greeter">Greeter</option>
        <option value="farm worker">Farm Worker</option>
        <option value="cash handler">Cash Handler</option>
        <option value="room service attendant">Room Service Attendant</option>
        <option value="parking lot attendant">Parking Lot Attendant</option>
        <option value="fast food cashier">Fast Food Cashier</option>
        <option value="bellhop">Bellhop</option>
        <option value="cleaning staff">Cleaning Staff</option>
        <option value="laundry worker">Laundry Worker</option>
        <option value="home health aide">Home Health Aide</option>
        <option value="caregiver">Caregiver</option>
        <option value="food packer">Food Packer</option>
        <option value="produce stocker">Produce Stocker</option>
        <option value="meat cutter">Meat Cutter</option>
        <option value="delivery helper">Delivery Helper</option>
        <option value="cafeteria worker">Cafeteria Worker</option>
        <option value="school bus driver">School Bus Driver</option>
        <option value="crossing guard">Crossing Guard</option>
        <option value="daycare worker">Daycare Worker</option>
        <option value="street vendor">Street Vendor</option>
        <option value="gas station attendant">Gas Station Attendant</option>
        <option value="night security guard">Night Security Guard</option>
        <option value="ticket collector">Ticket Collector</option>
        <option value="concession worker">Concession Worker</option>
        <option value="ride operator">Ride Operator</option>
        <option value="carnival worker">Carnival Worker</option>
        <option value="cash register clerk">Cash Register Clerk</option>
        <option value="bagger">Bagger</option>
        <option value="ticket seller">Ticket Seller</option>
        <option value="office clerk">Office Clerk</option>
        <option value="line worker">Line Worker</option>
        <option value="registered nurse">Registered Nurse</option>
        <option value="teacher">Teacher</option>
        <option value="construction worker">Construction Worker</option>
        <option value="electrician">Electrician</option>
        <option value="plumber">Plumber</option>
        <option value="pharmacist">Pharmacist</option>
        <option value="bus driver">Bus Driver</option>
        <option value="delivery driver">Delivery Driver</option>
        <option value="graphic designer">Graphic Designer</option>
        <option value="waiter">Waiter</option>
        <option value="chef">Chef</option>
        <option value="barista">Barista</option>
        <option value="mechanic">Mechanic</option>
        <option value="dentist">Dentist</option>
        <option value="dental hygienist">Dental Hygienist</option>
        <option value="warehouse worker">Warehouse Worker</option>
        <option value="forklift operator">Forklift Operator</option>
        <option value="it specialist">IT Specialist</option>
        <option value="data analyst">Data Analyst</option>
        <option value="project manager">Project Manager</option>
        <option value="human resources specialist">Human Resources Specialist</option>
        <option value="marketing manager">Marketing Manager</option>
        <option value="consultant">Consultant</option>
        <option value="bank teller">Bank Teller</option>
        <option value="loan officer">Loan Officer</option>
        <option value="financial advisor">Financial Advisor</option>
        <option value="event planner">Event Planner</option>
        <option value="receptionist">Receptionist</option>
        <option value="fitness trainer">Fitness Trainer</option>
        <option value="physical therapist">Physical Therapist</option>
        <option value="veterinarian">Veterinarian</option>
        <option value="animal caretaker">Animal Caretaker</option>
        <option value="photographer">Photographer</option>
        <option value="journalist">Journalist</option>
        <option value="editor">Editor</option>
        <option value="writer">Writer</option>
        <option value="scientist">Scientist</option>
        <option value="research assistant">Research Assistant</option>
        <option value="security guard">Security Guard</option>
        <option value="janitor">Janitor</option>
        <option value="librarian">Librarian</option>
        <option value="busboy">Busboy</option>
        <option value="flight attendant">Flight Attendant</option>
        <option value="pilot">Pilot</option>
        <option value="bartender">Bartender</option>
        <option value="childcare worker">Childcare Worker</option>
        <option value="psychologist">Psychologist</option>
        <option value="social worker">Social Worker</option>
        <option value="real estate agent">Real Estate Agent</option>
        <option value="customer support representative">Customer Support Representative</option>
        <option value="administrative support specialist">Administrative Support Specialist</option>
        <option value="office assistant">Office Assistant</option>
        <option value="warehouse associate">Warehouse Associate</option>
        <option value="warehouse manager">Warehouse Manager</option>
        <option value="inventory specialist">Inventory Specialist</option>
        <option value="shipping and receiving clerk">Shipping and Receiving Clerk</option>
        <option value="material handler">Material Handler</option>
        <option value="call center representative">Call Center Representative</option>
        <option value="customer care specialist">Customer Care Specialist</option>
        <option value="customer success manager">Customer Success Manager</option>
        <option value="client services coordinator">Client Services Coordinator</option>
        <option value="cashier">Cashier</option>
        <option value="sales clerk">Sales Clerk</option>
        <option value="retail associate">Retail Associate</option>
        <option value="housekeeper">Housekeeper</option>
        <option value="food service worker">Food Service Worker</option>
        <option value="dishwasher">Dishwasher</option>
        <option value="server">Server</option>
        <option value="parking attendant">Parking Attendant</option>
        <option value="front desk agent">Front Desk Agent</option>
        <option value="hotel concierge">Hotel Concierge</option>
        <option value="carpenter">Carpenter</option>
        <option value="hvac technician">HVAC Technician</option>
        <option value="welder">Welder</option>
        <option value="landscaper">Landscaper</option>
        <option value="painter">Painter</option>
        <option value="truck driver">Truck Driver</option>
        <option value="logistics manager">Logistics Manager</option>
        <option value="fleet manager">Fleet Manager</option>
        <option value="dispatcher">Dispatcher</option>        <option value="marketing manager">Marketing Manager</option>
        <option value="consultant">Consultant</option>
        <option value="bank teller">Bank Teller</option>
        <option value="loan officer">Loan Officer</option>
        <option value="financial advisor">Financial Advisor</option>
        <option value="event planner">Event Planner</option>
        <option value="receptionist">Receptionist</option>
        <option value="fitness trainer">Fitness Trainer</option>
        <option value="physical therapist">Physical Therapist</option>
        <option value="veterinarian">Veterinarian</option>
        <option value="animal caretaker">Animal Caretaker</option>
        <option value="photographer">Photographer</option>
        <option value="journalist">Journalist</option>
        <option value="editor">Editor</option>
        <option value="writer">Writer</option>
        <option value="scientist">Scientist</option>
        <option value="research assistant">Research Assistant</option>
        <option value="security guard">Security Guard</option>
        <option value="janitor">Janitor</option>
        <option value="librarian">Librarian</option>
        <option value="busboy">Busboy</option>
        <option value="flight attendant">Flight Attendant</option>
        <option value="pilot">Pilot</option>
        <option value="bartender">Bartender</option>
        <option value="childcare worker">Childcare Worker</option>
        <option value="psychologist">Psychologist</option>
        <option value="social worker">Social Worker</option>
        <option value="real estate agent">Real Estate Agent</option>
    </select>
    
    <select id="stateSelect">
        <option value="">Select a state</option>
        <option value="Alabama">Alabama</option>
        <option value="Alaska">Alaska</option>
        <option value="Arizona">Arizona</option>
        <option value="Arkansas">Arkansas</option>
        <option value="California">California</option>
        <option value="Colorado">Colorado</option>
        <option value="Connecticut">Connecticut</option>
        <option value="Delaware">Delaware</option>
        <option value="Florida">Florida</option>
        <option value="Georgia">Georgia</option>
        <option value="Hawaii">Hawaii</option>
        <option value="Idaho">Idaho</option>
        <option value="Illinois">Illinois</option>
        <option value="Indiana">Indiana</option>
        <option value="Iowa">Iowa</option>
        <option value="Kansas">Kansas</option>
        <option value="Kentucky">Kentucky</option>
        <option value="Louisiana">Louisiana</option>
        <option value="Maine">Maine</option>
        <option value="Maryland">Maryland</option>
        <option value="Massachusetts">Massachusetts</option>
        <option value="Michigan">Michigan</option>
        <option value="Minnesota">Minnesota</option>
        <option value="Mississippi">Mississippi</option>
        <option value="Missouri">Missouri</option>
        <option value="Montana">Montana</option>
        <option value="Nebraska">Nebraska</option>
        <option value="Nevada">Nevada</option>
        <option value="New Hampshire">New Hampshire</option>
        <option value="New Jersey">New Jersey</option>
        <option value="New Mexico">New Mexico</option>
        <option value="New York">New York</option>
        <option value="North Carolina">North Carolina</option>
        <option value="North Dakota">North Dakota</option>
        <option value="Ohio">Ohio</option>
        <option value="Oklahoma">Oklahoma</option>
        <option value="Oregon">Oregon</option>
        <option value="Pennsylvania">Pennsylvania</option>
        <option value="Rhode Island">Rhode Island</option>
        <option value="South Carolina">South Carolina</option>
        <option value="South Dakota">South Dakota</option>
        <option value="Tennessee">Tennessee</option>
        <option value="Texas">Texas</option>
        <option value="Utah">Utah</option>
        <option value="Vermont">Vermont</option>
        <option value="Virginia">Virginia</option>
        <option value="Washington">Washington</option>
        <option value="West Virginia">West Virginia</option>
        <option value="Wisconsin">Wisconsin</option>
        <option value="Wyoming">Wyoming</option>
    </select>
    
    <input type="number" id="perPage" placeholder="Results per page" value="5" />
    <button onclick="fetchJobs()">Fetch Jobs</button>
    <button id="addJobButton">Add Selected Job</button>
    <button id="autoAddButton">Auto Add Jobs</button>
    <button id="stopAutoAddButton" class="hidden">Stop Auto Add</button>
    
    <div id="loading">Loading...</div>
    <div id="autoAddProgress"></div>
    <div id="messageArea"><span id="messageAreaText"></span></div>
 
    <div id="jobTableContainer">
        <table id="jobTable">
            <thead>
                <tr>
                    <th><input type="checkbox" id="selectAll" ></th>
                    <th id="sortJobTitle">Job Title</th>
                    <th id="sortCompany">Company</th>
                    <th id="sortCity">City</th>
                    <th id="sortState">State</th>
                    <th id="sortSalary">Salary</th>
                    <th id="sortDate">Date</th>
                    <th id="sortCategory">Category</th>
                    
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="jobApplications" onclick="handleTableClick(event)"></tbody>
        </table>
    </div>
    
    <div id="errorDisplay" style="color: red; margin-top: 10px;"></div>


    <!-- Footer -->
    <footer id="dynamic-footer"></footer>
    
    <!-- Firebase configuration/ Login& Out -->
    <script type="module" src="https://reelcareer.co/public/js/main.js"></script> 

    <!-- Firebase JS SDK and Custom Scripts -->

    <!-- Firebase and Job Fetcher Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>


    <script>



// Select All Jobs
function toggleSelectAll() {
    const selectAllCheckbox = document.getElementById("selectAll");
    const checkboxes = document.querySelectorAll(".job-checkbox");  // Get all individual checkboxes

    checkboxes.forEach(checkbox => {
        checkbox.checked = selectAllCheckbox.checked;  // Set all checkboxes based on selectAll
        toggleRowSelection(checkbox);  // Update row selection (class)
    });
}

// Optionally, you can add event listener for each individual checkbox to ensure the "Select All" box updates accordingly
document.addEventListener("DOMContentLoaded", () => {
    const selectAllCheckbox = document.getElementById("selectAll");
    selectAllCheckbox.addEventListener("click", () => {
        toggleSelectAll()
    });
    // Update the "Select All" checkbox when individual checkboxes are toggled
    const checkboxes = document.querySelectorAll(".job-checkbox");
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener("change", () => {
            const allChecked = [...checkboxes].every(cb => cb.checked);  // Check if all checkboxes are selected
            selectAllCheckbox.checked = allChecked;  // Update the "Select All" checkbox
        });
    });
});

document.addEventListener("DOMContentLoaded", () => {


    window.toggleRowSelection = toggleRowSelection;
    window.toggleSelectAll = toggleSelectAll;


    const sortColumns = [
        "sortJobTitle",
        "sortCompany",
        "sortCity",
        "sortState",
        "sortSalary",
        "sortDate",
        "sortCategory"
    ];

    sortColumns.forEach((columnId, index) => {
        const column = document.getElementById(columnId);
        column.addEventListener("click", () => sortTable(index + 1)); // Adjust column index
    });







    function toggleRowSelection(checkbox) {
    const row = checkbox.closest("tr"); // Get the parent <tr> of the checkbox
    if (checkbox.checked) {
        row.classList.add("selected"); // Add the selected class
    } else {
        row.classList.remove("selected"); // Remove the selected class
    }
}


        window.toggleRowSelection = toggleRowSelection;

        function handleTableClick(event) {
    if (event.target && event.target.classList.contains('job-checkbox')) {
        toggleRowSelection(event.target); // Pass the actual checkbox
    }
}

        
window.handleTableClick = handleTableClick ;
});



let sortDirection = [true, true, true, true, true, true, true, true]; // Store the sort direction for each column (true for ascending, false for descending)

// Move sortTable outside of the event listener
function sortTable(columnIndex) {
    const table = document.getElementById("jobTable");
    const rows = Array.from(table.rows).slice(1); // Get all rows except the header
    const isAscending = sortDirection[columnIndex];
    sortDirection[columnIndex] = !isAscending; // Toggle sort direction

    const sortedRows = rows.sort((rowA, rowB) => {
        const cellA = rowA.cells[columnIndex].innerText.trim();
        const cellB = rowB.cells[columnIndex].innerText.trim();

        // Handle sorting based on column type (numeric or text)
        if (columnIndex === 5) { // Salary column
            const salaryA = parseFloat(cellA) || 0;
            const salaryB = parseFloat(cellB) || 0;
            return isAscending ? salaryA - salaryB : salaryB - salaryA;
        } else if (columnIndex === 6) { // Date column
            const dateA = new Date(cellA);
            const dateB = new Date(cellB);
            return isAscending ? dateA - dateB : dateB - dateA;
        } else { // For text columns (e.g., Job Title, Company, etc.)
            return isAscending ? cellA.localeCompare(cellB) : cellB.localeCompare(cellA);
        }
    });

    // Append sorted rows to the table
    const tbody = document.getElementById("jobApplications");
    tbody.innerHTML = ""; // Clear existing rows
    sortedRows.forEach(row => tbody.appendChild(row));
}


//window.sortTable = sortTable;



      
    </script>
    <script type="module">


import { db , getStorage, ref, uploadBytes, getDownloadURL, limit,
  doc, arrayUnion, RecaptchaVerifier, increment, getDoc, arrayRemove, signInWithPhoneNumber,
  query, updateDoc, setDoc, addDoc, signInAnonymously, orderBy, onAuthStateChanged,
  uploadBytesResumable, signInWithPopup, FacebookAuthProvider, GoogleAuthProvider, startAfter,
  OAuthProvider, signOut, deleteDoc, getFirestore, serverTimestamp,
  createUserWithEmailAndPassword, signInWithEmailAndPassword, deleteObject,
  where, getDocs, storage, getAuth, collection, auth, analytics,
  googleProvider,onSnapshot ,writeBatch ,batch, } from 'https://reelcareer.co/js/module.js';

const batch = writeBatch(db);  // Initialize batch operation
let count = 0;




            function parseCityFromLocation(location) {
            const parts = location.split(',');
            return parts.length > 0 ? parts[0].trim() : '';
        }

        function parseStateFromLocation(location) {
            const parts = location.split(',');
            return parts.length > 1 ? parts[1].trim() : '';
        }

        function parseCityFromLocationNew(locationString) {
            if (locationString && locationString.includes(',')) {
                return locationString.split(',')[0].trim();
            }
            return '';
        }
  
        let autoAdd = false;
        let autoAddTimeout;
        document.addEventListener("DOMContentLoaded", () => {


 // Loading State
 function toggleLoading(state) {
            document.getElementById("loading").style.display = state ? "block" : "none";
        }



        // Fetch Jobs
        async function fetchJobs() {
    let query = document.getElementById("query").value;
    let query2 = document.getElementById("query2").value;
    const perPage = document.getElementById("perPage").value;
    const stateSelect = document.getElementById("stateSelect");
    const selectedState = stateSelect.value;

    if(query == '') {
        query = query2;
    }

    // Build the URL based on whether a state is selected
    let url = `https://api.adzuna.com/v1/api/jobs/us/search/1?app_id=3ea9a2f1&app_key=e74d84b00c37bbfabe11710ebafcd138&results_per_page=${perPage}&what=${query}`;
    if (selectedState) {
        url += `&where=${selectedState}`;
    }

    // API request
    try {
        toggleLoading(true);
        const response = await axios.get(url);
        displayJobs(response.data.results);
    } catch (error) {
        console.error("Error fetching jobs:", error);
        showMessage("Error fetching jobs. Please try again.", true);
    } finally {
        toggleLoading(false);
    }
}

window.fetchJobs = fetchJobs;


});

function getSelectedJobs() {
    const selectedRows = document.querySelectorAll(".job-item.selected");
    const jobs = [];
    selectedRows.forEach(row => {
        const job = {
            title: row.children[1].textContent,
            company: row.children[2].textContent
        };
        jobs.push(job);
    });
    console.log("Selected Jobs:", jobs);
    return jobs;
}
function displayJobs(jobs) {
    const container = document.getElementById("jobApplications");
    container.innerHTML = "";

    jobs.forEach(job => {
        const jobData = JSON.stringify(job); // Serialize job object

        // Main Row (Summary)
        const row = document.createElement("tr");
        row.className = "job-item";
        row.innerHTML = `
            <td><input type="checkbox" class="job-checkbox"></td>
            <td>${job.title}</td>
            <td>${job.company.display_name || "N/A"}</td>
            <td>${parseCityFromLocationNew(job.location.display_name) || "N/A"}</td>
            <td>${job.location.area[1] || "N/A"}</td>
            <td>${(parseFloat(job.salary_min) + parseFloat(job.salary_max)) / 2 || 0}</td>
            <td>${new Date(job.created).toLocaleDateString() || ''}</td>
            <td>${job.category.tag || ''}</td>
            <td>
                <button onclick="toggleDetails(this)">Details</button>
                <button onclick="addJob('${job.id}')">Add</button>
            </td>
            <input type="hidden" value='${jobData}'> <!-- Hidden input -->
        `;

        // Collapsible Row (Details)
        const detailsRow = document.createElement("tr");
        detailsRow.className = "job-details hidden"; // Initially hidden
        detailsRow.innerHTML = `
            <td colspan="9">
                <div class="job-details-content">
                    <p><strong>Company:</strong> ${job.company.display_name}</p>
                    <p><strong>Description:</strong> ${job.description || "No description available"}</p>
                    <p><strong>Contract Type:</strong> ${job.contract_time || "Full-time"}</p>
                    <p><strong>Location:</strong> ${job.location.display_name || "N/A"}</p>
                    <p><strong>Salary Range:</strong> ${job.salary_min || 0} - ${job.salary_max || 0}</p>
                    <p><strong>Tags:</strong> ${job.category.tag || "None"}</p>
                </div>
            </td>
        `;

        container.appendChild(row);
        container.appendChild(detailsRow);

        // Attach event listener to the checkbox
        const checkbox = row.querySelector(".job-checkbox");
        checkbox.addEventListener("click", () => toggleRowSelection(checkbox));
    });
}

document.addEventListener("DOMContentLoaded", () => {


    
// Toggle function for showing/hiding details
function toggleDetails(button) {
    const currentRow = button.closest("tr");
    const detailsRow = currentRow.nextElementSibling; // Find the collapsible row
    if (detailsRow && detailsRow.classList.contains("job-details")) {
        detailsRow.classList.toggle("hidden");
    }
}













        // Add Selected Jobs  window.addSelectedJobs = addSelectedJobs;

        async function addSelectedJobs() {
            const selectedJobs = document.querySelectorAll(".job-item.selected");
            if (selectedJobs.length === 0) {
                showMessage("No jobs selected.", true);
                return;
            }

        }
            

       
        

   

    

        // Show Message
        function showMessage(message, isError = false) {
            const messageArea = document.getElementById("messageArea");
            const messageText = document.getElementById("messageAreaText");
            messageArea.classList.toggle("error", isError);
            messageText.textContent = message;
            messageArea.style.display = "block";
            setTimeout(() => messageArea.style.display = "none", 3000);
        }

   

        const addJobButton = document.getElementById("addJobButton");
    addJobButton.addEventListener("click", () => {
        addSelectedJobs()
    });


    });



    
        // Add Job (simplified)
        function addJob(jobId) {
            console.log(`Job ID: ${jobId} has been added.`);
        }


        selectedJobs.forEach((jobRow) => {
    const job = JSON.parse(jobRow.querySelector('input[type="hidden"]').value); // Retrieve job data
    const jobRef = collection(db, "Jobs");  // Reference to the Jobs collection
    const job_location = job['location']['area'] || []; // Location area

    // Searchable Title
    const searchableTitle = job.title
        .toLowerCase()
        .replace(/[^a-z0-9\s]/g, "")  // Remove special characters
        .split(" ")  // Split into words
        .filter(Boolean)  // Remove empty strings
        .join(" ");  // Join back into a single string

    // Process Tags
    let tags = job.category && job.category.tag ? job.category.tag.split('-').map(word => word.trim()) : [];
    const searchableTags = tags
        .map(tag => tag.toLowerCase())  // Convert each tag to lowercase
        .map(tag => tag.replace(/[^a-z0-9\s]/g, ""))  // Remove special characters
        .join(" ");  // Join back into a single string

    console.log(searchableTags);  // Log the final searchable string for debugging

    // Adding job data to batch
    const docRef = doc(db, 'jobs', job.jobId || '');  // Ensure jobId is valid, use a fallback if not

    batch.set(docRef, { 
        title: (job.title || '').toLowerCase(),
        searchableTitle: searchableTitle,  
        jobId: job.jobId || '',  // Ensure jobId is present
        recrecruiterID: '',  // You can update this if needed
        company: job.company.display_name,
        description: job.description || '', 
        location: (job.location || '').toLowerCase(),
        city: parseCityFromLocationNew(job.location.display_name) || '', 
        county: parseStateFromLocation(job.location.display_name) || '', 
        state: job.location.area[1] || '', 
        country: job.location.area[0] || 'US', 
        type: job.contract_time || 'Full-time', 
        salaryMin: parseFloat(job.salary_min) || 0, 
        salaryMax: parseFloat(job.salary_max) || 0,   
        salary: (parseFloat(job.salary_min) + parseFloat(job.salary_max)) / 2 || 0,
        contractToHire: 'No', 
        immediateHire: 'No', 
        industry: job.category.label || '', 
        category: job.category.tag || '',
        benefits: [],  // Add benefits if needed
        tags: searchableTags || '',  // Store tags as a single string
        boosted: "None", 
        boostExpiration: "None", 
        boostExpiresAt: "None", 
        boostedByID: "None", 
        status: "active", 
        createdAt: new Date(job.created), 
        applicantsViewed: 0, 
        savedForLater: 0, 
        applicationWebsite: job.redirect_url || '', 
        applicationAvailableBool: false, 
        submittedBy: "Adzuna", 
        searchableRequirements: ''
    });

    count++;  // Increment the count for successful jobs processed
});

try {
    await batch.commit();
    showMessage(`${count} jobs added successfully.`);
} catch (error) {
    console.error("Error adding jobs:", error);
    showMessage("Failed to add jobs. Please try again.");
}

    </script>
</body>
