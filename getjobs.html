<style> 
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
    h1 { text-align: center; }
    #jobTableContainer { margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
    th { cursor: pointer; background-color: #f4f4f4; }
    .selected { background-color: #dff0d8; }
    #messageArea { display: none; margin-top: 10px; padding: 10px; background: lightgray; }
    .error { background: lightcoral; color: white; }
    #loading { display: none; text-align: center; margin-top: 20px; }
    #autoAddProgress { height: 20px; background: blue; color: white; text-align: center; width: 0%; transition: width 0.5s; }
    #stopAutoAddButton.hidden { display: none; }
</style>

<body>
    <h1>Job Fetcher and Uploader</h1>
    <input type="text" id="query1" placeholder="Enter job query" value="software developer" />

    <select id="query2">
        <option value="software developer" selected>Software Developer</option>
        <option value="data scientist">Data Scientist</option>
        <option value="part time">part time</option>
        <option value="manager">Manager</option>
        <option value="assistant"> Assistant</option>
        <option value="host">Host</option>
        <option value="hostess">Hostess</option>
        <option value="greeter">Greeter</option>
        <option value="worker"> Worker</option>
        <option value="handler">Handler</option>
        <option value="room service attendant">Room Service Attendant</option>
        <option value="parking lot attendant">Parking Lot Attendant</option>
        <option value="fast food cashier">Fast Food Cashier</option>
        <option value="bellhop">Bellhop</option>
        <option value="cleaning staff">Cleaning Staff</option>
        <option value="laundry worker">Laundry Worker</option>
        <option value="home health aide">Home Health Aide</option>
        <option value="caregiver">Caregiver</option>
        <option value="food packer">Food Packer</option>
        <option value="produce stocker">Produce Stocker</option>
        <option value="meat cutter">Meat Cutter</option>
        <option value="delivery helper">Delivery Helper</option>
        <option value="cafeteria worker">Cafeteria Worker</option>
        <option value="school bus driver">School Bus Driver</option>
        <option value="crossing guard">Crossing Guard</option>
        <option value="daycare worker">Daycare Worker</option>
        <option value="street vendor">Street Vendor</option>
        <option value="gas station attendant">Gas Station Attendant</option>
        <option value="night security guard">Night Security Guard</option>
        <option value="ticket collector">Ticket Collector</option>
        <option value="concession worker">Concession Worker</option>
        <option value="ride operator">Ride Operator</option>
        <option value="carnival worker">Carnival Worker</option>
        <option value="cash register clerk">Cash Register Clerk</option>
        <option value="bagger">Bagger</option>
        <option value="ticket seller">Ticket Seller</option>
        <option value="office clerk">Office Clerk</option>
        <option value="line worker">Line Worker</option>
        <option value="registered nurse">Registered Nurse</option>
        <option value="teacher">Teacher</option>
        <option value="construction worker">Construction Worker</option>
        <option value="electrician">Electrician</option>
        <option value="plumber">Plumber</option>
        <option value="pharmacist">Pharmacist</option>
        <option value="bus driver">Bus Driver</option>
        <option value="delivery driver">Delivery Driver</option>
        <option value="graphic designer">Graphic Designer</option>
        <option value="waiter">Waiter</option>
        <option value="chef">Chef</option>
        <option value="barista">Barista</option>
        <option value="mechanic">Mechanic</option>
        <option value="dentist">Dentist</option>
        <option value="dental hygienist">Dental Hygienist</option>
        <option value="warehouse worker">Warehouse Worker</option>
        <option value="forklift operator">Forklift Operator</option>
        <option value="it specialist">IT Specialist</option>
        <option value="data analyst">Data Analyst</option>
        <option value="project manager">Project Manager</option>
        <option value="software developer" selected>Software Developer</option>
        <option value="data scientist">Data Scientist</option>
        <option value="web developer">Web Developer</option>
        <option value="product manager">Product Manager</option>
        <option value="personal assistant">Personal Assistant</option>
        <option value="host">Host</option>
        <option value="hostess">Hostess</option>
        <option value="greeter">Greeter</option>
        <option value="farm worker">Farm Worker</option>
        <option value="cash handler">Cash Handler</option>
        <option value="room service attendant">Room Service Attendant</option>
        <option value="parking lot attendant">Parking Lot Attendant</option>
        <option value="fast food cashier">Fast Food Cashier</option>
        <option value="bellhop">Bellhop</option>
        <option value="cleaning staff">Cleaning Staff</option>
        <option value="laundry worker">Laundry Worker</option>
        <option value="home health aide">Home Health Aide</option>
        <option value="caregiver">Caregiver</option>
        <option value="food packer">Food Packer</option>
        <option value="produce stocker">Produce Stocker</option>
        <option value="meat cutter">Meat Cutter</option>
        <option value="delivery helper">Delivery Helper</option>
        <option value="cafeteria worker">Cafeteria Worker</option>
        <option value="school bus driver">School Bus Driver</option>
        <option value="crossing guard">Crossing Guard</option>
        <option value="daycare worker">Daycare Worker</option>
        <option value="street vendor">Street Vendor</option>
        <option value="gas station attendant">Gas Station Attendant</option>
        <option value="night security guard">Night Security Guard</option>
        <option value="ticket collector">Ticket Collector</option>
        <option value="concession worker">Concession Worker</option>
        <option value="ride operator">Ride Operator</option>
        <option value="carnival worker">Carnival Worker</option>
        <option value="cash register clerk">Cash Register Clerk</option>
        <option value="bagger">Bagger</option>
        <option value="ticket seller">Ticket Seller</option>
        <option value="office clerk">Office Clerk</option>
        <option value="line worker">Line Worker</option>
        <option value="registered nurse">Registered Nurse</option>
        <option value="teacher">Teacher</option>
        <option value="construction worker">Construction Worker</option>
        <option value="electrician">Electrician</option>
        <option value="plumber">Plumber</option>
        <option value="pharmacist">Pharmacist</option>
        <option value="bus driver">Bus Driver</option>
        <option value="delivery driver">Delivery Driver</option>
        <option value="graphic designer">Graphic Designer</option>
        <option value="waiter">Waiter</option>
        <option value="chef">Chef</option>
        <option value="barista">Barista</option>
        <option value="mechanic">Mechanic</option>
        <option value="dentist">Dentist</option>
        <option value="dental hygienist">Dental Hygienist</option>
        <option value="warehouse worker">Warehouse Worker</option>
        <option value="forklift operator">Forklift Operator</option>
        <option value="it specialist">IT Specialist</option>
        <option value="data analyst">Data Analyst</option>
        <option value="project manager">Project Manager</option>
        <option value="human resources specialist">Human Resources Specialist</option>
        <option value="marketing manager">Marketing Manager</option>
        <option value="consultant">Consultant</option>
        <option value="bank teller">Bank Teller</option>
        <option value="loan officer">Loan Officer</option>
        <option value="financial advisor">Financial Advisor</option>
        <option value="event planner">Event Planner</option>
        <option value="receptionist">Receptionist</option>
        <option value="fitness trainer">Fitness Trainer</option>
        <option value="physical therapist">Physical Therapist</option>
        <option value="veterinarian">Veterinarian</option>
        <option value="animal caretaker">Animal Caretaker</option>
        <option value="photographer">Photographer</option>
        <option value="journalist">Journalist</option>
        <option value="editor">Editor</option>
        <option value="writer">Writer</option>
        <option value="scientist">Scientist</option>
        <option value="research assistant">Research Assistant</option>
        <option value="security guard">Security Guard</option>
        <option value="janitor">Janitor</option>
        <option value="librarian">Librarian</option>
        <option value="busboy">Busboy</option>
        <option value="flight attendant">Flight Attendant</option>
        <option value="pilot">Pilot</option>
        <option value="bartender">Bartender</option>
        <option value="childcare worker">Childcare Worker</option>
        <option value="psychologist">Psychologist</option>
        <option value="social worker">Social Worker</option>
        <option value="real estate agent">Real Estate Agent</option>
        <option value="customer support representative">Customer Support Representative</option>
        <option value="administrative support specialist">Administrative Support Specialist</option>
        <option value="office assistant">Office Assistant</option>
        <option value="warehouse associate">Warehouse Associate</option>
        <option value="warehouse manager">Warehouse Manager</option>
        <option value="inventory specialist">Inventory Specialist</option>
        <option value="shipping and receiving clerk">Shipping and Receiving Clerk</option>
        <option value="material handler">Material Handler</option>
        <option value="call center representative">Call Center Representative</option>
        <option value="customer care specialist">Customer Care Specialist</option>
        <option value="customer success manager">Customer Success Manager</option>
        <option value="client services coordinator">Client Services Coordinator</option>
        <option value="cashier">Cashier</option>
        <option value="sales clerk">Sales Clerk</option>
        <option value="retail associate">Retail Associate</option>
        <option value="housekeeper">Housekeeper</option>
        <option value="food service worker">Food Service Worker</option>
        <option value="dishwasher">Dishwasher</option>
        <option value="server">Server</option>
        <option value="parking attendant">Parking Attendant</option>
        <option value="front desk agent">Front Desk Agent</option>
        <option value="hotel concierge">Hotel Concierge</option>
        <option value="carpenter">Carpenter</option>
        <option value="hvac technician">HVAC Technician</option>
        <option value="welder">Welder</option>
        <option value="landscaper">Landscaper</option>
        <option value="painter">Painter</option>
        <option value="truck driver">Truck Driver</option>
        <option value="logistics manager">Logistics Manager</option>
        <option value="fleet manager">Fleet Manager</option>
        <option value="dispatcher">Dispatcher</option>        <option value="marketing manager">Marketing Manager</option>
        <option value="consultant">Consultant</option>
        <option value="bank teller">Bank Teller</option>
        <option value="loan officer">Loan Officer</option>
        <option value="financial advisor">Financial Advisor</option>
        <option value="event planner">Event Planner</option>
        <option value="receptionist">Receptionist</option>
        <option value="fitness trainer">Fitness Trainer</option>
        <option value="physical therapist">Physical Therapist</option>
        <option value="veterinarian">Veterinarian</option>
        <option value="animal caretaker">Animal Caretaker</option>
        <option value="photographer">Photographer</option>
        <option value="journalist">Journalist</option>
        <option value="editor">Editor</option>
        <option value="writer">Writer</option>
        <option value="scientist">Scientist</option>
        <option value="research assistant">Research Assistant</option>
        <option value="security guard">Security Guard</option>
        <option value="janitor">Janitor</option>
        <option value="librarian">Librarian</option>
        <option value="busboy">Busboy</option>
        <option value="flight attendant">Flight Attendant</option>
        <option value="pilot">Pilot</option>
        <option value="bartender">Bartender</option>
        <option value="childcare worker">Childcare Worker</option>
        <option value="psychologist">Psychologist</option>
        <option value="social worker">Social Worker</option>
        <option value="real estate agent">Real Estate Agent</option>
    </select>
    

    <input type="number" id="perPage" placeholder="Results per page" value="5" />
    <button onclick="fetchJobs()">Fetch Jobs</button>
    <button id="addJobButton">Add Selected Job</button>
    <button id="autoAddButton">Auto Add Jobs</button>
    <button id="stopAutoAddButton" class="hidden">Stop Auto Add</button>
    
    <div id="loading">Loading...</div>
    <div id="autoAddProgress"></div>
    <div id="messageArea"><span id="messageAreaText"></span></div>

    <div id="jobTableContainer">
        <table id="jobTable">
            <thead>
                <tr>
                    <th><input type="checkbox" id="selectAll" onclick="toggleSelectAll()"></th>
                    <th>Job Title</th>
                    <th>Company</th>
                    <th>City</th>
                    <th>State</th>
                    <th>Salary</th>
                    <th>Date</th>
                    <th>Category</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="jobApplications"></tbody>
        </table>
    </div>

    <div id="errorDisplay" style="color: red; margin-top: 10px;"></div>

    <!-- Firebase and Job Fetcher Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script type="module">

import { getFirestore, collection, writeBatch } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        import {
                db, doc, getDoc, query, updateDoc,
                setDoc, ref, signInWithPopup, orderBy,
                 
                uploadBytes, OAuthProvider, arrayUnion, getStorage,
                signOut, addDoc, increment, onAuthStateChanged,
                createUserWithEmailAndPassword, signInWithEmailAndPassword,
                where, getDocs, storage, deleteObject, 
                auth, analytics, deleteDoc, getDownloadURL
            } from 'https://reelcareer.co/js/module.js';
    
    

            function parseCityFromLocation(location) {
            const parts = location.split(',');
            return parts.length > 0 ? parts[0].trim() : '';
        }

        function parseStateFromLocation(location) {
            const parts = location.split(',');
            return parts.length > 1 ? parts[1].trim() : '';
        }

        function parseCityFromLocationNew(locationString) {
            if (locationString && locationString.includes(',')) {
                return locationString.split(',')[0].trim();
            }
            return '';
        }



        
        let autoAdd = false;
        let autoAddTimeout;
        document.addEventListener("DOMContentLoaded", () => {

        // Fetch Jobs
        async function fetchJobs() {
            let query = document.getElementById("query").value;
            let query2 = document.getElementById("query2").value;
            const perPage = document.getElementById("perPage").value;

            if(query == ''){
                query = query2;

            }
            // API request
            try {
                toggleLoading(true);
                const response = await axios.get(`https://api.adzuna.com/v1/api/jobs/us/search/1?app_id=3ea9a2f1&app_key=e74d84b00c37bbfabe11710ebafcd138&results_per_page=${perPage}&what=${query}`);
                displayJobs(response.data.results);
            } catch (error) {
                console.error("Error fetching jobs:", error);
                showMessage("Error fetching jobs. Please try again.", true);
            } finally {
                toggleLoading(false);
            }
        }
window.fetchJobs = fetchJobs;



});

        // Display Jobs in Table
        function displayJobs(jobs) {
            const container = document.getElementById("jobApplications");
            container.innerHTML = "";
            jobs.forEach(job => {
                const row = document.createElement("tr");
                row.className = "job-item";
                row.innerHTML = `
                    <td><input type="checkbox" class="job-checkbox" onclick="toggleRowSelection(this)"></td>
                    <td>${job.title}</td>
                    <td>${job.company.display_name || "N/A"}</td>
                    <td>${parseCityFromLocationNew(job.location.display_name) || "N/A"}</td>
                    <td>${job.location.area[1] || "N/A"}</td>
                    <td>${ (parseFloat(job.salary_min) + parseFloat(job.salary_max)) / 2 || 0}</td>
                    <td>${new Date(job.created) || ''}</td>
                    <td>${job.category.tag || ''}</td>
                    <td><button onclick="addJob(${job.id})">Add</button></td>
                `;
                container.appendChild(row);
            });
        }

        // Toggle Row Selection
        function toggleRowSelection(checkbox) {
            const row = checkbox.closest('tr');
            row.classList.toggle('selected', checkbox.checked);
        }

        // Select All Jobs
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById("selectAll");
            const checkboxes = document.querySelectorAll(".job-checkbox");
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                toggleRowSelection(checkbox);
            });
        }

        // Add Selected Jobs
        async function addSelectedJobs() {
            const selectedJobs = document.querySelectorAll(".job-item.selected");
            if (selectedJobs.length === 0) {
                showMessage("No jobs selected.", true);
                return;
            }

            const batch = writeBatch(db);
            let count = 0;

            selectedJobs.forEach((jobRow) => {
                const job = JSON.parse(jobRow.querySelector('input[type="hidden"]').value);
                const jobRef = collection(db, "Jobs");
                let job_location = job['location']['area'] || [];

const searchableTitle = job.title
.toLowerCase()
.replace(/[^a-z0-9\s]/g, "") // Remove special characters
.split(" ") // Split into words
.filter(Boolean)  // Remove empty strings
.join(" "); // Join back into a single string

let tags = job.category && job.category.tag ? job.category.tag.split('-').map(word => word.trim()) : [];
const searchableTags = tags
.toLowerCase()
.replace(/[^a-z0-9\s]/g, "") // Remove special characters
.split(" ") // Split into words
.filter(Boolean)  // Remove empty strings
.join(" "); // Join back into a single string

batch.set(docRef, { 
title: (job.title || '').toLowerCase(),
searchableTitle: searchableTitle,  // Store as lowercase string for Firebase search
jobId: '',

company: job.company.display_name,
description: job.description || '', 
location: (job.location || '').toLowerCase(),
city: parseCityFromLocationNew(job.location.display_name) || '', 
county: parseStateFromLocation(job.location.display_name) || '', 
state: job.location.area[1] || '', 
country: job.location.area[0] || 'US', 
type: job.contract_time || 'Full-time', 
salaryMin: parseFloat(job.salary_min) || 0, 
salaryMax: parseFloat(job.salary_max) || 0,   
salary: (parseFloat(job.salary_min) + parseFloat(job.salary_max)) / 2 || 0,
contractToHire: 'No', 
immediateHire: 'No', 
industry: job.category.label || '', 
category: job.category.tag || '',
benefits: [], 
tags: searchableTags || '',
boosted: "None", 
boostExpiration: "None", 
boostExpiresAt: "None", 
boostedByID: "None", 
status: "active", 
createdAt: new Date(job.created), 
applicantsViewed: 0, 
savedForLater: 0, 
applicationWebsite: job.redirect_url || '', 
applicationAvailableBool: false, 
submittedBy: "Adzuna", 
searchableRequirements: ''

                });
                count++;
            });

            await batch.commit();
            showMessage(`${count} jobs added successfully.`);
        }

        // Show Message
        function showMessage(message, isError = false) {
            const messageArea = document.getElementById("messageArea");
            const messageText = document.getElementById("messageAreaText");
            messageArea.classList.toggle("error", isError);
            messageText.textContent = message;
            messageArea.style.display = "block";
            setTimeout(() => messageArea.style.display = "none", 3000);
        }

        // Loading State
        function toggleLoading(state) {
            document.getElementById("loading").style.display = state ? "block" : "none";
        }

        // Add Job (simplified)
        function addJob(jobId) {
            console.log(`Job ID: ${jobId} has been added.`);
        }
    </script>
</body>
