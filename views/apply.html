<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Apply for your dream job with ReelCareer. Submit your application and take the next step in your career journey with ease. Explore opportunities in various industries and get hired today.">
  <meta name="keywords" content="apply for jobs, job application, submit application, career opportunities, employment, job search, apply online, submit resume, job seekers, job application form">
  <meta name="author" content="ReelCareer">
  <meta name="robots" content="index, follow">
  <meta name="language" content="en">
  <meta name="geo.region" content="US-TX">
  <meta name="geo.placename" content="Dallas, Texas">

  <!-- Title optimized for Apply Page -->
  <title>Apply for Jobs | Submit Your Application on ReelCareer</title>

  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Apply for Jobs | Start Your Career on ReelCareer">
  <meta property="og:description" content="Submit your job application and start the next step in your career with ReelCareer. Apply easily for job openings in various fields.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.reelcareer.co/apply">
  <meta property="og:image" content="https://www.reelcareer.co/images/apply_page_image.png"> <!-- Update image path accordingly -->
  <meta property="og:site_name" content="ReelCareer">
  <meta property="og:locale" content="en_US">

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@ReelCareer">
  <meta name="twitter:title" content="Apply for Jobs | Submit Your Application on ReelCareer">
  <meta name="twitter:description" content="Apply for your ideal job easily on ReelCareer. Submit your application and start your career journey.">
  <meta name="twitter:image" content="https://www.reelcareer.co/images/sq_logo_n_BG_tie_reelx.png"> <!-- Update image path accordingly -->

  <!-- Canonical Tag for SEO -->
  <link rel="canonical" href="https://www.reelcareer.co/apply">

  <!-- Standard Favicon -->
  <link rel="icon" type="image/x-icon" href="https://www.ReelCareer.co/images/favicons/favicon.ico">

  <!-- 32x32 Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://www.ReelCareer.co/images/favicons/favicon-32x32.png">

  <!-- 16x16 Favicon -->
  <link rel="icon" type="image/png" sizes="16x16" href="https://www.ReelCareer.co/images/favicons/favicon-16x16.png">

  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" sizes="180x180" href="https://www.ReelCareer.co/images/favicons/apple-touch-icon.png">

  <!-- Android Favicon (192x192) -->
  <link rel="icon" type="image/png" sizes="192x192" href="https://www.ReelCareer.co/images/favicons/android-chrome-192x192.png">

  <!-- Chrome Favicon (512x512) -->
  <link rel="icon" type="image/png" sizes="512x512" href="https://www.ReelCareer.co/images/favicons/android-chrome-512x512.png">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

  <!-- Bootstrap CSS -->
  <script src="../public/js/scripts.js"></script>
  <script src="../public/js/loadScripts.js"></script>
  <!-- Custom CSS -->
  <link rel="stylesheet" href="../public/css/styles.css">

</head>

<body>
  <script src="../public/js/bodyload.js"></script>

  <!-- Navigation Bar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">

  </nav>
  <main>
    <div class="container mt-5 mb-5">
      <h1 class="text-center mb-4 text-muted">Job Application</h1>

      <form id="applicationForm" class="shadow p-4 rounded bg-white" novalidate>

        <app>

          <!-- Applicant Information -->
          <h3 class="border-bottom pb-2 mb-4">Applicant Information</h3>
            <div id="jobPostedByArea" class="mb-4"></div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <div class="form-group">
                  <label for="firstName" class="font-weight-bold">First Name</label>
                  <input type="text" id="firstName" class="form-control" required>
                  <div class="invalid-feedback">Please enter your first name.</div>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <div class="form-group">
                  <label for="lastName" class="font-weight-bold">Last Name</label>
                  <input type="text" id="lastName" class="form-control" required>
                  <div class="invalid-feedback">Please enter your last name.</div>
                </div>
              </div>
            </div>

                        <!-- User Location -->
                        <div class="form-group">
                          <label for="userLocation" class="font-weight-bold">Location</label>
                          <input type="text" id="userLocation" oninput="autoSuggest(this.value,'locationSuggestions')" class="form-control  keywordInput location-input" placeholder="Enter your location">
                          <div class="invalid-feedback">Please enter a valid address.</div>
                        </div>
            
                        <div class="form-group mb-4">
                          <label for="phone" class="font-weight-bold">Phone</label>
                          <input type="tel" id="phone" class="form-control" required>
                          <div class="invalid-feedback">Please enter a valid phone number.</div>
                        </div>

            <div class="form-group mb-3">
              <label for="email" class="font-weight-bold">Email</label>
              <input type="email" id="email" class="form-control" required>
              <div class="invalid-feedback">Please enter a valid email address.</div>
            </div>



          <!-- Expected Salary -->
          <div class="form-group" id="salaryExpectionArea">
            <label for="expectedSalary" class="font-weight-bold">Expected Salary</label>
            <input type="text" id="expectedSalary" class="form-control"  onkeydown="restrictKeys(event)" aria-label="Salary Range" oninput="updateCurrency(this)" class="form-control" id="jobSalary" min="0" placeholder="Enter salary"  value="Negotiable">
          </div>



        </app>

        <!-- Custom Questions -->
        <h5 id="customQuestionsText" class="text-muted text-center mb-3">The following questions are provided by the recruiter and are optional.</h5>
        <div id="customQuestionsContainer" class="mb-4"></div>

        <!-- Imprint  -->
        <div class="text-center m-auto">
          <h3 class="font-weight-bold embedded-Logo">ReelCareer.co</h3>
        </div>

        <!-- Resume Submission Options -->
        <div class="container mt-5">
          <h3 class="border-bottom pb-2 mb-4">Resume Submission</h3>

          <!-- Your URLs -->
          <div class="form-group">
            <label for="portfolio" class="font-weight-bold">Portfolio</label>
            <input type="url" id="portfolio" class="form-control" placeholder="https://yourPortfolio.com">
          </div>
          <div class="form-group">

            <label for="linkedIn" class="font-weight-bold">LinkedIn</label>
            <input type="url" id="linkedIn" class="form-control" placeholder="https://www.linkedin.com/in/yourLinkedin">
          </div>
          <div class="form-group">

            <label for="website" class="font-weight-bold">Website</label>
            <input type="url" id="website" class="form-control" placeholder="https://yourWebsite.com">
          </div>

          <!-- Video Resume Upload -->
          <div class="form-group hide">
            <label for="videoResumeUpload" class="mb-5 font-weight-bold">Upload Video Resume (Coming Soon)</label>
            <input type="file" id="videoResumeUpload" class="form-control-file" disabled>
            <button type="button" id="createVideoResume" class="btn btn-link bg-colorLightGray outline" disabled>Create One</button>
          </div>

          <!-- Cover Letter -->
          <div class="form-group" id="coverLetterArea">
            <label for="coverLetter" class="font-weight-bold">Cover Letter</label>
            <textarea id="coverLetter" class="form-control" rows="3" placeholder="Summarize your experience..."></textarea>
          </div>

          <div class="file-upload-container form-group">
            <label class="file-upload-label" for="resumeInput">
              <span>Upload Resume (PDF, DOC, DOCX)</span>
              <input type="file" id="resumeInput" accept=".pdf, .doc, .docx" class="file-upload-input">
            </label>
            <div class="file-name-display" id="fileNameDisplay">No file selected</div>
          </div>

          <div id="previewModal" class="modal">
            <div class="modal-content">
              <button class="close-popup close" id="closeButton">âœ–</button>
              <div id="resumePreviewContent"></div>
              <input type="text" id="resumeTitle" placeholder="Enter Resume Title" class="resume-title-input">
              <div  id="useResume" class="modal-action-btn btn close">Use This Resume</div>
            </div>
          </div>

          <hr />

          <!-- Note to Recruiter -->
          <div class="form-group">
            <label for="noteToRecruiter" class="font-weight-bold">Note to Recruiter</label>
            <textarea id="noteToRecruiter" class="form-control" rows="3" placeholder="Write a brief note to the recruiter..."></textarea>
          </div>

          <hr />

          <!-- Nondisclosure Questions -->
          <div class="form-group mb-4">
            <p class="text-muted font-weight-bold">Voluntary Self-Identification</p>
            <p>This section is optional. Your response will not affect your application and is used solely for Equal Employment Opportunity (EEO) reporting purposes.</p>
          </div>

          <div class="form-group mb-4">
            <!-- Gender (optional) -->
            <label for="gender" class="font-weight-bold">Gender</label>
            <select class="form-control" id="gender">
              <option value="">Prefer not to answer</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Non-Binary">Non-Binary</option>
            </select>
          </div>

          <div class="form-group mb-4">
            <label for="preferredPronouns">Preferred Pronouns:</label>
            <select id="preferredPronouns" name="preferredPronouns">
              <option value="">Select your pronouns</option>
              <option value="he/him">He/Him</option>
              <option value="she/her">She/Her</option>
              <option value="they/them">They/Them</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group mb-4">
            <!-- Race/Ethnicity (optional) -->
            <label for="race" class="font-weight-bold mt-3">Race/Ethnicity</label>
            <select class="form-control" id="race">
              <option value="">Prefer not to answer</option>
              <option value="White">White</option>
              <option value="Black or African American">Black or African American</option>
              <option value="Asian">Asian</option>
              <option value="Hispanic or Latino">Hispanic or Latino</option>
              <option value="Native American or Alaska Native">Native American or Alaska Native</option>
            </select>
          </div>

          <div class="form-group mb-4">
            <!-- Veteran Status (optional) -->
            <label for="veteran" class="font-weight-bold mt-3">Veteran Status</label>
            <select class="form-control" id="veteran">
              <option value="">Prefer not to answer</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </div>

          <div class="form-group mb-4">
            <!-- Disability (optional) -->
            <label for="disability" class="font-weight-bold mt-3">Disability Status</label>
            <select class="form-control" id="disability">
              <option value="">Prefer not to answer</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </div>

          <!-- Consent Section -->
          <div class="form-group mb-4">
            <div class="form-check">
              <input type="checkbox" id="consentAcknowledgement" required class="form-check-input">
              <label for="consentAcknowledgement" class="form-check-label">
                I consent to the collection and sharing of my personal information as described in the
                <a href="https://reelcareer.co/views/privacy" class="text-light" rel="noopener noreferrer">Privacy Policy</a>.
              </label>
            </div>
          </div>

          <!-- Disclosure Section -->
          <div class="form-group mt-4">
            <label for="disclosureName" class="form-label font-weight-bold">Your Name</label>
            <input type="text" id="disclosureName" placeholder="Enter your name" class="form-control" required>
          </div>

          <div class="form-group mb-4">
            <label for="disclosureDate" class="form-label font-weight-bold">Date</label>
            <input type="date" id="disclosureDate" class="form-control" required>
          </div>

          <!-- Action Buttons -->
          <div class="form-group text-center mt-4">
            <button type="button" id="boostApplication" class="btn btn-warning btn-lg mx-2">Boost Application</button>
            <button type="button" id="previewApplication" class="btn btn-info btn-lg mx-2">Preview Application</button>
            <!--      <button type="button" id="saveForLater" class="btn btn-secondary btn-lg mx-2">Save for Later</button> -->
            <button type="submit" id="submitApplication" class="btn btn-success btn-lg mx-2">Submit Application</button>
          </div>

          <!-- Recruiter Interaction Buttons -->
          <div class="d-flex justify-content-between mt-4">
            <button type="button" id="backToJobPost" class="btn btn-light">Back to Job Post</button>
          </div>
        </div>

      </form>

    </div>

  </main>

  <style>
    /* Custom styles for enhanced UI/UX */
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f8f9fa;
    }

    app .form-group {
      transition: box-shadow 0.3s, transform 0.3s;
      padding: 10px;
      background-color: #ffffff;
      border-radius: 25px;
    }

    app .form-group:hover {
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      transform: scale(1.02);
    }

    .progress {
      height: 20px;
    }

    /* Tooltip styles */
    .tooltip-inner {
      background-color: #5cb85c;
    }

    .tooltip-arrow {
      border-top-color: #5cb85c;
    }

    .custom-control-enhanced {
      position: relative;
      display: flex;
      align-items: center;
      padding-left: 40px;
      margin-bottom: 12px;
    }

    .custom-radio-enhanced .custom-control-input {
      position: absolute;
      left: 0;
      z-index: -1;
      width: 1rem;
      height: 1rem;
      opacity: 0;
    }

    .custom-radio-enhanced .custom-control-label {
      position: relative;
      margin-bottom: 0;
      padding-left: 2.5rem;
      cursor: pointer;
      font-size: 1rem;
      color: #495057;
      transition: color 0.2s;
      font-weight: 800;
    }

    .custom-radio-enhanced .custom-control-label:before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      width: 1.5rem;
      height: 1.5rem;
      border: 2px solid #343535;
      border-radius: 50%;
      background-color: transparent;
      transform: translateY(-50%);
      transition: all 0.2s;
    }

    .custom-radio-enhanced .custom-control-input:checked~.custom-control-label:before {
      background-color: #9482ff;
      border-color: #606060;
    }

    .custom-radio-enhanced .custom-control-input:checked~.custom-control-label:after {
      content: '';
      position: absolute;
      top: 50%;
      left: 0.5rem;
      width: 0.5rem;
      height: 0.5rem;
      background-color: white;
      border-radius: 50%;
      transform: translateY(-50%);
    }

    .custom-radio-enhanced:hover .custom-control-label:before {
      border-color: #4398f3;
    }


            /* File Upload Container */
.file-upload-container {
    display: flex;
    align-items: center;
    gap: 10px;
    font-family: Arial, sans-serif;
    margin: 20px 0;
}

/* Label Button Styling */
.file-upload-label {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    background-color: #007bff;
    color: #fff;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    font-weight: 500;
}

.file-upload-label:hover {
    background-color: #0056b3;
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
}

.file-upload-label span::before {
    content: ""; /* Add an icon before the label text */
    margin-right: 8px;
}

/* Hide the native file input */
.file-upload-label input[type="file"] {
    display: none;
}

/* Display Selected File Name */
.file-name-display {
    font-size: 14px;
    color: #666;
}

/* Hover and Focus States */
.file-upload-label:focus-within {
    outline: 2px solid #0056b3;
    outline-offset: 2px;
}


/* Media Query for Responsive Text */
@media (max-width: 600px) {
    .file-upload-label {
        font-size: 14px;
        padding: 10px 16px;
    }
    .file-name-display {
        font-size: 13px;
    }
}

    .modal {
      display: none;
      /* Hidden by default */
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
      /* Background overlay */
    }

    .modal-content {
      position: relative;
      background-color: #fff;
      margin: 10% auto;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
    }

    .close-popup {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 20px;
      color: #888;
      cursor: pointer;
      background: transparent;
      border: none;
    }

    .modal-action-btn {
      margin-top: 10px;
      padding: 8px 16px;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .modal-action-btn:hover {
      background-color: #0056b3;
    }
  </style>

  <script>
    const resumeInput = document.getElementById('resumeInput');
    const fileNameDisplay = document.getElementById('fileNameDisplay');
    const resumePreviewModal = document.getElementById('previewModal');
    const resumePreviewContent = document.getElementById('resumePreviewContent');
    const useResume = document.getElementById('useResume');
    const closeButton = document.getElementById('closeButton');
    const resumeTitleInput = document.getElementById('resumeTitle');
    // Handle file selection and preview
    resumeInput.addEventListener('change', handleFiles);

    function handleFiles() {
  if (resumeInput.files.length > 0) {
    const file = resumeInput.files[0];
    const fileName = file.name;
    fileNameDisplay.textContent = fileName;

// Open the modal for preview
openModal(file);  

// Add onclick event to display the filename as a clickable button
fileNameDisplay.onclick = function() {
  fileNameDisplay.style.display = 'block';
  fileNameDisplay.classList.add("btn");  // Use classList.add to add the class
};

// Handle case when no file is selected
} else {
  fileNameDisplay.textContent = 'Upload Resume (PDF, DOC, DOCX)';  // Reset display
  fileNameDisplay.classList.remove("btn");  // Use classList.remove to remove the class
}

}

// Open modal to preview the resume
function openModal(file) {
  // Check if the file is an image
  const isImage = /\.(jpe?g|png|gif)$/i.test(file.name);
  const isPDF = /\.pdf$/i.test(file.name);

  // Create preview content
  let previewContent = `<p>File: ${file.name}</p>`;

  if (isImage) {
    const reader = new FileReader();
    reader.onload = function(e) {
      previewContent += `<img src="${e.target.result}" alt="Image Preview" style="max-width:100%; margin-top: 10px;">`;
      resumePreviewContent.innerHTML = previewContent;  // Insert content into modal
      resumePreviewModal.style.display = 'block';  // Show the modal
    };
    reader.readAsDataURL(file);  // Load image as base64 URL
  } else if (isPDF) {
    const pdfUrl = URL.createObjectURL(file);
    previewContent += `
      <object data="${pdfUrl}" type="application/pdf" width="100%" height="500px">
        <p>Your browser does not support inline PDF previews. <a href="${pdfUrl}" target="_blank">Download PDF</a></p>
      </object>
    `;
    resumePreviewContent.innerHTML = previewContent;
    resumePreviewModal.style.display = 'block';
  } else {
    previewContent += `<p>No preview available. Please upload a PDF or image file.</p>`;
    resumePreviewContent.innerHTML = previewContent;
    resumePreviewModal.style.display = 'block';
  }
}

    // Close the modal
    closeButton.onclick = function() {
      event.preventDefault(); // Prevent the form from refreshing the page

      resumePreviewModal.style.display = 'none';
    };
    // Handle save action
    useResume.onclick = function() {
      event.preventDefault(); // Prevent the form from refreshing the page

      const resumeTitle = resumeTitleInput.value;

      // Add saving logic here
      //   showToast("Saving resume with title:", resumeTitle, "info");
      // Close modal after saving
      resumePreviewModal.style.display = 'none';
    };
    // Close modal when clicking outside of it
    window.onclick = function(event) {
      if (event.target === previewModal) {
        resumePreviewModal.style.display = 'none';
      }
    };
    // Drag and Drop functionality
    const fileUploadLabel = document.querySelector('.file-upload-label');
    fileUploadLabel.addEventListener('dragover', (e) => {
      e.preventDefault();
      fileUploadLabel.style.backgroundColor = '#e2e6ea'; // Background on drag over
    });
    fileUploadLabel.addEventListener('dragleave', (e) => {
      fileUploadLabel.style.backgroundColor = '#f8f9fa'; // Reset background
    });
    fileUploadLabel.addEventListener('drop', (e) => {
      e.preventDefault();
      fileUploadLabel.style.backgroundColor = '#f8f9fa'; // Reset background
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        resumeInput.files = files; // Assign the files to the input
        handleFiles(); // Process the dropped files
      }
    });











    // Function to load custom questions into the container
    function loadCustomQuestions(customQuestions) {
      const customQuestionsContainer = document.getElementById('customQuestionsContainer');
      console.log("Loading Custom Questions. Current content:", customQuestionsContainer.innerHTML);
      // Clear existing questions
      customQuestionsContainer.innerHTML = '';
      if (!Array.isArray(customQuestions) || customQuestions.length === 0) {
        customQuestionsContainer.innerHTML = '';
        document.getElementById('customQuestionsText').style.display = "none";
        return;
      }
      let questionCount = 0; // Initialize question count
      customQuestions.forEach(question => {
        questionCount++; // Increment question count
        let inputElement;
        // Ensure each question has a unique id
        if (!question.id) {
          console.warn("Missing question.id for question: ", question);
          question.id = `question_${questionCount}`; // Assign a dummy ID based on count
        }
        switch (question.type) {
          case 'multiple-choice':
            inputElement = `
                <div class="form-group border rounded p-4 mb-4 shadow-sm bg-light">
                    <label class="font-weight-bold">Question #${questionCount}</label>
                    <hr>
                    <p>${question.question}</p>
                    <div class="custom-control-wrapper">
                        ${question.options.map(option => `
                            <div class="custom-control custom-radio custom-radio-enhanced mb-3">
                                <input type="radio" id="option-${option}-${question.id}" name="question-${question.id}" class="custom-control-input" value="${option}">
                                <label class="custom-control-label" for="option-${option}-${question.id}">${option}</label>
                            </div>
                        `).join('')}
                    </div>
                </div>
                `;
            break;
          case 'statement':
            inputElement = `
                <div class="form-group border rounded p-3 mb-4 shadow-sm bg-light">
                    <label class="font-weight-bold">Question #${questionCount}</label>
                    <hr/>
                    <p>${question.question}</p>
                    <textarea class="form-control" id="${question.id}" rows="3" placeholder="Your answer here..."></textarea>
                </div>
                `;
            break;
          default:
            console.warn('Unknown question type:', question.type);
            break;
        }
        customQuestionsContainer.insertAdjacentHTML('beforeend', inputElement);
      });
    }
    document.getElementById('previewApplication').addEventListener('click', () => {
      const firstName = document.getElementById('firstName').value;
      const lastName = document.getElementById('lastName').value;
      const userLocation = document.getElementById('userLocation').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;
      const expectedSalary = document.getElementById('expectedSalary').value;
      const noteToRecruiter = document.getElementById('noteToRecruiter').value;
      console.log("previewApplication");
      // Collecting custom questions responses
      const customQuestionsResponses = [];
      // Get custom questions from the customQuestionsContainer
      const customQuestions = document.querySelectorAll('#customQuestionsContainer .form-group'); // Select the form groups
      customQuestions.forEach((question, index) => {
        console.log("question  ",question);

        const questionId = question.querySelector('label').innerText; // Getting question text as ID
        let previewQuestion = question.querySelector('p').innerText;
        let answer;
        // Check if it's a multiple-choice question
// Check if the question has multiple-choice options
const selectedOption = question.querySelector(`input[name="question-question_${index+1}"]:checked`);
  
  if (selectedOption) {
    // If a radio button is selected, use its value

    previewAnswer = selectedOption.value;
  } else {
    // Otherwise, check if there's a textarea (for open-ended answers)
    const textarea = question.querySelector('textarea');
    previewAnswer = textarea ? textarea.value.trim() : 'No answer provided';
  }

  // Store question and answer in the responses array
  customQuestionsResponses.push({
    questionId,
    question: previewQuestion,
    answer: previewAnswer
  });

  
      });
      // Function to create and display preview modal
      function showPreviewModal() {
        // Create preview content
        const previewContent = `
            <h3 class="text-primary">Application Preview</h3>
            <p><strong>First Name:</strong> ${firstName}</p>
            <p><strong>Last Name:</strong> ${lastName}</p>
            <p><strong>Location:</strong> ${userLocation}</p>
            <p><strong>Phone:</strong> ${phone}</p>
            <p><strong>Email:</strong> ${email}</p>
            <p><strong>Expected Salary:</strong> ${expectedSalary}</p>
            <p><strong>Note to Recruiter:</strong> ${noteToRecruiter || 'No note provided.'}</p>
            <h4 class="mt-3">Custom Questions</h4>
            <ul class="list-group">
                ${customQuestionsResponses.map(response => `
                    <li class="list-group-item">
                        <strong>${response.questionId}:</strong><p>${response.question}</p> ${response.answer || 'No response'}
                    </li>
                `).join('')}
            </ul>
        `;
        // Create modal structure
        const previewModal = document.createElement('div');
        previewModal.className = 'modal fade show';
        previewModal.style.display = 'block'; // Show modal immediately
        previewModal.innerHTML = `
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Application Preview</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        ${previewContent}
                    </div>
                    <div class="modal-footer">
<button type="button" class="btn btn-secondary close-btn" data-dismiss="modal">Close</button> <!-- Footer close button -->
                    </div>
                </div>
            </div>
        `;

        // Append modal to the body
        document.body.appendChild(previewModal); // Use document.body instead of document.main
  
  // Close modal on close button click
  const closeModal = () => {
   document.body.removeChild(previewModal); // Remove modal when closed
  };
 

  // Add event listeners to both close buttons
  previewModal.querySelector('.close').addEventListener('click', closeModal);
  previewModal.querySelector('.close-btn').addEventListener('click', closeModal);

  showPreviewModal(); // Call the function to show the preview modal

      }
 

  });
  </script>

  <!-- Footer -->
  <footer id="dynamic-footer"></footer>

  <!-- Firebase configuration/ Login& Out -->
  <script type="module" src="../public/js/main.js"></script>

  <!-- Dynamic Schema Markup -->
  <script type="module">
    import {
      db,
      storage,
      analytics,
      auth,
      app
    } from '../public/js/main.js'; // Adjust the path based on your structure
    import {
      query,
      where,
      arrayUnion,
      updateDoc,
      getDoc,
      doc,
      orderBy,
      limit,
      collection,
      getDocs,
      addDoc
    } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
    // Function to extract the user ID from URL parameters
    function getUserIdFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get('userId');
    }
    // Function to retrieve jobId from the URL
    function getJobIdFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get('jobId');
    }
    let jobTitle = '';
    let companyData = '';
    let jobData = '';
    let jobId = '';
    let userIdURL = '';
    let userId = '';
    async function initializeUserId() {
      try {
        // Wait for the Firebase Auth state to initialize
        await auth.onAuthStateChanged((user) => {
          if (user) {
            userId = user.uid; // Access the user ID
            //   console.log("User ID:", userId);
            // You can call your functions that require userId here
            // Example usage
            userIdURL = getUserIdFromURL();
            jobId = getJobIdFromURL();

            // Load job and company info on page load
            if (jobId != null) {  // Check if jobDocRef is NOT null
                          //console.log("jobId   ",jobId,"  userIdURL  ",userIdURL);
            const jobDocRef = doc(db, 'Jobs', jobId); // Reference to the job document
  fetchJobAndCompanyInfo(jobDocRef);
} else {
  // Show error message if jobDocRef is null
  const applicationForm = document.getElementById('applicationForm');
  applicationForm.textContent = "";  // Clear any existing content

  applicationForm.innerHTML = `
    <h2>Error Fetching Job Application</h2>
    <p>There was an error retrieving the job details. Please try again later.</p>
    <a href="/job-listing-page" class="btn btn-primary">Back to Jobs</a>
  `;
}

          } else {
            console.error("No user is signed in.");
            // Handle the case where the user is not signed in
          }
        });
      } catch (error) {
        console.error("Error initializing user ID:", error);
      }
    }
    initializeUserId(); // Call the function to initialize user ID
    // Assuming userIdURL is defined and accessible
    if (userIdURL !== userId) {
      console.warn("Unauthorized access attempt detected! User ID mismatch.");
      console.log("What are you doing?");
      // Optionally, you could redirect the user or show a warning in the UI
      // window.location.href = 'error.html'; // Redirect example
      // showToast("You are not authorized to view this page.", "error"); // Example toast message
    } else {
      console.log("Access granted. Proceeding with the operation.");
    }
    document.getElementById('backToJobPost').addEventListener('click', () => {
      window.history.back(); // Back to the previous page
    });
    // Show loading spinner
    // Function to gather answers from custom questions
    function getCustomAnswers(customQuestions) {
      const customAnswers = {};
      customQuestions.forEach((question, index) => {
        let answer;
        //        console.log("Processing question: ", question);
        // Ensure question.id is valid
        if (!question.id) {
          console.warn("Missing question.id for question: ", question);
        }
        switch (question.type) {
          case 'multiple-choice':
            const selectedOption = document.querySelector(`input[name="question-${question.id}"]:checked`);
            answer = selectedOption ? selectedOption.value : 'No option selected';
            break;
          case 'statement':
            answer = document.getElementById(question.id)?.value?.trim() || 'N/A'; // Default for statements
            break;
          default:
            console.warn(`Unhandled question type: ${question.type}`);
            answer = "N/A";
            break;
        }
        // Store both the question and its answer in the customAnswers object
        customAnswers[question.id] = {
          question: question.question,
          answer: answer,
          timestamp: new Date().toLocaleString()
        };
      });
      return customAnswers;
    }
    // Fetch Job and Company Information
    async function fetchJobAndCompanyInfo(jobDocRef) {
      try {
        const jobDoc = await getDoc(jobDocRef); // Get the job document
        if (!jobDoc.exists()) {
          throw new Error('Job not found.');
        }
        jobData = jobDoc.data();
        jobTitle = jobData.title;
        jobId = getJobIdFromURL();
        // Populate job information and company information
        document.getElementById('jobPostedByArea').innerHTML = ` 
    <div class="card border-primary mb-4 shadow-sm">
        <div class="card-header bg-primary text-white font-weight-bold">
            Job Details
        </div>
        <div class="card-body">
            <h5 class="card-title">${jobData.title}</h5>
            <h6 class="card-subtitle mb-2 text-muted">${jobData.company}</h6>
            <div class="d-flex justify-content-between">
                <p class="card-text"><strong>Location:</strong> ${jobData.location}</p>
                <p class="card-text"><strong>Type:</strong> ${jobData.type}</p>
            </div>
            <div class="d-flex justify-content-between">
                <p class="card-text"><strong>Industry:</strong> ${jobData.industry}</p>
                <p class="card-text"><strong>Salary:</strong> ${jobData.salary} ${jobData.salaryPayTime ? jobData.salaryPayTime : ''}</p>
            </div>
            <p class="card-text"><strong>Posted on:</strong> ${new Date(jobData.createdAt.seconds * 1000).toLocaleDateString()}</p>
            <div class="text-center">
                <a href="job-detail?id=${jobId}" class="btn btn-primary btn-lg">View More Details</a>
            </div>
        </div>
    </div>
`;
        console.log("Custom Questions:", jobData.customQuestions);
        loadCustomQuestions(jobData.customQuestions);
      } catch (error) {
        console.error('Error fetching job and company info:', error);
        showToast('Failed to load job information. Please try again.', 'error');
      }
    }
    // Function to sanitize user input
    function sanitizeInput(input) {
      return input.trim().replace(/<[^>]*>/g, '');
      return input;
    }
    // Form Validation
    function validateForm() {
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const linkedIn = document.getElementById('linkedin').value.trim();
  const portfolio = document.getElementById('portfolio').value.trim();
  const website = document.getElementById('website').value.trim();

  // Email validation
  const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
  if (!emailPattern.test(email)) {
    showToast('Invalid email format.', 'error');
    return false;
  }

  // Phone validation - checking for numeric values with 10-15 digits
  const phonePattern = /^\d{10,15}$/;
  if (!phonePattern.test(phone)) {
    showToast('Phone number must be numeric and between 10 to 15 digits.', 'error');
    return false;
  }

  // URL validation pattern for LinkedIn, portfolio, and website
  const urlPattern = /^(https?:\/\/)?([\w-]+\.)+[\w-]{2,6}\/?/;

  // LinkedIn validation
  if (linkedIn && !urlPattern.test(linkedIn)) {
    showToast('Invalid LinkedIn URL format.', 'error');
    return false;
  }

  // Portfolio validation
  if (portfolio && !urlPattern.test(portfolio)) {
    showToast('Invalid portfolio URL format.', 'error');
    return false;
  }

  // Website validation
  if (website && !urlPattern.test(website)) {
    showToast('Invalid website URL format.', 'error');
    return false;
  }

  return true;
}
    // Function to handle application submission
    async function submitApplication(event, isBoosted) {
      // const userId = auth.currentUser ? auth.currentUser.uid : null; // Get user ID
      event.preventDefault(); // Prevent the form from refreshing the page
      // Now proceed with your form submission logic
      const formData = new FormData(this);
      // Example: log the form data
      //console.log('Form submitted:', formData);
      if (!userId) {
        showToast('You must be logged in to apply.', 'error');
        return;
      }
      //    console.log("userId  ",userId);
      const jobId = getJobIdFromURL();
      // console.log("jobId  ",jobId);
      if (jobData.applicationAvailableBool) {
        // Validate form fields before proceeding
        if (!validateForm()) {
          return;
        }
        // const userId = getUserIdFromURL();
        const jobId = getJobIdFromURL();
        // Assuming these values are populated elsewhere
        const jobTitle = jobData.title;
        const companyName = jobData.company;
        const companyId = jobData.companyId;
        const referralSource = new URLSearchParams(window.location.search).get('referralSource') || 'Direct Visit'; // Get referral source from URL
        const experienceSummary = document.getElementById('experienceSummary').value;
        const expectedSalary = document.getElementById('expectedSalary').value;
        const linkedIn = sanitizeInput(document.getElementById('linkedin').value);
        const portfolio = sanitizeInput(document.getElementById('portfolio').value);
        const website = sanitizeInput(document.getElementById('website').value);

      // Retrieve answers for custom questions
        const customAnswers = getCustomAnswers(jobData.customQuestions);
        // Prepare main application data
        const applicationData = {
          firstName: sanitizeInput(document.getElementById('firstName').value),
          lastName: sanitizeInput(document.getElementById('lastName').value),
          location: sanitizeInput(document.getElementById('userLocation').value),
          email: sanitizeInput(document.getElementById('email').value),
          phone: sanitizeInput(document.getElementById('phone').value),
          feedback: sanitizeInput(document.getElementById('noteToRecruiter').value),
          jobTitle: jobTitle,
          companyName: companyName || "",
          companyId: companyId,
          boostedApp: isBoosted,
          jobId: jobId,
          status: [{
            status: "active",
            timestamp: new Date().toLocaleString()
          }],
          statusHistory: [{
            status: "applied",
            timestamp: new Date().toLocaleString(),
          }],
          notes: [],
          interviewRequestBool: false,
          interviewRequestDate: '',
          testRequestBool: false,
          testRequestExpireDate: '',
          testRequestNames: [],
          views: 0,
          applicantCount: increment(1),
          resumeViews: 0,
          videoResumeViews: 0,
          userId: userId,
          customAnswers: customAnswers,
          applyDate: new Date().toLocaleString(),
          source: referralSource,
          digitalResume: "",
          userLinks: {
            LinkedIn: linkedIn,
            Website: website,
            Portfolio: portfolio
          }, // optional social links
          coverLetter: sanitizeInput(document.getElementById('coverLetter').value),
          expectedSalary: expectedSalary, // or collected from the applicant
          boostNotes: isBoosted ? "Application boosted on " + new Date().toLocaleString() : "",
        };
        //  console.log("applicationData  ",applicationData);
        // Prepare applicant PDC data (Personal Data Compliance)
        const applicant_PDC = {
          gender: sanitizeInput(document.getElementById('gender').value),
          race: sanitizeInput(document.getElementById('race').value),
          veteran: sanitizeInput(document.getElementById('veteran').value),
          disability: sanitizeInput(document.getElementById('disability').value),
          preferredPronouns: sanitizeInput(document.getElementById('preferredPronouns').value || ""),
          consentAcknowledgement: document.getElementById('consentAcknowledgement').checked,
          disclosureName: sanitizeInput(document.getElementById('disclosureName').value),
          disclosureDate: sanitizeInput(document.getElementById('disclosureDate').value),
          disclosureLocation: sanitizeInput(document.getElementById('userLocation').value || ""),
          legalDisclosures: document.getElementById('legalDisclosures')?.checked || false,
          // Job-specific information
          jobTitle: jobTitle,
          companyName: companyName || "",
          jobId: jobId,
          submitted: new Date().toLocaleString(),
        };
        // console.log("applicant_PDC  ",applicant_PDC);
        //return;
        try {
          // Show loading indicator if you have one
          // Upload files
          await uploadFile('resumeInput', 'resumes', applicationData, 'resumeUrl');
          //   await uploadFile('videoResumeUpload', 'video_resumes', applicationData, 'videoResumeUrl');
          // Submit the application data to Firestore
          await addDoc(collection(db, 'Applications'), applicationData);
          // Send the applicant's personal data compliance (PDC) information
          await sendToAppDataCompliance(applicant_PDC);
          // Update user's document with the job application info
          const userDocRef = doc(db, 'Users', userId); // Reference to the user's document
          await updateDoc(userDocRef, {
            userApps: arrayUnion({
              JobID: jobId,
              JobTitle: jobTitle,
              CompanyName: companyName,
              Status: status, // e.g., "Active," "Interview Scheduled"
              IsBoosted: isBoosted, // Shows if the application was boosted
              ApplyDate: new Date().toISOString(),
              // Additional helpful fields for user summary
              Location: jobLocation, // Location of the job, if available
              ApplicationCount: applicationCount + 1, // Keeps track of the total applications user has submitted
              LastStatusUpdate: new Date().toISOString(), // Tracks when the status was last updated
              ResumeLastViewed: null, // Tracks last viewed date of resume by recruiter
              Notes: [], // Allows user or system to add notes about the application
              AppliedFromPlatform: platform, // Captures source if multi-platform (e.g., website, mobile app)
              UpcomingInterviewDate: interviewDate || null, // Tracks any scheduled interviews
              RequiredTestsCompleted: false, // Tracks if user completed required assessments or tests
            })
          });
          // Show success message
          showToast('Application submitted successfully!', 'success');
        } catch (error) {
          console.error('Error submitting application:', error);
          showToast('Error submitting application. Please try again.', 'error');
        } finally {}
      }
    }
    // Event listener for regular application submission
    document.getElementById('submitApplication').addEventListener('click', (event) => {
      submitApplication(event, false); // Regular application
    });
    // Event listener for boosted application submission
    document.getElementById('boostApplication').addEventListener('click', (event) => {
      submitApplication(event, true); // Boosted application
    });
    // Function to upload files and add their URLs to the applicantData
    async function uploadFile(inputId, folder, applicantData, urlKey) {
      const file = document.getElementById(inputId).files[0];
      if (file) {
        const fileRef = storage.ref(`${folder}/${file.name}`);
        await fileRef.put(file);
        applicantData[urlKey] = await fileRef.getDownloadURL();
      }
    }
    // Function to send applicant_PDC to AppDataCompliance collection
    async function sendToAppDataCompliance(applicantData) {
      try {
        const docRef = await addDoc(collection(db, 'AppDataCompliance'), applicantData);
        // console.log('Document written with ID: ', docRef.id);
      } catch (error) {
        // console.error('Error adding document to AppDataCompliance:', error);
      }
    }
    let viewStartTime;
    // Function to set the last internal page in sessionStorage before navigating
    function setInternalPageSource() {
      sessionStorage.setItem('lastInternalPage', window.location.href);
    }
    // Function to start tracking the view time when the page loads
    function startViewTimer() {
      viewStartTime = Date.now();
    }
    // Function to update the application's 'applicantsViewed' count, view source, and view duration in Firebase
    async function updateApplicationViewData() {
      // Calculate view duration in seconds
      const viewEndTime = Date.now();
      const durationOfView = (viewEndTime - viewStartTime) / 1000; // Convert ms to seconds
      // Determine the source
      const externalSource = document.referrer && !document.referrer.includes(window.location.origin) ?
        document.referrer :
        null;
      const internalSource = sessionStorage.getItem('lastInternalPage');
      const viewSource = externalSource || internalSource || 'Direct Visit';
      // Retrieve job and user information
      const jobId = new URLSearchParams(window.location.search).get('jobId'); // Get jobId from URL
      const jobTitle = document.getElementById('jobTitle')?.innerText || ''; // Job title can be set here if needed
      const userId = new URLSearchParams(window.location.search).get('userId');
      const viewerRole = auth.currentUser ? 'job seeker' : 'guest'; // Set role based on login status
      const referralSource = new URLSearchParams(window.location.search).get('referralSource') || 'Direct Visit'; // Get referral source from URL
      // Validate job ID before proceeding
      if (!jobId) {
        console.error("Missing jobId. View data not recorded.");
        return;
      }
      // Update the job view data in the Jobs collection
      try {
        await updateDoc(doc(db, 'Jobs', jobId), {
          viewedBy: arrayUnion({
            viewerId: userId, // ID of the user or 'guest'
            viewerRole: viewerRole, // Role of the viewer (e.g., 'job seeker', 'recruiter', or 'guest')
            viewDate: new Date().toISOString(),
            viewMethod: navigator.userAgentData?.mobile ? "mobile" : "desktop", // Detects desktop or mobile view
            durationOfView: durationOfView || null, // Optional: estimated duration of view in seconds
            viewSource: viewSource, // Tracks the source of the view
            referralSource: referralSource // Tracks the referral source
          }),
          applicantsViewed: increment(1),
        });
        console.log("Job view data updated successfully.");
      } catch (error) {
        console.error("Error updating job view data:", error);
      }
    }
    // Event listener to set last internal page before navigating away
    window.addEventListener('beforeunload', setInternalPageSource);
    // Event listener to start timing the view when the page loads
    window.addEventListener('load', startViewTimer);
    // Event listener to record data when the page is unloaded
    window.addEventListener('beforeunload', updateApplicationViewData);
    // Function to load form values from local storage
    function loadFormValues() {
      // Load stored user data
      const storedUserData = localStorage.getItem('userData');
      if (storedUserData) {
        // Parse the stored data
        const userData = JSON.parse(storedUserData);
        document.getElementById('portfolio').value = userData.portfolio || '';
        document.getElementById('userLocation').value = userData.location || '';
        document.getElementById('email').value = userData.email || '';
        document.getElementById('website').value = userData.other || '';
      }
      // Load job form values
      const formValues = localStorage.getItem('jobFormValues');
      if (formValues) {
        const parsedFormValues = JSON.parse(formValues);
        // Loop through form fields and set their values or set to empty if they don't exist
        for (const [key, value] of Object.entries(parsedFormValues)) {
          const inputElement = document.getElementById(key);
          if (inputElement) {
            inputElement.value = value || '';
          }
        }
        showToast('Form values loaded successfully!', "success");
      }
      if (jobData) {
        // Display or hide cover letter area based on jobData.coverLetter
        if (jobData.requestExpectedSalary) {
          document.getElementById('salaryExpectionArea').style.display = "block";
        } else {
          document.getElementById('salaryExpectionArea').style.display = "none";
          document.getElementById('expectedSalary').value = "Not Asked";
        }       
         if (jobData.coverLetter) {
          document.getElementById('coverLetterArea').style.display = "block";
        } else {
          document.getElementById('coverLetterArea').style.display = "none";
          document.getElementById('coverLetter').value = "Not Asked";
        }
        // Set or remove 'required' attribute for cover letter based on jobData.requiredCoverLetter
        const coverLetterField = document.getElementById('requiredCoverLetter');
        if (jobData.requiredCoverLetter) {
          coverLetterField.setAttribute("required", "true");
        } else {
          coverLetterField.removeAttribute("required");
        }
        // Set or remove 'required' attribute for resume based on jobData.resumeRequired
        const resumeField = document.getElementById('resumeInput');
        if (jobData.resumeRequired) {
          resumeField.setAttribute("required", "true");
        } else {
          resumeField.removeAttribute("required");
        }
      }
    }
    // Function to save form values to local storage
    function saveFormValues() {
      const formValues = {
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        email: document.getElementById('email').value,
        userLocation: document.getElementById('userLocation').value,
        phone: document.getElementById('phone').value,
        gender: document.getElementById('gender').value,
        race: document.getElementById('race').value,
        veteran: document.getElementById('veteran').value,
        disability: document.getElementById('disability').value,
        consentAcknowledgement: document.getElementById('consentAcknowledgement').checked,
        disclosureName: document.getElementById('disclosureName').value,
        legalDisclosures: document.getElementById('legalDisclosures').value,
        preferredPronouns: document.getElementById('preferredPronouns').value,
        disclosureDate: document.getElementById('disclosureDate').value,
        portfolio: document.getElementById('portfolio').value,
        website: document.getElementById('website').value,
        coverLetter: document.getElementById('coverLetter').value,
        expectedSalary: document.getElementById('expectedSalary').value,
      };
      // Store form values in local storage
      localStorage.setItem('jobFormValues', JSON.stringify(formValues));
      showToast('Form values saved successfully!', "success");
    }
    // Load form values when the page is loaded
    window.onload = loadFormValues;
    // Save form values when the form is submitted (add this to your form submit handler)
    document.getElementById('applicationForm').onsubmit = function() {};
  </script>

</body>

</html>