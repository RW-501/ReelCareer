<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Explore the company profile, latest job openings, and get insights into the work environment.">
    <meta name="keywords" content="company profile, job openings, work environment, careers, apply now, job alerts">
    <meta name="robots" content="index, follow">
    <title>Company Profile - [Company Name]</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        /* Custom styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }
        .company-media img, .company-media video {
            max-width: 100%;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .cta-buttons a {
            margin-right: 15px;
            transition: background-color 0.3s;
        }
        .cta-buttons a:hover {
            background-color: #0056b3; /* Change the color on hover */
            color: #fff; /* Change text color on hover */
        }
        .loading-state {
            text-align: center;
            font-size: 1.2em;
        }
        .social-icons a {
            margin: 0 5px;
            color: #007bff;
            text-decoration: none;
        }
        .social-icons a:hover {
            color: #0056b3; /* Change color on hover */
        }
    </style>

    <script src="../public/js/scripts.js"></script>
    <script src="../public/js/loadScripts.js"></script>
    <link rel="stylesheet" href="../public/css/styles.css">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="../index.html">ReelCareer</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="job-listings.html">Jobs</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Companies</a></li>
                    <li class="nav-item"><a class="nav-link" href="auth.html">Login</a></li>
                </ul>
            </div>
        </div>
    </nav>
    
    <main>
        <section class="container mt-5">
            <div class="row">
                <div class="col-md-8">
                    <h2 id="companyName" class="loading-state">Loading...</h2>
                    <input type="text" id="editCompanyName" class="form-control" style="display:none;" placeholder="Enter Company Name">
                    
                    <p id="companyDescription" class="lead loading-state">Loading description...</p>
                    <textarea id="editCompanyDescription" class="form-control" rows="3" style="display:none;" placeholder="Enter Company Description"></textarea>
                    
                    <p><strong>Industry:</strong> <span id="companyIndustry" class="loading-state">Loading...</span></p>
                    <input type="text" id="editCompanyIndustry" class="form-control" style="display:none;" placeholder="Enter Industry">
                    
                    <p><strong>Location:</strong> <span id="companyLocation" class="loading-state">Loading...</span></p>
                    <input type="text" id="editCompanyLocation" class="form-control" style="display:none;" placeholder="Enter Location">
                    
                    <div id="editButtons" style="display:none;">
                        <button id="saveChangesBtn" class="btn btn-primary mt-3">Save Changes</button>
                        <button id="cancelChangesBtn" class="btn btn-secondary mt-3">Cancel</button>
                    </div>
                    
                    <!-- Company Job Listings -->
                    <h3>Current Job Openings</h3>
                    <div id="jobListings" class="list-group">
                        <!-- Job listings will be dynamically inserted here -->
                    </div>
                </div>
                <div class="col-md-4 text-center">
                    <img id="companyLogo" src="../images/sq_logo_n_BG.png" alt="Company Logo" class="img-fluid rounded-circle">
                    <input type="file" id="editCompanyLogo" class="form-control mt-2" style="display:none;">
                    <button id="editProfileBtn" class="btn btn-secondary" style="display:none;">Edit Profile</button>
                    
                    <!-- Social Media Links -->
                    <div class="social-icons mt-3">
                        <a href="#" aria-label="Facebook" target="_blank">Facebook</a>
                        <a href="#" aria-label="Twitter" target="_blank">Twitter</a>
                        <a href="#" aria-label="LinkedIn" target="_blank">LinkedIn</a>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Footer -->
    <footer id="dynamic-footer" class="text-center mt-5"></footer>
    
    <!-- Firebase configuration/ Login& Out -->
    <script type="module" src="../public/js/main.js"></script> 

    <!-- Dynamic Schema Markup -->
    <script type="module">
        import { db, auth } from '../public/js/main.js';
        import { doc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const urlParams = new URLSearchParams(window.location.search);
        const companyId = urlParams.get('companyId');
        const userId = auth.currentUser ? auth.currentUser.uid : null; // Get the current user's ID

        // Check if a companyId exists in the URL
        if (companyId) {
            // Fetch company data from Firestore
            const companyRef = doc(db, "Companies", companyId);
            getDoc(companyRef).then((docSnapshot) => {
                if (docSnapshot.exists()) {
                    const companyData = docSnapshot.data();
                    document.getElementById("companyName").innerText = companyData.name;
                    document.getElementById("companyDescription").innerText = companyData.description;
                    document.getElementById("companyIndustry").innerText = companyData.industry;
                    document.getElementById("companyLocation").innerText = companyData.location;

                    // Load job listings
                    loadJobListings(companyId);

                    // Check if the user is the admin of this company
                    if (userId === companyData.adminId) {
                        // Show editable fields
                        toggleEditMode(true);
                    }
                } else {
                    // Handle the case when the company does not exist
                    console.log("Company not found");
                }
            }).catch((error) => {
                console.error("Error fetching company data:", error);
            });
        } else {
            // No companyId in the URL; show empty fields for creating a company
            toggleEditMode(false);
        }

        // Load Job Listings


// Load Job Listings
async function loadJobListings(companyId) {
    const jobsRef = collection(db, "Jobs");
    const jobsQuery = query(jobsRef, where("companyId", "==", companyId));

    const querySnapshot = await getDocs(jobsQuery);
    const jobListingsContainer = document.getElementById("jobListings");
    jobListingsContainer.innerHTML = ''; // Clear previous listings

    querySnapshot.forEach((doc) => {
        const job = doc.data();
        const jobItem = document.createElement("div");
        jobItem.className = "list-group-item list-group-item-action";
        jobItem.innerHTML = `<h5>${job.title}</h5><p>${job.description}</p><a href="job-detail.html?jobId=${doc.id}" class="btn btn-link">View Job</a>`;
        jobListingsContainer.appendChild(jobItem);
    });
}

        // Toggle Edit Mode
        document.getElementById("editProfileBtn").addEventListener("click", () => {
            toggleEditMode(true);
        });

        document.getElementById("saveChangesBtn").addEventListener("click", () => {
            saveCompanyChanges();
        });

        document.getElementById("cancelChangesBtn").addEventListener("click", () => {
            toggleEditMode(false);
        });

        function toggleEditMode(editMode) {
            const isEditing = editMode === true;
            document.getElementById("companyName").style.display = isEditing ? "none" : "block";
            document.getElementById("companyDescription").style.display = isEditing ? "none" : "block";
            document.getElementById("companyIndustry").style.display = isEditing ? "none" : "block";
            document.getElementById("companyLocation").style.display = isEditing ? "none" : "block";
            document.getElementById("editCompanyName").style.display = isEditing ? "block" : "none";
            document.getElementById("editCompanyDescription").style.display = isEditing ? "block" : "none";
            document.getElementById("editCompanyIndustry").style.display = isEditing ? "block" : "none";
            document.getElementById("editCompanyLocation").style.display = isEditing ? "block" : "none";
            document.getElementById("editButtons").style.display = isEditing ? "block" : "none";
            document.getElementById("editProfileBtn").style.display = isEditing ? "none" : "block";
        }

        function saveCompanyChanges() {
            const updatedData = {
                name: document.getElementById("editCompanyName").value,
                description: document.getElementById("editCompanyDescription").value,
                industry: document.getElementById("editCompanyIndustry").value,
                location: document.getElementById("editCompanyLocation").value
            };
            
            // Update Firestore document
            updateDoc(doc(db, "Companies", companyId), updatedData)
                .then(() => {
                    console.log("Company data updated successfully");
                    toggleEditMode(false); // Return to view mode
                })
                .catch((error) => {
                    console.error("Error updating company data:", error);
                });
        }
    </script>
</body>
</html>
