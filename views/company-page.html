<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Explore the company profile, latest job openings, and get insights into the work environment.">
    <meta name="keywords" content="company profile, job openings, work environment, careers, apply now, job alerts">
    <meta name="robots" content="index, follow">
    <title>Company Profile - [Company Name]</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        /* Custom styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }
        .company-media img, .company-media video {
            max-width: 100%;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .cta-buttons a {
            margin-right: 15px;
        }
    </style>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <!-- Bootstrap CSS -->
    <script src="../public/js/scripts.js"></script>
    <script src="../public/js/loadScripts.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../public/css/styles.css">

</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="../index.html">ReelCareer</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="job-listings.html">Jobs</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Companies</a></li>
                    <li class="nav-item"><a class="nav-link" href="auth.html">Login</a></li>
                </ul>
            </div>
        </div>
    </nav>
    
    <main>
        <section class="container mt-5">
            <div class="row">
                <div class="col-md-8">
                    <h2 id="companyName">Loading...</h2>
                    <input type="text" id="editCompanyName" class="form-control" style="display:none;" placeholder="Enter Company Name">
                    
                    <p id="companyDescription" class="lead">Loading description...</p>
                    <textarea id="editCompanyDescription" class="form-control" rows="3" style="display:none;" placeholder="Enter Company Description"></textarea>
                    
                    <p><strong>Industry:</strong> <span id="companyIndustry">Loading...</span></p>
                    <input type="text" id="editCompanyIndustry" class="form-control" style="display:none;" placeholder="Enter Industry">
                    
                    <p><strong>Location:</strong> <span id="companyLocation">Loading...</span></p>
                    <input type="text" id="editCompanyLocation" class="form-control" style="display:none;" placeholder="Enter Location">
                    
                    <div id="editButtons" style="display:none;">
                        <button id="saveChangesBtn" class="btn btn-primary mt-3">Save Changes</button>
                        <button id="cancelChangesBtn" class="btn btn-secondary mt-3">Cancel</button>
                    </div>
                </div>
                <div class="col-md-4 text-center">
                    <img id="companyLogo" src="../images/sq_logo_n_BG.png" alt="Company Logo" class="img-fluid rounded-circle">
                    <input type="file" id="editCompanyLogo" class="form-control mt-2" style="display:none;">
                    <button id="editProfileBtn" class="btn btn-secondary" style="display:none;">Edit Profile</button>
                </div>
            </div>
        </section>
    </main>
    <!-- Footer -->
    <footer id="dynamic-footer"></footer>
    
    <!-- Firebase configuration/ Login& Out -->
    <script type="module" src="../public/js/main.js"></script> 

    <!-- Dynamic Schema Markup -->
    <script type="module">
        import { db, auth } from '../public/js/main.js';
        import { doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const urlParams = new URLSearchParams(window.location.search);
        const companyId = urlParams.get('companyId');
        const userId = auth.currentUser ? auth.currentUser.uid : null; // Get the current user's ID

        // Check if a companyId exists in the URL
        if (companyId) {
            // Fetch company data from Firestore
            const companyRef = doc(db, "Companies", companyId);
            getDoc(companyRef).then((docSnapshot) => {
                if (docSnapshot.exists()) {
                    const companyData = docSnapshot.data();
                    document.getElementById("companyName").innerText = companyData.name;
                    document.getElementById("companyDescription").innerText = companyData.description;
                    document.getElementById("companyIndustry").innerText = companyData.industry;
                    document.getElementById("companyLocation").innerText = companyData.location;

                    // Check if the user is the admin of this company
                    if (userId === companyData.adminId) {
                        // Show editable fields
                        toggleEditMode(true);
                    }
                } else {
                    // Handle the case when the company does not exist
                    console.log("Company not found");
                }
            }).catch((error) => {
                console.error("Error fetching company data:", error);
            });
        } else {
            // No companyId in the URL; show empty fields for creating a company
            toggleEditMode(false);
        }

        // Toggle Edit Mode
        document.getElementById("editProfileBtn").addEventListener("click", () => {
            toggleEditMode(true);
        });

        document.getElementById("saveChangesBtn").addEventListener("click", () => {
            saveCompanyChanges();
        });

        document.getElementById("cancelChangesBtn").addEventListener("click", () => {
            toggleEditMode(false);
        });

        function toggleEditMode(editMode) {
            const isEditing = editMode === true;
            document.getElementById("companyName").style.display = isEditing ? "none" : "block";
            document.getElementById("companyDescription").style.display = isEditing ? "none" : "block";
            document.getElementById("companyIndustry").style.display = isEditing ? "none" : "block";
            document.getElementById("companyLocation").style.display = isEditing ? "none" : "block";
            document.getElementById("editCompanyName").style.display = isEditing ? "block" : "none";
            document.getElementById("editCompanyDescription").style.display = isEditing ? "block" : "none";
            document.getElementById("editCompanyIndustry").style.display = isEditing ? "block" : "none";
            document.getElementById("editCompanyLocation").style.display = isEditing ? "block" : "none";
            document.getElementById("editCompanyLogo").style.display = isEditing ? "block" : "none";
            document.getElementById("editButtons").style.display = isEditing ? "block" : "none";

            // Set current values to input fields if entering edit mode
            if (isEditing) {
                document.getElementById("editCompanyName").value = document.getElementById("companyName").innerText;
                document.getElementById("editCompanyDescription").value = document.getElementById("companyDescription").innerText;
                document.getElementById("editCompanyIndustry").value = document.getElementById("companyIndustry").innerText;
                document.getElementById("editCompanyLocation").value = document.getElementById("companyLocation").innerText;
            } else {
                // If not in edit mode, reset input values to empty for creating a new company
                if (!companyId) {
                    document.getElementById("editCompanyName").value = '';
                    document.getElementById("editCompanyDescription").value = '';
                    document.getElementById("editCompanyIndustry").value = '';
                    document.getElementById("editCompanyLocation").value = '';
                }
            }
        }

        function saveCompanyChanges() {
            const updatedCompany = {
                name: document.getElementById("editCompanyName").value,
                description: document.getElementById("editCompanyDescription").value,
                industry: document.getElementById("editCompanyIndustry").value,
                location: document.getElementById("editCompanyLocation").value,
            };

            const companyRef = doc(db, "Companies", companyId || updatedCompany.name); // Use companyId or new company name
            // Update or create company data
            // Assume a function updateCompanyInFirestore() handles this
            updateCompanyInFirestore(companyRef, updatedCompany).then(() => {
                alert("Company details saved successfully!");
                toggleEditMode(false);
                // Optionally refresh the page or redirect
            }).catch((error) => {
                console.error("Error saving company details:", error);
            });
        }

        function updateCompanyInFirestore(companyRef, updatedCompany) {
            // Implement the Firestore update/create logic
            return null; // Replace with actual logic
        }
    </script>
</body>
</html>
