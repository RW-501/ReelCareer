<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="User profile page for managing bio, resumes, messaging, and job applications.">
    <meta name="keywords" content="job applications, resumes, video resumes, job seeking, career management">
    <meta name="author" content="ReelCareer">
    <title>User Profile | ReelCareer</title>

    <!-- SEO Schema Markup -->
    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebPage",
            "name": "User Profile",
            "description": "User profile for managing bio, resumes, and applications.",
            "publisher": {
                "@type": "Organization",
                "name": "ReelCareer"
            }
        }
    </script>
<style>
    .tags-container {
    margin-top: 10px;
}
.tag {
    display: inline-block;
    background-color: #e0e0e0; /* Light gray background */
    border-radius: 3px; /* Rounded corners */
    padding: 5px 10px; /* Padding around the text */
    margin-right: 5px; /* Space between tags */
    font-size: 14px; /* Font size */
}

.badge {
    background-color: #007bff;
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
}
</style>


    <!-- Bootstrap CSS -->

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- Bootstrap CSS -->
    <script src="https://reelcareer.co/public/js/scripts.js"></script> 
    <script src="https://reelcareer.co/public/js/loadScripts.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="https://reelcareer.co/public/css/styles.css">

</head>


<body>
    <script src="https://reelcareer.co/public/js/bodyload.js"></script>
    
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="https://reelcareer.co">ReelCareer</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="news">News</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="jobs">Jobs</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="user">Profile</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="messaging">Messages</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link btn btn-danger" href="logout">Logout</a>
                </li>
            </ul>
        </div>
    </nav>



    
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li id="lastBreadcrumb_home" class="breadcrumb-item"><a href="https://reelcareer.co/">Home</a></li>
          <li class="breadcrumb-item active" aria-current="page">User</li>
        </ol>
      </nav>

        <main id="main-content">



    <!-- User Profile Section -->
    <div class="container mt-5">
        <div class="userProfile">
            <div class="col-md-4">
                <!-- User Info Section -->
                <div class="card">
                    <div class="card-body text-center">
                        <img  id="profilePic" src="/images/sq_logo_n_BG_tie_reel.png" alt="User Profile Picture" class="img-fluid rounded-circle mb-3" style="width: 150px;">
                        <h3 id="user-name">User Name</h3>
                        <p id="user-bio">This is a short bio about the user...</p>
                        <span id="membership-badge" class="badge badge-success">Premium Member</span>
                        <span id="verified-badge" class="badge badge-info">Verified</span>
                        <p id="user-location">Location: <span id="location-text">City, State</span></p>
                        <div id="tags-container"></div>

                        
        <button class="btn btn-primary btn-block" id="send-message-btn">Send Message</button>
        <button class="btn btn-primary btn-block"  id="share-profile-btn">Share Profile</button>
        <button class="btn btn-primary btn-block" id="connect-btn">Connect</button>
        <button class="btn btn-primary btn-block" id="view-profile-btn">View Profile</button>

        <button class="btn btn-primary btn-block" id="jobSeeker-btn">Job Seeker Dashboard</button>
        <button class="btn btn-primary btn-block" id="recruiter-btn">Recruiter Dashboard</button>
    </div>
</div>
                    

                <!-- Digital Resume Link -->
                <div class="card mt-3">
                    <div class="card-body">
                        <h5>Digital Resume</h5>
                        <a href="#" id="digital-resume-link" class="btn btn-primary">View Resume</a>
                    </div>
                </div>

                <!-- Social Media and Websites -->
                <div class="card mt-3">
                    <div class="card-body">
                        <h5>Social Media & Websites</h5>
                        <ul id="social-media-list">
                            <!-- Social media links will be dynamically listed here -->
                        </ul>
                    </div>
                </div>

                <!-- Video Resumes -->
                <div class="card mt-3">
                    <div class="card-body">
                        <h5>Video Resumes</h5>
                        <ul id="video-resume-list">
                            <!-- Video resume files will be dynamically listed here -->
                        </ul>
                        <button class="btn btn-primary btn-block" onclick="location.href='dashboard.html'">Edit Video Resumes</button>
                    </div>
                </div>               
            </div>       
        
           


            <div class="col-md-8 public">



            



<div id="profileSettings"  class="container">
  <h1 class="mb-4">Profile Settings</h1>
  <p class="text-muted">Keep your profile up to date to improve your visibility and networking opportunities.</p>

  <ul class="nav profile-nav-item" id="profileTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="profile-personal-tab" data-bs-toggle="tab" data-bs-target="#personal-profile" type="button" role="tab" aria-controls="personal" aria-selected="true">
        Personal
      </button>
    </li>
    <li class="profile-nav-item" role="presentation">
      <button class="nav-link" id="profile-social-tab" data-bs-toggle="tab" data-bs-target="#social-profile" type="button" role="tab" aria-controls="social" aria-selected="false">
        Social
      </button>
    </li>
    <li class="profile-nav-item" role="presentation">
      <button class="nav-link" id="profile-membership-tab" data-bs-toggle="tab" data-bs-target="#membership-profile" type="button" role="tab" aria-controls="membership" aria-selected="false">
        Membership
      </button>
    </li>
  </ul>

  <div class="tab-content mt-4">
    <div class="tab-pane fade show active" id="personal-profile" role="tabpanel" aria-labelledby="profile-personal-tab">
      <h3>Personal Information</h3>
      <p>Update your personal details here.</p>
  <!-- Personal Tab -->
    <form id="personalForm-profile">
      <div class="mb-3">
        <label for="usernameSET-profile" class="form-label">Username</label>
        <input type="name" class="form-control" id="usernameSET-profile" placeholder="Your desired username">
      </div>
      <div class="mb-3">
        <label for="emailSET-profile" class="form-label">Email</label>
        <input type="email" class="form-control" id="emailSET-profile" disabled>
      </div>
      <div class="mb-3">
        <label for="profilePictureSET-profile" class="form-label">Profile Picture</label>
        <input type="file" class="form-control" id="profilePictureSET-profile">
      </div>
      <div class="mb-3">
        <label for="nameSET-profile" class="form-label">Name</label>
        <input type="name" class="form-control" id="nameSET-profile" placeholder="Your full name">
      </div>

      <div class="mb-3">
        <label for="phoneSET-profile" class="form-label">Phone</label>
        <input type="tel" class="form-control" id="phoneSET-profile">
      </div>

      <div class="mb-3">
        <label for="dobSET-profile" class="form-label">DOB</label>
        <input type="date" class="form-control" id="dobSET-profile">
      </div>

      <div class="mb-3">
        <label for="bioSET-profile" class="form-label">Bio</label>
        <textarea class="form-control" id="bioSET-profile" rows="3" placeholder="Tell us about yourself"></textarea>
      </div>
      <div class="mb-3">
        <label for="locationSET-profile" class="form-label">Location</label>
        <input type="text" class="form-control" id="locationSET-profile" placeholder="Enter your city or state">
      </div>
      <div class="mb-3">
        <label for="tagsSET-profile">Tags <small class="text-muted">(Add a tag and press Enter)</small></label>
        <div id="tagsContainertagsSET-profile">
        <input type="text" class="form-control" id="tagsSET-profile" placeholder="(e.g., JavaScript, Management)">
       </div>
       
      </div>
      <div class="mb-3">
        <label for="positionSET-profile" class="form-label">Current Position</label>
        <input type="text" class="form-control" id="positionSET-profile" placeholder="Your job title or current role">
      </div>
      <div class="form-check mb-3">
        <input type="checkbox" class="form-check-input" id="publicProfileSET-profile">
        <label class="form-check-label" for="publicProfileSET-profile">Public Profile</label>
      </div>
    </form>




    </div>
    <div class="tab-pane fade" id="social-profile" role="tabpanel" aria-labelledby="profile-social-tab">
      <h3>Social Profiles</h3>
      <p>Manage your social media links here.</p>
 <!-- Social Tab -->
    <form id="socialForm-profile">
      <div class="mb-3">
        <label for="linkedinSET-profile" class="form-label">LinkedIn Profile</label>
        <input type="url" class="form-control" id="linkedinSET-profile" placeholder="https://www.linkedin.com/in/yourprofile">
      </div>
      <div class="mb-3">
        <label for="portfolioSET-profile" class="form-label">Portfolio</label>
        <input type="url" class="form-control" id="portfolioSET-profile" placeholder="https://portfolio.com/yourprofile">
      </div>
      <div class="mb-3">
        <label for="githubSET-profile" class="form-label">GitHub Profile</label>
        <input type="url" class="form-control" id="githubSET-profile" placeholder="https://github.com/yourprofile">
      </div>
      <div class="mb-3">
        <label for="otherSET-profile" class="form-label">Other Website</label>
        <input type="url" class="form-control" id="otherSET-profile" placeholder="https://otherwebsite.com/yourprofile">
      </div>
    </form>



    </div>
    <div class="tab-pane fade" id="membership-profile" role="tabpanel" aria-labelledby="profile-membership-tab">
      <h3>Membership Details</h3>
      <p>Check your membership information here.</p>

 <!-- Membership Tab -->
    <form id="membershipForm-profile">
      <div class="mb-3">
        <label for="membershipTypeSET-profile" class="form-label">Membership Type</label>
        <select class="form-select" id="membershipTypeSET-profile">
          <option value="free">Free</option>
          <option value="premium">Premium</option>
          <option value="enterprise">Enterprise</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="membershipStatus-profile" class="form-label">Membership Status</label>
        <input type="text" class="form-control" id="membershipStatus-profile" value="Active" disabled>
      </div>
      <div class="mb-3">
        <label for="renewalDateSET-profile" class="form-label">Renewal Date</label>
        <input type="date" class="form-control" id="renewalDateSET-profile">
      </div>

      <div class="mb-3">
        <label for="lastLogin-profile" class="form-label">lastLogin</label>
        <input type="date" class="form-control" id="lastLogin-profile">
      </div>
      <div class="mb-3">
        <label for="userID-profile" class="form-label">userID</label>
        <input type="text" class="form-control" id="userID-profile">
      </div>

    </form>

    
    <div class="d-flex justify-content-between mt-4">
        <button type="button" class="btn btn-danger" id="deactivateAccountBtn-profile">Deactivate Account</button>
        <button type="button" class="btn btn-primary" id="saveProfileBtn-profile">Save Changes</button>
      </div>

    </div>
  </div>
  


</div>

                
                 
              
                
                  <script>document.addEventListener("DOMContentLoaded", () => {
                    const tabs = document.querySelectorAll(".nav-link");
                    const tabContents = document.querySelectorAll(".tab-pane");
                  
                    tabs.forEach((tab) => {
                      tab.addEventListener("click", (e) => {
                        // Remove active class from all tabs
                        tabs.forEach((t) => t.classList.remove("active"));
                  
                        // Hide all tab contents
                        tabContents.forEach((content) => content.classList.remove("active", "show"));
                  
                        // Add active class to the clicked tab
                        e.target.classList.add("active");
                  
                        // Show the corresponding tab content
                        const target = document.querySelector(e.target.dataset.bsTarget);
                        if (target) {
                          target.classList.add("active", "show");
                        }
                      });
                    });
                  });
                  

                  </script>
             
                





                <!-- Open Jobs Section -->
                <div class="card mt-3">
                    <div class="card-body">
                        <h5>Open Jobs</h5>
                        <ul id="open-jobs-list">
                            <!-- Open jobs will be dynamically listed here -->
                        </ul>
                    </div>
                </div>

                <!-- Blogs Section -->
                <div class="card mt-3">
                    <div class="card-body">
                        <h5>Blogs</h5>
                        <ul id="blogs-list">
                            <!-- Blogs will be dynamically listed here -->
                        </ul>
                    </div>
                </div>

                <!-- Companies Section -->
                <div class="card mt-3">
                    <div class="card-body">
                        <h5>Companies</h5>
                        <ul id="companies-list">
                            <!-- Companies will be dynamically listed here -->
                        </ul>
                    </div>
                </div>
            </div>



        </div>
    </div>
       

<!-- Send Message Modal -->
<div class="modal fade hide" id="sendMessageModal" tabindex="-1" aria-labelledby="sendMessageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="sendMessageModalLabel">Send Message</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="sendMessageForm">
                    <div class="form-group">
                        <label for="message-content">Message</label>
                        <textarea class="form-control" id="message-content" rows="4" required></textarea>
                    </div>
                    <input type="hidden" id="recipient-id" value="">
                    <div class="form-group">
                        <label for="message-attachments">Attachments</label>
                        <input type="file" class="form-control-file" id="message-attachments">
                    </div>
                    <button type="submit" class="btn btn-primary">Send</button>
                </form>
            </div>
        </div>
    </div>
</div>

</main>

<div id="currentUserId" hidden></div>
<div id="userPageId" hidden></div>

    <!-- Footer -->
    <footer id="dynamic-footer"></footer>

    <!-- Firebase configuration/ Login& Out -->
    <script type="module" src="https://reelcareer.co/public/js/main.js"></script>

<!-- Firebase JS SDK and Custom Scripts -->

<script type="module">
   
   
   import {
    getUserId, db, doc, getDoc, query, updateDoc,
        setDoc, ref, signInWithPopup, orderBy,
        arrayRemove, arrayUnion , uploadBytesResumable, 
        uploadBytes, OAuthProvider, getStorage,
        signOut, addDoc, increment, onAuthStateChanged,
        createUserWithEmailAndPassword, signInWithEmailAndPassword,
        where, getDocs, storage, collection, deleteObject, 
        auth, analytics, deleteDoc, getDownloadURL
    } from 'https://reelcareer.co/js/module.js';










    function showPrivateProfileMessage() {
    // Create a container div
    const container = document.createElement('div');
    container.className = 'private-profile-container';
    container.style.cssText = `
        display: flex; 
        justify-content: center; 
        align-items: center; 
        height: 100vh; 
        background-color: #f5f5f5;
    `;

    // Create the card div
    const card = document.createElement('div');
    card.className = 'private-profile-card';
    card.style.cssText = `
        background-color: white; 
        padding: 20px; 
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
        border-radius: 8px; 
        text-align: center;
    `;

    // Add a title to the card
    const title = document.createElement('h3');
    title.textContent = 'Profile is Private';
    title.style.marginBottom = '15px';
    card.appendChild(title);

    // Add a message inside the card
    const message = document.createElement('p');
    message.textContent = 'This profile is private and cannot be viewed.';
    message.style.marginBottom = '20px';
    card.appendChild(message);

    // Create a "Go Back" button
    const goBackButton = document.createElement('button');
    goBackButton.textContent = 'Go Back';
    goBackButton.className = 'btn btn-primary'; // Assuming Bootstrap classes, if used
    goBackButton.style.padding = '10px 20px';
    
    // Add an event listener to navigate back
    goBackButton.addEventListener('click', () => {
        window.history.back(); // This takes the user to the previous page
    });

    card.appendChild(goBackButton);

    // Append the card to the container
    container.appendChild(card);

    // Append the container to the body (or a specific element on your page)
    document.body.appendChild(container);
}

function showUserDataNotFoundMessage() {
    // Create a container div
    const container = document.createElement('div');
    container.className = 'user-data-not-found-container';
    container.style.cssText = `
        display: flex; 
        justify-content: center; 
        align-items: center; 
        height: 100vh; 
        background-color: #f5f5f5;
    `;

    // Create the card div
    const card = document.createElement('div');
    card.className = 'user-data-not-found-card';
    card.style.cssText = `
        background-color: white; 
        padding: 20px; 
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
        border-radius: 8px; 
        text-align: center;
    `;

    // Add a title to the card
    const title = document.createElement('h3');
    title.textContent = 'User Data Not Found';
    title.style.marginBottom = '15px';
    card.appendChild(title);

    // Add a message inside the card
    const message = document.createElement('p');
    message.textContent = 'The requested user data could not be found.';
    message.style.marginBottom = '20px';
    card.appendChild(message);

    // Create a "Go Back" button
    const goBackButton = document.createElement('button');
    goBackButton.textContent = 'Go Back';
    goBackButton.className = 'btn btn-primary'; // Assuming Bootstrap classes, if used
    goBackButton.style.padding = '10px 20px';
    
    // Add an event listener to navigate back
    goBackButton.addEventListener('click', () => {
        window.history.back(); // This takes the user to the previous page
    });

    card.appendChild(goBackButton);

    // Append the card to the container
    container.appendChild(card);

    // Append the container to the body (or a specific element on your page)
    document.body.appendChild(container);
}


function showUserSignedOutMessage() {
    // Create a container div
    const container = document.createElement('div');
    container.className = 'user-signed-out-container';
    container.style.cssText = `
        display: flex; 
        justify-content: center; 
        align-items: center; 
        height: 100vh; 
        background-color: #f5f5f5;
    `;

    // Create the card div
    const card = document.createElement('div');
    card.className = 'user-signed-out-card';
    card.style.cssText = `
        background-color: white; 
        padding: 20px; 
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
        border-radius: 8px; 
        text-align: center;
    `;

    // Add a title to the card
    const title = document.createElement('h3');
    title.textContent = 'Signed Out';
    title.style.marginBottom = '15px';
    card.appendChild(title);

    // Add a message inside the card
    const message = document.createElement('p');
    message.textContent = 'You have been signed out. Please log in to continue.';
    message.style.marginBottom = '20px';
    card.appendChild(message);

    // Create a "Login" button
    const loginButton = document.createElement('button');
    loginButton.textContent = 'Go to Login Page';
    loginButton.className = 'btn btn-primary'; // Assuming Bootstrap classes, if used
    loginButton.style.padding = '10px 20px';

    // Add an event listener to redirect to the login page
    loginButton.addEventListener('click', () => {
        window.location.href = '/login'; // Change '/login' to your actual login page URL
    });

    card.appendChild(loginButton);

    // Append the card to the container
    container.appendChild(card);

    // Append the container to the body (or a specific element on your page)
    document.body.appendChild(container);
}




// Retrieve and populate form inputs for tabs
window.onload = async function () {


  const generalTags = createTagInputSystem({
        tagsContainerId: "tagsContainertagsSET-profile",
        badgeClass: "tag-primary" // Custom badge class for general tags
    });



    setTimeout(() => {

    const userId =  getUserId();

console.log("Module User We outside: ", userId);

    

        const urlParams = new URLSearchParams(window.location.search);
        const userIdFromURL = urlParams.get('u');

        // Ensure userIdFromURL is not null or undefined
        if (userIdFromURL) {
            checkUser(userIdFromURL);
            document.getElementById('currentUserId').innerText = userId;
            document.getElementById('userPageId').innerText = userIdFromURL;

            document.getElementById('send-message-btn').style.display = 'block';
            document.getElementById('connect-btn').style.display = 'block';

            document.getElementById('jobSeeker-btn').style.display = 'none';
            document.getElementById('recruiter-btn').style.display = 'none';
            document.getElementById('view-profile-btn').style.display = 'none';

            document.getElementById('profileSettings').style.display = 'none';
      
        } else {
            checkUser(userId);
            document.getElementById('send-message-btn').style.display = 'none';
            document.getElementById('connect-btn').style.display = 'none';
            document.getElementById('jobSeeker-btn').style.display = 'block';
            document.getElementById('recruiter-btn').style.display = 'block';
            document.getElementById('view-profile-btn').style.display = 'block';

            document.getElementById('profileSettings').style.display = 'block';
        }
     
        


   



        // Async function to check the user profile (userData)
        async function checkUser(userIdFromURL) {
            try {
                // Fetch profile information based on userId in the URL
                const profileDoc = doc(db, 'Users', userIdFromURL);
                const profileSnapshot = await getDoc(profileDoc);

                if (profileSnapshot.exists()) {
                    const userData = profileSnapshot.data();
                    console.log("User data fetched from Firestore:", userData);

             
                    // Check if the profile is public
                    if (userData.profilePublic) {
                        showPrivateProfileMessage(); // Show private profile message
                    } else {
                        await loadUserData(userData); // Load user data if public
                        await loadUserJobs(userData);
                        await loadUserBlogs(userIdFromURL);
                        await loadUserCompanies(userIdFromURL);
                        await loadUserVideoResumes(userData);
                        await loadSocialMedia(userData);
                    }
                } else {
                    // Call this function when the user data is not found
                    showUserDataNotFoundMessage();
                }
                
            } catch (error) {
                console.error("Error fetching user data:", error);
            }
            
        }



}, 1000);
};

    









document.getElementById('saveProfileBtn-profile').addEventListener('click', async () => {
    

    // Create an array of website info
const websitesSetup = [
  { name: "LinkedIn", url: document.getElementById('linkedinSET-profile').value.trim() },
  { name: "Other", url: document.getElementById('otherSET-profile').value.trim() },
  { name: "GitHub", url: document.getElementById('githubSET-profile').value.trim() },
  { name: "Portfolio", url: document.getElementById('portfolioSET-profile').value.trim() }
];

// Optionally, you can filter out empty entries like this:
const websites = websitesSetup.filter(site => site.url !== "");


    const userData = {
      // Personal Information tab
      displayName: document.getElementById('usernameSET-profile').value.trim(),
     // email: document.getElementById('emailSET-profile').value.trim(),
      phone: document.getElementById('phoneSET-profile').value.trim(),
      dob: document.getElementById('dobSET-profile').value.trim(),
      name: document.getElementById('nameSET-profile').value.trim(),
      bio: document.getElementById('bioSET-profile').value.trim(),
      location: document.getElementById('locationSET-profile').value.trim(),
      position: document.getElementById('positionSET-profile').value.trim(),
      publicProfile: document.getElementById('publicProfileSET-profile').checked,


      tags: document.getElementById('tagsSET-profile').textContent.trim().split(",").map((item) => item.toLowerCase().trim()),


      // Social Profiles tab
      linkedin: document.getElementById('linkedinSET-profile').value.trim(),
      other: document.getElementById('otherSET-profile').value.trim(),
      github: document.getElementById('githubSET-profile').value.trim(),
      portfolio: document.getElementById('portfolioSET-profile').value.trim(),
      websites: websites,


// Membership Details tab
      membershipType: document.getElementById('membershipTypeSET-profile').value.trim(),
      membershipExpiry: document.getElementById('renewalDateSET-profile').value.trim(),
    };

    try {

        
 // Create a reference to the user's document
 const userDocRef = doc(db, "Users", getUserId());

// Update the user's document with merge: true
await setDoc(userDocRef, userData, { merge: true });
console.log("User data saved successfully!");
showToast("Your profile has been updated successfully.");
} catch (error) {
console.error("Error saving user data:", error.message);
showToast("There was an error updating your profile. Please try again later.");
}            
                    });
                


                    document.getElementById('deactivateAccountBtn-profile').addEventListener('click', async () => {
  const userDocRef = doc(db, 'Users', getUserId());

  try {
    // Check if user ID is valid
    const userId = getUserId();
    if (!userId) {
      alert('Invalid user ID. Please log in again.');
      return;
    }

    // Fetch current user status
    const userDoc = await getDoc(userDocRef);
    if (!userDoc.exists()) {
      alert('User not found! Please contact support.');
      return;
    }

    const currentStatus = userDoc.data().status;
    if (!currentStatus) {
      alert('Unable to retrieve account status. Please try again.');
      return;
    }

    const isCurrentlyActive = currentStatus === 'active';

    // Confirmation message based on current status
    const action = isCurrentlyActive ? 'deactivate' : 'reactivate';
    const confirmToggle = confirm(`Are you sure you want to ${action} your account?`);

    if (!confirmToggle) {
      console.log(`${action.charAt(0).toUpperCase() + action.slice(1)} canceled by the user.`);
      return;
    }

    // Toggle status
    const newStatus = isCurrentlyActive ? 'inactive' : 'active';

    // Update user's status
    await updateDoc(userDocRef, { status: newStatus });
    console.log(`User account status updated to ${newStatus}`);

    // Update job posts' status
    try {
      const jobsQuery = query(
        collection(db, 'Jobs'),
        where('createdBy', '==', userId)
      );
      const jobDocs = await getDocs(jobsQuery);

      if (!jobDocs.empty) {
        jobDocs.forEach(async (jobDoc) => {
          const jobRef = doc(db, 'Jobs', jobDoc.id);
          await updateDoc(jobRef, { status: newStatus });
          console.log(`Job post ${jobDoc.id} status updated to ${newStatus}`);
        });
      } else {
        console.log('No job posts found for the user.');
      }
    } catch (jobError) {
      console.error('Error updating job posts status:', jobError);
      alert('An error occurred while updating job posts. Please try again later.');
    }

    // Update applications' status
    try {
      const applicationsQuery = query(
        collection(db, 'Applications'),
        where('userId', '==', userId)
      );
      const applicationDocs = await getDocs(applicationsQuery);

      if (!applicationDocs.empty) {
        applicationDocs.forEach(async (appDoc) => {
          const appRef = doc(db, 'Applications', appDoc.id);
          await updateDoc(appRef, { status: newStatus });
          console.log(`Application ${appDoc.id} status updated to ${newStatus}`);
        });
      } else {
        console.log('No applications found for the user.');
      }
    } catch (appError) {
      console.error('Error updating applications status:', appError);
      alert('An error occurred while updating applications. Please try again later.');
    }

    // Update button text
    const button = document.getElementById('deactivateAccountBtn-profile');
    button.textContent = isCurrentlyActive ? 'Reactivate Account' : 'Deactivate Account';

    // Notify user of successful update
    alert(`Your account and related data have been successfully ${action}d.`);
  } catch (error) {
    console.error('Error during toggle process:', error);
    alert('An unexpected error occurred. Please try again later.');
  }
});



        async function loadUserData(profileData) {



            console.log("profileDatam   ",profileData);

if (profileData) {
  const userData = profileData;

  // Populate the Personal Information tab
  document.getElementById('usernameSET-profile').value = userData.displayName || "";
  document.getElementById('emailSET-profile').value = userData.email || "";
  document.getElementById('phoneSET-profile').value = userData.phone || "";
  document.getElementById('dobSET-profile').value = userData.dob || "";
  document.getElementById('locationSET-profile').value = userData.location || "";
  document.getElementById('nameSET-profile').value = userData.name || "";
  document.getElementById('bioSET-profile').value = userData.bio || "";
  document.getElementById('tagsSET-profile').value = userData.tags || "";
  document.getElementById('positionSET-profile').value = userData.position || "";
  document.getElementById('publicProfileSET-profile').checked = userData.publicProfile || "";

  // Populate the Social Profiles tab
  document.getElementById('linkedinSET-profile').value = userData.linkedin || "";
  document.getElementById('otherSET-profile').value = userData.other || "";
  document.getElementById('githubSET-profile').value = userData.github || "";
  document.getElementById('portfolioSET-profile').value = userData.portfolio || "";

  // Populate the Membership Details tab
  document.getElementById('membershipTypeSET-profile').value = userData.membershipType || "";
  document.getElementById('membershipStatus-profile').value = userData.membershipType || "";
  document.getElementById('renewalDateSET-profile').value = userData.membershipExpiry || "";

  document.getElementById('lastLogin-profile').value = userData.lastLogin || "";
  document.getElementById('userID-profile').value = userData.userID || "";
} else {
  console.log("No user data found!");
}


            document.getElementById('profilePic').src = profileData.profilePic ? profileData.profilePic : '/images/sq_logo_n_BG_sm.png';
            document.getElementById('user-name').innerText = profileData.displayName || 'User Name';
            document.getElementById('user-bio').innerText = profileData.bio || 'This is a short bio about the user...';
            document.getElementById('location-text').innerText = profileData.location || 'City, State';

            const verified = profileData.verified || "Not Verified";
            const membership = profileData.membershipType || "Basic";
            console.log("membership: ", membership);
            console.log("verified: ", verified);

            const tagsContainer = document.getElementById('tagsSET-profile');

// Check if the tags array is defined and has elements
if (!profileData.tags || profileData.tags.length === 0) {
    // If there are no tags, display a message
    tagsContainer.innerHTML = '<p></p>';
} else {
    // Directly use the tags array since it contains strings
    const tags = profileData.tags; // No need to map since they're already strings
    
    console.log("tags: ", tags);

    // Display the tags in the container
    const tagElements = tags.map(tag => `<span class="tag mb-1">${tag}</span>`).join(' ');
//tagsContainer.innerHTML = '<strong>Tags: </strong>' + tagElements;
}



            // Membership Badge
            async function loadMembershipBadge(membership) {
            const badge = document.getElementById('membership-badge');
            if (membership) {
                badge.innerHTML = `<span class="badge">Membership Level: ${membership}</span>`;
            }
        }

        async function loadVerifiedBadge(verified) {
    const badge = document.getElementById('verified-badge');
    if (badge) {
        if (verified) {
            badge.innerHTML = `<span class="badge badge-success">Verified</span>`;
        } else {
            badge.innerHTML = `<span class="badge badge-warning">Not Verified</span>`;
        }
    } else {
        console.error('Verified badge element not found');
    }
}

            // Digital Resume Link
            const digitalResumeLink = ""
           // digitalResumeLink.href = profileData.digitalResumeUrl || '#';
          //  digitalResumeLink.innerText = profileData.digitalResumeUrl ? 'View Resume' : 'No Resume Available';
        }

        async function loadUserJobs(userData) {

            const jobsList = document.getElementById('open-jobs-list');



            if (!userData.jobPosts) {
                jobsList.innerHTML = '<li>No open jobs found.</li>';
                return;
            }





            userData.jobPosts.forEach(jobData => {
                
                const listItem = document.createElement('li');
                listItem.innerHTML =  `<a href="https://reelcareer.co/views/job-details?id=${jobData.jobID}" title="${jobData.jobTitle}">${jobData.jobTitle}</a>`   || '';
                jobsList.appendChild(listItem);
            });
        }


        async function loadUserBlogs(userId) {
            const blogsRef = collection(db, 'Blogs');
            const q = query(blogsRef, where("createdByID", "==", userId));
            const blogSnapshot = await getDocs(q);
            const blogsList = document.getElementById('blogs-list');

            if (blogSnapshot.empty) {
                blogsList.innerHTML = '<li>No blogs found.</li>';
                return;
            }

            blogSnapshot.forEach(doc => {
                const blogData = doc.data();
                const listItem = document.createElement('li');
                listItem.innerText = blogData.title || 'Blog Title';
                blogsList.appendChild(listItem);
            });
        }

        async function loadUserCompanies(userId) {
            const companiesRef = collection(db, 'Companies');
            const q = query(companiesRef, where("createdByID", "==", userId));
            const companySnapshot = await getDocs(q);
            const companiesList = document.getElementById('companies-list');

            if (companySnapshot.empty) {
                companiesList.innerHTML = '<li>No companies found.</li>';
                return;
            }

            companySnapshot.forEach(doc => {
                const companyData = doc.data();
                const listItem = document.createElement('li');
                listItem.innerText = companyData.name || 'Company Name';
                companiesList.appendChild(listItem);
            });
        }

        async function loadUserVideoResumes(userData) {
          //  const videoResumesRef = collection(db, 'VideoResumes');
          //  const q = query(videoResumesRef, where("createdByID", "==", userId));
         //   const videoSnapshot = await getDocs(q);
            const videoResumeList = document.getElementById('video-resume-list');

            if (!userData.resumes) {
                videoResumeList.innerHTML = '<li>No video resumes found.</li>';
                return;
            }

            userData.resumes.forEach(videoData => {
                //const videoData = doc.data();
                const listItem = document.createElement('li');
                listItem.innerText = videoData.fileName || 'Video Resume Title';
                listItem.addEventListener('click', () => playVideo(videoData.videoUrl));
                videoResumeList.appendChild(listItem);
            });
        }

        function playVideo(videoUrl) {
            // Add logic to play video in a modal or a new page
            showToast(`Playing video from URL: ${videoUrl}`);
        }

 async function loadSocialMedia(profileData) {
    const socialMediaListContainer = document.getElementById('social-media-list');

    // Check if socialMediaList exists and has items
    if (!profileData.websites || profileData.websites.length === 0) {
        socialMediaListContainer.innerHTML = '<li>No social media links found.</li>';
        return;
    }

    // Clear existing content (optional, if you want to refresh the list)
    socialMediaListContainer.innerHTML = ''; 

    // Iterate through each social media document
    profileData.websites.forEach(doc => {
        const socialData = doc.data();
        const listItem = document.createElement('li');

        // Use template literals for better readability
        listItem.innerHTML = `<a href="${encodeURI(socialData.url)}" target="_blank" rel="noopener noreferrer">${socialData.name}</a>`;
        
        socialMediaListContainer.appendChild(listItem);
    });
}
 document.getElementById('share-profile-btn').addEventListener('click', () => {
  const userId = getUserId();

     // Replace with actual user ID
            const shareUrl = `https://reelcareer.co/views/user?u=${userId}`; // Construct share URL
            navigator.clipboard.writeText(shareUrl).then(() => {
                showToast('Profile link copied to clipboard!');
            }).catch(err => {
                console.error('Could not copy text: ', err);
            });
        });
  

        document.getElementById('jobSeeker-btn').addEventListener('click', async () => {
          window.location.href = 'https://reelcareer.co/views/job-seeker';

        });


        document.getElementById('recruiter-btn').addEventListener('click', async () => {
          window.location.href = 'https://reelcareer.co/views/recruiter-dashboard';

        });


        document.getElementById('view-profile-btn').addEventListener('click', async () => {
          const userId = getUserId();

          window.location.href = `https://reelcareer.co/views/user?u=${userId}`;

        });





        document.getElementById('connect-btn').addEventListener('click', async () => {
          const userId = getUserId();

          const urlParams = new URLSearchParams(window.location.search);
        const userIdFromURL = urlParams.get('u');

        const userDataSaved = JSON.parse(localStorage.getItem('userData')) || [];


            if (userId !== userIdFromURL) {
                const connectionRef = collection(db, 'Connections');
                await addDoc(connectionRef, {
                    from: userId,
                    to: userIdFromURL,
                    status: 'pending', // or 'accepted' based on your logic
                    createdAt: new Date(),
                    fromGroup: 'new',
                    fromNote: '',
                    fromName: userDataSaved.displayName,
                    fromProfilePicture: 'main',
                    fromProfileURL: `https://reelcareer.co/views/user?u=${userId}`,
                
                
                
                  });
                showToast('Connection request sent!');
            } else {
                showToast('You cannot connect with yourself.');
            }
        });


        document.getElementById('send-message-btn').addEventListener('click', function() {
          const urlParams = new URLSearchParams(window.location.search);
        const userIdFromURL = urlParams.get('u');

    // Set recipient ID from the profile data
    document.getElementById('recipient-id').value = userIdFromURL; // Assuming userIdFromURL is the recipient ID.
    $('#sendMessageModal').modal('show'); // Show the modal
});


document.getElementById('sendMessageForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const senderID = auth.currentUser.uid;
    const recipientID = document.getElementById('recipient-id').value;
    const content = document.getElementById('message-content').value;
    const attachments = document.getElementById('message-attachments').files[0] || '';
    
    const messageData = {
        recipientID: recipientID,
        senderID: senderID,
        type: 'message',
        content: content,
        createdAt: new Date(),
            read: false,
            messageType: 'contact', // group, system, advertisment, 

            group: 'main',
            contentType: 'text', /// video, picture, resume, link
            status: "unread", 
            attachments: attachments ? attachments.name : '',
            isDeleted: false
    };
    
    try {
        const messagesCollection = collection(db, 'Messages');
        await addDoc(messagesCollection, messageData);
        
        showToast('Message sent successfully!');
        $('#sendMessageModal').modal('hide'); // Hide the modal after sending the message
    } catch (error) {
        console.error("Error sending message: ", error);
        showToast('Failed to send message. Please try again.');
    }
});






















    </script>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
