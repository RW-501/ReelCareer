<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Stay updated with the latest news articles submitted by users, recruiters, and companies.">
    <meta name="keywords" content="Career Tips, Industry News, Recruiter Insights">
    <title>News Portal</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
    


    <!-- Dynamic Schema Markup -->
    <script type="application/ld+json" id="dynamicSchema">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "News Page",
        "description": "Latest news articles submitted by users, recruiters, and companies.",
        "url": "http://www.example.com/news",
        "mainEntity": {
            "@type": "WebSite",
            "name": "News Portal",
            "url": "http://www.example.com"
        }
    }
    </script>
</head>
<body>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="../index.html">ReelCareer</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="job-listings.html">Job Listings</a></li>
                <li class="nav-item"><a class="nav-link" href="company-pages.html">Company Pages</a></li>
                <li class="nav-item"><a class="nav-link" href="job-seeker.html">Job Seeker</a></li>
                <li class="nav-item"><a class="nav-link" href="recruiter-dashboard.html">Recruiter Dashboard</a></li>
                <li class="nav-item"><a class="nav-link" href="news.html">News</a></li>
            </ul>
        </div>
    </nav>
<header class="bg-dark text-white text-center p-4">
    <h1>News Portal</h1>
    <nav>
        <ul class="nav justify-content-center">
            <li class="nav-item"><a class="nav-link text-white" href="#submission">Submit Article</a></li>
            <li class="nav-item"><a class="nav-link text-white" href="#news-feed">News Feed</a></li>
        </ul>
    </nav>
</header>

<main class="container my-5">
    <section id="submission" class="mb-5">
        <h2>Submit Your Article</h2>
        <div id="article-form" onsubmit="submitArticle()">
          <!--  <form id="article-form" onsubmit="submitArticle(event)"> -->
                <div class="form-group">
                <label for="title">Title:</label>
                <input type="text" class="form-control" id="title" required>
            </div>
            <div class="form-group">
                <label for="content">Content:</label>
                <textarea class="form-control" id="content" required></textarea>
            </div>
            <div class="form-group">
                <label for="tags">Tags (select relevant tags):</label>
                <select class="form-control" id="tags" multiple required>
                    <option value="Job Search Tips">Job Search Tips</option>
                    <option value="Career Development">Career Development</option>
                    <option value="Industry News">Industry News</option>
                    <option value="Remote Work">Remote Work</option>
                    <option value="Hiring Trends">Hiring Trends</option>
                </select>
            </div>
            <div class="form-group">
                <label for="category">Category:</label>
                <select class="form-control" id="category" required>
                    <option value="Career Tips">Career Tips</option>
                    <option value="Industry News">Industry News</option>
                    <option value="Recruiter Insights">Recruiter Insights</option>
                </select>
            </div>
            <div class="form-group">
                <label for="media">Upload Media (images/videos/documents):</label>
                <input type="file" class="form-control" id="media" multiple accept="image/*,video/*,application/pdf">
                <small>Recommended image size: 1200x800 pixels.</small>
            </div>
            <button type="submit" class="btn btn-success" onclick="submitArticle();">Submit Article</button>
            <button type="button" class="btn btn-secondary" onclick="previewArticleFunc();">Preview</button>
        </div> 
        <div id="preview" class="mt-4"></div>
    </section>

    <section id="news-feed">
        <h2>Latest News</h2>
        <div id="articles" class="row">Loading articles...</div>

    </section>
</main>

<footer class="text-center p-4 bg-dark text-white">
    <p>&copy; 2024 News Portal</p>
</footer>

<!-- CKEditor for rich text editing -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ckeditor/4.16.0/ckeditor.js"></script>

    
   <!-- Firebase configuration/ Login& Out -->
   <script type="module" src="../public/js/main.js"></script> 
   
   <script>
    function previewArticleFunc() {
        console.log("Preview Article Function Called");

        const title = document.getElementById('title').value;
        const content = CKEDITOR.instances['content'].getData();
        const tags = Array.from(document.getElementById('tags').selectedOptions).map(option => option.value);
        const category = document.getElementById('category').value;

        document.getElementById('preview').innerHTML = `
            <h3>${title}</h3>
            <div>${content}</div>
            <p>Tags: ${tags.join(', ')}</p>
            <p>Category: ${category}</p>
        `;
    }

    

</script>


<script type="module">
    import { db, storage, analytics, app } from '../public/js/main.js'; // Adjust the path based on your structure
    import { collection, getDocs, addDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
    import { ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-storage.js";

    
         // Initialize CKEditor for rich text editing
    CKEDITOR.replace('content');


    // Auto-save drafts feature
    const autoSaveInterval = setInterval(() => {
        const title = document.getElementById('title').value;
        const content = CKEDITOR.instances['content'].getData();
        const tags = Array.from(document.getElementById('tags').selectedOptions).map(option => option.value);
        const category = document.getElementById('category').value;

        if (title || content) {
            const draftData = { title, content, tags, category };
            localStorage.setItem('draftArticle', JSON.stringify(draftData));
        }
    }, 30000); // Auto-save every 30 seconds

    // Load draft if exists
    window.onload = function() {
        const savedDraft = JSON.parse(localStorage.getItem('draftArticle'));
        if (savedDraft) {
            document.getElementById('title').value = savedDraft.title;
            CKEDITOR.instances['content'].setData(savedDraft.content);
            savedDraft.tags.forEach(tag => {
                const option = Array.from(document.getElementById('tags').options).find(opt => opt.value === tag);
                if (option) option.selected = true;
            });
            document.getElementById('category').value = savedDraft.category;
        }
        displayArticles(getDocs,collection);
    };

     
   

    // Implement spam detection
    const spamDetection = (submission) => {
        const spamKeywords = ["spam", "fake"];
        return !spamKeywords.some(keyword => submission.includes(keyword));
    };

   
    


  // Function to submit an article
async function submitArticle(addDo,collection ) {
    console.log("submitArticle function called");

    const title = document.getElementById('title').value;
    const content = CKEDITOR.instances['content'].getData();
    const tags = Array.from(document.getElementById('tags').selectedOptions).map(option => option.value);
    const category = document.getElementById('category').value;
    const mediaFiles = document.getElementById('media').files;

    // Check for bad words or injections (simple example)
    const forbiddenWords = ["badword1", "badword2"];
    if (forbiddenWords.some(word => content.includes(word))) {
        alert("Your content contains inappropriate language.");
        return;
    }

    console.log("Starting media upload...");

    // Upload media files to Firebase Cloud Storage
    const mediaURLs = [];
    const uploadPromises = Array.from(mediaFiles).map(file => {
        const fileRef = ref(storage, `media/${file.name}`); // Create a reference for the file
        const uploadTask = uploadBytesResumable(fileRef, file); // Upload file

        return uploadTask.then(snapshot => getDownloadURL(snapshot.ref)); // Get the download URL after upload
    });

    // Wait for all media files to be uploaded and get URLs
    const urls = await Promise.all(uploadPromises);
    mediaURLs.push(...urls);

    // Prepare article data
    const newArticle = {
        title,
        content,
        tags,
        category,
        mediaFiles: mediaURLs,
        authorID: 'user123', // Replace with actual user ID
        authorType: 'user', // Replace based on submission
        status: 'pending',
        createdAt: new Date()
    };

    try {
        // Add article to Firestore (or Firebase Realtime Database)
        await addDoc(collection(db, 'Articles'), newArticle); // Firestore syntax
        console.log('Article successfully added!');
        displayArticles(getDocs,collection); // Function to refresh article display
        document.getElementById('article-form').reset();
        CKEDITOR.instances['content'].setData('');
        localStorage.removeItem('draftArticle'); // Clear draft if any

    } catch (error) {
        console.error("Error adding article:", error);
    }
}
    // Function to display articles
 // Function to display articles
async function displayArticles(getDocs,collection ) {
    console.log("displayArticles function called"); // Debugging log
    
    const articlesContainer = document.getElementById('articles');
    if (!articlesContainer) {
        console.error('No articles container found in DOM'); // Check if the element exists
        return;
    }

    articlesContainer.innerHTML = ''; // Clear previous content

    try {
        const articlesSnapshot = await getDocs(collection(db, 'Articles')); // Fetch articles collection
        console.log("Fetched snapshot: ", articlesSnapshot);

        articlesSnapshot.forEach((doc) => {
            const article = doc.data();
            console.log("Fetched article: ", article);

            const articleId = doc.id;

            const articleElement = document.createElement('div');
            articleElement.className = 'col-md-4 mb-4';
            articleElement.innerHTML = `
                <div class="card">
                    <img src="${article.mediaFiles[0] || 'default-image-url'}" class="card-img-top" alt="${article.title}">
                    <div class="card-body">
                        <h5 class="card-title">${article.title}</h5>
                        <p class="card-text">${article.content.substring(0, 100)}...</p>
                        <p>Tags: ${article.tags ? article.tags.join(', ') : 'No tags'}</p>
                        <p>Category: ${article.category || 'Uncategorized'}</p>
                        <a href="article.html?id=${articleId}" class="btn btn-primary">Read More</a>
                    </div>
                </div>
            `;
            articlesContainer.appendChild(articleElement);
        });

    } catch (error) {
        console.error("Error fetching articles:", error);
    }

    console.log("Articles display finished.");
}

</script>

</body>
</html>
