<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Stay updated with the latest news articles submitted by users, recruiters, and companies.">
    <meta name="keywords" content="Career Tips, Industry News, Recruiter Insights">
    <title>News Portal</title>
    <style>

#news-submission-area {
    background-color: #f8f9fa;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

#articles .card {
    transition: transform 0.3s, box-shadow 0.3s;
}

#articles .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
}

#articles .card-img-top {
    object-fit: cover;
    height: 200px;
}

.modal-header {
    border-bottom: none;
}

.modal-body {
    padding: 2rem;
}

.modal-footer {
    border-top: none;
}

    </style>


    <!-- Dynamic Schema Markup -->
    <script type="application/ld+json" id="dynamicSchema">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "News Page",
        "description": "Latest news articles submitted by users, recruiters, and companies.",
        "url": "http://www.example.com/news",
        "mainEntity": {
            "@type": "WebSite",
            "name": "News Portal",
            "url": "http://www.example.com"
        }
    }
    </script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <!-- Bootstrap CSS -->
    <script src="../public/js/scripts.js"></script>
    <script src="../public/js/loadScripts.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../public/css/styles.css">

</head>


<body>
    <script src="../public/js/bodyload.js"></script>
    

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="../index.html">ReelCareer</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="job-listings.html">Job Listings</a></li>
                <li class="nav-item"><a class="nav-link" href="company-pages.html">Company Pages</a></li>
                <li class="nav-item"><a class="nav-link" href="job-seeker.html">Job Seeker</a></li>
                <li class="nav-item"><a class="nav-link" href="recruiter-dashboard.html">Recruiter Dashboard</a></li>
                <li class="nav-item"><a class="nav-link" href="news.html">News</a></li>
            </ul>
        </div>
    </nav>
<header class="bg-dark text-white text-center p-4">
    <h1>News Portal</h1>
    <nav>
        <ul class="nav justify-content-center">
            <li class="nav-item"><a class="nav-link text-white" href="#submission">Submit Article</a></li>
            <li class="nav-item"><a class="nav-link text-white" href="#news-feed">News Feed</a></li>
        </ul>
    </nav>
</header>

<main class="container my-5">
    <section id="news-submission-area" class="container my-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="font-weight-bold">News Feed</h2>
            <button class="btn btn-primary btn-lg" id="create-article-btn">Create Article</button>
        </div>
    
        <div id="articles" class="row">
            <!-- Dynamically generated articles will go here -->
        </div>
    </section>
    
    <!-- Modal for Creating Article -->
    <div class="modal fade hide" id="articleModal" tabindex="-1" aria-labelledby="articleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="articleModalLabel">Submit Your Article</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="article-form">
                        <div class="form-group mb-3">
                            <label for="title" class="form-label">Title</label>
                            <input type="text" class="form-control" id="title" placeholder="Enter the article title" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="content" class="form-label">Content</label>
                            <textarea class="form-control" id="content" rows="5" placeholder="Enter your article content" required></textarea>
                        </div>
                        <div class="form-group mb-3">
                            <label for="tags" class="form-label">Tags</label>
                            <select class="form-select" id="tags" multiple required>
                                <option value="Job Search Tips">Job Search Tips</option>
                                <option value="Career Development">Career Development</option>
                                <option value="Industry News">Industry News</option>
                                <option value="Remote Work">Remote Work</option>
                                <option value="Hiring Trends">Hiring Trends</option>
                            </select>
                        </div>
                        <div class="form-group mb-3">
                            <label for="category" class="form-label">Category</label>
                            <select class="form-select" id="category" required>
                                <option value="Career Tips">Career Tips</option>
                                <option value="Industry News">Industry News</option>
                                <option value="Recruiter Insights">Recruiter Insights</option>
                            </select>
                        </div>
                        <div class="form-group mb-3">
                            <label for="media" class="form-label">Upload Media</label>
                            <input type="file" class="form-control" id="media" multiple accept="image/*,video/*,application/pdf">
                            <small class="text-muted">Recommended image size: 1200x800 pixels.</small>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-success">Submit Article</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
</main>

 <!-- Bootstrap JS and dependencies -->
 <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
 <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- CKEditor for rich text editing -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ckeditor/4.16.0/ckeditor.js"></script>

    



    <!-- Footer -->
    <footer id="dynamic-footer"></footer>
    
    <!-- Firebase configuration/ Login& Out -->
    <script type="module" src="../public/js/main.js"></script> 

    <!-- Dynamic Schema Markup -->
    <script type="module">
    import { db, storage, analytics, app  } from '../public/js/main.js'; // Adjust the path based on your structure
    import { query, where, orderBy, limit,  collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
    
      import { db, storage, analytics, app, collection, getDocs } from '../public/js/main.js'; // Adjust the path based on your structure
  
 // Initialize CKEditor for rich text editing
 CKEDITOR.replace('content');
/*

// Auto-save drafts feature
const autoSaveInterval = setInterval(() => {
    const title = document.getElementById('title').value;
    const content = CKEDITOR.instances['content'].getData();
    const tags = Array.from(document.getElementById('tags').selectedOptions).map(option => option.value);
    const category = document.getElementById('category').value;

    if (title || content) {
        const draftData = { title, content, tags, category };
        localStorage.setItem('draftArticle', JSON.stringify(draftData));
    }
}, 30000); // Auto-save every 30 seconds

*/

// Implement spam detection
const spamDetection = (submission) => {
    const spamKeywords = ["spam", "fake"];
    return !spamKeywords.some(keyword => submission.includes(keyword));
};





// Function to open the Create Article modal
document.getElementById('create-article-btn').addEventListener('click', function() {
    const modal = new bootstrap.Modal(document.getElementById('articleModal'));
    modal.show();
});

async function submitArticle(event) {
    event.preventDefault(); // Prevent form submission

    const title = document.getElementById('title').value;
    const content = CKEDITOR.instances['content'].getData();
    const tags = Array.from(document.getElementById('tags').selectedOptions).map(option => option.value);
    const category = document.getElementById('category').value;
    const mediaFiles = document.getElementById('media').files;

    let mediaURLs = [];

    // Media upload logic...
    if (mediaFiles.length > 0) {
        const uploadPromises = Array.from(mediaFiles).map(file => {
            const fileRef = ref(storage, `media/${file.name}`);
            const uploadTask = uploadBytesResumable(fileRef, file);

            return uploadTask.then(snapshot => getDownloadURL(snapshot.ref));
        });

        mediaURLs = await Promise.all(uploadPromises);
    }

    const newArticle = {
        title,
        content,
        tags,
        category,
        mediaFiles: mediaURLs,
        createdAt: new Date()
    };

    try {
        await addDoc(collection(db, 'Articles'), newArticle);
        console.log('Article successfully added!');
        
        // Close modal after submission
        const modalElement = document.getElementById('articleModal');
        const modal = bootstrap.Modal.getInstance(modalElement);
        modal.hide();

        // Refresh articles
        displayArticles();
    } catch (error) {
        console.error('Error adding article:', error);
    }
}


// Function to display articles
async function displayArticles() {
console.log("displayArticles function called"); // Debugging log

const articlesContainer = document.getElementById('articles');
if (!articlesContainer) {
    console.error('No articles container found in DOM'); // Check if the element exists
    return;
}

articlesContainer.innerHTML = ''; // Clear previous content
const articlesCollectionRef = collection(db, 'Articles'); // Reference to the Articles collection

try {
    const articlesSnapshot = await getDocs(articlesCollectionRef);
    console.log("Fetched snapshot: ", articlesSnapshot);

    articlesSnapshot.forEach((doc) => {
        const article = doc.data();
        console.log("Fetched article: ", article);

        const articleId = doc.id;

        const articleElement = document.createElement('div');
        articleElement.className = 'col-md-4 mb-4';
        articleElement.innerHTML = `
                <div class="card">
                    <img src="${article.mediaFiles[0] || '/images/rc_text_sm.png'}" class="card-img-top" alt="${article.title}">
                    <div class="card-body">
                        <h5 class="card-title">${article.title}</h5>
                        <p class="card-text">${article.content.substring(0, 100)}...</p>
                        <p>Tags: ${article.tags ? article.tags.join(', ') : 'No tags'}</p>
                        <p>Category: ${article.category || 'Uncategorized'}</p>
                        <a href="article.html?id=${article.id}" class="btn btn-primary">Read More</a>
                    </div>
                </div>
            `;
            articlesContainer.appendChild(articleElement);
    });

} catch (error) {
    console.error("Error fetching articles:", error);
}

console.log("Articles display finished.");
}



// Function to update the HTML and display the articles
function updateNewsFeed(articles) {
    const articlesContainer = document.getElementById('articles');
    articlesContainer.innerHTML = ''; // Clear the placeholder text

    if (articles.length === 0) {
        articlesContainer.innerHTML = '<p>No articles available at the moment.</p>';
        return;
    }

    // Create article cards for each article
    articles.forEach(article => {
        const articleCard = document.createElement('div');
        articleCard.classList.add('col-md-4');

        articleCard.innerHTML = `
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">${article.title}</h5>
                    <p class="card-text">${article.content.substring(0, 100)}...</p>
                    <a href="#" class="btn btn-primary">Read More</a>
                </div>
            </div>
        `;

        articlesContainer.appendChild(articleCard);
    });
}

// Call the function to display articles when the page loads
window.onload = () => {
    displayArticles();
};

function previewArticleFunc() {
        console.log("Preview Article Function Called");

        const title = document.getElementById('title').value;
        const content = CKEDITOR.instances['content'].getData();
        const tags = Array.from(document.getElementById('tags').selectedOptions).map(option => option.value);
        const category = document.getElementById('category').value;

        document.getElementById('preview').innerHTML = `
            <h3>${title}</h3>
            <div>${content}</div>
            <p>Tags: ${tags.join(', ')}</p>
            <p>Category: ${category}</p>
        `;
    }

   
    





</script>

</body>
</html>
