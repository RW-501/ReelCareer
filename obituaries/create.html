<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Create your Career Obituary">
    <meta property="og:description" content="Learn how to create meaningful obituary pages to celebrate and remember your loved ones with ReelCareer.">
    <meta property="og:image" content="https://reelcareer.co/images/8pic_rc.png">
    <meta property="og:url" content="https://reelcareer.co/obituaries/about">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Create your Career Obituary">
    <meta name="twitter:description" content="Learn how to create meaningful obituary pages to celebrate and remember your loved ones with ReelCareer.">
    <meta name="twitter:image" content="https://reelcareer.co/images/8pic_rc.png">
    <meta name="twitter:url" content="https://reelcareer.co/obituaries/create">
    
    <!-- General Meta Tags -->
    <meta name="description" content="Explore our obituary creation service to honor and celebrate the lives of your loved ones. Learn how to create a personalized page with photos, details, and cherished memories.">
    <meta name="keywords" content="obituary, about obituary service, memorial, legacy, celebration of life, remembrance">
    <meta name="author" content="ReelCareer">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#ffffff">
    
    <!-- Canonical Tag for SEO -->
    <link rel="canonical" href="https://reelcareer.co/obituaries/create">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="https://reelcareer.co/images/favicons/favicon.ico">

    <title>Create your Career Obituary | ReelCareer</title>


    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "url": "https://reelcareer.co/obituaries/create",
      "name": "Create Your Obituary",
      "description": "Create your personalized obituary page. Add details, photos, and memories to leave a lasting legacy.",
      "author": {
        "@type": "Organization",
        "name": "ReelCareer",
        "url": "https://reelcareer.co/"
      },
      "publisher": {
        "@type": "Organization",
        "name": "ReelCareer",
        "url": "https://reelcareer.co/",
        "logo": {
          "@type": "ImageObject",
          "url": "https://reelcareer.co/images/8pic_rc.png",
          "width": 200,
          "height": 60
        }
      },
      "image": {
        "@type": "ImageObject",
        "url": "https://reelcareer.co/images/8pic_rc.png",
        "width": 1200,
        "height": 630
      }
    }
    </script>


    <title>Create Your Obituary</title>

<!-- Main Script Loader -->
<script src="https://reelcareer.co/scripts/js/loader.js"></script>

<style>

main {
    /* Styling Labels */
    label {
        font-weight: 600;
        display: block;
        margin: 12px 0 6px;
        color: #4a4a4a;
        font-size: 1.1rem;
    }
    
    /* Styling Inputs and Textareas */
    select,
    input[type="date"],
    input[type="text"],
    input[type="url"],
    textarea {
        width: 100%;
        padding: 12px 16px;
        border-radius: 8px;
        border: 1px solid #ddd;
        margin-bottom: 20px;
        font-size: 1rem;
        background-color: #f9f9f9;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease-in-out;
    }
    select:focus,
    input[type="date"]:focus,
    input[type="text"]:focus,
    input[type="url"]:focus,
    textarea:focus {
        border-color: #007bff;
        background-color: #fff;
        box-shadow: 0 0 5px rgba(0, 123, 255, 0.25);
        outline: none;
    }
    
    /* Styling Textarea */
    textarea {
        height: 180px;
        resize: vertical;
    }
    
    /* Styling File Input */
    .input-file {
        padding: 12px;
        font-size: 1rem;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f9f9f9;
        transition: all 0.3s ease-in-out;
        width: 100%;
    }
    
    .input-file:hover {
        background-color: #f1f1f1;
        border-color: #ccc;
    }
    
    /* Modern Hover Effect */
    select:hover,
    input[type="date"]:hover,
    input[type="text"]:hover,
    input[type="url"]:hover,
    textarea:hover {
        border-color: #bbb;
    }
    
    /* Additional Style: Placeholder Text */
    input::placeholder,
    textarea::placeholder {
        color: #aaa;
        font-style: italic;
    }
    
    /* Adding Responsive Design */
    @media (max-width: 768px) {
        input[type="text"],
        input[type="url"],
        textarea {
            font-size: 0.95rem;
            padding: 10px 14px;
        }
    
        label {
            font-size: 1rem;
        }
    }
    
    
    #imageControls {
        margin-top: 10px;
    }
    
    #imageControls button {
        margin-right: 5px;
        padding: 5px 10px;
        cursor: pointer;
        border: none;
        background-color: #f0f0f0;
        border-radius: 5px;
        transition: background-color 0.3s;
    }
    
    #imageControls button:hover {
        background-color: #ddd;
    }
    
    

  
    
    #messageDiv {
        text-align: center;
    }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }
    
        .modal-content {
        background-color: #fff;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 600px;
        border-radius: 25px;
    }
    
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 0;
            right: 20px;
        }
    
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    
        #previewContent {
            margin-bottom: 20px;
        }
    
        img {
            display: block;
            margin: 10px auto;
            max-width: 100%;
        }
    
        #closePreviewButton {
        padding: 10px;
        background-color: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
        display: grid;
        margin: auto;
        align-content: center;
        justify-content: center;
        align-items: center;
        justify-items: center;
    }
    
        #closePreviewButton:hover {
            background-color: #45a049;
        }
        .inputArea {
        display: grid;
        width: 100%;
        align-content: space-between;
        justify-content: space-between;
        align-items: stretch;
        justify-items: stretch;
        border: beige solid;
        padding: .5rem;
        border-radius: 25px;
        margin: .5rem;
    }
        .flex {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        justify-content: space-evenly;
        align-items: stretch;
        align-content: stretch;
        gap: .5rem;
    }
    
    .preview-about {
        width: 100%;
        display: grid;
    
    }
    .preview-info {
        width: 100%;
        display: grid;
    
    }
    .preview-dates {
        width: 100%;
        display: flex;
        flex-wrap: nowrap;
        align-content: space-between;
        justify-content: space-between;
        flex-direction: row;
    }
    .preview-pic {
        width: 100%;
        display: grid;
    
    }
    .flex {
        display: flex;
    }

    .previewShareButton {
    display: flex;
    margin: 1rem;
}

    #actionButtons {
        display: none;
    }
     
}    
    </style>
    
</head>
<body>

  <!-- Navigation Bar -->
  <nav id="Main-Nav_bar" class="navbar navbar-expand-lg main-navbar-light shadow-sm sticky-top" role="navigation">
    <div class="container d-flex align-items-center justify-content-between">
      <!-- Logo -->
      <a class="navbar-brand embossed" id="MAIN-LOGO-Reel-Career" href="https://reelcareer.co/" aria-label="Go to home page">
        ReelCareer
      </a>

      <!-- Always-visible Icons -->
      <ul class="navbar-nav d-flex flex-row justify-content-center flex-grow-1" id="iconBar">
        
      <li class="nav-item mx-2">
        <a class="nav-link" href="https://reelcareer.co/job-listings" aria-label="Go to job listings page">
          <i class="fa fa-briefcase"></i>
        </a>
      </li>
      <li class="nav-item mx-2">
        <a class="nav-link" href="https://reelcareer.co/reels" aria-label="Go to reels page">
          <i class="fa fa-video"></i>
        </a>
      </li>
      <li class="nav-item mx-2">
        <a class="nav-link" href="https://reelcareer.co/views/membership" aria-label="Go to membership page">
          <i class="fa fa-user"></i>
        </a>
      </li>
      <li class="nav-item mx-2">
        <a class="nav-link" href="https://reelcareer.co/views/blogs" aria-label="Go to blogs page">
          <i class="fa fa-pencil-alt"></i>
        </a>
      </li>
      </ul>

      <!-- Auth Section -->
      <div id="authSection" class="d-flex align-items-center"><button class="btn btn-primary" id="loginButton">Login / Create Account</button></div>
    </div>
  </nav>


<header>
    <h1>Create Your Obituary</h1>
</header>

   <!-- Breadcrumb Section -->
<div id="main-breadcrumb" class="breadcrumb">
    <a href="https://reelcareer.co/">Home</a> | <a href="https://reelcareer.co/obituaries">Obituaries</a> 
    | <a href="https://reelcareer.co/obituaries/create">Create</a>| <a href="https://reelcareer.co/obituaries/about">About</a>
</div>


    <!-- Main Content Section -->
<main id="main-content">


    <div class="container">
        <h2>Leave Your Legacy</h2>
        <p>This page allows you to create your obituary, share details about your life, and give your loved ones a lasting memory of you. Fill in the following details to create your obituary page.</p>

        <form id="obituaryForm" aria-labelledby="obituaryFormTitle">
            <h2 id="obituaryFormTitle">Create Obituary</h2> <!-- Adds title for screen readers -->
        
            <div class="section">
                <div class="inputArea">
                    <label for="name" aria-label="Enter the full name of the person">Full Name</label>
                    <p id="nameHint" class="visually-hidden">Please enter the person's full name.</p>
                    <input type="text" id="name" name="name" placeholder="Enter your full name" required aria-required="true" aria-describedby="nameHint">
                    </div>

                    <div class="flex">
                    <div class="inputArea">
                    <label for="sunrise" aria-label="Select the date of birth (Sunrise)">Sunrise (Date)</label>
                    <p id="sunriseHint" class="visually-hidden">Please select the date of birth (Sunrise).</p>
                    <input type="date" id="sunrise" name="sunrise" required aria-required="true" aria-describedby="sunriseHint">
       </div>


                    <div class="inputArea">
                    <label for="sunset" aria-label="Select the date of passing (Sunset)">Sunset (Date)</label>
                    <p id="sunsetHint" class="visually-hidden">Please select the date of passing (Sunset).</p>
                    <input type="date" id="sunset" name="sunset" required aria-required="true" aria-describedby="sunsetHint">
                </div>
            </div>
                    

            <div class="inputArea">
                <label for="hashTag" aria-label="Enter related hashtags for the event (e.g., #Memorial, #CelebrationOfLife)">Event Hashtags (e.g., #Memorial, #CelebrationOfLife)</label>
                <p id="hashTagHint" class="visually-hidden">Please enter hashtags related to the event, separated by spaces or commas.</p>
                <input 
                  type="text" 
                  id="hashTag" 
                  name="hashTag" 
                  placeholder="Enter hashtags related to the event (e.g., #Memorial, #CelebrationOfLife)" 
                  aria-describedby="hashTagHint" 
                >
              </div>
              
                <div class="inputArea">
                    <label for="location" aria-label="Enter where services will be held (e.g., Virtual Event, Venue)">Event Location (e.g., Virtual Event, Directions, or Venue)</label>
                    <p id="locationHint" class="visually-hidden">Please where services will be held or additional details like Zoom link, address, etc.</p>
                    <input type="text" id="location" name="location" placeholder="Enter where services will be held or additional details (e.g., Zoom link, address)" required aria-required="true" aria-describedby="locationHint">
                </div>
                    
                <div class="inputArea">  
                     <label for="category" aria-label="Select a category">Category</label>
                    <p id="categoryHint" class="visually-hidden">Select the category that best describes the person.</p>
                    <select id="category" name="category" required aria-required="true" aria-describedby="categoryHint">
                        <option value="" disabled selected>Select a category</option>
                        <option value="family">Family</option>
                        <option value="friend">Friend</option>
                        <option value="creator">Creator</option>
                        <option value="developer">Developer</option>
                        <option value="designer">Designer</option>
                        <option value="photographer">Photographer</option>
                        <option value="musician">Musician</option>
                        <option value="plumber">Plumber</option>
                        <option value="electrician">Electrician</option>
                        <option value="teacher">Teacher</option>
                        <option value="engineer">Engineer</option>
                        <option value="doctor">Doctor</option>
                        <option value="nurse">Nurse</option>
                        <option value="chef">Chef</option>
                        <option value="artist">Artist</option>
                        <option value="writer">Writer</option>
                        <option value="other">Other (Specify)</option>
                    </select>
                
                    <div id="otherCategoryContainer" style="display: none;">
                        <label for="otherCategory" aria-label="Specify another category">Specify Category</label>
                        <p id="otherCategoryHint" class="visually-hidden">If the category is not listed, please specify it here.</p>
                        <input type="text" id="otherCategory" name="otherCategory" placeholder="Specify other category" aria-describedby="otherCategoryHint">
                    </div>
                </div>
                        
                <div class="inputArea">
                    <label for="gender" aria-label="Select a gender">Gender</label>
                    <p id="genderHint" class="visually-hidden">Select the gender or pronouns that best describe the person.</p>
                    <select id="gender" name="gender" required aria-required="true" aria-describedby="genderHint">
                        <option value="" disabled selected>Select a gender or pronouns</option>
                        <option value="male">Male (he/him)</option>
                        <option value="female">Female (she/her)</option>
                        <option value="nonbinary">Non-binary (they/them)</option>
                        <option value="transMale">Transgender Male (he/him)</option>
                        <option value="transFemale">Transgender Female (she/her)</option>
                        <option value="genderqueer">Genderqueer (they/them)</option>
                        <option value="preferNotToSay">Prefer not to say</option>
                        <option value="other">Other (Specify)</option>
                    </select>
                </div>
                



                <div class="inputArea">
                    <div id="suggestionBox" style="margin-top: 20px;">
                        <label for="suggestions" aria-label="Select a suggested 'About' text">Suggested "About" Text</label>
                        <select id="suggestions">
                            <option value="" disabled selected>Select a suggestion</option>
                        </select>
                    </div>
                </div>

                <div class="inputArea">
                    <label for="about" aria-label="Write a short biography or summary about the person">About the Person</label>
                    <p id="aboutHint" class="visually-hidden">Please provide a brief biography or summary of the person's life.</p>
                    <textarea id="about" name="about" placeholder="Write a short biography or summary about the person" required aria-required="true" aria-describedby="aboutHint"></textarea>
                </div>

                    <label for="pageName" aria-label="Enter obituary page URL">URL (Obituary Page URL)</label>
                    <p id="urlHint" class="visually-hidden">Format: /celebrating/[your-url]. The URL should only contain letters, numbers, hyphens, and underscores.</p>
                    <input type="text" id="pageName" name="url" placeholder="Choose a URL (e.g., john-doe)" required aria-required="true" aria-describedby="urlHint">
                    
                    <div>
                        <p>Preview URL:</p>
                        <p id="urlPreview">https://reelcareer.co/obituaries/celebrating/</p>
                        <p id="urlAvailabilityMessage" style="color: red; display: none;" aria-live="polite">This page name is already taken. Please choose another one.</p>
                    </div>
                </div>
            </div>
                    
            <div class="inputArea">              
                    <label for="mainPhoto" aria-label="Upload main photo">Main Photo</label> 
                    <p id="photoHint" class="visually-hidden">Upload a main photo for the obituary.</p>
                    <input type="file" id="mainPhoto" name="mainPhoto" class="input-file" accept="image/*" required aria-required="true" aria-describedby="photoHint">
                    
                    <!-- Image preview container -->
                    <div id="imagePreviewContainer" style="display: none; margin-top: 20px;">
                        <!-- Image preview that will display the selected image -->
                        <img id="imagePreview" src="" alt="Uploaded main photo preview" style="max-width: 200px; max-height: 200px; border: 1px solid #ccc; cursor: pointer;">
                        <div id="imageControls">
                            <button id="toggleBnw">Black & White</button>
                            <button id="rotateImage">Rotate</button>
                            <button id="zoomIn">Zoom In</button>
                            <button id="zoomOut">Zoom Out</button>
                            <button id="resetImage">Reset</button>
                        </div>
                    </div>
            </div>

 
                <div class="inputArea">                   
                     <label for="video" aria-label="Enter video URL">Video (Optional)</label>
                    <p id="videoHint" class="visually-hidden">Optional: Provide a video URL (e.g., YouTube, Vimeo) related to the obituary.</p>
                    <input type="url" id="video" name="video" class="input-file" placeholder="Enter video URL (YouTube, Vimeo, MP4, etc.)" aria-describedby="videoHint">
                    <div id="videoPreview"></div>
                </div>
                    
                <div class="inputArea">
                    <label for="socialLinkName" aria-label="Enter social media name (e.g., Facebook, CashApp, Instagram)">Social Media Name (e.g., Facebook, CashApp, Instagram)</label>
                    <p id="socialNameHint" class="visually-hidden">Enter the name of the social media platform (e.g., Facebook, CashApp, Instagram).</p>
                    <input type="text" id="socialLinkName" name="socialLinkName" class="input-file" placeholder="Enter social media name" required aria-required="true" aria-describedby="socialNameHint">
                
                    <label for="socialLinks" aria-label="Enter social media link (URL)">Social Media Link (URL)</label>
                    <p id="socialLinkHint" class="visually-hidden">Enter the full URL to the social media profile (e.g., https://yourURL.com).</p>
                    <input type="url" id="socialLinks" name="socialLinks" class="input-file" placeholder="Enter your social media link (e.g., https://yourURL.com)" required aria-required="true" aria-describedby="socialLinkHint">
                </div>


        
            <div class="button-container">
                <button type="button" id="preview-button" aria-label="Preview the obituary">Preview Obituary</button>
                <button type="button" id="paypal-button" aria-label="Create the obituary and proceed to payment">Create Now</button>
            </div>
        </form>

<!-- Correct container for the PayPal button -->
<div id="paypal-button-container" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div id="paypalContent"></div>
        <button id="closeModal">Close</button>
    </div>
</div>

<!-- The Popup Modal -->
<div id="previewModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Obituary Preview</h2>
        <div id="previewContent"></div>
        <div id="actionButtons"></div>
        <button id="closePreviewButton">Close Preview</button>
    </div>
</div>

</main>


<footer class="site-footer">
    <div class="footer-content">
        <p>Leave a lasting legacy. Share your story with the world.</p>
        <nav class="footer-nav">
            <a href="https://reelcareer.co/obituaries/">Obituaries</a>
            <a href="https://reelcareer.co/obituaries/create">Create an Obituary</a>
            <a href="https://reelcareer.co/obituaries/about">About Career Obituaries</a>
            <a href="https://reelcareer.co/">ReelCareer</a>
        </nav>
        <p>&copy; <span id="currentYear"></span> ReelCareer.co. All rights reserved.</p>
    </div>
</footer>




    <!-- Include PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=AcOZi3sszHkpUZJCLDRglEAusFk4W_siExTkNTWQhjMSFRxV7Prc81274wHQ8H-wYYfnWsm4p6Rw55Qp"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script> <!-- For fetching IP -->

<!-- Include Firebase SDK as a module -->
<script type="module">
    import {
        db, getStorage, ref, uploadBytes, getDownloadURL, limit,
  doc, arrayUnion, RecaptchaVerifier, increment, getDoc, arrayRemove, signInWithPhoneNumber,
  query, updateDoc, setDoc, addDoc, signInAnonymously, orderBy, onAuthStateChanged,
  uploadBytesResumable, signInWithPopup, FacebookAuthProvider, GoogleAuthProvider, startAfter,
  OAuthProvider, signOut, deleteDoc, getFirestore, serverTimestamp,
  createUserWithEmailAndPassword, signInWithEmailAndPassword, deleteObject,
  where, getDocs, storage, getAuth, collection, auth, analytics,
  googleProvider,onSnapshot , linkWithCredential, EmailAuthProvider ,
  getUserId // Export the function
    } from 'https://reelcareer.co/scripts/js/load/module.js';

            // Fetch user's IP address using an external service
        async function getUserIP() {
            try {
                const response = await axios.get('https://api.ipify.org?format=json');
                return response.data.ip;
            } catch (error) {
                console.error('Error fetching IP address:', error);
                return 'Unknown IP';
            }
        }

        // Listen for authentication state changes to get the user ID
let userID = '';
      



// Function to fetch user IP and location details
async function getUserDetails() {
  try {
    const response = await fetch("https://ipapi.co/json/");
    const data = await response.json();

    return {
      ip: data.ip,
      city: data.city,
      state: data.region,
      country: data.country_name,
      location: {
        latitude: data.latitude,
        longitude: data.longitude,
      },
    };
  } catch (error) {
    console.error("Error fetching user details:", error);
    return null;
  }
}
const fileInput = document.getElementById('mainPhoto');
let imagePreview = document.getElementById('imagePreview');
const imagePreviewContainer = document.getElementById('imagePreviewContainer');
const toggleBnwButton = document.getElementById('toggleBnw');
const rotateButton = document.getElementById('rotateImage');
const zoomInButton = document.getElementById('zoomIn');
const zoomOutButton = document.getElementById('zoomOut');
const resetButton = document.getElementById('resetImage');

// Default image transformations
let isBlackAndWhite = false;
let rotationDegree = 0;
let zoomLevel = 1;
let originalImageUrl = ''; // To store the original image URL

// Function to update image styles using canvas
function updateImageStylesAndCreateCanvas() {

    imagePreview = document.getElementById('imagePreview');
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');

    // Set canvas size based on the image's natural size
    const { naturalWidth, naturalHeight } = imagePreview;
    canvas.width = naturalWidth;
    canvas.height = naturalHeight;

    // Clear the canvas and set the origin point for transformations
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.translate(canvas.width / 2, canvas.height / 2);
    ctx.rotate((rotationDegree * Math.PI) / 180); // Convert degrees to radians
    ctx.scale(zoomLevel, zoomLevel);

    // Apply grayscale filter (if enabled)
    ctx.filter = isBlackAndWhite ? 'grayscale(100%)' : 'none';

    // Draw the transformed image
    ctx.drawImage(imagePreview, -naturalWidth / 2, -naturalHeight / 2);
    ctx.restore();

    return canvas;
}

// Update image preview in real-time
function updateImageStyles() {
    const canvas = updateImageStylesAndCreateCanvas();
    imagePreview.src = canvas.toDataURL(); // Update the image with the transformed canvas
}

// Handle file selection and display the image
fileInput.addEventListener('change', function (event) {
    // Ensure mainPhoto exists before attempting to hide it
    const mainPhotoElement = document.getElementById('mainPhoto');
    if (mainPhotoElement) {
        mainPhotoElement.style.display = 'none'; // Hide the image if it exists
    }


    const file = event.target.files[0];

    if (file && file.type.startsWith('image/')) {
        const imageUrl = URL.createObjectURL(file);
        imagePreview.src = imageUrl;
        imagePreview.style.display = 'block';
        imagePreviewContainer.style.display = 'block';

        originalImageUrl = imageUrl; // Save the original image URL

        // Reset transformations on new image load
        isBlackAndWhite = false;
        rotationDegree = 0;
        zoomLevel = 1;
    }
});

// Transformation button event listeners
toggleBnwButton.addEventListener('click', function (event) {
    event.preventDefault(); // Prevent default behavior
    isBlackAndWhite = !isBlackAndWhite;
    updateImageStyles();
});

rotateButton.addEventListener('click', function (event) {
    event.preventDefault(); // Prevent default behavior
    rotationDegree = (rotationDegree + 90) % 360; // Rotate in steps of 90 degrees
    updateImageStyles();
});

zoomInButton.addEventListener('click', function (event) {
    event.preventDefault(); // Prevent default behavior
    zoomLevel = Math.min(3, zoomLevel + 0.1); // Cap the maximum zoom level
    updateImageStyles();
});

zoomOutButton.addEventListener('click', function (event) {
    event.preventDefault(); // Prevent default behavior
    zoomLevel = Math.max(0.5, zoomLevel - 0.1); // Prevent zooming out too far
    updateImageStyles();
});

resetButton.addEventListener('click', function (event) {
    event.preventDefault(); // Prevent default behavior
    isBlackAndWhite = false;
    rotationDegree = 0;
    zoomLevel = 1;

    // Reset the image to the original URL
    imagePreview.src = originalImageUrl;
    imagePreview.style.filter = 'none'; // Remove grayscale filter for default view
});
    // Allow the user to click the preview image to change it
    imagePreview.addEventListener('click', function() {
        fileInput.click(); // Trigger the file input to allow a new image selection
    });



    document.getElementById('category').addEventListener('change', function () {
        const otherCategory = document.getElementById('otherCategoryContainer');
        if (this.value === 'other') {
            otherCategory.style.display = 'block';
        } else {
            otherCategory.style.display = 'none';
        }
    });

    function displayVideoPreview(videoUrl, videoPreviewContainer) {

    // Check if the videoPreviewContainer is null
    if (!videoPreviewContainer) {
        console.error('Error: videoPreviewContainer is null or undefined.');
        return;
    }

    // Clear previous content in the container
    videoPreviewContainer.innerHTML = "";

    // Check if there is a videoUrl to display
    if (videoUrl) {
        // YouTube Video Check
        if (videoUrl.includes("youtube.com") || videoUrl.includes("youtu.be")) {
            const youtubeEmbed = videoUrl.includes("youtube.com") 
                ? videoUrl.replace("watch?v=", "embed/") 
                : videoUrl.replace("youtu.be/", "youtube.com/embed/");
            videoPreviewContainer.innerHTML = `
                <iframe width="560" height="315" src="${youtubeEmbed}" frameborder="0" allowfullscreen></iframe>`;
        }
        // Vimeo Video Check
        else if (videoUrl.includes("vimeo.com")) {
            const vimeoId = videoUrl.split("/").pop();
            videoPreviewContainer.innerHTML = `
                <iframe src="https://player.vimeo.com/video/${vimeoId}" width="560" height="315" frameborder="0" 
                        allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>`;
        }
        // MP4 Video Check (and other formats like .webm, .ogg)
        else if (videoUrl.match(/\.(mp4|webm|ogg)$/i)) {
            videoPreviewContainer.innerHTML = `
                <video width="560" height="315" controls>
                    <source src="${videoUrl}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>`;
        }
        // Dailymotion Video Check
        else if (videoUrl.includes("dailymotion.com")) {
            const dailymotionId = videoUrl.split("/").pop();
            videoPreviewContainer.innerHTML = `
                <iframe frameborder="0" width="560" height="315" src="https://www.dailymotion.com/embed/video/${dailymotionId}" 
                        allowfullscreen></iframe>`;
        }
        // Twitch Video Check
        else if (videoUrl.includes("twitch.tv")) {
            const twitchId = videoUrl.split("/").pop();
            videoPreviewContainer.innerHTML = `
                <iframe src="https://player.twitch.tv/?video=${twitchId}" height="315" width="560" frameborder="0" 
                        scrolling="no" allowfullscreen></iframe>`;
        }
        // Facebook Video Check
        else if (videoUrl.includes("facebook.com")) {
            const facebookId = videoUrl.split("/").pop();
            videoPreviewContainer.innerHTML = `
                <iframe src="https://www.facebook.com/plugins/video.php?href=https://www.facebook.com/video.php?v=${facebookId}" 
                        width="560" height="315" frameborder="0" allowfullscreen></iframe>`;
        }
        // Instagram Video Check
        else if (videoUrl.includes("instagram.com")) {
            const instagramId = videoUrl.split("/p/").pop().split("/")[0];
            videoPreviewContainer.innerHTML = `
                <iframe src="https://www.instagram.com/p/${instagramId}/embed" width="560" height="315" frameborder="0" 
                        scrolling="no" allowfullscreen></iframe>`;
        }
        // Twitter Video Check
        else if (videoUrl.includes("twitter.com")) {
            const twitterId = videoUrl.split("/status/").pop();
            videoPreviewContainer.innerHTML = `
                <iframe src="https://twitframe.com/show?url=${encodeURIComponent(videoUrl)}" width="560" height="315" 
                        frameborder="0" allowfullscreen></iframe>`;
        }
        // TikTok Video Check
        else if (videoUrl.includes("tiktok.com")) {
            const tiktokId = videoUrl.split("/video/").pop();
            videoPreviewContainer.innerHTML = `
                <iframe src="https://www.tiktok.com/embed/${tiktokId}" width="560" height="315" frameborder="0" 
                        allowfullscreen></iframe>`;
        }
        // Unsupported platform message
        else {
            videoPreviewContainer.innerHTML = "<p>Unsupported video platform. Please enter a URL from a supported platform like YouTube, Vimeo, Dailymotion, Instagram, or MP4.</p>";
        }

    } else {
        // Handle case when there is no videoUrl provided
        videoPreviewContainer.innerHTML = "<p>Please enter a video URL.</p>";
    }
}



    document.getElementById("video").addEventListener("input", function() {
    const videoUrl = this.value.trim();
    const videoPreview = document.getElementById("videoPreview");

    displayVideoPreview(videoUrl, videoPreview);
});
// Display the "Other" category input if selected
document.getElementById('category').addEventListener('change', function() {
    if (this.value === 'other') {
        document.getElementById('otherCategoryContainer').style.display = 'block';
    } else {
        document.getElementById('otherCategoryContainer').style.display = 'none';
    }
});

// Function to generate "about" suggestions
function generateAboutText() {
    const name = document.getElementById("name").value;
let sunrise = document.getElementById("sunrise").value;
let sunset = document.getElementById("sunset").value;
const hashTag = document.getElementById("hashTag").value.trim();
const location = document.getElementById("location").value;
const category = document.getElementById("category").value;
const otherCategory = document.getElementById("otherCategory").value;

let categoryText = category;
if (category === 'other' && otherCategory) {
    categoryText = otherCategory;
}
sunrise = formatDate(sunrise);
sunset = formatDate(sunset);

// Ensure hashtags are valid
let validHashTag = hashTag.startsWith("#") ? hashTag : `#${hashTag}`;
validHashTag = validHashTag.replace(/\s+/g, ''); // Remove spaces


const genderMap = {
    male: { pronouns: { subject: "he", object: "him", possessive: "his" } },
    female: { pronouns: { subject: "she", object: "her", possessive: "her" } },
    nonbinary: { pronouns: { subject: "they", object: "them", possessive: "their" } },
    transMale: { pronouns: { subject: "he", object: "him", possessive: "his" } },
    transFemale: { pronouns: { subject: "she", object: "her", possessive: "her" } },
    genderqueer: { pronouns: { subject: "they", object: "them", possessive: "their" } },
    preferNotToSay: { pronouns: { subject: "they", object: "them", possessive: "their" } },
    other: { pronouns: { subject: "they", object: "them", possessive: "their" } }
};

// Get the selected gender and corresponding pronouns
const gender = document.getElementById("gender").value;
const pronouns = genderMap[gender]?.pronouns || genderMap.other.pronouns;

const aboutSuggestions = [
    `In loving memory of ${name}, who was born on ${sunrise} and peacefully departed on ${sunset}. A beloved ${categoryText}, ${pronouns.subject} dedicated ${pronouns.possessive} life to making a difference in the lives of others. In ${location}, ${pronouns.subject} left a legacy of kindness, compassion, and integrity that will be treasured for generations. Friends, family, and colleagues all cherish the countless memories of laughter and joy shared with ${pronouns.object}. ${validHashTag}`,
    `${name}, a remarkable and inspiring ${categoryText}, graced this world from ${sunrise} until ${sunset}. Known for ${pronouns.possessive} unmatched generosity and warm heart, ${pronouns.subject} touched the hearts of many in ${location} and beyond. ${pronouns.subject.charAt(0).toUpperCase() + pronouns.subject.slice(1)} believed in spreading kindness wherever ${pronouns.subject} went. Though ${pronouns.subject} is no longer with us, ${pronouns.possessive} spirit lives on through the lives ${pronouns.subject} influenced. ${validHashTag}`,
    `From the sunrise of ${sunrise} to the sunset of ${sunset}, the life of ${name} was a tapestry woven with love, hope, and resilience. A cherished ${categoryText} in ${location}, ${pronouns.subject} embodied the spirit of compassion. ${pronouns.subject} was always there to lend a hand, offer a kind word, or inspire with ${pronouns.possessive} courage. ${pronouns.possessive.charAt(0).toUpperCase() + pronouns.possessive.slice(1)} story will forever be told in the hearts of those ${pronouns.subject} uplifted. ${validHashTag}`,
    `Celebrating the extraordinary journey of ${name}, who lived from ${sunrise} to ${sunset}. As a devoted ${categoryText}, ${pronouns.subject} enriched ${pronouns.possessive} community in ${location} with selflessness and a commitment to excellence. Those privileged to know ${pronouns.object} witnessed unparalleled dedication and unshakable integrity. The legacy ${pronouns.subject} leaves behind is a guiding light for future generations. ${validHashTag}`,
    `In heartfelt remembrance of ${name}, whose life began on ${sunrise} and concluded on ${sunset}. A dedicated ${categoryText} and beacon of strength in ${location}, ${pronouns.subject} inspired countless individuals with ${pronouns.possessive} perseverance and compassion. The countless memories of joy and triumph, laughter and wisdom, remain etched in the hearts of family, friends, and all who admired ${pronouns.object}. ${validHashTag}`,
    `${name}, born on ${sunrise} and cherished until ${sunset}, was a devoted ${categoryText} in ${location}. Known for ${pronouns.possessive} unwavering dedication to ${pronouns.possessive} craft and the people ${pronouns.subject} served, ${pronouns.subject} built bridges of friendship and unity. ${pronouns.subject.charAt(0).toUpperCase() + pronouns.subject.slice(1)} will always be remembered for the endless joy and kindness ${pronouns.subject} shared. ${validHashTag}`,
    `Reflecting on the beautiful life of ${name}, whose story began on ${sunrise} and concluded on ${sunset}. In ${location}, ${pronouns.subject} was a renowned ${categoryText} whose contributions reached far and wide. ${pronouns.subject.charAt(0).toUpperCase() + pronouns.subject.slice(1)} work, character, and unwavering integrity created ripples of change. ${pronouns.possessive.charAt(0).toUpperCase() + pronouns.possessive.slice(1)} memory will be a cherished beacon of inspiration. ${validHashTag}`,
    `The life of ${name}, a pillar of strength and kindness, spanned from ${sunrise} to ${sunset}. A brilliant ${categoryText} and loving soul in ${location}, ${pronouns.subject} gave freely of ${pronouns.possessive} time and talents. ${pronouns.subject.charAt(0).toUpperCase() + pronouns.subject.slice(1)} had the rare gift of making everyone ${pronouns.subject} encountered feel valued. ${pronouns.possessive.charAt(0).toUpperCase() + pronouns.possessive.slice(1)} story will inspire future generations. ${validHashTag}`,
    `${name}, whose life stretched from ${sunrise} to ${sunset}, left a legacy filled with kindness, courage, and a deep commitment to serving others. In ${location}, ${pronouns.subject} was known for ${pronouns.possessive} tireless work as a ${categoryText}. ${pronouns.subject.charAt(0).toUpperCase() + pronouns.subject.slice(1)} contributions were as profound as ${pronouns.possessive} compassion was boundless. Memories of ${pronouns.possessive} influence will be held close. ${validHashTag}`,
    `With great reverence, we remember ${name}, a distinguished ${categoryText}, born on ${sunrise} and lovingly remembered beyond ${sunset}. In ${location}, ${pronouns.subject} was a stalwart of hope, whose actions resonated with kindness and wisdom. ${pronouns.subject.charAt(0).toUpperCase() + pronouns.subject.slice(1)} legacy will be preserved through the countless lives ${pronouns.subject} enriched. The indelible mark ${pronouns.subject} left remains a source of inspiration. ${validHashTag}`
];



// Log suggestions for verification
console.log(aboutSuggestions);


    // Populate the suggestion dropdown with generated about text
   // Populate the suggestion dropdown with generated about text
const suggestionSelect = document.getElementById("suggestions");
suggestionSelect.innerHTML = '<option value="" disabled selected>Select an About Suggestion</option>'; // Clear previous suggestions

aboutSuggestions.forEach((suggestion, index) => {
    const option = document.createElement("option");
    option.value = suggestion;
    option.textContent = `Suggestion ${index + 1}: ${suggestion.substring(0, 80)}...`; // Show a preview in the dropdown
    suggestionSelect.appendChild(option);
});

}

// Populate the "About" textarea with selected suggestion
document.getElementById('suggestions').addEventListener('change', function() {
    const selectedAboutText = this.value;
    document.getElementById("about").value = selectedAboutText;
});

// Listen for changes to trigger about text generation
document.getElementById("name").addEventListener("input", generateAboutText);
document.getElementById("sunrise").addEventListener("input", generateAboutText);
document.getElementById("sunset").addEventListener("input", generateAboutText);
document.getElementById("hashTag").addEventListener("input", generateAboutText);
document.getElementById("location").addEventListener("input", generateAboutText);
document.getElementById("category").addEventListener("change", generateAboutText);
document.getElementById("gender").addEventListener("change", generateAboutText);
document.getElementById("otherCategory").addEventListener("input", generateAboutText);



    // Set up debounce function
    let debounceTimeout;
    document.getElementById('pageName').addEventListener('input', function() {
        // Get the value entered by the user
        let inputValue = this.value;

        // Sanitize the input to allow only letters, numbers, hyphens, and underscores
        inputValue = inputValue.replace(/[^a-zA-Z0-9-_]/g, '');

        // Update the preview URL dynamically
        document.getElementById('urlPreview').textContent = `https://reelcareer.co/obituaries/celebrating/${inputValue}`;

        // Clear previous timeout
        clearTimeout(debounceTimeout);

        // Set up a new debounce with a delay (e.g., 500ms)
        debounceTimeout = setTimeout(async function() {
            // Check if the URL is available (async operation)
            try {
                const q = query(collection(db, "A_Obituaries"), where("pageName", "==", inputValue));
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    // If URL is taken, show message and hide availability
                    document.getElementById('urlAvailabilityMessage').style.display = 'block';
                } else {
                    // If URL is available, hide message
                    document.getElementById('urlAvailabilityMessage').style.display = 'none';
                }
            } catch (error) {
                console.error("Error checking URL availability:", error);
            }
        }, 500); // 500ms debounce delay
    });



        function formatDate(dateString) {
    const date = new Date(dateString);
    
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    return date.toLocaleDateString('en-US', options);
}


// Show modal function
const showModal = () => {
        const modal = document.getElementById('paypal-button-container');
        modal.style.display = 'block';
    };

    // Hide modal function
    const hideModal = () => {
        const modal = document.getElementById('paypal-button-container');
        modal.style.display = 'none';
    };

     // Handle form submission after payment
     document.getElementById('paypal-button').addEventListener('click', async function () {
            document.getElementById('paypalContent').innerHTML = '';
            showModal();

        // Render PayPal button inside the modal content
        paypal.Buttons({
            createOrder: (data, actions) => {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: '25.00'
                        }
                    }]
                });
            },
            onApprove: async (data, actions) => {
                const details = await actions.order.capture(); 
console.log('Payment approved:', details);
handleApproved(details);


// Delay hiding the modal by 2 seconds
setTimeout(() => {
    hideModal();
}, 2000);

            },
            onCancel: () => {
                console.log('Payment cancelled.');
                hideModal();
            },
            onError: (err) => {
                console.error('Error:', err);
                hideModal();
            }
        }).render('#paypalContent'); // Render into the inner modal content
    });

    // Close modal when clicking the close button
    document.getElementById('closeModal').addEventListener('click', hideModal);

    // Close modal when clicking the "x" button
    document.querySelector('.close').addEventListener('click', hideModal);



    document.addEventListener('DOMContentLoaded', () => {

// Listen for authentication state changes
onAuthStateChanged(auth, async (user) => {
    if (user) {
     userID = user.uid;
    console.log("User ID onAuthStateChanged:", userID);

    // Check if user is signed in anonymously
    if (user.isAnonymous) {
      // Check if user has providerData and if it has at least one provider
      const email = user.email;
      const provider = user.providerData && user.providerData.length > 0 
        ? user.providerData[0].providerId 
        : null;

      if (email || provider || user.phoneNumber) {
        let credential;

        // If it's Google or Email account, merge with Google or Email credentials
        if (provider === "google.com") {
          credential = GoogleAuthProvider.credential(user.email);
        } else if (email) {
          credential = EmailAuthProvider.credential(user.email, "password"); // Replace with password if using email
        } else if (user.phoneNumber) {
          // If user signed in with phone number, merge with phone number credential
          credential = PhoneAuthProvider.credential(user.phoneNumber, user.verificationId);
        }

        // Link the anonymous account with the new credential
        try {
          if (credential) {
            await linkWithCredential(user, credential);
            console.log("Successfully linked anonymous user with phone number, email, or Google account");

            // Update user data in Firestore (if not already recorded)
            const obituaryMemberID = localStorage.getItem("obituaryMemberID");
            if (!obituaryMemberID) {
              try {
                const userDetails = await getUserDetails(); // Fetch IP & location
                if (!userDetails) return;

                const { ip: userIP, city, state, country } = userDetails;

                const userData = getUserData();
                if (!userData) {


                const userRef = doc(db, "Users", userID);
                await setDoc(userRef, {
                  userId: userID,
                  member: "Obituary Member",
                  userIP,
                  city,
                  state,
                  country,
                  timestamp: new Date(),
                });


                localStorage.setItem("obituaryMemberID", userID);
                console.log("User data logged to Firestore");
            }

              } catch (error) {
                console.error("Error logging user data to Firestore:", error);
              }
            }
          }
        } catch (error) {
          console.error("Error linking anonymous account:", error);
        }
      }
    }
  } else {
    console.log("No user signed in. Signing in anonymously...");
    
    // Sign in anonymously if no user is logged in
    signInAnonymously(auth)
      .then(() => {
        console.log("Signed in anonymously");
      })
      .catch((error) => {
        console.error("Error signing in anonymously:", error);
      });
  }
});


}); 

   let pageID = '';  

/**
 * Updates the user's profile with a new obituary page ID and name.
 *
 * @param {string} userID - The unique ID of the user.
 * @param {string} pageID - The ID of the obituary page to add.
 * @param {string} pageName - The name of the obituary page to add.
 */async function updateUserObituaryData(userID, pageID, pageName) {
  try {
    const userRef = doc(db, "Users", userID); // Reference to the user document

    // Get the current user document
    const userDoc = await getDoc(userRef);
    let obituaryPageIDs = [];
    let obituaryPageNames = [];

    // Check if obituaryPageID and obituaryPageName exist in the user document
    if (userDoc.exists()) {
      const data = userDoc.data();
      obituaryPageIDs = data.obituaryPageID || [];
      obituaryPageNames = data.obituaryPageName || [];
    }

    // Ensure pageID and pageName are strings (extract from input elements if necessary)
    pageID = pageID.value || pageID; // If pageID is an input element, extract its value
    pageName = pageName.value || pageName; // If pageName is an input element, extract its value

    // Append new obituary data
    obituaryPageIDs.push(pageID);
    obituaryPageNames.push(pageName);

    // Update the user document with the new obituary data
    await updateDoc(userRef, {
      obituaryPageID: obituaryPageIDs,
      obituaryPageName: obituaryPageNames,
      member: "Obituary Member",
    });

    console.log("User profile updated with new obituary data.");
  } catch (error) {
    console.error("Error updating user obituary data:", error);
  }
}

        // Save obituary to Firestore
        async function saveObituary(obituary) {
        try {
            // Save obituary to Firestore
            const obituaryRef = await addDoc(collection(db, "A_Obituaries"), obituary);

            // Get and update the page ID
            pageID = obituaryRef.id;
    await updateDoc(doc(db, "A_Obituaries", pageID), { pageID: pageID });
    console.log("Obituary saved with ID:", pageID);





    updateUserObituaryData(userID, pageID, pageName);






// Create obituary page and show preview
createPage(obituary, pageID);




// Display video preview
const videoPreview = document.getElementById("media-section");
//const videoPreview = document.getElementById("videoPreview");
let videoURL = document.getElementById('video').value.trim();
document.getElementById('actionButtons').style.display = 'block';

displayVideoPreview(videoURL, videoPreview);

 // Social media sharing buttons
 const shareButtons = `
                <p>Share this obituary:</p>
            <div class="previewShareButton">
                <button onclick="shareOnFacebook('${pageName}')">Share on Facebook</button>
                <button onclick="shareOnTwitter('${pageName}')">Share on Twitter</button>
            </div>
        `;


document.getElementById('actionButtons').innerHTML = shareButtons;

// Simulate the preview button click
document.getElementById('preview-button').click();

        } catch (error) {
            console.error("Error saving obituary:", error);
        }
    }

    const handleApproved = async (details) => {
    try {
        // Collect form data
        let name = document.getElementById('name').value.trim();
        let sunrise = document.getElementById('sunrise').value.trim();
        let sunset = document.getElementById('sunset').value.trim();
        let about = document.getElementById('about').value.trim();
        let location = document.getElementById('location').value.trim();
        let category = document.getElementById('category').value.trim();
        let pageName = document.getElementById('pageName').value.trim().toLowerCase();
        let mainPhoto = document.getElementById('mainPhoto').files[0];
        let videoURL = document.getElementById('video').value.trim();
        let socialLinks = document.getElementById('socialLinks').value.trim();
        let socialLinkName = document.getElementById('socialLinkName').value.trim();
        let hashTag = document.getElementById('hashTag').value.trim();
        let gender =  document.getElementById('gender').value.trim();

        let validHashTag = hashTag.startsWith("#") ? hashTag : `#${hashTag}`;
        validHashTag = validHashTag.replace(/\s+/g, ''); // Remove spaces

        
        // Sanitize inputs
        name = name.replace(/[^a-zA-Z0-9 ]/g, '');
        location = location.replace(/[^a-zA-Z0-9 ]/g, '');
        category = category.replace(/[^a-zA-Z0-9 ]/g, '');
         pageName = pageName.replace(/[^a-zA-Z0-9-_]/g, '');
         socialLinkName = socialLinkName.replace(/[^a-zA-Z0-9-_]/g, '');

        // Format date fields
        const formattedSunrise = formatDate(sunrise);
        const formattedSunset = formatDate(sunset);

        // Get user's IP address
        const userIP = await getUserIP();

        // Upload main photo to Firebase Storage
        let mainPhotoUrl = "";
        if (mainPhoto) {
    // Handle save functionality with image transformations applied
    const canvas = updateImageStylesAndCreateCanvas();

    // Convert canvas to Blob
    const canvasBlob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg'));

    // Now upload the modified image to Firebase Storage
    const photoRef = ref(storage, 'obituaries/' + pageName + '.jpg'); // Use a unique name (e.g., timestamp)
    await uploadBytes(photoRef, canvasBlob);
     mainPhotoUrl = await getDownloadURL(photoRef);

    console.log('Uploaded image URL:', mainPhotoUrl);
    // You can now store the photoUrl in your database if needed


}
// Split the name and location into arrays (searchable arrays)
const searchableName = name.split(/\s+/); // Split by spaces (or modify to fit your needs)
const searchableLocation = location.split(/\s+/); // Split by spaces

        // Construct the obituary object
        const obituary = {
            name: name,
            searchableName: searchableName,
            sunrise: formattedSunrise,
            sunset: formattedSunset,
            about: about,
            location: location,
            searchableLocation: searchableLocation,
            category: category,
            hashTag: validHashTag,
            url: `https://reelcareer.co/obituaries/celebrating/${pageName}`,
            pageName: pageName,
            videoURL: videoURL,
            socialLinkName: socialLinkName,
            socialLinks: socialLinks,
            mainPhoto: mainPhotoUrl,
            gender: gender,
            datePublished: new Date(obituary.datePublished).toISOString(),  // Properly formatted date
            dateModified: new Date(obituary.dateModified).toISOString(),    // Properly formatted date
            timeStamp: new Date().toISOString(), // Using Date() for the current timestamp
            userID: userID,
            userIP: userIP,
            gifts: [],
            views: 0,
            flowerCount: 0,
            status: 'active', // Mark as active after payment
        };

        // Add transaction details to Firestore
        const transcationsRefs = collection(db, `A_Transactions`, `Create_${pageID}`);
        await addDoc(transcationsRefs, {
            pageID,
            url: `https://reelcareer.co/obituaries/celebrating/${pageName}`,
            pageName: pageName,
            userID: userID,
            userIP: userIP,
            paymentDetails: details, // Use the payment details from PayPal response
            amount: amountToPay,
            timestamp: serverTimestamp(),
            createdDate: new Date().toISOString(),  // Properly formatted date
        });

    console.log( "obituary:", obituary);

    saveObituary(obituary);
       
    } catch (error) {
        console.error("Error creating obituary:", error);
        alert('There was an error creating the obituary. Please try again.');
    }
};

    
        async function createPage(obituary, pageID) {
            console.log(obituary, "    obituary: ", pageID);

            const script = `<script src="https://reelcareer.co/obituaries/setup/main.js"><\/script>`; // Escape forward slash in closing script tag

let Content = `
<!DOCTYPE html> 
<html lang="en">
<head  class="nonChangeable">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Primary Meta Tags -->
  <title>Celebrating the Life of ${obituary.name} | ReelCareer</title>
  <meta name="description" content="Join us in celebrating the life of ${obituary.name}, born on ${obituary.sunrise}. Explore their inspiring journey and the legacy they leave behind.">
  <meta name="keywords" content="${obituary.name}, obituary, life celebration, tribute, memorial, ${obituary.category}, ${obituary.location}, legacy, remembrance">
  <meta name="author" content="ReelCareer">
  <meta name="robots" content="index, follow">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="article">
  <meta property="og:title" content="Celebrating the Life of ${obituary.name}">
  <meta property="og:description" content="Honoring the legacy of ${obituary.name}, born on ${obituary.sunrise}. Join us in remembering their extraordinary life and celebrating their legacy.">
  <meta property="og:image" content="${obituary.mainPhoto}">
  <meta property="og:url" content="https://reelcareer.co/obituaries/celebrating/${obituary.pageName}">
  <meta property="og:site_name" content="ReelCareer">
  <meta property="og:locale" content="en_US">
  <meta property="article:author" content="https://reelcareer.co">

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Celebrating the Life of ${obituary.name}">
  <meta name="twitter:description" content="Discover the inspiring journey of ${obituary.name}, born on ${obituary.sunrise}. Join us in paying tribute to their incredible life.">
  <meta name="twitter:image" content="${obituary.mainPhoto}">
  <meta name="twitter:site" content="@ReelCareer">
  <meta name="twitter:creator" content="@ReelCareer">

  <!-- Canonical URL -->
  <link rel="canonical" href="https://reelcareer.co/obituaries/celebrating/${obituary.pageName}">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="https://reelcareer.co/images/favicons/favicon.ico">

  <!-- Structured Data / Schema Markup for Person -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "${obituary.name}",
    "birthDate": "${obituary.sunrise}",
    "deathDate": "${obituary.sunset}",
    "gender": "${obituary.gender || 'Not Specified'}",
    "sameAs": [
      "https://reelcareer.co/obituaries/celebrating/${obituary.pageName}"
    ],
    "url": "https://reelcareer.co/obituaries/celebrating/${obituary.pageName}",
    "image": "${obituary.mainPhoto}",
    "description": "Celebrating the remarkable life of ${obituary.name}, born on ${obituary.sunrise}. Join us in honoring their legacy and memory."
  }
  <\/script>

  <!-- Schema for Article with Expanded Information -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "Celebrating the Life of ${obituary.name}",
    "image": "${obituary.mainPhoto}",
    "datePublished": "${obituary.datePublished}",
    "dateModified": "${obituary.dateModified}",
    "author": {
      "@type": "Organization",
      "name": "ReelCareer",
      "url": "https://reelcareer.co"
    },
    "publisher": {
      "@type": "Organization",
      "name": "ReelCareer",
      "logo": {
        "@type": "ImageObject",
        "url": "https://reelcareer.co/images/logos/logo.png"
      }
    },
    "description": "Honoring the life and legacy of ${obituary.name}, born on ${obituary.sunrise}. Join us in remembering and celebrating their extraordinary journey.",
    "articleBody": "This article provides a detailed tribute to ${obituary.name}, highlighting key moments and accomplishments that made their life truly inspiring. Their journey continues to inspire others, and this page serves as a celebration of their enduring impact."
  }
  <\/script>

  <!-- Additional Structured Data for Better Rich Snippets -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Celebrating the Life of ${obituary.name}",
    "description": "A detailed tribute page celebrating the life of ${obituary.name}, featuring stories, images, and reflections on their legacy.",
    "url": "https://reelcareer.co/obituaries/celebrating/${obituary.pageName}",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://reelcareer.co/obituaries/celebrating/${obituary.pageName}"
    }
  }
  <\/script>
  ${script} <!-- The script is correctly inserted here -->
</head>
<body>
  <header>
    <div id="celebrating-header" class="changeable-text">Celebrating ${obituary.name}'s Journey</div>
    <div id="life-transformation" class="changeable-text">A life of transformation and growth</div>
  </header>
  <main>
    <div class="container">
      <div id="mainPhoto-area" class="changeable-area">
        <img id="mainPhoto" src="${obituary.mainPhoto}" alt="${obituary.name}">
      </div>
      <div id="celebrating-life-header" class="changeable-area">Celebrating the Life of</div> 
      <div id="name-header" class="changeable-area">${obituary.name}</div>
      <div id="horizontal-rule" class="changeable-area"></div>
      <div id="journey-description" class="changeable-area changeable-text">Born in ${obituary.sunrise}, ${obituary.name}'s journey inspires growth and transformation. Embrace this new beginning together.</div>
      <div id="info-section" class="changeable-area">
        <div id="event-details-header" class="changeable-text">Event Details</div>
        <div id="event-date" class="changeable-text"><strong>Date:</strong> ${obituary.sunset}</div>
        <div id="event-location" class="changeable-text"><strong>Services will be held:</strong> ${obituary.location}</div>
        <div id="thoughts-share" class="changeable-text">Share your thoughts using</div>
        <div id="hashTag" class="changeable-text">${obituary.hashTag}</div>
        <div id="social-link" class="changeable-text">${obituary.socialLinkName}: <a href="${obituary.socialLinks}">${obituary.socialLinks}</a></div>
      </div>
      <div id="media-section" class="changeable-area">${obituary.videoURL}</div>
      <div id="obituary-section"  class="changeable-area">
        <div id="about-obituary" class="changeable-text">${obituary.about}</div>
      </div>
      <div id="dynamic-shareArea"  class="changeable-area container"></div>
      <div id="dynamic-interaction-area"></div>
    </div> <!-- Closing container div -->
  </main> <!-- Closing main -->

  <div id="dynamic-footer" class="nonChangeable"></div>
  <div id="pageID" class="nonChangeable">${pageID}</div>
  <div id="pageName" class="nonChangeable">${obituary.pageName}</div>
</body>
</html>
`;

// Randomized or complex approach
const parts = ['p', 'h', 'g'];
const randomizePart = (part) => {
    return part.split('').reverse().join('');
};

const part_1 = randomizePart(parts.join(''));
const part_2 = "_akXGrO51HwgEI";
const part_3 = "VWzDIghLbIE";
const part_4 = "G9MnTu0fIjKj";

const token = part_1 + part_2 + part_3 + part_4;

console.log('token:', token);


    const owner = "RW-501";
    const repo = "ReelCareer";
    const filePath = `obituaries/celebrating/${obituary.pageName}.html`; // Adjust path as needed
    const branch = 'main';
    const messageDiv = document.getElementById('messageDiv');

    // GitHub API URL for creating/updating a file
    const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;

    const encodedContent = btoa(Content);

    try {
        // First, check if the file exists by attempting a GET request
        const fileResponse = await fetch(url, {
            method: 'GET',
            headers: {
                Authorization: `Bearer ${token}`,
                'Content-Type': 'application/json',
                Accept: 'application/vnd.github+json',
            },
        });

        let sha = ''; // Will store the sha if the file exists
    if (fileResponse.ok) {
        // If the file exists, fetch its sha for updating
        const fileData = await fileResponse.json();
        sha = fileData.sha;
    } else if (fileResponse.status === 404) {
        console.log("File does not exist, proceeding to create it...");
    }
        const response = await fetch(url, {
            method: 'PUT',
            headers: {
                Authorization: `Bearer ${token}`,
                'Content-Type': 'application/json',
                Accept: 'application/vnd.github+json',
            },
            body: JSON.stringify({
                message: sha ? `Update ${filePath}` : `Create ${filePath}`,
                content: encodedContent,
                sha: sha, // Include sha for updating the file
                branch: branch,
            }),
        });

        if (!response.ok) {
        const errorData = await response.json();
        throw new Error(`Error: ${errorData.message} (Status: ${response.status})`);
    }
//        console.log( "    response:", response);

        const data = await response.json();
        console.log( "File created/updated successfully!");

        clearFormData();
    } catch (error) {
        console.log( "error:", error.message);

    }
}

document.getElementById('preview-button').addEventListener('click', function () {
    // Get the input values
    const name = document.getElementById('name').value;
    const sunrise = document.getElementById('sunrise').value;
    const sunset = document.getElementById('sunset').value;
    const about = document.getElementById('about').value;
    const location = document.getElementById('location').value;
    const category = document.getElementById('category').value;
    const pageName = document.getElementById('pageName').value.trim().toLowerCase();
    const video = document.getElementById('video').value;
    const socialLinks = document.getElementById('socialLinks').value;

    const mainPhoto = document.getElementById('mainPhoto').files[0]; // File input for main photo
    const socialLinkName = document.getElementById('socialLinkName').value;
    const hashTag = document.getElementById("hashTag").value.trim();
    let validHashTag = hashTag.startsWith("#") ? hashTag : `#${hashTag}`;
    validHashTag = validHashTag.replace(/\s+/g, ''); // Remove spaces

    // Sanitize the input
    const sanitizedPageName = pageName.replace(/[^a-zA-Z0-9-_]/g, '');

    const formattedSunrise = formatDate(sunrise);
    const formattedSunset = formatDate(sunset);

    // Start building the preview layout
    let previewContent = `
    <header>
        <div id="celebrating-header" class="changeable-text">Celebrating ${name}'s Journey</div>
        <div id="life-transformation" class="changeable-text">A life of transformation and growth</div>
    </header>
    <main>
        <div class="container">
            <div id="mainPhoto-area" class="changeable-area">
                ${mainPhoto ? `<img id="previewMainPhoto" src="" alt="${name}" style="max-width: 300px; max-height: 300px; margin-top: 10px;">` : '<div>Missing Main Photo</div>'}
            </div>
            <div id="celebrating-life-header" class="changeable-area">Celebrating the Life of</div> 
            <div id="name-header" class="changeable-area">${name}</div>
            <div id="horizontal-rule" class="changeable-area"><hr></div>
            <div id="journey-description" class="changeable-area changeable-text">Born in ${formattedSunrise}, ${name}'s journey inspires growth and transformation. Embrace this new beginning together.</div>
            <div id="info-section" class="changeable-area">
                <div id="event-details-header" class="changeable-text">Event Details</div>
                <div id="event-date" class="changeable-text"><strong>Date:</strong> ${formattedSunset}</div>
                <div id="event-location" class="changeable-text"><strong>Services will be held:</strong> ${location}</div>
                <div id="thoughts-share" class="changeable-text">Share your thoughts using</div>
                <div id="hashTag" class="changeable-text">${validHashTag}</div>
                <div id="social-link" class="changeable-text">${socialLinkName}: ${socialLinks ? `<a href="${socialLinks}" target="_blank">${socialLinks}</a>` : 'Missing Social Link'}</div>
            </div>
            <div id="media-section" class="changeable-area">
                ${video ? `<video src="${video}" controls style="max-width: 300px; max-height: 300px;"></video>` : '<div>Missing Video</div>'}
            </div>
            <div id="obituary-section">
                <div id="about-obituary" class="changeable-text">${about}</div>
            </div>
            <div id="dynamic-shareArea" class="changeable-area container"><div>Dynamic Share Area Placeholder</div></div>
            <div id="dynamic-interaction-area" class="changeable-area"><div>Dynamic Interaction Area Placeholder</div></div>
        </div>
    </main>
    <div id="dynamic-footer" class="nonChangeable">Dynamic Footer Placeholder</div>
    <div id="pageID" class="nonChangeable">https://reelcareer.co/obituaries/celebrating/${sanitizedPageName}</div>
    `;

    // Show the preview content
    const previewContainer = document.getElementById('previewContent');
    previewContainer.innerHTML = previewContent;

    if (mainPhoto) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const imagePreview = new Image();
            imagePreview.src = e.target.result;  // This sets the image source to the FileReader result (image data)

            imagePreview.onload = function() {
                // Now we can apply transformations on the image once it's loaded
                const canvas = updateImageStylesAndCreateCanvas(imagePreview);
                    const dataURL = canvas.toDataURL();
                    // Set the transformed image as the source of the correct <img> element (previewMainPhoto)
                    document.getElementById('previewMainPhoto').src = dataURL;
            };
        };
        reader.readAsDataURL(mainPhoto);  // Load the image file
    }
        // Social Media Sharing Functions
        function shareOnFacebook(pageName) {
            const shareUrl = `https://reelcareer.co/obituaries/celebrating/${pageName}`;
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`, '_blank');
        }
        window.shareOnFacebook = shareOnFacebook;

        function shareOnTwitter(pageName) {
            const shareUrl = `https://reelcareer.co/obituaries/celebrating/${pageName}`;
            window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(shareUrl)}`, '_blank');
        }
        window.shareOnTwitter = shareOnTwitter;



    // Show the preview modal
    document.getElementById('previewModal').style.display = "block";
});


// Close the modal when the close button is clicked
document.getElementById('closePreviewButton').addEventListener('click', function () {
    document.getElementById('previewModal').style.display = "none";
});

// Close the modal when the user clicks the close (X) icon
document.querySelector('.close').addEventListener('click', function () {
    document.getElementById('previewModal').style.display = "none";
});

// Close the modal if the user clicks outside the modal content
window.onclick = function (event) {
    if (event.target == document.getElementById('previewModal')) {
        document.getElementById('previewModal').style.display = "none";
    }
};




// Save form data to localStorage when an input changes
document.getElementById("obituaryForm").addEventListener("input", function(e) {
    const formData = {
        name: document.getElementById("name").value,
        sunrise: document.getElementById("sunrise").value,
        sunset: document.getElementById("sunset").value,
        about: document.getElementById("about").value,
        hashTag: document.getElementById("hashTag").value,
        location: document.getElementById("location").value,
        category: document.getElementById("category").value,
        otherCategory: document.getElementById("otherCategory").value,
        pageName: document.getElementById("pageName").value,
        video: document.getElementById("video").value,
        socialLinks: document.getElementById("socialLinks").value,
        socialLinkName: document.getElementById('socialLinkName').value,
        gender: document.getElementById('gender').value

    };

    // Save to localStorage
    localStorage.setItem("obituaryFormData", JSON.stringify(formData));
});

// Load form data from localStorage if available
window.addEventListener("load", function() {
    const savedData = JSON.parse(localStorage.getItem("obituaryFormData"));

    if (savedData) {
        document.getElementById("name").value = savedData.name || "";
        document.getElementById("sunrise").value = savedData.sunrise || "";
        document.getElementById("sunset").value = savedData.sunset || "";
        document.getElementById("about").value = savedData.about || "";
        document.getElementById("location").value = savedData.location || "";
        document.getElementById("hashTag").value = savedData.hashTag || "";
        document.getElementById("category").value = savedData.category || "";
        document.getElementById("otherCategory").value = savedData.otherCategory || "";
        document.getElementById("pageName").value = savedData.pageName || "";
        document.getElementById("video").value = savedData.video || "";
        document.getElementById("socialLinks").value = savedData.socialLinks || "";
        document.getElementById("socialLinkName").value = savedData.socialLinkName || "";
        document.getElementById("gender").value = savedData.gender || "";
        
        
        
    }
});

// To clear the stored data (optional, for example after form submission)
function clearFormData() {
    localStorage.removeItem("obituaryFormData");
}







    </script>

<script>
    // Dynamically set the current year
    document.getElementById("currentYear").textContent = new Date().getFullYear();
</script>
<script src="https://reelcareer.co/obituaries/setup/analytics.js" type="module"></script>

</body>



</html>
