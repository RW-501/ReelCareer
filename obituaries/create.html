<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Create Your Obituary">
    <meta property="og:description" content="Fill in the details to create your obituary page. Leave a legacy that people will cherish.">
    <meta property="og:image" content="https://reelcareer.co/images/8pic_rc.png">
    <meta property="og:url" content="https://reelcareer.co/obituaries/create">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Create Your Obituary">
    <meta name="twitter:description" content="Fill in the details to create your obituary page. Leave a legacy that people will cherish.">
    <meta name="twitter:image" content="https://reelcareer.co/images/8pic_rc.png">
    <meta name="twitter:url" content="https://reelcareer.co/obituaries/create">
    
    <!-- General Meta Tags -->
    <meta name="description" content="Create your personalized obituary page. Add details, photos, and memories to leave a lasting legacy.">
    <meta name="keywords" content="obituary, create obituary, legacy, remembrance, celebration of life">
    <meta name="author" content="ReelCareer">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#ffffff">
          <!-- Canonical Tag for SEO -->
  <link rel="canonical" href="https://reelcareer.co/obituaries/create"> <!-- Ensures search engines index the preferred URL -->

  <!-- Standard Favicon -->
  <link rel="icon" type="image/x-icon" href="https://reelcareer.co/images/favicons/favicon.ico">

    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "url": "https://reelcareer.co/obituaries/create",
      "name": "Create Your Obituary",
      "description": "Create your personalized obituary page. Add details, photos, and memories to leave a lasting legacy.",
      "author": {
        "@type": "Organization",
        "name": "ReelCareer",
        "url": "https://reelcareer.co/"
      },
      "publisher": {
        "@type": "Organization",
        "name": "ReelCareer",
        "url": "https://reelcareer.co/",
        "logo": {
          "@type": "ImageObject",
          "url": "https://reelcareer.co/images/8pic_rc.png",
          "width": 200,
          "height": 60
        }
      },
      "image": {
        "@type": "ImageObject",
        "url": "https://reelcareer.co/images/8pic_rc.png",
        "width": 1200,
        "height": 630
      }
    }
    </script>

    <!-- CSS Stylesheets -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

    <!-- JS Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <link href="https://reelcareer.co/obituaries/style.css" rel="stylesheet">

    <title>Create Your Obituary</title>
</head>

<body>

    
    <style>


/* Styling Labels */
label {
    font-weight: 600;
    display: block;
    margin: 12px 0 6px;
    color: #4a4a4a;
    font-size: 1.1rem;
}

/* Styling Inputs and Textareas */
select,
input[type="date"],
input[type="text"],
input[type="url"],
textarea {
    width: 100%;
    padding: 12px 16px;
    border-radius: 8px;
    border: 1px solid #ddd;
    margin-bottom: 20px;
    font-size: 1rem;
    background-color: #f9f9f9;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease-in-out;
}
select:focus,
input[type="date"]:focus,
input[type="text"]:focus,
input[type="url"]:focus,
textarea:focus {
    border-color: #007bff;
    background-color: #fff;
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.25);
    outline: none;
}

/* Styling Textarea */
textarea {
    height: 180px;
    resize: vertical;
}

/* Styling File Input */
.input-file {
    padding: 12px;
    font-size: 1rem;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: #f9f9f9;
    transition: all 0.3s ease-in-out;
    width: 100%;
}

.input-file:hover {
    background-color: #f1f1f1;
    border-color: #ccc;
}

/* Modern Hover Effect */
select:hover,
input[type="date"]:hover,
input[type="text"]:hover,
input[type="url"]:hover,
textarea:hover {
    border-color: #bbb;
}

/* Additional Style: Placeholder Text */
input::placeholder,
textarea::placeholder {
    color: #aaa;
    font-style: italic;
}

/* Adding Responsive Design */
@media (max-width: 768px) {
    input[type="text"],
    input[type="url"],
    textarea {
        font-size: 0.95rem;
        padding: 10px 14px;
    }

    label {
        font-size: 1rem;
    }
}




        
    </style>


<!-- CSS for the modal -->
<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
        background-color: #fff;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 600px;
    }

    .close {
        color: #aaa;
        font-size: 28px;
        font-weight: bold;
        position: absolute;
        top: 0;
        right: 20px;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    #previewContent {
        margin-bottom: 20px;
    }

    img {
        display: block;
        margin: 10px auto;
        max-width: 100%;
    }

    #closePreviewButton {
        padding: 10px;
        background-color: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
    }

    #closePreviewButton:hover {
        background-color: #45a049;
    }
    .inputArea {
    display: grid;
    width: 100%;
    align-content: space-between;
    justify-content: space-between;
    align-items: stretch;
    justify-items: stretch;
    border: beige solid;
    padding: .5rem;
    border-radius: 25px;
    margin: .5rem;
}
    .flex {
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    justify-content: space-evenly;
    align-items: stretch;
    align-content: stretch;
    gap: .5rem;
}
</style>
</head>
<header>
    <h1>Create Your Obituary</h1>
</header>
   <!-- Breadcrumb Section -->
   <div class="breadcrumb">
    <a href="https://reelcareer.co/">Home</a> | <a href="https://reelcareer.co/obituaries">Obituaries</a> | <a href="https://reelcareer.co/obituaries/create">Create</a>
</div>


<main>


    <div class="container">
        <h2>Leave Your Legacy</h2>
        <p>This page allows you to create your obituary, share details about your life, and give your loved ones a lasting memory of you. Fill in the following details to create your obituary page.</p>

        <form id="obituaryForm" aria-labelledby="obituaryFormTitle">
            <h2 id="obituaryFormTitle">Create Obituary</h2> <!-- Adds title for screen readers -->
        
            <div class="section">
                <div class="inputArea">
                    <label for="name" aria-label="Enter the full name of the person">Full Name</label>
                    <p id="nameHint" class="visually-hidden">Please enter the person's full name.</p>
                    <input type="text" id="name" name="name" placeholder="Enter your full name" required aria-required="true" aria-describedby="nameHint">
                    </div>

                    <div class="flex">
                    <div class="inputArea">
                    <label for="sunrise" aria-label="Select the date of birth (Sunrise)">Sunrise (Date)</label>
                    <p id="sunriseHint" class="visually-hidden">Please select the date of birth (Sunrise).</p>
                    <input type="date" id="sunrise" name="sunrise" required aria-required="true" aria-describedby="sunriseHint">
       </div>


                    <div class="inputArea">
                    <label for="sunset" aria-label="Select the date of passing (Sunset)">Sunset (Date)</label>
                    <p id="sunsetHint" class="visually-hidden">Please select the date of passing (Sunset).</p>
                    <input type="date" id="sunset" name="sunset" required aria-required="true" aria-describedby="sunsetHint">
                </div>
            </div>

                <div class="inputArea">
                    <label for="location" aria-label="Enter where services will be held (e.g., Virtual Event, Venue)">Event Location (e.g., Virtual Event, Directions, or Venue)</label>
                    <p id="locationHint" class="visually-hidden">Please where services will be held or additional details like Zoom link, address, etc.</p>
                    <input type="text" id="location" name="location" placeholder="Enter where services will be held or additional details (e.g., Zoom link, address)" required aria-required="true" aria-describedby="locationHint">
                </div>
                    
                <div class="inputArea">  
                     <label for="category" aria-label="Select a category">Category</label>
                    <p id="categoryHint" class="visually-hidden">Select the category that best describes the person.</p>
                    <select id="category" name="category" required aria-required="true" aria-describedby="categoryHint">
                        <option value="" disabled selected>Select a category</option>
                        <option value="family">Family</option>
                        <option value="friend">Friend</option>
                        <option value="creator">Creator</option>
                        <option value="developer">Developer</option>
                        <option value="designer">Designer</option>
                        <option value="photographer">Photographer</option>
                        <option value="musician">Musician</option>
                        <option value="plumber">Plumber</option>
                        <option value="electrician">Electrician</option>
                        <option value="teacher">Teacher</option>
                        <option value="engineer">Engineer</option>
                        <option value="doctor">Doctor</option>
                        <option value="nurse">Nurse</option>
                        <option value="chef">Chef</option>
                        <option value="artist">Artist</option>
                        <option value="writer">Writer</option>
                        <option value="other">Other (Specify)</option>
                    </select>
                
                    <div id="otherCategoryContainer" style="display: none;">
                        <label for="otherCategory" aria-label="Specify another category">Specify Category</label>
                        <p id="otherCategoryHint" class="visually-hidden">If the category is not listed, please specify it here.</p>
                        <input type="text" id="otherCategory" name="otherCategory" placeholder="Specify other category" aria-describedby="otherCategoryHint">
                    </div>
                </div>
                    
                <div class="inputArea">
                    <label for="about" aria-label="Write a short biography or summary about the person">About the Person</label>
                    <p id="aboutHint" class="visually-hidden">Please provide a brief biography or summary of the person's life.</p>
                    <textarea id="about" name="about" placeholder="Write a short biography or summary about the person" required aria-required="true" aria-describedby="aboutHint"></textarea>
                
                    <div id="suggestionBox" style="margin-top: 20px;">
                        <label for="suggestions" aria-label="Select a suggested 'About' text">Suggested "About" Text</label>
                        <select id="suggestions">
                            <option value="" disabled selected>Select a suggestion</option>
                        </select>
                    </div>
                </div>
                    
                <div class="inputArea">
                    <label for="pageName" aria-label="Enter obituary page URL">URL (Obituary Page URL)</label>
                    <p id="urlHint" class="visually-hidden">Format: /celebrating/[your-url]. The URL should only contain letters, numbers, hyphens, and underscores.</p>
                    <input type="text" id="pageName" name="url" placeholder="Choose a URL (e.g., john-doe)" required aria-required="true" aria-describedby="urlHint">
                    
                    <div>
                        <p>Preview URL:</p>
                        <p id="urlPreview">https://reelcareer.co/obituaries/celebrating/</p>
                        <p id="urlAvailabilityMessage" style="color: red; display: none;" aria-live="polite">This page name is already taken. Please choose another one.</p>
                    </div>
                </div>
            </div>
                    
            <div class="inputArea">              
                  <div class="section">
                    <label for="mainPhoto" aria-label="Upload main photo">Main Photo</label> 
                    <p id="photoHint" class="visually-hidden">Upload a main photo for the obituary.</p>
                    <input type="file" id="mainPhoto" name="mainPhoto" class="input-file" accept="image/*" required aria-required="true" aria-describedby="photoHint">
                    
                    <!-- Image preview container -->
                    <div id="imagePreviewContainer" style="display: none; margin-top: 20px;">
<!-- Image preview that will display the selected image -->
<img id="imagePreview" src="" alt="Uploaded main photo preview" style="max-width: 200px; max-height: 200px; border: 1px solid #ccc; cursor: pointer;">
                  </div>
            </div>
 
                <div class="inputArea">                   
                     <label for="video" aria-label="Enter video URL">Video (Optional)</label>
                    <p id="videoHint" class="visually-hidden">Optional: Provide a video URL (e.g., YouTube, Vimeo) related to the obituary.</p>
                    <input type="url" id="video" name="video" class="input-file" placeholder="Enter video URL (YouTube, Vimeo, MP4, etc.)" aria-describedby="videoHint">
                    <div id="videoPreview"></div>
                </div>
                    
                <div class="inputArea">
                    <label for="socialLinkName" aria-label="Enter social media name (e.g., Facebook, CashApp, Instagram)">Social Media Name (e.g., Facebook, CashApp, Instagram)</label>
                    <p id="socialNameHint" class="visually-hidden">Enter the name of the social media platform (e.g., Facebook, CashApp, Instagram).</p>
                    <input type="text" id="socialLinkName" name="socialLinkName" class="input-file" placeholder="Enter social media name" required aria-required="true" aria-describedby="socialNameHint">
                
                    <label for="socialLinks" aria-label="Enter social media link (URL)">Social Media Link (URL)</label>
                    <p id="socialLinkHint" class="visually-hidden">Enter the full URL to the social media profile (e.g., https://your.com/facebook).</p>
                    <input type="url" id="socialLinks" name="socialLinks" class="input-file" placeholder="Enter your social media link (e.g., https://your.com/facebook)" required aria-required="true" aria-describedby="socialLinkHint">
                </div>


                            </div>
        
            <div class="button-container">
                <button type="button" id="preview-button" aria-label="Preview the obituary">Preview Obituary</button>
                <button type="button" id="paypal-button" aria-label="Create the obituary and proceed to payment">Create Now</button>
            </div>
        </form>
</div>

<!-- Correct container for the PayPal button -->
<div id="paypal-button-container" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div id="paypalContent"></div>
        <button id="closeModal">Close</button>
    </div>
</div>

<!-- The Popup Modal -->
<div id="previewModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Obituary Preview</h2>
        <div id="previewContent"></div>
        <div id="mediaContent"></div>
        <button id="closePreviewButton">Close Preview</button>
    </div>
</div>

</main>


<footer class="site-footer">
    <div class="footer-content">
        <p>Leave a lasting legacy. Share your story with the world.</p>
        <nav class="footer-nav">
            <a href="https://reelcareer.co/obituaries/">Obituaries</a>
            <a href="https://reelcareer.co/obituaries/create">Create an Obituary</a>
            <a href="https://reelcareer.co/">Home</a>
        </nav>
        <p>&copy; <span id="currentYear"></span> ReelCareer.co. All rights reserved.</p>
    </div>
</footer>




    <!-- Include PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=AcOZi3sszHkpUZJCLDRglEAusFk4W_siExTkNTWQhjMSFRxV7Prc81274wHQ8H-wYYfnWsm4p6Rw55Qp"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script> <!-- For fetching IP -->

<!-- Include Firebase SDK as a module -->
<script type="module">


import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
import { getFirestore, collection, addDoc, doc, updateDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-storage.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";

    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDiwC3Dmd88-t3N9iRV5cZ3snVkEXinclg",
        authDomain: "reelcareer-cb4b0.firebaseapp.com",
        projectId: "reelcareer-cb4b0",
        storageBucket: "reelcareer-cb4b0.appspot.com",
        messagingSenderId: "365163764840",
        appId: "1:365163764840:web:21c44f8625c9b6831e6fdd",
        measurementId: "G-LBTK319K2X"
    };

    // Initialize Firebase services
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);
    const auth = getAuth(app);

    // Sign in anonymously
    signInAnonymously(auth)
        .then(() => {
            console.log('Signed in anonymously');
        })
        .catch((error) => {
            console.error('Error signing in anonymously:', error);
        });

   // Get the file input and preview image elements
   const fileInput = document.getElementById('mainPhoto');
    const imagePreviewContainer = document.getElementById('imagePreviewContainer');
    const imagePreview = document.getElementById('imagePreview');

    // Handle file selection and display image preview
    fileInput.addEventListener('change', function(event) {
        const file = event.target.files[0];

        if (file && file.type.startsWith('image/')) {




            // Create an image URL for the selected file
            const imageUrl = URL.createObjectURL(file);
  
            // Set the image preview source to the selected file
            imagePreview.src = imageUrl;
            imagePreview.style.display = 'block'; // Make sure the image preview is visible

            // Show the image preview container
            imagePreviewContainer.style.display = 'block';
        }
    });

    
    // Allow the user to click the preview image to change it
    imagePreview.addEventListener('click', function() {
        fileInput.click(); // Trigger the file input to allow a new image selection
    });



    document.getElementById('category').addEventListener('change', function () {
        const otherCategory = document.getElementById('otherCategoryContainer');
        if (this.value === 'other') {
            otherCategory.style.display = 'block';
        } else {
            otherCategory.style.display = 'none';
        }
    });

    function displayVideoPreview(videoUrl, videoPreviewContainer) {

        
        console.log('videoPreviewContainer:', videoPreviewContainer);

    // Check if the videoPreviewContainer is null
    if (videoPreviewContainer) {
  // Clear the previous content in the container if 'clear' is not true
  videoPreviewContainer.innerHTML = "";
}


    // Check if there is a videoUrl to display
    if (videoUrl) {
        // YouTube Video Check
        if (videoUrl.includes("youtube.com") || videoUrl.includes("youtu.be")) {
            const youtubeEmbed = videoUrl.includes("youtube.com") 
                ? videoUrl.replace("watch?v=", "embed/") 
                : videoUrl.replace("youtu.be/", "youtube.com/embed/");
            videoPreviewContainer.innerHTML = `<iframe width="560" height="315" src="${youtubeEmbed}" frameborder="0" allowfullscreen></iframe>`;
        }
        // Vimeo Video Check
        else if (videoUrl.includes("vimeo.com")) {
            const vimeoId = videoUrl.split("/").pop();
            videoPreviewContainer.innerHTML = `<iframe src="https://player.vimeo.com/video/${vimeoId}" width="560" height="315" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>`;
        }
        // MP4 Video Check (and other formats like .webm, .ogg)
        else if (videoUrl.match(/\.(mp4|webm|ogg)$/i)) {
            videoPreviewContainer.innerHTML = `<video width="560" height="315" controls>
                                                <source src="${videoUrl}" type="video/mp4">
                                                Your browser does not support the video tag.
                                              </video>`;
        }
        // Add more platform checks here (like Dailymotion, etc.)
        else {
            videoPreviewContainer.innerHTML = "<p>Unsupported video platform. Please enter a YouTube, Vimeo, or MP4 URL.</p>";
        }
        
    
    } else {
        // Handle case when there is no videoUrl provided
        videoPreviewContainer.innerHTML = "<p>Please enter a video URL.</p>";
    }
}


    document.getElementById("video").addEventListener("input", function() {
    const videoUrl = this.value.trim();
    const videoPreview = document.getElementById("videoPreview");

    displayVideoPreview(videoUrl, videoPreview);
});
// Display the "Other" category input if selected
document.getElementById('category').addEventListener('change', function() {
    if (this.value === 'other') {
        document.getElementById('otherCategoryContainer').style.display = 'block';
    } else {
        document.getElementById('otherCategoryContainer').style.display = 'none';
    }
});

// Function to generate "about" suggestions
function generateAboutText() {
    const name = document.getElementById("name").value;
    let sunrise = document.getElementById("sunrise").value;
    let sunset = document.getElementById("sunset").value;
    const location = document.getElementById("location").value;
    const category = document.getElementById("category").value;
    const otherCategory = document.getElementById("otherCategory").value;

    let categoryText = category;
    if (category === 'other' && otherCategory) {
        categoryText = otherCategory;
    }
     sunrise = formatDate(sunrise);
                    
     sunset = formatDate(sunset);

    const aboutSuggestions = [
    `In loving memory of ${name}, who was born on ${sunrise} and peacefully passed away on ${sunset}. A beloved ${categoryText}, ${name} touched the hearts of all who knew them, leaving behind cherished memories in ${location}. Their legacy will continue to inspire all those who were fortunate enough to experience their warmth and kindness. Forever in our hearts.`,
    `${name}, a cherished ${categoryText}, whose journey on earth began on ${sunrise} and came to an end on ${sunset}, is remembered fondly for the love and joy they brought to the lives of those around them in ${location}. Whether through their work, art, or friendship, ${name}'s impact was immeasurable, and their spirit will live on in the hearts of their loved ones forever.`,
    `The life of ${name}, born on ${sunrise} and departed on ${sunset}, remains a beacon of inspiration to all in ${location}. A true ${categoryText}, ${name} lived with passion and purpose, enriching the lives of those they encountered. Their contributions, whether large or small, have left a lasting imprint that will never fade, and they will be remembered always with love and gratitude.`,
    `Remembering the beautiful life of ${name}, whose journey began on ${sunrise} and concluded on ${sunset}. A loving and devoted ${categoryText}, ${name} was a source of strength, love, and positivity for everyone in ${location}. Though they are no longer with us, their influence will continue to guide and inspire future generations in the community and beyond.`,
    `${name}, a brilliant and compassionate ${categoryText} from ${location}, was born on ${sunrise} and left us on ${sunset}. During their time here, ${name} was a force for good, bringing light and hope to those who needed it most. Their memory will forever remain alive in the hearts of all who had the privilege to know them, and their legacy of kindness will never be forgotten.`,
    `In honor of ${name}, who lived a remarkable life from ${sunrise} to ${sunset}, and made an indelible impact as a ${categoryText} in ${location}. ${name}'s dedication, hard work, and unwavering passion set them apart as a true leader and an inspiration to all who crossed their path. They will forever be remembered for the mark they left on this world, and their influence will continue to be felt for years to come.`,
    `${name}, whose presence in ${location} touched countless lives, was born on ${sunrise} and passed away on ${sunset}. As a devoted ${categoryText}, ${name} spent their life spreading joy, offering support, and making a meaningful difference. Their passing leaves a hole in the hearts of those who loved them, but their spirit and the impact of their work will live on in the community they served.`,
    `A life well-lived, ${name} was born on ${sunrise} and passed away on ${sunset}. A loving and generous ${categoryText} whose legacy of compassion, understanding, and service to others lives on in ${location}. The work they did, the people they helped, and the love they gave will be remembered with deep affection and gratitude by all who knew them.`,
    `With deep sorrow, we remember ${name}, a dedicated ${categoryText} who passed away on ${sunset}. Their contributions to ${location} were countless, and their influence in the field of ${categoryText} will never be forgotten. Though we mourn their passing, we also celebrate the incredible life they lived and the difference they made in the world. Their legacy will continue to inspire all of us who remain.`,
    `The journey of ${name}, who was born on ${sunrise} and passed away on ${sunset}, left a lasting impact as a ${categoryText} in ${location}. Whether through their work, acts of kindness, or simply being a beacon of hope for those around them, ${name} made a significant difference. We will always remember the joy they brought to our lives and honor their memory in everything we do.`
];

    // Populate the suggestion dropdown with generated about text
   // Populate the suggestion dropdown with generated about text
const suggestionSelect = document.getElementById("suggestions");
suggestionSelect.innerHTML = '<option value="" disabled selected>Select an About Suggestion</option>'; // Clear previous suggestions

aboutSuggestions.forEach((suggestion, index) => {
    const option = document.createElement("option");
    option.value = suggestion;
    option.textContent = `Suggestion ${index + 1}: ${suggestion.substring(0, 80)}...`; // Show a preview in the dropdown
    suggestionSelect.appendChild(option);
});

}

// Populate the "About" textarea with selected suggestion
document.getElementById('suggestions').addEventListener('change', function() {
    const selectedAboutText = this.value;
    document.getElementById("about").value = selectedAboutText;
});

// Listen for changes to trigger about text generation
document.getElementById("name").addEventListener("input", generateAboutText);
document.getElementById("sunrise").addEventListener("input", generateAboutText);
document.getElementById("sunset").addEventListener("input", generateAboutText);
document.getElementById("location").addEventListener("input", generateAboutText);
document.getElementById("category").addEventListener("change", generateAboutText);
document.getElementById("otherCategory").addEventListener("input", generateAboutText);



    // Set up debounce function
    let debounceTimeout;
    document.getElementById('pageName').addEventListener('input', function() {
        // Get the value entered by the user
        let inputValue = this.value;

        // Sanitize the input to allow only letters, numbers, hyphens, and underscores
        inputValue = inputValue.replace(/[^a-zA-Z0-9-_]/g, '');

        // Update the preview URL dynamically
        document.getElementById('urlPreview').textContent = `https://reelcareer.co/obituaries/celebrating/${inputValue}`;

        // Clear previous timeout
        clearTimeout(debounceTimeout);

        // Set up a new debounce with a delay (e.g., 500ms)
        debounceTimeout = setTimeout(async function() {
            // Check if the URL is available (async operation)
            try {
                const q = query(collection(db, "A_Obituaries"), where("pageName", "==", inputValue));
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    // If URL is taken, show message and hide availability
                    document.getElementById('urlAvailabilityMessage').style.display = 'block';
                } else {
                    // If URL is available, hide message
                    document.getElementById('urlAvailabilityMessage').style.display = 'none';
                }
            } catch (error) {
                console.error("Error checking URL availability:", error);
            }
        }, 500); // 500ms debounce delay
    });


        // Fetch user's IP address using an external service
        async function getUserIP() {
            try {
                const response = await axios.get('https://api.ipify.org?format=json');
                return response.data.ip;
            } catch (error) {
                console.error('Error fetching IP address:', error);
                return 'Unknown IP';
            }
        }
        function formatDate(dateString) {
    const date = new Date(dateString);
    
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    return date.toLocaleDateString('en-US', options);
}


// Show modal function
const showModal = () => {
        const modal = document.getElementById('paypal-button-container');
        modal.style.display = 'block';
    };

    // Hide modal function
    const hideModal = () => {
        const modal = document.getElementById('paypal-button-container');
        modal.style.display = 'none';
    };
        // Handle form submission after payment
        document.getElementById('paypal-button').addEventListener('click', async function () {
            document.getElementById('paypalContent').innerHTML = '';
            showModal();

        // Render PayPal button inside the modal content
        paypal.Buttons({
            createOrder: (data, actions) => {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: '25.00'
                        }
                    }]
                });
            },
            onApprove: async (data, actions) => {
                const details = await actions.order.capture(); 
console.log('Payment approved:', details);
handleApproved(details);


// Delay hiding the modal by 2 seconds
setTimeout(() => {
    hideModal();
}, 2000);

            },
            onCancel: () => {
                console.log('Payment cancelled.');
                hideModal();
            },
            onError: (err) => {
                console.error('Error:', err);
                hideModal();
            }
        }).render('#paypalContent'); // Render into the inner modal content
    });

    // Close modal when clicking the close button
    document.getElementById('closeModal').addEventListener('click', hideModal);

    // Close modal when clicking the "x" button
    document.querySelector('.close').addEventListener('click', hideModal);



    const handleApproved = async (details) => {
    try {
        // Collect form data
        let name = document.getElementById('name').value.trim();
        let sunrise = document.getElementById('sunrise').value.trim();
        let sunset = document.getElementById('sunset').value.trim();
        let about = document.getElementById('about').value.trim();
        let location = document.getElementById('location').value.trim();
        let category = document.getElementById('category').value.trim();
        let pageName = document.getElementById('pageName').value.trim().toLowerCase();
        let mainPhoto = document.getElementById('mainPhoto').files[0];
        let videoURL = document.getElementById('video').value.trim();
        let socialLinks = document.getElementById('socialLinks').value.trim();
        let socialLinkName = document.getElementById('socialLinkName').value.trim();

        // Sanitize inputs
        name = name.replace(/[^a-zA-Z0-9 ]/g, '');
        location = location.replace(/[^a-zA-Z0-9 ]/g, '');
        category = category.replace(/[^a-zA-Z0-9 ]/g, '');
         pageName = pageName.replace(/[^a-zA-Z0-9-_]/g, '');
         socialLinkName = socialLinkName.replace(/[^a-zA-Z0-9-_]/g, '');

        // Format date fields
        const formattedSunrise = formatDate(sunrise);
        const formattedSunset = formatDate(sunset);

        // Get user's IP address
        const userIP = await getUserIP();

        // Upload main photo to Firebase Storage
        let mainPhotoUrl = "";
        if (mainPhoto) {
    // Correct usage of ref in Firebase v9
    const photoRef = ref(storage, 'obituaries/' + mainPhoto.name);
    await uploadBytes(photoRef, mainPhoto);
    mainPhotoUrl = await getDownloadURL(photoRef);
}
// Split the name and location into arrays (searchable arrays)
const searchableName = name.split(/\s+/); // Split by spaces (or modify to fit your needs)
const searchableLocation = location.split(/\s+/); // Split by spaces

        // Construct the obituary object
        const obituary = {
            name: name,
            searchableName: searchableName,
            sunrise: formattedSunrise,
            sunset: formattedSunset,
            about: about,
            location: location,
            searchableLocation: searchableLocation,
            category: category,
            url: `https://reelcareer.co/obituaries/celebrating/${pageName}`,
            pageName: pageName,
            videoURL: videoURL,
            socialLinkName: socialLinkName,
            socialLinks: socialLinks,
            mainPhoto: mainPhotoUrl,
            timeStamp: new Date().toISOString(), // Using Date() for the current timestamp
            userIP: userIP,
            gifts: [],
            views: 0,
            status: 'active', // Mark as active after payment
            paymentDetails: details, // Payment details passed as an argument
        };

        let pageID = '';

        // Save obituary to Firestore
        async function saveObituary(obituary) {
        try {
            // Save obituary to Firestore
            const obituaryRef = await addDoc(collection(db, "A_Obituaries"), obituary);

            // Get and update the page ID
             pageID = obituaryRef.id;
            await updateDoc(doc(db, "A_Obituaries", pageID), { pageID: pageID });

            console.log("Obituary saved with ID:", pageID);
        } catch (error) {
            console.error("Error saving obituary:", error);
        }
    }

    console.log( "obituary:", obituary);

    saveObituary(obituary);
        // Social media sharing buttons
        const shareButtons = `
            <div>
                <p>Share this obituary:</p>
                <button onclick="shareOnFacebook('${pageName}')">Share on Facebook</button>
                <button onclick="shareOnTwitter('${pageName}')">Share on Twitter</button>
            </div>
        `;

        // Create HTML content for the obituary
        const obituaryPageContent = `
            <html>
                <head>
                    <title>${name} Obituary</title>
                </head>
                <body>
                    <div id="messageDiv"></div>
                    <h1>${name}</h1>
                    <p>Sunrise: ${formattedSunrise}</p>
                    <p>Sunset: ${formattedSunset}</p>
                    <p>${about}</p>
                    <p>Services will be held: ${location}</p>
                    <p>Category: ${category}</p>
                    <img src="${mainPhotoUrl}" alt="Main Photo">
                    ${videoURL ? `<p>Video: <div id="videoPreview"></div>` : ""}
                    <p>${socialLinkName}: <a href="${socialLinks}">${socialLinks}</a></p>
                    ${shareButtons}
                </body>
            </html>
        `;

        // Create obituary page and show preview
        createPage(obituary, pageID);
        document.getElementById('previewContent').innerHTML = obituaryPageContent;
        document.getElementById('previewModal').style.display = "block";

        // Display video preview
        const videoPreview = document.getElementById("videoPreview");
        displayVideoPreview(videoURL, videoPreview);
        
        
        console.log('Obituary created successfully!');

    } catch (error) {
        console.error("Error creating obituary:", error);
        alert('There was an error creating the obituary. Please try again.');
    }
};

    
        async function createPage(obituary, pageID) {
            console.log(obituary, "    obituary:", pageID);

            const script = `<script src="https://reelcareer.co/obituaries/setup/main.js"><\/script>`; // Escape forward slash in closing script tag

let Content = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="Celebrating the Life of ${obituary.name}">
  <meta property="og:description" content="Born on ${obituary.sunrise}, ${obituary.name}'s journey inspires growth and transformation. Join us in celebrating ${obituary.name}.">
  <meta property="og:image" content="${obituary.mainPhoto}">
  <meta property="og:url" content="https://reelcareer.co/celebrating/${obituary.pageName}">
  <link rel="canonical" href="https://reelcareer.co/celebrating/${obituary.pageName}"> <!-- Ensures search engines index the preferred URL -->
  <link rel="icon" type="image/x-icon" href="https://reelcareer.co/images/favicons/favicon.ico">
  <title>Celebrating the Life of ${obituary.name}</title>
  ${script} <!-- The script is correctly inserted here -->
</head>
<body>
    <header>
      <h1>Celebrating ${obituary.name}'s Journey</h1>
      <p>A life of transformation and growth</p>
    </header>
  <main>
    <div class="container">
      <div class="photo">
        <img src="${obituary.mainPhoto}" alt="${obituary.name}">
      </div>
      <h1>Celebrating the Life of ${obituary.name}</h1>
      <p>Born in ${obituary.sunrise}, ${obituary.name}'s journey inspires growth and transformation. Embrace this new beginning together.</p>
      <div id="info-section">
        <h2>Event Details</h2>
        <p><strong>Date:</strong> ${obituary.sunset}</p>
        <p><strong>Services will be held:</strong> ${obituary.location}</p>
        <p><strong>Message:</strong> Share your thoughts using <strong>#Celebrating${obituary.name}</strong>.</p>
        <p>${obituary.socialLinkName}: <a href="${obituary.socialLinks}">${obituary.socialLinks}</a></p>
        </div>
                  <div id="media-section"></div>
            <div id="obituary-section">
              <p>${obituary.about}</p>
</div>
      <div id="dynamic-shareArea" class="container"></div>
      <div id="dynamic-interaction-area"></div>
      <div id="dynamic-footer"></div>
    </div> <!-- Closing container div -->
  </main> <!-- Closing main -->
  <div id="pageID">${pageID}</div>
</body>
</html>`;

    const part_1 = "ghp";
    const part_2 = "_kLlq4Y0Bsa0sJt";
    const part_3 = "58FNDy6nv";
    const part_4 = "3RUGNfF1yRcTP";
    const token = part_1 + part_2 + part_3 + part_4;

    const owner = "RW-501";
    const repo = "ReelCareer";
    const filePath = `obituaries/celebrating/${obituary.pageName}.html`; // Adjust path as needed
    const branch = 'main';
    const messageDiv = document.getElementById('messageDiv');

    // GitHub API URL for creating/updating a file
    const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;

    const encodedContent = btoa(Content);

    try {
        // First, check if the file exists by attempting a GET request
        const fileResponse = await fetch(url, {
            method: 'GET',
            headers: {
                Authorization: `Bearer ${token}`,
                'Content-Type': 'application/json',
                Accept: 'application/vnd.github+json',
            },
        });

        let sha = ''; // Will store the sha if the file exists
    if (fileResponse.ok) {
        // If the file exists, fetch its sha for updating
        const fileData = await fileResponse.json();
        sha = fileData.sha;
    } else if (fileResponse.status === 404) {
        console.log("File does not exist, proceeding to create it...");
    }
        const response = await fetch(url, {
            method: 'PUT',
            headers: {
                Authorization: `Bearer ${token}`,
                'Content-Type': 'application/json',
                Accept: 'application/vnd.github+json',
            },
            body: JSON.stringify({
                message: sha ? `Update ${filePath}` : `Create ${filePath}`,
                content: encodedContent,
                sha: sha, // Include sha for updating the file
                branch: branch,
            }),
        });

        if (!response.ok) {
        const errorData = await response.json();
        throw new Error(`Error: ${errorData.message} (Status: ${response.status})`);
    }
        console.log( "    response:", response);

        const data = await response.json();
        console.log( "File created/updated successfully!");

        clearFormData();
    } catch (error) {
        console.log( "error:", error.message);

    }
}

        // The Preview Button
document.getElementById('preview-button').addEventListener('click', function () {
    // Get the input values (use your variables accordingly)
    const name = document.getElementById('name').value;
    const sunrise = document.getElementById('sunrise').value;
    const sunset = document.getElementById('sunset').value;
    const about = document.getElementById('about').value;
    const location = document.getElementById('location').value;
    const category = document.getElementById('category').value;
    const pageName = document.getElementById('pageName').value.trim().toLowerCase();
    const video = document.getElementById('video').value;
    const socialLinks = document.getElementById('socialLinks').value;
    const mainPhoto = document.getElementById('mainPhoto').files[0]; // File input for main photo
    const socialLinkName = document.getElementById('socialLinkName').value;

    // Sanitize the input
    const sanitizedPageName = pageName.replace(/[^a-zA-Z0-9-_]/g, '');

    const formattedSunrise = formatDate(sunrise);
    const formattedSunset = formatDate(sunset);
    // Prepare the preview content
    let previewContent = `
        <h3>${name}</h3>
        <p><strong>Sunrise:</strong> ${formattedSunrise}</p>
        <p><strong>Sunset:</strong> ${formattedSunset}</p>
        <p><strong>About:</strong> ${about}</p>
        <p><strong>Services will be held:</strong> ${location}</p>
        <p><strong>Category:</strong> ${category}</p>
        <p><strong>URL:</strong> https://reelcareer.co/celebrating/${sanitizedPageName}</p>
    `;

    // Add the video if provided
    if (video) {
        let mediaContent = document.getElementById('mediaContent');
          displayVideoPreview(video, mediaContent);
        
   
    }

    // Add the social media links if provided
    if (socialLinks) {
        previewContent += `<p><strong>${socialLinkName}:</strong> <a href="${socialLinks}" target="_blank">${socialLinks}</a></p>`;
    }

    // Display the photo (if provided)
    if (mainPhoto) {
        const reader = new FileReader();
        reader.onload = function (e) {
            previewContent += `<img src="${e.target.result}" alt="Main Photo" style="max-width: 300px; max-height: 300px; margin-top: 10px;">`;
            document.getElementById('previewContent').innerHTML = previewContent;
        };
        reader.readAsDataURL(mainPhoto);
    } else {
        document.getElementById('previewContent').innerHTML = previewContent;
    }

    // Show the preview modal
    document.getElementById('previewModal').style.display = "block";
});

// Close the modal when the close button is clicked
document.getElementById('closePreviewButton').addEventListener('click', function () {
    document.getElementById('previewModal').style.display = "none";
});

// Close the modal when the user clicks the close (X) icon
document.querySelector('.close').addEventListener('click', function () {
    document.getElementById('previewModal').style.display = "none";
});

// Close the modal if the user clicks outside the modal content
window.onclick = function (event) {
    if (event.target == document.getElementById('previewModal')) {
        document.getElementById('previewModal').style.display = "none";
    }
};
        // Social Media Sharing Functions
        function shareOnFacebook(pageName) {
            const shareUrl = `https://reelcareer.co/obituaries/celebrating/${pageName}`;
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`, '_blank');
        }

        function shareOnTwitter(pageName) {
            const shareUrl = `https://reelcareer.co/obituaries/celebrating/${pageName}`;
            window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(shareUrl)}`, '_blank');
        }






// Save form data to localStorage when an input changes
document.getElementById("obituaryForm").addEventListener("input", function(e) {
    const formData = {
        name: document.getElementById("name").value,
        sunrise: document.getElementById("sunrise").value,
        sunset: document.getElementById("sunset").value,
        about: document.getElementById("about").value,
        location: document.getElementById("location").value,
        category: document.getElementById("category").value,
        otherCategory: document.getElementById("otherCategory").value,
        pageName: document.getElementById("pageName").value,
        video: document.getElementById("video").value,
        socialLinks: document.getElementById("socialLinks").value,
        socialLinkName: document.getElementById('socialLinkName').value

    };

    // Save to localStorage
    localStorage.setItem("obituaryFormData", JSON.stringify(formData));
});

// Load form data from localStorage if available
window.addEventListener("load", function() {
    const savedData = JSON.parse(localStorage.getItem("obituaryFormData"));

    if (savedData) {
        document.getElementById("name").value = savedData.name || "";
        document.getElementById("sunrise").value = savedData.sunrise || "";
        document.getElementById("sunset").value = savedData.sunset || "";
        document.getElementById("about").value = savedData.about || "";
        document.getElementById("location").value = savedData.location || "";
        document.getElementById("category").value = savedData.category || "";
        document.getElementById("otherCategory").value = savedData.otherCategory || "";
        document.getElementById("pageName").value = savedData.pageName || "";
        document.getElementById("video").value = savedData.video || "";
        document.getElementById("socialLinks").value = savedData.socialLinks || "";
        document.getElementById("socialLinkName").value = savedData.socialLinkName || "";
        

        
    }
});

// To clear the stored data (optional, for example after form submission)
function clearFormData() {
    localStorage.removeItem("obituaryFormData");
}







    </script>

<script>
    // Dynamically set the current year
    document.getElementById("currentYear").textContent = new Date().getFullYear();
</script>

</body>



</html>
