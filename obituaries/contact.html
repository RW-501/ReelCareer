<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Us</title>
    <link rel="stylesheet" href="styles.css"> <!-- Optional, for styling -->
</head>
<body>
    <div class="contact-form-container">
        <h2>Contact Us</h2>
        <form id="contactForm">
            <label for="name">Name</label>
            <input type="text" id="name" required>

            <label for="email">Email</label>
            <input type="email" id="email" required>

            <label for="phone">Phone (Optional)</label>
            <input type="tel" id="phone">

            <label for="message">Message</label>
            <textarea id="message" required></textarea>

            <label for="pageName">Page Name (Optional)</label>
            <input type="text" id="pageName">

            <label for="pageID">Page ID (Optional)</label>
            <input type="text" id="pageID">

            <button type="submit">Submit</button>
        </form>
    </div>

  
    <script type="module">


import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

// Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyDiwC3Dmd88-t3N9iRV5cZ3snVkEXinclg",
    authDomain: "reelcareer-cb4b0.firebaseapp.com",
    projectId: "reelcareer-cb4b0",
    storageBucket: "reelcareer-cb4b0.appspot.com",
    messagingSenderId: "365163764840",
    appId: "1:365163764840:web:21c44f8625c9b6831e6fdd",
    measurementId: "G-LBTK319K2X"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Function to get user's IP and location
async function getUserDetails() {
    try {
        const response = await fetch("https://ipapi.co/json/");
        const data = await response.json();
        return {
            ip: data.ip,
            city: data.city,
            state: data.region,
            country: data.country_name,
            zipCode: data.postal,
        };
    } catch (error) {
        console.error("Error fetching user details:", error);
        return null;
    }
}

// Function to handle form submission
document.getElementById("contactForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    // Get form values
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const message = document.getElementById("message").value.trim();
    const pageName = document.getElementById("pageName").value.trim();
    const pageID = document.getElementById("pageID").value.trim();

    // Fetch user IP and location
    const userDetails = await getUserDetails();

    if (!userDetails) return;

    const { ip, city, state, country, zipCode } = userDetails;

    // Prepare the contact message data
    const contactData = {
        name,
        email,
        phone,
        message,
        messageType: "obituaryMember",
        pageName: pageName || null,
        pageID: pageID || null,
        ipAddress: ip,
        city,
        state,
        country,
        zipCode,
        messageType: "general",  // You can make this dynamic if needed
        status: "unread",        // Status set to unread initially
        timestamp: serverTimestamp(), // Use Firestore timestamp
    };

    // Add contact message to Firebase Firestore
    try {
        const contactRef = collection(db, "Contacts");
        await addDoc(contactRef, contactData);
        alert("Your message has been sent successfully.");
    } catch (error) {
        console.error("Error sending message:", error);
        alert("There was an error sending your message.");
    }
});


    </script>
</body>
</html>
