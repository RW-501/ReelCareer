<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obituary Analytics</title>
    <link rel="stylesheet" href="styles.css"> <!-- Add a reference to your styles -->

<style>
body {
    font-family: Arial, sans-serif;
    background-color: #f9f9f9;
    margin: 0;
    padding: 0;
}

.container {
    max-width: 800px;
    margin: 20px auto;
    padding: 20px;
    background-color: white;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
}

h1, h2 {
    text-align: center;
    color: #333;
}

.analytics-section {
    display: grid;
    gap: 20px;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    margin-top: 20px;
}

.analytics-card {
    padding: 20px;
    background-color: #f0f8ff;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    text-align: center;
}

.analytics-card h2 {
    margin-bottom: 10px;
    color: #555;
}

.analytics-card p {
    margin: 0;
    font-size: 16px;
    color: #666;
}


</style>
</head>
<body>
    <div class="container">
        <h1>Analytics for Obituary</h1>
        <div id="analytics-section" class="analytics-section">
            <h2>Loading analytics data...</h2>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { 
            getFirestore, doc, getDoc, increment 
        } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
        import { query, where, getDocs, collection } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDiwC3Dmd88-t3N9iRV5cZ3snVkEXinclg",
            authDomain: "reelcareer-cb4b0.firebaseapp.com",
            projectId: "reelcareer-cb4b0",
            storageBucket: "reelcareer-cb4b0.appspot.com",
            messagingSenderId: "365163764840",
            appId: "1:365163764840:web:21c44f8625c9b6831e6fdd",
            measurementId: "G-LBTK319K2X"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Function to load analytics
        async function loadAnalytics(pageID) {
            const analyticsSection = document.getElementById("analytics-section");

            try {
                const analyticsRef = collection(db, "A_Ob_Analytics"); // Reference to the collection
    const q = query(analyticsRef, where("pageID", "==", pageID)); // Query where the pageID field matches the desired pageID
    const docSnap = await getDocs(q); // Execute the query

                if (docSnap.exists()) {
                    const data = docSnap.data();

                    analyticsSection.innerHTML = `
                        <div class="analytics-card">
                            <h2>Total Page Views</h2>
                            <p>${data.totalPageViews || 0}</p>
                        </div>
                        <div class="analytics-card">
                            <h2>Last Viewed</h2>
                            <p>${new Date(data.lastPageViewed || "").toLocaleString() || "N/A"}</p>
                        </div>
                        <div class="analytics-card">
                            <h2>Last Referral</h2>
                            <p>${data.lastReferral || "Direct"}</p>
                        </div>
                        <div class="analytics-card">
                            <h2>User Locations</h2>
                            <p>City: ${data.lastCity || "Unknown"}</p>
                            <p>State: ${data.lastState || "Unknown"}</p>
                            <p>Country: ${data.lastCountry || "Unknown"}</p>
                        </div>
                        <div class="analytics-card">
                            <h2>Page View Count by Title</h2>
                            <ul>
                                ${Object.entries(data.pageViewCount || {}).map(([title, count]) => `
                                    <li>${title}: ${count}</li>
                                `).join("")}
                            </ul>
                        </div>
                    `;
                } else {
                    analyticsSection.innerHTML = `
                        <h2>No analytics data found for this page.</h2>
                    `;
                }
            } catch (error) {
                console.error("Error loading analytics:", error);
                analyticsSection.innerHTML = `
                    <h2>Error loading analytics data. Please try again later.</h2>
                `;
            }
        }

        // Assuming `pageID` is passed as a query parameter
        const urlParams = new URLSearchParams(window.location.search);
        const pageID = urlParams.get("pageID");

        if (pageID) {
            loadAnalytics(pageID);
        } else {
            document.getElementById("analytics-section").innerHTML = `
                <h2>Page ID is missing in the URL. Please provide a valid pageID.</h2>
            `;
        }
    </script>
</body>
</html>
