<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <title>Job Management</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
    <style>
        /* Add any additional styles specific to this page here */
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Reelcareer Admin</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                <li class="nav-item"><a class="nav-link" href="user-management.html">User Management</a></li>
                <li class="nav-item"><a class="nav-link" href="job-management.html">Job Management</a></li>
                <li class="nav-item"><a class="nav-link" href="application-management.html">Application Management</a></li>
                <li class="nav-item"><a class="nav-link" href="content-management.html">Content Management</a></li>
                <li class="nav-item"><a class="nav-link" href="settings.html">Settings</a></li>
                <li class="nav-item"><a class="nav-link" href="analytics.html">Analytics</a></li>
                <li class="nav-item"><a class="nav-link" href="chatbot.html">Chatbot</a></li>
                <li class="nav-item"><a class="nav-link" href="support.html">Support</a></li>
            </ul>
        </div>
    </nav>

    <div class="container mt-4">
        <h1>Job Management</h1>

        <!-- Add Job Button -->
        <button class="btn btn-success mb-3" onclick="openJobModal()">Add Job</button>

        <!-- Job Table -->
        <table class="table table-bordered table-striped" id="jobTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Category</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="jobTableBody">
                <!-- Job rows will be dynamically populated here -->
            </tbody>
        </table>

        <!-- Job Modal -->
        <div class="modal fade" id="jobModal" tabindex="-1" aria-labelledby="jobModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="jobModalLabel">Add/Edit Job</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="jobForm">
                            <div class="form-group">
                                <label for="jobTitle">Job Title</label>
                                <input type="text" class="form-control" id="jobTitle" required>
                            </div>
                            <div class="form-group">
                                <label for="jobDescription">Job Description</label>
                                <textarea class="form-control" id="jobDescription" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="jobCategory">Category</label>
                                <select class="form-control" id="jobCategory" required>
                                    <!-- Categories will be populated here -->
                                </select>
                            </div>
                            <input type="hidden" id="jobId">
                            <button type="submit" class="btn btn-primary">Save</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Category Management -->
        <h2 class="mt-5">Manage Job Categories</h2>
        <div class="mb-3">
            <input type="text" id="categoryInput" class="form-control" placeholder="Add New Category">
            <button class="btn btn-primary mt-2" onclick="addCategory()">Add Category</button>
        </div>

        <table class="table table-bordered table-striped" id="categoryTable">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="categoryTableBody">
                <!-- Category rows will be dynamically populated here -->
            </tbody>
        </table>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Load jobs
        function loadJobs() {
            db.collection('jobs').get().then((querySnapshot) => {
                const jobTableBody = document.getElementById('jobTableBody');
                jobTableBody.innerHTML = ''; // Clear existing rows
                querySnapshot.forEach((doc) => {
                    const job = doc.data();
                    const row = `
                        <tr>
                            <td>${doc.id}</td>
                            <td>${job.title}</td>
                            <td>${job.description}</td>
                            <td>${job.category}</td>
                            <td>
                                <button class="btn btn-warning btn-sm" onclick="editJob('${doc.id}', '${job.title}', '${job.description}', '${job.category}')">Edit</button>
                                <button class="btn btn-danger btn-sm" onclick="deleteJob('${doc.id}')">Delete</button>
                            </td>
                        </tr>
                    `;
                    jobTableBody.insertAdjacentHTML('beforeend', row);
                });
            });
        }

        // Load job categories
        function loadCategories() {
            db.collection('categories').get().then((querySnapshot) => {
                const categorySelect = document.getElementById('jobCategory');
                const categoryTableBody = document.getElementById('categoryTableBody');
                categorySelect.innerHTML = ''; // Clear existing options
                categoryTableBody.innerHTML = ''; // Clear existing rows

                querySnapshot.forEach((doc) => {
                    const category = doc.data().name;
                    const option = `<option value="${category}">${category}</option>`;
                    categorySelect.insertAdjacentHTML('beforeend', option);

                    const row = `
                        <tr>
                            <td>${category}</td>
                            <td>
                                <button class="btn btn-danger btn-sm" onclick="deleteCategory('${doc.id}')">Delete</button>
                            </td>
                        </tr>
                    `;
                    categoryTableBody.insertAdjacentHTML('beforeend', row);
                });
            });
        }

        // Open job modal for adding a job
        function openJobModal() {
            document.getElementById('jobForm').reset();
            document.getElementById('jobId').value = '';
            $('#jobModal').modal('show');
        }

        // Edit job
        function editJob(id, title, description, category) {
            document.getElementById('jobTitle').value = title;
            document.getElementById('jobDescription').value = description;
            document.getElementById('jobCategory').value = category;
            document.getElementById('jobId').value = id;
            $('#jobModal').modal('show');
        }

        // Delete job
        function deleteJob(id) {
            db.collection('jobs').doc(id).delete().then(() => {
                loadJobs(); // Reload jobs after deletion
            }).catch(error => {
                console.error("Error removing job: ", error);
            });
        }

        // Save job (add/edit)
        document.getElementById('jobForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const id = document.getElementById('jobId').value;
            const title = document.getElementById('jobTitle').value;
            const description = document.getElementById('jobDescription').value;
            const category = document.getElementById('jobCategory').value;

            if (id) {
                // Update job
                db.collection('jobs').doc(id).update({ title, description, category }).then(() => {
                    loadJobs(); // Reload jobs after update
                    $('#jobModal').modal('hide');
                });
            } else {
                // Add new job
                db.collection('jobs').add({ title, description, category }).then(() => {
                    loadJobs(); // Reload jobs after adding
                    $('#jobModal').modal('hide');
                });
            }
        });

        // Add category
        function addCategory() {
            const categoryName = document.getElementById('categoryInput').value;
            if (categoryName) {
                db.collection('categories').add({ name: categoryName }).then(() => {
                    document.getElementById('categoryInput').value = '';
                    loadCategories(); // Reload categories after adding
                });
            }
        }

        // Delete category
        function deleteCategory(id) {
            db.collection('categories').doc(id).delete().then(() => {
                loadCategories(); // Reload categories after deletion
            }).catch(error => {
                console.error("Error removing category: ", error);
            });
        }

        // Load jobs and categories on page load
        window.onload = function() {
            loadJobs();
            loadCategories();
        };
    </script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
</body>
</html>
