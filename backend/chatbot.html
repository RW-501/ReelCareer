<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Management - Admin</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://reelcareer.co/backend/css/styles.css">
    <style>
        /* Custom styles for a user-friendly design */
        .form-group {
            position: relative;
        }
        .tooltip {
            position: absolute;
            top: -5px;
            left: 105%;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            padding: 5px;
            z-index: 100;
            display: none;
        }
        .form-group:hover .tooltip {
            display: block;
        }



        body {
  font-family: Arial, sans-serif;
  padding: 20px;
}

h1 {
  font-size: 2em;
}

h2, h3 {
  margin-top: 20px;
}

#general-questions-list, #predefined-questions-list {
  list-style-type: none;
}

button {
  margin-top: 10px;
  padding: 5px 10px;
  cursor: pointer;
}

textarea {
  width: 100%;
}

form input, form textarea, form select {
  display: block;
  margin: 10px 0;
  padding: 5px;
  width: 100%;
}

    </style>
</head>

<body>
    <script src="https://reelcareer.co/public/js/bodyload.js"></script>
    
   <!-- Navbar section -->
<nav id="Main_Nav" class="navbar navbar-expand-lg navbar-light bg-light" role="navigation" aria-label="Main Navigation">
  <a class="navbar-brand" href="https://reelcareer.co">ReelCareer.co</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">

                        <!-- Dashboard and New Group -->
                        <div class="navGroup" title="Dashboard and Analytics">
                            <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/notes">Notes</a></li>
                            <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/titles-fix">Title Fix</a></li>
                  </div>

            <!-- Dashboard and Analytics Group -->
            <div class="navGroup" title="Dashboard and Analytics">
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/dashboard">Dashboard</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/analytics">Analytics</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/state-labour-market">State Labour Market</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/ping">Ping</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/page-editor">Page Editor</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/notes">Notes</a></li>
            </div>
            <!-- Management Tools -->
            <div class="navGroup" title="Management Tools">
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/content-management">Content <small>Management</small></a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/user-management">User <small>Management</small></a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/job-management">Job <small>Management</small></a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/application-management">Application <small>Management</small></a></li>
            </div>
            <!-- General Settings and Utilities -->
            <div class="navGroup" title="General Settings and Utilities">
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/contact">Contact</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/settings">Settings</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/support">Support</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/chatbot">Chatbot</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/notifications-management">Notifications <small>Management</small></a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/system-logs">System Logs</a></li>
            </div>
            <!-- Finance and Monetization -->
            <div class="navGroup" title="Finance and Monetization">
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/transactions">Transactions</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/integration-management">Integration <small>Management</small></a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/payments">Payments</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/monetization">Monetization</a></li>
            </div>
            <!-- SEO and Cleanup -->
            <div class="navGroup" title="SEO and Cleanup">
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/delete-dup">Delete Dup</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/seo-helper">SEO Helper</a></li>
            </div>
            <!-- Role and Personality Management -->
            <div class="navGroup" title="Role and Personality Management">
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/role-management">Role <small>Management</small></a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/trait-personality-management">Trait Personality <small>Management</small></a></li>
            </div>
        </ul>
    </div>
</nav>

    <div class="container mt-4">
        <h1>Chatbot Management</h1>

        <!-- Chatbot Configuration Section -->
        <div class="card mb-4">
            <div>
                <h2>Manage Questions</h2>
            
                <div id="general-questions">
                  <h3>General Questions</h3>
                  <ul id="general-questions-list">
                    <!-- List of general questions -->
                  </ul>
                </div>
            
                <div id="predefined-questions">
                  <h3>Predefined Questions</h3>
                  <ul id="predefined-questions-list">
                    <!-- List of predefined questions -->
                  </ul>
                </div>
            
                <h3>Add New Question</h3>
                <form id="new-question-form">
                  <label for="question">Question</label>
                  <input type="text" id="question" required>
            
                  <label for="answer">Answer</label>
                  <textarea id="answer" required></textarea>
            
                  <label for="category">Category</label>
                  <select id="category">
                    <option value="General">General</option>
                    <option value="Predefined">Predefined</option>
                  </select>
            
                  <label for="link">Add Link (Optional)</label>
                  <input type="text" id="link">
            
                  <button type="submit">Add Question</button>
                </form>
            
                <h3>Export Questions to JSON</h3>
                <textarea id="json-output" rows="10" cols="50" readonly></textarea>
                <button id="copy-json-btn">Copy JSON</button>
              </div>
            
            </div>
        </div>

        <!-- Search Bar for Interaction Logs -->
        <div class="mb-3">
            <input type="text" id="searchInput" class="form-control" placeholder="Search Interaction Logs..." onkeyup="filterLogs()">
        </div>

        <!-- Chatbot Interaction Logs Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h4>Chatbot Interaction Logs</h4>
                <table class="table table-bordered" id="interactionTable">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>User Input</th>
                            <th>Bot Response</th>
                        </tr>
                    </thead>
                    <tbody id="interactionBody">
                        <tr>
                            <td colspan="3">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- User Feedback on Suggestions Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h4>User Feedback on Suggestions</h4>
                <table class="table table-bordered" id="feedbackTable">
                    <thead>
                        <tr>
                            <th>Suggestion</th>
                            <th>Feedback</th>
                            <th>Rating</th>
                        </tr>
                    </thead>
                    <tbody id="feedbackBody">
                        <tr>
                            <td colspan="3">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Help Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h4>User Education</h4>
                <p>This section provides guidance on how to effectively manage chatbot responses.</p>
                <ul>
                    <li>Use clear and concise intents for better understanding.</li>
                    <li>Provide multiple suggestions to enhance user experience.</li>
                    <li>Regularly review interaction logs to identify common queries.</li>
                </ul>
            </div>
        </div>
    </div>


    <!-- Footer -->
    <footer id="dynamic-footer"></footer>
    
    <!-- Firebase configuration/ Login& Out -->
    <script type="module" src="https://reelcareer.co/public/js/main.js"></script> 

    <!-- Firebase JS SDK and Custom Scripts -->

    <script type="module">
        import {
            db, doc, getDoc, query, updateDoc,
            setDoc, ref, signInWithPopup, orderBy,
             
            uploadBytes, OAuthProvider, arrayUnion, getStorage,
            signOut, addDoc, increment, onAuthStateChanged,
            createUserWithEmailAndPassword, signInWithEmailAndPassword,
            where, getDocs, storage, collection, deleteObject, 
            auth, analytics, deleteDoc, getDownloadURL
        } from 'https://reelcareer.co/js/module.js';





        // Load interaction logs from Firestore
        function loadInteractionLogs() {
            const interactionBody = document.getElementById('interactionBody');
            interactionBody.innerHTML = '<tr><td colspan="3">Loading...</td></tr>'; // Loading state

            db.collection('ChatbotInteractions').orderBy('timestamp', 'desc').limit(10)
                .get().then((querySnapshot) => {
                    interactionBody.innerHTML = ''; // Clear loading message
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        const row = `
                            <tr>
                                <td>${new Date(data.timestamp).toLocaleString()}</td>
                                <td>${data.question}</td>
                                <td>${data.botResponse}</td>
                            </tr>
                        `;
                        interactionBody.innerHTML += row;
                    });
                }).catch((error) => {
                    console.error("Error loading interactions: ", error);
                    interactionBody.innerHTML = '<tr><td colspan="3">Error loading data.</td></tr>';
                });
        }

        // Load feedback on suggestions from Firestore
        function loadFeedback() {
            const feedbackBody = document.getElementById('feedbackBody');
            feedbackBody.innerHTML = '<tr><td colspan="3">Loading...</td></tr>'; // Loading state

            db.collection('suggestionFeedback').get()
                .then((querySnapshot) => {
                    feedbackBody.innerHTML = ''; // Clear loading message
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        const row = `
                            <tr>
                                <td>${data.suggestion}</td>
                                <td>${data.feedback}</td>
                                <td>
                                    <select class="form-control" onchange="rateFeedback('${doc.id}', this.value)">
                                        <option value="">Rate</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                                </td>
                            </tr>
                        `;
                        feedbackBody.innerHTML += row;
                    });
                }).catch((error) => {
                    console.error("Error loading feedback: ", error);
                    feedbackBody.innerHTML = '<tr><td colspan="3">Error loading data.</td></tr>';
                });
        }

        // Submit chatbot form
        document.getElementById('chatbotForm').addEventListener('submit', (event) => {
            event.preventDefault();

            const intent = document.getElementById('intent').value;
            const response = document.getElementById('response').value;
            const suggestions = document.getElementById('suggestions').value.split(',').map(s => s.trim());
            const context = document.getElementById('context').value;

            // Save to Firestore
            db.collection('ChatbotResponses').add({
                intent,
                response,
                suggestions,
                context,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById('responseOutput').innerText = 'Response saved successfully!';
                loadInteractionLogs(); // Reload logs after saving
                loadFeedback(); // Reload feedback after saving
                document.getElementById('chatbotForm').reset();
            }).catch((error) => {
                console.error("Error saving response: ", error);
                document.getElementById('responseOutput').innerText = 'Error saving response.';
            });
        });

        // Filter interaction logs based on user input
        function filterLogs() {
            const input = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#interactionBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(input) ? '' : 'none';
            });
        }

        // Rate user feedback
        function rateFeedback(docId, rating) {
            db.collection('suggestionFeedback').doc(docId).update({
                rating: rating
            }).then(() => {
                console.log("Feedback rated successfully!");
            }).catch((error) => {
                console.error("Error updating feedback rating: ", error);
            });
        }

        // Initial data loading
        loadInteractionLogs();
        loadFeedback();






















        const generalQuestions = [
  { question: "How do I reset my password?", answer: "To reset your password, go to the 'Forgot Password' section on the login page.", category: "Account Management" },
  { question: "Where can I find my job applications?", answer: "You can view your job applications in the 'Applications' section of your dashboard.", category: "Dashboard" },
  // Add more sample data
];

const predefinedQuestions = [
  { question: "How do I contact support?", answer: "You can contact support through our 'Contact Us' page. Here's the link: [Contact Us](https://reelcareer.com/contact).", category: "Support" },
  { question: "How do I update my profile?", answer: "To update your profile, visit the 'Profile' section in your account settings.", category: "Account Management" },
  // Add more sample data
];

// Fetch /chat_bot.json on page load (for real data)
async function fetchChatbotData() {
  try {
    const response = await fetch('/chat_bot.json');
    const data = await response.json();
    generalQuestions.push(...data.generalQuestions);
    predefinedQuestions.push(...data.predefinedQuestions);
    renderQuestions();
  } catch (error) {
    console.error("Error fetching data:", error);
  }
}

function renderQuestions() {
  const generalList = document.getElementById("general-questions-list");
  const predefinedList = document.getElementById("predefined-questions-list");

  generalList.innerHTML = '';
  predefinedList.innerHTML = '';

  generalQuestions.forEach(q => {
    const li = document.createElement("li");
    li.textContent = `${q.question} - ${q.category}`;
    generalList.appendChild(li);
  });

  predefinedQuestions.forEach(q => {
    const li = document.createElement("li");
    li.textContent = `${q.question} - ${q.category}`;
    predefinedList.appendChild(li);
  });
}

// Handle adding a new question
document.getElementById("new-question-form").addEventListener("submit", function(event) {
  event.preventDefault();

  const question = document.getElementById("question").value;
  const answer = document.getElementById("answer").value;
  const category = document.getElementById("category").value;
  const link = document.getElementById("link").value;

  const newQuestion = {
    question,
    answer: link ? `${answer} Here's the link: [${link}](${link})` : answer,
    category
  };

  if (category === "General") {
    generalQuestions.push(newQuestion);
  } else {
    predefinedQuestions.push(newQuestion);
  }

  renderQuestions();
  document.getElementById("new-question-form").reset();
});

// Export questions to JSON
document.getElementById("copy-json-btn").addEventListener("click", function() {
  const jsonOutput = {
    generalQuestions,
    predefinedQuestions
  };

  const jsonText = JSON.stringify(jsonOutput, null, 2);
  document.getElementById("json-output").value = jsonText;
  copyToClipboard(jsonText);
});

function copyToClipboard(text) {
  const textarea = document.createElement('textarea');
  textarea.value = text;
  document.body.appendChild(textarea);
  textarea.select();
  document.execCommand('copy');
  document.body.removeChild(textarea);
}

// Initial fetch and render on page load
fetchChatbotData();

    </script>
</body>
</html>
