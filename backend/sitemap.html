<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://reelcareer.co/backend/css/styles.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.6.0/chart.min.js"></script>
    <title>Sitemap Generator</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .controls { margin-bottom: 20px; }
        .controls button { margin-right: 10px; }
        .progress-bar { width: 100%; background-color: #f3f3f3; border: 1px solid #ccc; height: 20px; margin: 10px 0; position: relative; }
        .progress { height: 100%; width: 0%; background-color: #4caf50; transition: width 0.3s; }
        .table-container { height: 300px; overflow-y: auto; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 8px; border: 1px solid #ccc; text-align: left; }
        th { cursor: pointer; }
        textarea { width: 100%; height: 150px; margin-top: 10px; }
        .error-log { margin-top: 20px; }
        .preview { margin-top: 20px; border: 1px solid #ccc; padding: 10px; }
        .filters { margin-top: 10px; }
      </style>
</head>

<body>
    <script src="https://reelcareer.co/public/js/bodyload.js"></script>
    
   <!-- Navbar section -->
<nav id="Main_Nav" class="navbar navbar-expand-lg navbar-light bg-light" role="navigation" aria-label="Main Navigation">
  <a class="navbar-brand" href="https://reelcareer.co">ReelCareer.co</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">

                        <!-- Dashboard and New Group -->
                        <div class="navGroup" title="Dashboard and Analytics">
                            <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/notes">Notes</a></li>
                            <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/titles-fix">Title Fix</a></li>
                            <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/sitemap">Sitmap Builder</a></li>
                  </div>

            <!-- Dashboard and Analytics Group -->
            <div class="navGroup" title="Dashboard and Analytics">
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/dashboard">Dashboard</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/analytics">Analytics</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/state-labour-market">State Labour Market</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/ping">Ping</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/page-editor">Page Editor</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/notes">Notes</a></li>
            </div>
            <!-- Management Tools -->
            <div class="navGroup" title="Management Tools">
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/content-management">Content <small>Management</small></a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/user-management">User <small>Management</small></a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/job-management">Job <small>Management</small></a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/application-management">Application <small>Management</small></a></li>
            </div>
            <!-- General Settings and Utilities -->
            <div class="navGroup" title="General Settings and Utilities">
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/contact">Contact</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/settings">Settings</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/support">Support</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/chatbot">Chatbot</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/notifications-management">Notifications <small>Management</small></a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/system-logs">System Logs</a></li>
            </div>
            <!-- Finance and Monetization -->
            <div class="navGroup" title="Finance and Monetization">
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/transactions">Transactions</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/integration-management">Integration <small>Management</small></a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/payments">Payments</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/monetization">Monetization</a></li>
            </div>
            <!-- SEO and Cleanup -->
            <div class="navGroup" title="SEO and Cleanup">
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/delete-dup">Delete Dup</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/seo-helper">SEO Helper</a></li>
            </div>
            <!-- Role and Personality Management -->
            <div class="navGroup" title="Role and Personality Management">
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/role-management">Role <small>Management</small></a></li>
                <li class="nav-item"><a class="nav-link" href="https://reelcareer.co/backend/trait-personality-management">Trait Personality <small>Management</small></a></li>
            </div>
        </ul>
    </div>
</nav>

    <div class="container mt-4">
        <h1>Sitemap Generator</h1>
  
        <h1>Sitemap Generator</h1>

        <div class="controls">
          <button id="selectAllBtn">Select All</button>
          <button id="startBtn">Start</button>
          <button id="stopBtn">Stop</button>
          <button id="exportCSV">Export CSV</button>
          <button id="exportJSON">Export JSON</button>
          <span>Total Links: <span id="linkCount">0</span></span>
        </div>
      
        <!-- Added a dropdown for scheduled crawling -->
        <label for="crawlSchedule">Schedule Crawling:</label>
        <select id="crawlSchedule">
          <option value="none">None</option>
          <option value="daily">Daily</option>
          <option value="weekly">Weekly</option>
        </select>
      
        <div class="progress-bar">
          <div id="progress" class="progress"></div>
        </div>
      
        <!-- Filters for duplicate detection and file type filtering -->
        <div class="filters">
          <label>
            <input type="checkbox" id="filterUnique"> Show only unique links
          </label>
          <label>
            <input type="checkbox" id="filterHTML"> Show only .html links
          </label>
          <label>
            <input type="checkbox" id="filterDuplicates"> Highlight duplicate links
          </label>
        </div>
      
        <div class="table-container">
          <table id="linkTable">
            <thead>
              <tr>
                <th onclick="sortTable(0)">URL</th>
                <th>Priority</th>
                <th>Changefreq</th>
                <th>Last Modified</th>
                <th>Reachability</th>
                <th>Select</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      
        <button id="downloadBtn">Download Sitemap</button>
        <textarea id="sitemapOutput" readonly></textarea>
        <button id="copyBtn">Copy to Clipboard</button>
      
        <h2>Preview</h2>
        <div class="preview" id="previewPane">Sitemap preview will appear here.</div>
      
        <h2>Error Log</h2>
        <div class="error-log" id="errorLog"></div>
      
        <script>
          const baseDomain = 'https://reelcareer.co';
          let links = new Set();
          let errors = [];
          let crawling = false;
          let totalLinks = 0;
      
          // Advanced Sorting and Filtering
          const filterUnique = document.getElementById('filterUnique');
          const filterHTML = document.getElementById('filterHTML');
          const filterDuplicates = document.getElementById('filterDuplicates');
      
          const fetchLinks = async (url) => {
  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error(`Failed to fetch ${url}: ${response.status}`);
    const text = await response.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(text, 'text/html');
    const anchors = doc.querySelectorAll('a[href]');

    anchors.forEach(anchor => {
      let href = anchor.href;

      // If the href is a relative URL, convert it to an absolute URL
      if (href.startsWith('/')) {
        href = new URL(href, baseDomain).href; // Make it absolute by combining with baseDomain
      }

      // Check if the URL starts with the base domain
      if (href.startsWith(baseDomain)) {
        // If the link is unique, add it
        if (!links.has(href)) {
          links.add(href);
          addLinkToTable(href);
        } else if (filterDuplicates.checked) {
          // Highlight duplicates if the filter is checked
          highlightDuplicate(href);
        }
      }
    });
  } catch (error) {
    errors.push(error.message);
    updateErrorLog();
  } finally {
    updateProgress();
  }
};

      
          const addLinkToTable = (url) => {
            const tableBody = document.querySelector('#linkTable tbody');
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${url}</td>
              <td><input type="number" value="0.5" class="priority" step="0.1" min="0.0" max="1.0"></td>
              <td>
                <select>
                  <option value="daily">Daily</option>
                  <option value="weekly">Weekly</option>
                  <option value="monthly">Monthly</option>
                </select>
              </td>
              <td>${new Date().toISOString().split('T')[0]}</td>
              <td><span class="status">Pending</span></td>
              <td><input type="checkbox"></td>
            `;
            tableBody.appendChild(row);
            totalLinks++;
            document.getElementById('linkCount').textContent = totalLinks;
      
            // Perform reachability check
            checkReachability(url, row);
          };
      
          const checkReachability = async (url, row) => {
            try {
              const response = await fetch(url);
              const statusCell = row.querySelector('.status');
              statusCell.textContent = response.ok ? 'Reachable' : 'Unreachable';
              statusCell.style.color = response.ok ? 'green' : 'red';
            } catch {
              row.querySelector('.status').textContent = 'Error';
              row.querySelector('.status').style.color = 'red';
            }
          };
      
          const highlightDuplicate = (url) => {
            const rows = document.querySelectorAll('#linkTable tbody tr');
            rows.forEach(row => {
              if (row.firstChild.textContent === url) {
                row.style.backgroundColor = '#ffcccc';
              }
            });
          };
      

          
// Add event listeners for filters
filterUnique.addEventListener('change', () => {
  filterLinks();
});

filterHTML.addEventListener('change', () => {
  filterLinks();
});

// Function to filter and display links based on selected filters
const filterLinks = () => {
  const tableRows = document.querySelectorAll('#linkTable tbody tr');
  tableRows.forEach(row => {
    const urlCell = row.querySelector('td:first-child');
    const url = urlCell.textContent;

    let showRow = true;

    // Filter by unique links
    if (filterUnique.checked) {
      const uniqueLinks = new Set();
      if (uniqueLinks.has(url)) {
        showRow = false;
      } else {
        uniqueLinks.add(url);
      }
    }

    // Filter by .html links
    if (filterHTML.checked && !url.endsWith('.html')) {
      showRow = false;
    }

    // Show or hide row based on filters
    if (showRow) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });
};

          // Scheduled Crawling Placeholder
          const scheduleCrawling = document.getElementById('crawlSchedule');
          scheduleCrawling.addEventListener('change', (e) => {
            console.log(`Scheduled crawling set to: ${e.target.value}`);
          });
      
          document.getElementById('startBtn').addEventListener('click', async () => {
            crawling = true;
            totalLinks = 0;
            links.clear();
            errors = [];
            await fetchLinks(baseDomain);
            updatePreview();
          });
        </script>




        </div>

    <!-- Footer -->
    <footer id="dynamic-footer"></footer>
    
    <!-- Firebase configuration/ Login& Out -->
    <script type="module" src="https://reelcareer.co/public/js/main.js"></script> 

    <!-- Firebase JS SDK and Custom Scripts -->

    <script type="module">
        import {
            db, doc, getDoc, query, updateDoc,
            setDoc, ref, signInWithPopup, orderBy,
             
            uploadBytes, OAuthProvider, arrayUnion, getStorage,
            signOut, addDoc, increment, onAuthStateChanged,
            createUserWithEmailAndPassword, signInWithEmailAndPassword,
            where, getDocs, storage, collection, deleteObject, 
            auth, analytics, deleteDoc, getDownloadURL
        } from 'https://reelcareer.co/js/module.js';




        
    </script>
    
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
