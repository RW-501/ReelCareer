<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Notes and To-Do</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <script src="https://reelcareer.co/public/js/bodyload.js"></script>

  <!-- Navbar section -->
  <nav id="Main_Nav" class="navbar navbar-expand-lg navbar-light bg-light" role="navigation" aria-label="Main Navigation">
    <a class="navbar-brand" href="https://reelcareer.co">ReelCareer.co</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <!-- Menu items go here -->
      </ul>
    </div>
  </nav>

  <div class="container mt-5">
    <h1 class="text-center">Admin Notes and To-Do</h1>

    <!-- Search Functionality -->
    <div class="mb-3">
      <input type="text" id="search" class="form-control" placeholder="Search..." onkeyup="filterItems()">
    </div>

    <article>
      <h2>Notes</h2>
      <div class="note-list" id="noteList" role="list">
        <!-- Notes dynamically loaded here -->
      </div>
    </article>
  
    <article>
      <h2>To-Do List</h2>
      <div class="todo-list" id="todoList" role="list">
        <!-- To-Do items dynamically loaded here -->
      </div>
    </article>
  </div>

  <!-- Tab Navigation -->
  <ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="notes-tab" data-toggle="tab" href="#notes" role="tab" aria-controls="notes" aria-selected="true">Notes</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="todos-tab" data-toggle="tab" href="#todos" role="tab" aria-controls="todos" aria-selected="false">To-Do List</a>
    </li>
  </ul>

  <div class="tab-content mt-3">
    <!-- Notes Tab -->
    <div class="tab-pane fade show active" id="notes" role="tabpanel" aria-labelledby="notes-tab">
      <form class="form-group mb-4">
        <label for="note">Add a Note</label>
        <textarea id="note" class="form-control" placeholder="Type your note here..."></textarea>
        <input type="text" id="noteGroup" class="form-control mt-2" placeholder="Enter group name">
        <input type="text" id="noteLink" class="form-control mt-2" placeholder="Enter link to topic">
        <button class="btn btn-primary mt-2" id="saveNote" type="button" aria-label="Save Note">Save Note</button>
      </form>
    </div>

    <!-- To-Do Tab -->
    <div class="tab-pane fade" id="todos" role="tabpanel" aria-labelledby="todos-tab">
      <form class="form-group mb-4">
        <label for="todo">Add a To-Do</label>
        <input type="text" id="todo" class="form-control" placeholder="Type your to-do here...">
        <input type="text" id="todoGroup" class="form-control mt-2" placeholder="Enter group name">
        <input type="text" id="todoLink" class="form-control mt-2" placeholder="Enter link to topic">
        <label for="todoComplete" class="mt-2">Mark as Complete</label>
        <input type="checkbox" id="todoComplete">
        <label for="todoComplete" class="ml-2">Need to Complete By</label>
        <input type="date" id="todoDueDate" class="form-control mt-2">
        <button class="btn btn-primary mt-2" id="saveTodo" type="button">Add To-Do</button>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer id="dynamic-footer"></footer>

  <!-- Firebase configuration/ Login& Out -->
  <script type="module" src="https://reelcareer.co/public/js/main.js"></script>

  <script type="module">
    import {
      db,
      doc,
      getDoc,
      query,
      updateDoc,
      setDoc,
      ref,
      signInWithPopup,
      orderBy,
      uploadBytes,
      OAuthProvider,
      arrayUnion,
      getStorage,
      signOut,
      addDoc,
      increment,
      onAuthStateChanged,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      where,
      getDocs,
      storage,
      collection,
      deleteObject,
      auth,
      analytics,
      deleteDoc,
      getDownloadURL
    } from 'https://reelcareer.co/js/module.js';

    // Loading Spinner
    function showLoading(state) {
      document.getElementById('loadingSpinner').style.display = state ? 'block' : 'none';
    }

    // Fetch Notes and To-Dos
    async function fetchAndRender(collectionRef, renderFn) {
      showLoading(true);
      try {
        const snapshot = await getDocs(collectionRef);
        const items = snapshot.docs.map(doc => ({
          id: doc.id,
          ...doc.data(),
        }));
        renderFn(items);
      } catch (error) {
        console.error("Error fetching items:", error);
      } finally {
        showLoading(false);
      }
    }

    // Reusable Render Function for Items
    function renderItems(items, containerId, renderItemFn) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      items.forEach(item => renderItemFn(item, container));
    }

    function renderNoteItem(note, container) {
      const div = document.createElement("div");
      div.className = "card mb-3";
      div.innerHTML = `
        <div class="card-body">
          <h5 class="card-title">${note.content}</h5>
          <p class="card-text">Group: ${note.group}</p>
          <p class="card-text">Link: <a href="${note.link}" target="_blank">${note.link}</a></p>
          <div class="d-flex justify-content-between">
            <button class="btn btn-warning" onclick="editItem('${note.id}', 'Notes')">Edit</button>
            <button class="btn btn-danger" onclick="deleteItem('${note.id}', 'Notes')">Delete</button>
          </div>
        </div>
      `;
      container.appendChild(div);
    }

    function renderTodoItem(todo, container) {
      const div = document.createElement("div");
      div.className = "card mb-3";
      div.innerHTML = `
        <div class="card-body">
          <h5 class="card-title">${todo.content}</h5>
          <p class="card-text">Group: ${todo.group}</p>
          <p class="card-text">Link: <a href="${todo.link}" target="_blank">${todo.link}</a></p>
          <p class="card-text">Due Date: ${todo.dueDate}</p>
          <input type="checkbox" ${todo.completed ? "checked" : ""} onclick="toggleComplete('${todo.id}', 'Todos')">
          <span>Complete</span>
          <div class="d-flex justify-content-between">
            <button class="btn btn-warning" onclick="editItem('${todo.id}', 'Todos')">Edit</button>
            <button class="btn btn-danger" onclick="deleteItem('${todo.id}', 'Todos')">Delete</button>
          </div>
        </div>
      `;
      container.appendChild(div);
    }

    // Delete Item
    async function deleteItem(itemId, collectionName) {
      if (confirm("Are you sure you want to delete this item?")) {
        const collectionRef = collection(db, collectionName);
        await deleteDoc(doc(collectionRef, itemId));
        fetchAndRender(collectionRef, collectionName === 'Notes' ? renderNoteItem : renderTodoItem);
      }
    }

    // Filter Function for Search Bar
    function filterItems() {
      const searchText = document.getElementById('search').value.toLowerCase();
      const filteredNotes = notes.filter(note => note.content.toLowerCase().includes(searchText));
      const filteredTodos = todos.filter(todo => todo.content.toLowerCase().includes(searchText));
      renderItems(filteredNotes, "noteList", renderNoteItem);
      renderItems(filteredTodos, "todoList", renderTodoItem);
    }

    // Handle Add Note
    $("#saveNote").click(async function () {
      const noteContent = $("#note").val();
      const noteGroup = $("#noteGroup").val();
      const noteLink = $("#noteLink").val();

      if (noteContent && noteGroup) {
        const collectionRef = collection(db, "Notes");
        await addDoc(collectionRef, {
          content: noteContent,
          group: noteGroup,
          link: noteLink,
        });

        // Clear input fields
        $("#note").val('');
        $("#noteGroup").val('');
        $("#noteLink").val('');

        fetchAndRender(collection(db, "Notes"), renderNoteItem);
      }
    });

    // Handle Add To-Do
    $("#saveTodo").click(async function () {
      const todoContent = $("#todo").val();
      const todoGroup = $("#todoGroup").val();
      const todoLink = $("#todoLink").val();
      const todoDueDate = $("#todoDueDate").val();
      const todoComplete = $("#todoComplete").is(':checked');

      if (todoContent && todoGroup) {
        const collectionRef = collection(db, "Todos");
        await addDoc(collectionRef, {
          content: todoContent,
          group: todoGroup,
          link: todoLink,
          completed: todoComplete,
          dueDate: todoDueDate,
        });

        // Clear input fields
        $("#todo").val('');
        $("#todoGroup").val('');
        $("#todoLink").val('');
        $("#todoComplete").prop('checked', false);
        $("#todoDueDate").val('');

        fetchAndRender(collection(db, "Todos"), renderTodoItem);
      }
    });

    fetchAndRender(collection(db, "Notes"), renderNoteItem);
    fetchAndRender(collection(db, "Todos"), renderTodoItem);
  </script>
</body>

</html>
