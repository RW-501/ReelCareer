<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Notes and To-Do</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <script src="https://reelcareer.co/public/js/bodyload.js"></script>

  <!-- Navbar section -->
  <nav id="Main_Nav" class="navbar navbar-expand-lg navbar-light bg-light" role="navigation" aria-label="Main Navigation">
    <a class="navbar-brand" href="https://reelcareer.co">ReelCareer.co</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <!-- Menu items go here -->
      </ul>
    </div>
  </nav>

  <div class="container mt-5">
    <h1 class="text-center">Admin Notes and To-Do</h1>

    <!-- Tab Navigation -->
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" id="notes-tab" data-toggle="tab" href="#notes" role="tab" aria-controls="notes" aria-selected="true">Notes</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="todos-tab" data-toggle="tab" href="#todos" role="tab" aria-controls="todos" aria-selected="false">To-Do List</a>
      </li>
    </ul>
    
    <div class="tab-content mt-3">
      <!-- Notes Tab -->
      <div class="tab-pane fade show active" id="notes" role="tabpanel" aria-labelledby="notes-tab">
        <form class="form-group mb-4">
          <label for="note">Add a Note</label>
          <textarea id="note" class="form-control" placeholder="Type your note here..."></textarea>
          <input type="text" id="noteGroup" class="form-control mt-2" placeholder="Enter group name">
          <input type="text" id="noteLink" class="form-control mt-2" placeholder="Enter link to topic">
          <button class="btn btn-primary mt-2" id="saveNote" type="button">Save Note</button>
        </form>
        <div id="noteList" class="note-list"></div>
      </div>

      <!-- To-Do Tab -->
      <div class="tab-pane fade" id="todos" role="tabpanel" aria-labelledby="todos-tab">
        <form class="form-group mb-4">
          <label for="todo">Add a To-Do</label>
          <input type="text" id="todo" class="form-control" placeholder="Type your to-do here...">
          <input type="text" id="todoGroup" class="form-control mt-2" placeholder="Enter group name">
          <input type="text" id="todoLink" class="form-control mt-2" placeholder="Enter link to topic">
          <label for="todoComplete" class="mt-2">Mark as Complete</label>
          <input type="checkbox" id="todoComplete">
          <label for="todoComplete" class="ml-2">Need to Complete By</label>
          <input type="date" id="todoDueDate" class="form-control mt-2">
          <button class="btn btn-primary mt-2" id="saveTodo" type="button">Add To-Do</button>
        </form>
        <div id="todoList" class="todo-list"></div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer id="dynamic-footer"></footer>

  <!-- Firebase configuration/ Login& Out -->
  <script type="module" src="https://reelcareer.co/public/js/main.js"></script>

  <script type="module">
    import {
      db,
      doc,
      getDoc,
      query,
      updateDoc,
      setDoc,
      ref,
      signInWithPopup,
      orderBy,
      uploadBytes,
      OAuthProvider,
      arrayUnion,
      getStorage,
      signOut,
      addDoc,
      increment,
      onAuthStateChanged,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      where,
      getDocs,
      storage,
      collection,
      deleteObject,
      auth,
      analytics,
      deleteDoc,
      getDownloadURL
    } from 'https://reelcareer.co/js/module.js';

    async function saveItem(collectionRef, data, fetchFn) {
      try {
        await addDoc(collectionRef, data);
        fetchFn();
      } catch (error) {
        console.error("Error saving item:", error);
      }
    }

    async function fetchAndRender(collectionRef, renderFn) {
      try {
        const snapshot = await getDocs(collectionRef);
        const items = snapshot.docs.map(doc => ({
          id: doc.id,
          ...doc.data(),
        }));
        renderFn(items);
      } catch (error) {
        console.error("Error fetching items:", error);
      }
    }

    const todosCollection = collection(db, "Todos");
    const notesCollection = collection(db, "Notes");

    function renderNotes(notes) {
      const noteList = document.getElementById("noteList");
      noteList.innerHTML = "";
      notes.forEach(note => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <p>${note.content} <small>(${note.timestamp})</small></p>
          <p>Group: ${note.group}</p>
          <p>Link: <a href="${note.link}" target="_blank">${note.link}</a></p>
          <div>
            <button class="btn edit-btn" onclick="editItem('${note.id}', notesCollection, '${note.content}', fetchNotes)">Edit</button>
            <button class="btn delete-btn" onclick="deleteItem('${note.id}', notesCollection, fetchNotes)">Delete</button>
          </div>
        `;
        noteList.appendChild(div);
      });
    }

    function renderTodos(todos) {
      const todoList = document.getElementById("todoList");
      todoList.innerHTML = "";
      todos.forEach(todo => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <p>${todo.content} <small>(${todo.timestamp})</small></p>
          <p>Group: ${todo.group}</p>
          <p>Link: <a href="${todo.link}" target="_blank">${todo.link}</a></p>
          <p>Due Date: ${todo.dueDate}</p>
          <input type="checkbox" ${todo.completed ? "checked" : ""} onclick="toggleComplete('${todo.id}', todosCollection, fetchTodos)">
          <span>Complete</span>
          <div>
            <button class="btn edit-btn" onclick="editItem('${todo.id}', todosCollection, '${todo.content}', fetchTodos)">Edit</button>
            <button class="btn delete-btn" onclick="deleteItem('${todo.id}', todosCollection, fetchTodos)">Delete</button>
          </div>
        `;
        todoList.appendChild(div);
      });
    }

    document.getElementById("saveNote").addEventListener("click", async () => {
      const note = document.getElementById("note").value;
      const group = document.getElementById("noteGroup").value;
      const link = document.getElementById("noteLink").value;
      const timestamp = new Date().toLocaleString();
      const noteData = { content: note, group, link, timestamp };
      await saveItem(notesCollection, noteData, fetchNotes);
    });

    document.getElementById("saveTodo").addEventListener("click", async () => {
      const todo = document.getElementById("todo").value;
      const group = document.getElementById("todoGroup").value;
      const link = document.getElementById("todoLink").value;
      const completed = document.getElementById("todoComplete").checked;
      const dueDate = document.getElementById("todoDueDate").value;
      const timestamp = new Date().toLocaleString();
      const todoData = { content: todo, group, link, completed, dueDate, timestamp };
      await saveItem(todosCollection, todoData, fetchTodos);
    });

    async function fetchNotes() {
      fetchAndRender(notesCollection, renderNotes);
    }

    async function fetchTodos() {
      fetchAndRender(todosCollection, renderTodos);
    }

    fetchNotes();
    fetchTodos();
  </script>
</body>

</html>
