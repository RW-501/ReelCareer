<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <title>Content Management</title>

  <!--  <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
<script>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

        tinymce.init({
            selector: '#newsContent, #blogContent', // Initialize TinyMCE for these textarea fields
            plugins: 'lists link image charmap preview',
            toolbar: 'undo redo | styleselect | bold italic | alignleft aligncenter alignright | bullist numlist outdent indent | link image | preview',
            height: 300 // Set the height of the editor
        });
    </script>
    --> 

</head>
    
<script src="../public/js/scripts.js"></script>
<script src="../public/js/loadScripts.js"></script>
</head>


<body>
    <script src="../public/js/bodyload.js"></script>
    
    <nav2 class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Reelcareer Admin</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                <li class="nav-item"><a class="nav-link" href="user-management.html">User Management</a></li>
                <li class="nav-item"><a class="nav-link" href="job-management.html">Job Management</a></li>
                <li class="nav-item"><a class="nav-link" href="application-management.html">Application Management</a></li>
                <li class="nav-item"><a class="nav-link" href="content-management.html">Content Management</a></li>
                <li class="nav-item"><a class="nav-link" href="settings.html">Settings</a></li>
                <li class="nav-item"><a class="nav-link" href="analytics.html">Analytics</a></li>
                <li class="nav-item"><a class="nav-link" href="chatbot.html">Chatbot</a></li>
                <li class="nav-item"><a class="nav-link" href="support.html">Support</a></li>
            </ul>
        </div>
    </nav2>

    <div class="container mt-4">
        <h1>Content Management</h1>
    
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script> <!-- Quill JS -->
    
    <!-- Toggle Buttons for Content Types -->
    <div class="btn-group mb-3" role="group">
        <button type="button" class="btn btn-secondary" onclick="toggleSection('newsSection')">Manage News Articles</button>
        <button type="button" class="btn btn-secondary" onclick="toggleSection('blogSection')">Manage Blog Posts</button>
        <button type="button" class="btn btn-secondary" onclick="toggleSection('faqsSection')">Manage FAQs</button>
    </div>
    
        <!-- News Article Form -->
        <div id="newsSection" class="content-section" style="display:none;">
            <h2>Manage News Articles <i class="fas fa-question-circle" data-toggle="tooltip" title="Add and manage news articles here."></i></h2>
            <form id="newsForm">
                <div class="form-group">
                    <label for="newsTitle">Title <i class="fas fa-question-circle" data-toggle="tooltip" title="Enter the title of the news article."></i></label>
                    <input type="text" class="form-control" id="newsTitle" required>
                </div>
                <div class="form-group">
                    <label for="newsContent">Content <i class="fas fa-question-circle" data-toggle="tooltip" title="Write the content of the news article."></i></label>
                    <!-- Replace the textarea with a div for Quill -->
                    <div id="newsEditor" style="height: 200px;"></div>
                    <input type="hidden" id="newsContent" name="newsContent" required>
                </div>
                <div class="form-group">
                    <label for="newsSource">Source <i class="fas fa-question-circle" data-toggle="tooltip" title="Enter the source of the news article with URL."></i></label>
                    <input type="text" class="form-control" id="newsSource" placeholder="Title" required>
                    <input type="url" class="form-control mt-2" id="newsUrl" placeholder="URL" required>
                </div>
                <div class="form-group">
                    <label for="newsImage">Upload Image <i class="fas fa-question-circle" data-toggle="tooltip" title="Upload an image for the news article."></i></label>
                    <input type="file" class="form-control" id="newsImage" accept="image/*" required>
                </div>
                <div class="form-group">
                    <label for="newsPostDate">Post Date <i class="fas fa-question-circle" data-toggle="tooltip" title="Select the date when the news article will be posted."></i></label>
                    <input type="date" class="form-control" id="newsPostDate" required>
                </div>
                <div class="form-group">
                    <label for="newsActivate">Activate <i class="fas fa-question-circle" data-toggle="tooltip" title="Choose whether to activate this article."></i></label>
                    <select class="form-control" id="newsActivate">
                        <option value="true">Yes</option>
                        <option value="false">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newsPostedBy">Posted By <i class="fas fa-question-circle" data-toggle="tooltip" title="Select the person posting the article."></i></label>
                    <select class="form-control" id="newsPostedBy" required>
                        <option value="" disabled selected>Select a person</option>
                        <option value="Web Dev">Web Dev</option>
                        <option value="Mod Team">Mod Team</option>
                        <option value="ReelCareer">ReelCareer</option>
                        <option value="Help Desk">Help Desk</option>
                        <!-- Add more options as needed -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="newsPostedById">Posted By ID <i class="fas fa-question-circle" data-toggle="tooltip" title="Select the ID of the person posting the article."></i></label>
                    <select class="form-control" id="newsPostedById" required>
                        <option value="" disabled selected>Select an ID</option>
                        <option value="0000">ID 1</option>
                        <option value="1111">ID 2</option>
                        <option value="2222">ID 3</option>
                        <option value="3333">ID 4</option>
                        <!-- Add more options as needed -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="newsCategory">Category <i class="fas fa-question-circle" data-toggle="tooltip" title="Select a category for the news article."></i></label>
                    <select class="form-control" id="newsCategory" required>
                        <option value="" disabled selected>Select a category</option>
                        <option value="Job Postings">Job Postings</option>
                        <option value="Career Advice">Career Advice</option>
                        <option value="Industry News">Industry News</option>
                        <option value="Event Updates">Event Updates</option>
                        <option value="Success Stories">Success Stories</option>
                        <option value="Company News">Company News</option>
                        <option value="JobMarket Trends">Job Market Trends</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newsImageCaption">Image Caption <i class="fas fa-question-circle" data-toggle="tooltip" title="Enter a caption for the associated image."></i></label>
                    <input type="text" class="form-control" id="newsImageCaption">
                </div>
                <button type="submit" class="btn btn-primary">Save News Article</button>
                <button type="reset" class="btn btn-secondary">Reset</button>
            </form>
        </div>
    
        <!-- Blog Post Form -->
        <div id="blogSection" class="content-section" style="display:none;">
            <h2>Manage Blog Posts <i class="fas fa-question-circle" data-toggle="tooltip" title="Add and manage blog posts here."></i></h2>
            <form id="blogForm">
                <div class="form-group">
                    <label for="blogTitle">Title <i class="fas fa-question-circle" data-toggle="tooltip" title="Enter the title of the blog post."></i></label>
                    <input type="text" class="form-control" id="blogTitle" required>
                </div>
                <div class="form-group">
                    <label for="blogContent">Content <i class="fas fa-question-circle" data-toggle="tooltip" title="Write the content of the blog post."></i></label>
                    <!-- Replace the textarea with a div for Quill -->
                    <div id="blogEditor" style="height: 200px;"></div>
                    <input type="hidden" id="blogContent" name="blogContent" required>
                </div>
                <div class="form-group">
                    <label for="blogImage">Upload Image <i class="fas fa-question-circle" data-toggle="tooltip" title="Upload an image for the blog post."></i></label>
                    <input type="file" class="form-control" id="blogImage" accept="image/*" required>
                </div>
                <div class="form-group">
                    <label for="blogPostDate">Post Date <i class="fas fa-question-circle" data-toggle="tooltip" title="Select the date when the blog post will be published."></i></label>
                    <input type="date" class="form-control" id="blogPostDate" required>
                </div>
                <div class="form-group">
                    <label for="blogActivate">Activate <i class="fas fa-question-circle" data-toggle="tooltip" title="Choose whether to activate this post."></i></label>
                    <select class="form-control" id="blogActivate">
                        <option value="true">Yes</option>
                        <option value="false">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="blogPostedBy">Posted By <i class="fas fa-question-circle" data-toggle="tooltip" title="Select the person posting the blog."></i></label>
                    <select class="form-control" id="blogPostedBy">
                        <option value="" disabled selected>Select an admin</option>
                        <option value="Web Dev">Web Dev</option>
                        <option value="Mod Team">Mod Team</option>
                        <option value="ReelCareer">ReelCareer</option>
                        <option value="Team Job Seeker">Team Job Seeker</option>
                        <option value="Team Promos">Team Promos</option>
                        <option value="Team Recruiter">Team Recruiter</option>
                        <option value="Help Desk">Help Desk</option>
                        <!-- Add more options as needed -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="blogPostedById">Posted By ID <i class="fas fa-question-circle" data-toggle="tooltip" title="Select the ID of the person posting the blog."></i></label>
                    <select class="form-control" id="blogPostedById">
                        <option value="" disabled selected>Select an ID</option>
                        <option value="0000">ID 1</option>
                        <option value="1111">ID 2</option>
                        <option value="2222">ID 3</option>
                        <option value="3333">ID 4</option>
                        <!-- Add more options as needed -->
                    </select>
                </div>
                          <div class="form-group">
                    <label for="blogCategory">Category <i class="fas fa-question-circle" data-toggle="tooltip" title="Select a category for the blog post."></i></label>
                    <select class="form-control" id="blogCategory" required>
                        <option value="" disabled selected>Select a category</option>
                        <option value="Career Advice">Career Advice</option>
                        <option value="Interview Tips">Interview Tips</option>
                        <option value="Resume Writing">Resume Writing</option>
                        <option value="JobSearch Strategies">Job Search Strategies</option>
                    </select>
                </div>
                <div class="form-group">
                <label for="blogTags">Tags (comma-separated):</label>
<input type="text" id="blogTags" placeholder="Enter tags">
</div>
                <div class="form-group">
                    <label for="blogImageCaption">Image Caption <i class="fas fa-question-circle" data-toggle="tooltip" title="Enter a caption for the associated image."></i></label>
                    <input type="text" class="form-control" id="blogImageCaption">
                </div>
                <button type="submit" class="btn btn-primary">Save Blog Post</button>
                <button type="reset" class="btn btn-secondary">Reset</button>
            </form>
        </div>


    <!-- FAQs Section -->
    <div id="faqsSection" class="content-section" style="display:none;">
        <h2>Manage FAQs <i class="fas fa-question-circle" data-toggle="tooltip" title="Add and manage FAQs here."></i></h2>
        <form id="faqsForm">
            <div class="form-group">
                <label for="faqQuestion">Question <i class="fas fa-question-circle" data-toggle="tooltip" title="Enter the question for the FAQ."></i></label>
                <input type="text" class="form-control" id="faqQuestion" required>
            </div>
            <div class="form-group">
                <label for="faqAnswer">Answer <i class="fas fa-question-circle" data-toggle="tooltip" title="Provide the answer to the FAQ."></i></label>
                <textarea class="form-control" id="faqAnswer" rows="5" required></textarea>
            </div>
            <div class="form-group">
                <label for="newsTags">Tags (comma-separated):</label>
                <input type="text" id="newsTags" placeholder="Enter tags">                
                </div>
            <div class="form-group">
                <label for="faqCategory">Category <i class="fas fa-question-circle" data-toggle="tooltip" title="Select a category for the FAQ."></i></label>
                <select class="form-control" id="faqCategory" required>
                    <option value="" disabled selected>Select a category</option>
                    <option value="General">General</option>
                    <option value="Technical">Technical</option>
                    <option value="Billing">Billing</option>
                    <option value="Account">Account</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Save FAQ</button>
            <button type="reset" class="btn btn-secondary">Reset</button>
        </form>
    </div>



</div>
    
<div id="viewContent">
        <div class="form-group">
            <label for="searchContent">Search Content</label>
            <input type="text" class="form-control" id="searchContent" placeholder="Search articles, blogs, FAQs..." onkeyup="filterContent()">
        </div>

        <h2 class="mt-4">Existing Content</h2>
        <div id="contentList"></div>
    </div>
    
<!-- Modal for displaying content -->
<div class="modal fade hide" id="contentModal" tabindex="-1" role="dialog" aria-labelledby="contentModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="contentModalLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="modalContentBody">
                <img id="modalImage" src="" alt="Content Image" class="img-fluid mb-3" style="display:none;">
                <p id="modalTextContent"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
    <!-- Footer -->
    <footer id="dynamic-footer"></footer>
    <script>
        // Initialize Quill editors for news and blog sections
        const newsEditor = new Quill('#newsEditor', {
            theme: 'snow'
        });
        const blogEditor = new Quill('#blogEditor', {
            theme: 'snow'
        });

        // Save content from Quill editor to hidden input before form submission
        $('#newsForm').on('submit', function() {
            $('#newsContent').val(newsEditor.root.innerHTML); // Set the content
        });

        $('#blogForm').on('submit', function() {
            $('#blogContent').val(blogEditor.root.innerHTML); // Set the content
        });

        // Toggle sections visibility
        function toggleSection(sectionId) {
            $('.content-section').hide(); // Hide all sections
            $('#' + sectionId).show();    // Show selected section
        }
    </script>

    <!-- Firebase configuration/ Login & Out -->
    <script type="module" src="../public/js/main.js"></script>

<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script type="module">
     import { db, storage, analytics, app, auth  } from '../public/js/main.js'; // Adjust the path based on your structure
     import { query, where, orderBy, limit,  collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
     import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-storage.js"; // Import required functions

      



            // Function to upload image to Firebase Storage

function uploadImage(file) { 
    return new Promise((resolve, reject) => {
        const storageRef = ref(storage, 'images/' + file.name); // Use ref() instead of storage.ref()
        const task = uploadBytes(storageRef, file); // Use uploadBytes to upload the file

        task.then(snapshot => {
            console.log('Upload successful!');

            // Get the download URL
            getDownloadURL(snapshot.ref).then(downloadURL => {
                resolve(downloadURL);
            }).catch(err => {
                reject(err);
            });
        }).catch(err => {
            reject(err);
        });
    });
}
            // Handle form submission for news articles
           // Handle form submission for news
document.getElementById('newsForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    const file = document.getElementById('newsImage').files[0];
    try {
        const imageUrl = await uploadImage(file);
     // Get a reference to the 'FAQs' collection
     const NewsCollection = collection(db, 'News');

// Add a new document to the 'FAQs' collection
await addDoc(NewsCollection, {
    title: document.getElementById('newsTitle').value,
    content: document.getElementById('newsContent').value,
    postDate: document.getElementById('newsPostDate').value,
    activate: document.getElementById('newsActivate').value === 'true',
    postedBy: document.getElementById('newsPostedBy').value,
    postedById: document.getElementById('newsPostedById').value,
    category: document.getElementById('newsCategory').value,
    imageUrl: imageUrl,
    imageCaption: document.getElementById('newsImageCaption').value,
    likes: 0,
    loves: 0,
    helpful: 0,
    viewCount: 0,
    tags: document.getElementById('newsTags').value.split(',').map(tag => tag.trim()) // Process tags as an array
});

        alert('News article saved successfully!');
        document.getElementById('newsForm').reset();
    } catch (error) {
        console.error('Error adding document: ', error);
    }
});

// Handle form submission for blog posts
document.getElementById('blogForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    const file = document.getElementById('blogImage').files[0];
    try {
        const imageUrl = await uploadImage(file);
        // Get a reference to the 'FAQs' collection
        const blogCollection = collection(db, 'Blogs');

        // Add a new document to the 'FAQs' collection
        await addDoc(blogCollection, {
    title: document.getElementById('blogTitle').value,
    content: document.getElementById('blogContent').value,
    postDate: document.getElementById('blogPostDate').value,
    activate: document.getElementById('blogActivate').value === 'true',
    postedBy: document.getElementById('blogPostedBy').value,
    postedById: document.getElementById('blogPostedById').value,
    category: document.getElementById('blogCategory').value,
    imageUrl: imageUrl,
    imageCaption: document.getElementById('blogImageCaption').value,
    likes: 0,
    loves: 0,
    helpful: 0,
    viewCount: 0,
    tags: document.getElementById('blogTags').value.split(',').map(tag => tag.trim()) // Process tags as array
});

        alert('Blog post saved successfully!');
        document.getElementById('blogForm').reset();
    } catch (error) {
        console.error('Error adding document: ', error);
    }
});

// Handle form submission for FAQs
document.getElementById('faqsForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    try {
        // Get a reference to the 'FAQs' collection
        const faqsCollection = collection(db, 'FAQs');

        // Add a new document to the 'FAQs' collection
        await addDoc(faqsCollection, {
    question: document.getElementById('faqQuestion').value,
    answer: document.getElementById('faqAnswer').value,
    category: document.getElementById('faqCategory').value,
    helpful: 0,
    activate: true,
    tags: document.getElementById('faqTags').value.split(',').map(tag => tag.trim()) // Process tags as an array
});

        alert('FAQ saved successfully!');
         document.getElementById('faqsForm').reset(); // Uncomment if you want to reset the form
    } catch (error) {
        console.error('Error adding document: ', error);
    }
});

document.addEventListener('DOMContentLoaded', function() {
    // Get the forms
    const newsForm = document.getElementById('newsForm');
    const blogForm = document.getElementById('blogForm');
    const faqForm = document.getElementById('faqsForm');

    // Function to reset form fields, excluding date input
    function resetFormFields(form) {
        form.querySelectorAll('input, textarea').forEach(function(input) {
            if (input.type !== 'date') {
                input.value = ''; // Clear input
            } else {
                input.value = new Date().toISOString().split('T')[0]; // Reset date to today
            }
        });
    }

    // Add event listener for the news form reset
    newsForm.addEventListener('reset', function() {
        resetFormFields(newsForm);
    });

    // Add event listener for the blog form reset
    blogForm.addEventListener('reset', function() {
        resetFormFields(blogForm);
    });

    // Add event listener for the FAQ form reset
    faqForm.addEventListener('reset', function() {
        resetFormFields(faqForm);
    });
});

        // Load existing content
      
        async function loadContent() {
    const contentList = document.getElementById('contentList');
    contentList.innerHTML = ''; // Clear existing content

    try {
        // Load News
        const newsSnapshot = await getDocs(collection(db, 'News'));
        newsSnapshot.forEach(doc => {
            const data = doc.data();
            contentList.innerHTML += `
                <h5 class="clickable" data-title="${data.title}" data-content="${data.content}" onclick="showContentModal(this)">${data.title} (News)</h5>
                <p>${data.content}</p>
                <hr>
            `;
        });

        // Load Blogs
        const blogsSnapshot = await getDocs(collection(db, 'Blogs'));
        blogsSnapshot.forEach(doc => {
            const data = doc.data();
            contentList.innerHTML += `
                <h5 class="clickable" data-title="${data.title}" data-content="${data.content}" onclick="showContentModal(this)">${data.title} (Blog)</h5>
                <p>${data.content}</p>
                <hr>
            `;
        });

        // Load FAQs
        const faqsSnapshot = await getDocs(collection(db, 'FAQs'));
        faqsSnapshot.forEach(doc => {
            const data = doc.data();
            contentList.innerHTML += `
                <h5 class="clickable" data-title="${data.question}" data-content="${data.answer}" onclick="showContentModal(this)">${data.question} (FAQ)</h5>
                <p>${data.answer}</p>
                <hr>
            `;
        });

    } catch (error) {
        console.error("Error loading content: ", error);
    }
}
// Load content on page load
document.addEventListener('DOMContentLoaded', function() {
    loadContent();
});

</script>

<script>

// Function to show modal with content
function showContentModal(element) {
        const title = $(element).data('title');
        const content = $(element).data('content');
        const imageUrl = $(element).data('image'); // Assuming data-image attribute holds the image URL

        // Set the modal title
        $('#contentModalLabel').text(title);

        // Set the modal content
        $('#modalTextContent').text(content);

        // Set the image if available
        if (imageUrl) {
            $('#modalImage').attr('src', imageUrl).show();
        } else {
            $('#modalImage').hide(); // Hide the image if not available
        }

        // Show the modal
        $('#contentModal').modal('show');
    }

function filterContent() {
    const input = document.getElementById('searchContent');
    const filter = input.value.toLowerCase();
    const contentDiv = document.getElementById('contentList');
    const contentItems = contentDiv.getElementsByTagName('div');

    for (let i = 0; i < contentItems.length; i++) {
        const title = contentItems[i].getElementsByTagName('h5')[0];
        if (title) {
            const txtValue = title.textContent || title.innerText;
            contentItems[i].style.display = txtValue.toLowerCase().includes(filter) ? "" : "none";
        }
    }
}

function toggleSection(sectionId) {
    const sections = ['newsSection', 'blogSection', 'faqsSection'];
    sections.forEach((id) => {
        document.getElementById(id).style.display = (id === sectionId) ? 'block' : 'none';
    });
}

$(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();
});



    </script>

    <!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<!-- jQuery (Must be included before Bootstrap JS) -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    
<!-- Popper.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>

<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

</body>
</html>
