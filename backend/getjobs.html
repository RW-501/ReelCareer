<style> 
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
    h1 { text-align: center; }
    #jobTableContainer { margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
    th { cursor: pointer; background-color: #f4f4f4; }
    .selected { background-color: #dff0d8; }
    #messageArea { display: none; margin-top: 10px; padding: 10px; background: lightgray; }
    .error { background: lightcoral; color: white; }
    #loading { display: none; text-align: center; margin-top: 20px; }
    #autoAddProgress { height: 20px; background: blue; color: white; text-align: center; width: 0%; transition: width 0.5s; }
    #stopAutoAddButton.hidden { display: none; }
</style>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <!-- Bootstrap CSS -->
    <script src="https://reelcareer.co/public/js/scripts.js"></script>
    <script src="https://reelcareer.co/public/js/loadScripts.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="https://reelcareer.co/public/css/styles.css">

</head>


<body>
    <script src="https://reelcareer.co/public/js/bodyload.js"></script>
    <script defer src="https://reelcareer.co/backend/js/admin.js"></script>


       <!-- Bootstrap JS and dependencies -->
       <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
       <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
       <style>

        #jobTableContainer {
            min-height: 500px;
        }
        
        * {
            user-select: auto !important;
            box-sizing: border-box;
        }
        </style>
    <nav>

    </nav>

    <div class="container">

    <h1>Job Fetcher and Uploader</h1>
    <h2 id="TotalJobsAdded" class="mt-4 mb-4">0</h2>
<div class="controls ">

    <!-- Buttons to Start and Stop the process -->
<button id="startButton">Start</button>
<button id="stopButton" disabled>Stop</button>
</div>
</div>

<div class="container">
    <input type="text" id="query" placeholder="Enter job query" />

    <select id="query2">
        <option value="" selected> </option>
        <option value="remote " >remote </option>
        <option value="full time">full time</option>
        <option value="part time">part time</option>
        <option value="manager">Manager</option>
        <option value="assistant"> Assistant</option>
        <option value="host">Host</option>
        <option value="hostess">Hostess</option>
        <option value="greeter">Greeter</option>
        <option value="worker"> Worker</option>
        <option value="handler">Handler</option>
        <option value="crs">crs</option>
        <option value="parking lot attendant">Parking Lot Attendant</option>
        <option value="fast food cashier">Fast Food Cashier</option>
        <option value="bellhop">Bellhop</option>
        <option value="cleaning staff">Cleaning Staff</option>
        <option value="laundry worker">Laundry Worker</option>
        <option value="home health aide">Home Health Aide</option>
        <option value="caregiver">Caregiver</option>
        <option value="food packer">Food Packer</option>
        <option value="produce stocker">Produce Stocker</option>
        <option value="meat cutter">Meat Cutter</option>
        <option value="delivery helper">Delivery Helper</option>
        <option value="cafeteria worker">Cafeteria Worker</option>
        <option value="school bus driver">School Bus Driver</option>
        <option value="crossing guard">Crossing Guard</option>
        <option value="daycare worker">Daycare Worker</option>
        <option value="street vendor">Street Vendor</option>
        <option value="gas station attendant">Gas Station Attendant</option>
        <option value="night security guard">Night Security Guard</option>
        <option value="ticket collector">Ticket Collector</option>
        <option value="concession worker">Concession Worker</option>
        <option value="ride operator">Ride Operator</option>
        <option value="carnival worker">Carnival Worker</option>
        <option value="cash register clerk">Cash Register Clerk</option>
        <option value="bagger">Bagger</option>
        <option value="ticket seller">Ticket Seller</option>
        <option value="office clerk">Office Clerk</option>
        <option value="line worker">Line Worker</option>
        <option value="registered nurse">Registered Nurse</option>
        <option value="teacher">Teacher</option>
        <option value="construction worker">Construction Worker</option>
        <option value="electrician">Electrician</option>
        <option value="plumber">Plumber</option>
        <option value="pharmacist">Pharmacist</option>
        <option value="bus driver">Bus Driver</option>
        <option value="delivery driver">Delivery Driver</option>
        <option value="graphic designer">Graphic Designer</option>
        <option value="waiter">Waiter</option>
        <option value="chef">Chef</option>
        <option value="barista">Barista</option>
        <option value="mechanic">Mechanic</option>
        <option value="dentist">Dentist</option>
        <option value="dental hygienist">Dental Hygienist</option>
        <option value="warehouse worker">Warehouse Worker</option>
        <option value="forklift operator">Forklift Operator</option>
        <option value="it specialist">IT Specialist</option>
        <option value="data analyst">Data Analyst</option>
        <option value="project manager">Project Manager</option>
        <option value="software developer">Software Developer</option>
        <option value="data scientist">Data Scientist</option>
        <option value="web developer">Web Developer</option>
        <option value="product manager">Product Manager</option>
        <option value="personal assistant">Personal Assistant</option>
        <option value="host">Host</option>
        <option value="hostess">Hostess</option>
        <option value="greeter">Greeter</option>
        <option value="farm worker">Farm Worker</option>
        <option value="cash handler">Cash Handler</option>
        <option value="room service attendant">Room Service Attendant</option>
        <option value="parking lot attendant">Parking Lot Attendant</option>
        <option value="fast food cashier">Fast Food Cashier</option>
        <option value="bellhop">Bellhop</option>
        <option value="cleaning staff">Cleaning Staff</option>
        <option value="laundry worker">Laundry Worker</option>
        <option value="home health aide">Home Health Aide</option>
        <option value="caregiver">Caregiver</option>
        <option value="food packer">Food Packer</option>
        <option value="produce stocker">Produce Stocker</option>
        <option value="meat cutter">Meat Cutter</option>
        <option value="delivery helper">Delivery Helper</option>
        <option value="cafeteria worker">Cafeteria Worker</option>
        <option value="school bus driver">School Bus Driver</option>
        <option value="crossing guard">Crossing Guard</option>
        <option value="daycare worker">Daycare Worker</option>
        <option value="street vendor">Street Vendor</option>
        <option value="gas station attendant">Gas Station Attendant</option>
        <option value="night security guard">Night Security Guard</option>
        <option value="ticket collector">Ticket Collector</option>
        <option value="concession worker">Concession Worker</option>
        <option value="ride operator">Ride Operator</option>
        <option value="carnival worker">Carnival Worker</option>
        <option value="cash register clerk">Cash Register Clerk</option>
        <option value="bagger">Bagger</option>
        <option value="ticket seller">Ticket Seller</option>
        <option value="office clerk">Office Clerk</option>
        <option value="line worker">Line Worker</option>
        <option value="registered nurse">Registered Nurse</option>
        <option value="teacher">Teacher</option>
        <option value="construction worker">Construction Worker</option>
        <option value="electrician">Electrician</option>
        <option value="plumber">Plumber</option>
        <option value="pharmacist">Pharmacist</option>
        <option value="bus driver">Bus Driver</option>
        <option value="delivery driver">Delivery Driver</option>
        <option value="graphic designer">Graphic Designer</option>
        <option value="waiter">Waiter</option>
        <option value="chef">Chef</option>
        <option value="barista">Barista</option>
        <option value="mechanic">Mechanic</option>
        <option value="dentist">Dentist</option>
        <option value="dental hygienist">Dental Hygienist</option>
        <option value="warehouse worker">Warehouse Worker</option>
        <option value="forklift operator">Forklift Operator</option>
        <option value="it specialist">IT Specialist</option>
        <option value="data analyst">Data Analyst</option>
        <option value="project manager">Project Manager</option>
        <option value="human resources specialist">Human Resources Specialist</option>
        <option value="marketing manager">Marketing Manager</option>
        <option value="consultant">Consultant</option>
        <option value="bank teller">Bank Teller</option>
        <option value="loan officer">Loan Officer</option>
        <option value="financial advisor">Financial Advisor</option>
        <option value="event planner">Event Planner</option>
        <option value="receptionist">Receptionist</option>
        <option value="fitness trainer">Fitness Trainer</option>
        <option value="physical therapist">Physical Therapist</option>
        <option value="veterinarian">Veterinarian</option>
        <option value="animal caretaker">Animal Caretaker</option>
        <option value="photographer">Photographer</option>
        <option value="journalist">Journalist</option>
        <option value="editor">Editor</option>
        <option value="writer">Writer</option>
        <option value="scientist">Scientist</option>
        <option value="research assistant">Research Assistant</option>
        <option value="security guard">Security Guard</option>
        <option value="janitor">Janitor</option>
        <option value="librarian">Librarian</option>
        <option value="busboy">Busboy</option>
        <option value="flight attendant">Flight Attendant</option>
        <option value="pilot">Pilot</option>
        <option value="bartender">Bartender</option>
        <option value="childcare worker">Childcare Worker</option>
        <option value="psychologist">Psychologist</option>
        <option value="social worker">Social Worker</option>
        <option value="real estate agent">Real Estate Agent</option>
        <option value="customer support representative">Customer Support Representative</option>
        <option value="administrative support specialist">Administrative Support Specialist</option>
        <option value="office assistant">Office Assistant</option>
        <option value="warehouse associate">Warehouse Associate</option>
        <option value="warehouse manager">Warehouse Manager</option>
        <option value="inventory specialist">Inventory Specialist</option>
        <option value="shipping and receiving clerk">Shipping and Receiving Clerk</option>
        <option value="material handler">Material Handler</option>
        <option value="call center representative">Call Center Representative</option>
        <option value="customer care specialist">Customer Care Specialist</option>
        <option value="customer success manager">Customer Success Manager</option>
        <option value="client services coordinator">Client Services Coordinator</option>
        <option value="cashier">Cashier</option>
        <option value="sales clerk">Sales Clerk</option>
        <option value="retail associate">Retail Associate</option>
        <option value="housekeeper">Housekeeper</option>
        <option value="food service worker">Food Service Worker</option>
        <option value="dishwasher">Dishwasher</option>
        <option value="server">Server</option>
        <option value="parking attendant">Parking Attendant</option>
        <option value="front desk agent">Front Desk Agent</option>
        <option value="hotel concierge">Hotel Concierge</option>
        <option value="carpenter">Carpenter</option>
        <option value="hvac technician">HVAC Technician</option>
        <option value="welder">Welder</option>
        <option value="landscaper">Landscaper</option>
        <option value="painter">Painter</option>
        <option value="truck driver">Truck Driver</option>
        <option value="logistics manager">Logistics Manager</option>
        <option value="fleet manager">Fleet Manager</option>
        <option value="dispatcher">Dispatcher</option>       
         <option value="marketing manager">Marketing Manager</option>
        <option value="consultant">Consultant</option>
        <option value="bank teller">Bank Teller</option>
        <option value="loan officer">Loan Officer</option>
        <option value="financial advisor">Financial Advisor</option>
        <option value="event planner">Event Planner</option>
        <option value="receptionist">Receptionist</option>
        <option value="fitness trainer">Fitness Trainer</option>
        <option value="physical therapist">Physical Therapist</option>
        <option value="veterinarian">Veterinarian</option>
        <option value="animal caretaker">Animal Caretaker</option>
        <option value="photographer">Photographer</option>
        <option value="journalist">Journalist</option>
        <option value="editor">Editor</option>
        <option value="writer">Writer</option>
        <option value="scientist">Scientist</option>
        <option value="research assistant">Research Assistant</option>
        <option value="security guard">Security Guard</option>
        <option value="janitor">Janitor</option>
        <option value="librarian">Librarian</option>
        <option value="busboy">Busboy</option>
        <option value="flight attendant">Flight Attendant</option>
        <option value="pilot">Pilot</option>
        <option value="bartender">Bartender</option>
        <option value="childcare worker">Childcare Worker</option>
        <option value="psychologist">Psychologist</option>
        <option value="social worker">Social Worker</option>
        <option value="real estate agent">Real Estate Agent</option>
    </select>
    
    <select id="stateSelect">
        <option value="">Select a state</option>
        <option value="Alabama">Alabama</option>
        <option value="Alaska">Alaska</option>
        <option value="Arizona">Arizona</option>
        <option value="Arkansas">Arkansas</option>
        <option value="California">California</option>
        <option value="Colorado">Colorado</option>
        <option value="Connecticut">Connecticut</option>
        <option value="Delaware">Delaware</option>
        <option value="Florida">Florida</option>
        <option value="Georgia">Georgia</option>
        <option value="Hawaii">Hawaii</option>
        <option value="Idaho">Idaho</option>
        <option value="Illinois">Illinois</option>
        <option value="Indiana">Indiana</option>
        <option value="Iowa">Iowa</option>
        <option value="Kansas">Kansas</option>
        <option value="Kentucky">Kentucky</option>
        <option value="Louisiana">Louisiana</option>
        <option value="Maine">Maine</option>
        <option value="Maryland">Maryland</option>
        <option value="Massachusetts">Massachusetts</option>
        <option value="Michigan">Michigan</option>
        <option value="Minnesota">Minnesota</option>
        <option value="Mississippi">Mississippi</option>
        <option value="Missouri">Missouri</option>
        <option value="Montana">Montana</option>
        <option value="Nebraska">Nebraska</option>
        <option value="Nevada">Nevada</option>
        <option value="New Hampshire">New Hampshire</option>
        <option value="New Jersey">New Jersey</option>
        <option value="New Mexico">New Mexico</option>
        <option value="New York">New York</option>
        <option value="North Carolina">North Carolina</option>
        <option value="North Dakota">North Dakota</option>
        <option value="Ohio">Ohio</option>
        <option value="Oklahoma">Oklahoma</option>
        <option value="Oregon">Oregon</option>
        <option value="Pennsylvania">Pennsylvania</option>
        <option value="Rhode Island">Rhode Island</option>
        <option value="South Carolina">South Carolina</option>
        <option value="South Dakota">South Dakota</option>
        <option value="Tennessee">Tennessee</option>
        <option value="Texas">Texas</option>
        <option value="Utah">Utah</option>
        <option value="Vermont">Vermont</option>
        <option value="Virginia">Virginia</option>
        <option value="Washington">Washington</option>
        <option value="West Virginia">West Virginia</option>
        <option value="Wisconsin">Wisconsin</option>
        <option value="Wyoming">Wyoming</option>
    </select>
    
    <input type="number" id="perPage" placeholder="Results per page" value="5" />
    <button onclick="fetchJobs()">Fetch Jobs</button>
    <button id="addJobButton">Add Selected Job</button>
    <button id="autoAddButton">Auto Add Jobs</button>
    <button id="stopAutoAddButton" class="hidden">Stop Auto Add</button>
</div>


    <div id="loading">Loading...</div>
    <div id="autoAddProgress"></div>
    <div id="messageArea"><span id="messageAreaText"></span></div>
 
    <div id="jobTableContainer">
        <table id="jobTable">
            <thead>
                <tr>
                    <th><input type="checkbox" id="selectAll" ></th>
                    <th id="sortJobTitle">Job Title</th>
                    <th id="sortCompany">Company</th>
                    <th id="sortCity">City</th>
                    <th id="sortState">State</th>
                    <th id="sortSalary">Salary</th>
                    <th id="sortDate">Date</th>
                    <th id="sortCategory">Category</th>
                    
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="jobApplications" onclick="handleTableClick(event)"></tbody>
        </table>
    </div>
    
    <div id="errorDisplay" style="color: red; margin-top: 10px;"></div>


    <!-- Footer -->
    <footer id="dynamic-footer"></footer>
    
    <!-- Firebase configuration/ Login& Out -->
    <script type="module" src="https://reelcareer.co/public/js/main.js"></script> 

    <!-- Firebase JS SDK and Custom Scripts -->

    <!-- Firebase and Job Fetcher Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>


    <script>



// Select All Jobs
function toggleSelectAll() {
    const selectAllCheckbox = document.getElementById("selectAll");
    const checkboxes = document.querySelectorAll(".job-checkbox");  // Get all individual checkboxes

    checkboxes.forEach(checkbox => {
        checkbox.checked = selectAllCheckbox.checked;  // Set all checkboxes based on selectAll
        toggleRowSelection(checkbox);  // Update row selection (class)
    });
}

// Optionally, you can add event listener for each individual checkbox to ensure the "Select All" box updates accordingly
document.addEventListener("DOMContentLoaded", () => {
    const selectAllCheckbox = document.getElementById("selectAll");
    selectAllCheckbox.addEventListener("click", () => {
        toggleSelectAll()
    });
    // Update the "Select All" checkbox when individual checkboxes are toggled
    const checkboxes = document.querySelectorAll(".job-checkbox");
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener("change", () => {
            const allChecked = [...checkboxes].every(cb => cb.checked);  // Check if all checkboxes are selected
            selectAllCheckbox.checked = allChecked;  // Update the "Select All" checkbox
        });
    });
});

document.addEventListener("DOMContentLoaded", () => {


    window.toggleRowSelection = toggleRowSelection;
    window.toggleSelectAll = toggleSelectAll;


    const sortColumns = [
        "sortJobTitle",
        "sortCompany",
        "sortCity",
        "sortState",
        "sortSalary",
        "sortDate",
        "sortCategory"
    ];

    sortColumns.forEach((columnId, index) => {
        const column = document.getElementById(columnId);
        column.addEventListener("click", () => sortTable(index + 1)); // Adjust column index
    });







    function toggleRowSelection(checkbox) {
    const row = checkbox.closest("tr"); // Get the parent <tr> of the checkbox
    if (checkbox.checked) {
        row.classList.add("selected"); // Add the selected class
    } else {
        row.classList.remove("selected"); // Remove the selected class
    }
}


        window.toggleRowSelection = toggleRowSelection;

        function handleTableClick(event) {
    if (event.target && event.target.classList.contains('job-checkbox')) {
        toggleRowSelection(event.target); // Pass the actual checkbox
    }
}

        
window.handleTableClick = handleTableClick ;
});



let sortDirection = [true, true, true, true, true, true, true, true]; // Store the sort direction for each column (true for ascending, false for descending)

// Move sortTable outside of the event listener
function sortTable(columnIndex) {
    const table = document.getElementById("jobTable");
    const rows = Array.from(table.rows)
        .slice(1) // Exclude the header row
        .filter(row => !row.classList.contains("job-details")); // Exclude collapsible rows

    const isAscending = sortDirection[columnIndex];
    sortDirection[columnIndex] = !isAscending; // Toggle sort direction

    const sortedRows = rows.sort((rowA, rowB) => {
        // Skip rows without expected cells
        if (rowA.cells.length <= columnIndex || rowB.cells.length <= columnIndex) return 0;

        const cellA = rowA.cells[columnIndex].innerText.trim();
        const cellB = rowB.cells[columnIndex].innerText.trim();

        // Handle sorting based on column type (numeric or text)
        if (columnIndex === 5) { // Salary column
            const salaryA = parseFloat(cellA) || 0;
            const salaryB = parseFloat(cellB) || 0;
            return isAscending ? salaryA - salaryB : salaryB - salaryA;
        } else if (columnIndex === 6) { // Date column
            const dateA = new Date(cellA);
            const dateB = new Date(cellB);
            return isAscending ? dateA - dateB : dateB - dateA;
        } else { // For text columns (e.g., Job Title, Company, etc.)
            return isAscending ? cellA.localeCompare(cellB) : cellB.localeCompare(cellA);
        }
    });

    // Append sorted rows to the table
    const tbody = document.getElementById("jobApplications");
    tbody.innerHTML = ""; // Clear existing rows
    sortedRows.forEach(row => tbody.appendChild(row));
}



//window.sortTable = sortTable;



      
    </script>
    <script type="module">


        import {
                db, doc, getDoc, query, updateDoc,
                setDoc, ref, signInWithPopup, orderBy,
                collection, getFirestore,writeBatch,
                uploadBytes, OAuthProvider, arrayUnion, getStorage,
                signOut, addDoc, increment, onAuthStateChanged,
                createUserWithEmailAndPassword, signInWithEmailAndPassword,
                where, getDocs, storage, deleteObject, batch,
                auth, analytics, deleteDoc, getDownloadURL
            } from 'https://reelcareer.co/js/module.js';
    
    

            function parseCityFromLocation(location) {
            const parts = location.split(',');
            return parts.length > 0 ? parts[0].trim() : '';
        }

        function parseStateFromLocation(location) {
            const parts = location.split(',');
            return parts.length > 1 ? parts[1].trim() : '';
        }

        function parseCityFromLocationNew(locationString) {
            if (locationString && locationString.includes(',')) {
                return locationString.split(',')[0].trim();
            }
            return '';
        }
  
        let autoAdd = false;
        let autoAddTimeout;
        document.addEventListener("DOMContentLoaded", () => {
            
 // Loading State
 function toggleLoading(state) {
            document.getElementById("loading").style.display = state ? "block" : "none";
        }



        // Fetch Jobs
        async function fetchJobs() {
    let query = document.getElementById("query").value;
    let query2 = document.getElementById("query2").value;
    const perPage = document.getElementById("perPage").value;
    const stateSelect = document.getElementById("stateSelect");
    const selectedState = stateSelect.value;

    if(query == '') {
        query = query2;
    }

    // Build the URL based on whether a state is selected
    let url = `https://api.adzuna.com/v1/api/jobs/us/search/1?app_id=3ea9a2f1&app_key=e74d84b00c37bbfabe11710ebafcd138&results_per_page=${perPage}&what=${query}`;
    if (selectedState) {
        url += `&where=${selectedState}`;
    }

    // API request
    try {
        toggleLoading(true);
        const response = await axios.get(url);
        displayJobs(response.data.results);
    } catch (error) {
        console.error("Error fetching jobs:", error);
        showToast("Error fetching jobs. Please try again.", true);
    } finally {
        toggleLoading(false);
    }
}

window.fetchJobs = fetchJobs;


});

function getSelectedJobs() {
    const selectedRows = document.querySelectorAll(".job-item.selected");
    const jobs = [];
    selectedRows.forEach(row => {
        const job = {
            title: row.children[1].textContent,
            company: row.children[2].textContent
        };
        jobs.push(job);
    });
    console.log("Selected Jobs:", jobs);
    return jobs;
}
function displayJobs(jobs) {
    const container = document.getElementById("jobApplications");
    container.innerHTML = "";

    jobs.forEach(job => {
        const jobData = JSON.stringify(job); // Serialize job object
   //     console.log('job  ',job);
   //     console.log('jobData  ',jobData);

        // Main Row (Summary)
        const row = document.createElement("tr");
        row.className = "job-item";
        let tags = job.category && job.category.tag
    ? job.category.tag.split('-').map(word => word.trim()) 
    : "";

    let type = job.contract_time && job.contract_time
    ? job.contract_time.split('_').map(word => word.trim()) 
    : "";
        row.innerHTML = `
            <td><input type="checkbox" class="job-checkbox"></td>
            <td>${job.title}</td>
            <td>${job.company.display_name || "N/A"}</td>
            <td>${parseCityFromLocationNew(job.location.display_name) || "N/A"}</td>
            <td>${job.location.area[1] || "N/A"}</td>
            <td>${(parseFloat(job.salary_min) + parseFloat(job.salary_max)) / 2 || 0}</td>
            <td>${new Date(job.created).toLocaleDateString() || ''}</td>
            <td>${job.category.tag || ''}</td>
            <td>
                <button onclick="toggleDetails(this)">Details</button>
                <button onclick="addJob('${job.id}')">Add</button>
            </td>
<input type="hidden" value='${encodeURIComponent(jobData)}'> <!-- Hidden input -->
        `;

        // Collapsible Row (Details)
        const detailsRow = document.createElement("tr");
        detailsRow.className = "job-details hidden"; // Initially hidden
        detailsRow.innerHTML = `
            <td colspan="9">
                <div class="job-details-content">
                    <p><strong>Company:</strong> ${job.company.display_name}</p>
                    <p><strong>Description:</strong> ${job.description || "No description available"}</p>
                    <p><strong>Contract Type:</strong> ${type || "Full-time"}</p>
                    <p><strong>Location:</strong> ${job.location.display_name || "N/A"}</p>
                    <p><strong>Salary Range:</strong> ${job.salary_min || 0} - ${job.salary_max || 0}</p>
                    <p><strong>Tags:</strong> ${tags || "None"}</p>
                </div>
            </td>
        `;

        container.appendChild(row);
        container.appendChild(detailsRow);

        // Attach event listener to the checkbox
        const checkbox = row.querySelector(".job-checkbox");
        checkbox.addEventListener("click", () => toggleRowSelection(checkbox));
    });
}

document.addEventListener("DOMContentLoaded", () => {


    
// Toggle function for showing/hiding details
function toggleDetails(button) {
    const currentRow = button.closest("tr");
    const detailsRow = currentRow.nextElementSibling; // Find the collapsible row
    if (detailsRow && detailsRow.classList.contains("job-details")) {
        detailsRow.classList.toggle("hidden");
    }
}


const values = [ "austin", "atlanta", "albuquerque", "arlington", "anaheim", "anchorage", "augusta", "alexandria", "amarillo", "anchorage",
    "asheville", "akron", "allentown", "aurora", "athens", "arvada", "abilene", "ann arbor", "avondale", "appleton",
    "birmingham", "baltimore", "buffalo", "boston", "boise", "bakersfield", "bridgeport", "brownsville", "bellevue", "bend",
    "boulder", "bismarck", "burlington", "bay area", "bridgeport", "blacksburg", "boca raton", "bentonville", "beaverton", "burlington",
    "columbus", "chicago", "charlotte", "cincinnati", "cleveland", "colorado springs", "corpus christi", "chattanooga", "chesapeake", "columbia",
    "cary", "charleston", "champaign", "culver city", "clinton", "clearwater", "charlottesville", "cedar rapids", "corona", "cleveland heights",
    "dallas", "denver", "detroit", "durham", "doral", "des moines", "denton", "dothan", "dayton", "draper",
    "el paso", "eugene", "evansville", "evanston", "erie", "escondido", "elgin", "encinitas", "evanston", "east lansing",
    "fort worth", "fresno", "fort lauderdale", "fayetteville", "frisco", "fullerton", "flint", "fort collins", "fargo", "fishers",
    "greensboro", "grand rapids", "glendale", "gloucester", "gainesville", "greenville", "grand prairie", "gilbert", "goodyear", "garden grove",
    "houston", "henderson", "honolulu", "hartford", "hollywood", "highland", "hialeah", "hickory", "huntington", "huntsville",
    "indianapolis", "irvine", "irving", "indianapolis", "jacksonville", "jersey city", "joliet", "joplin", "jackson", "juneau",
    "kansas city", "killeen", "knoxville", "kalamazoo", "kent", "kenner", "kirkland", "kingston", "katy", "kalamazoo",
    "lubbock", "louisville", "los angeles", "long beach", "lincoln", "lansing", "louisville", "laredo", "lafayette", "lakewood",
    "memphis", "miami", "milwaukee", "minneapolis", "madison", "mesa", "montgomery", "mobile", "madison", "mesa",
    "macon", "moreno valley", "missoula", "medford", "merced", "modesto", "myrtle beach", "montpelier", "manchester", "missouri city",
    "macon", "morristown", "marion", "montrose", "mountain view", "mountain brook", "mckinney", "mcallen", "middletown", "murrieta",
    "minot", "manteca", "marietta", "macon", "moline", "mount pleasant", "mississippi", "mission viejo", "monroe", "myrtle beach",
    "melbourne", "murfreesboro", "meridian", "madison", "milford", "menifee", "marietta", "minneapolis", "murrieta", "muncie",
    "mesa", "mobile", "moreno valley", "madison", "mckinney", "murphy", "mchenry", "montgomery", "mountain view", "mcallen",
    "nashville", "new york", "new orleans", "newark", "norfolk", "naperville", "novi", "north las vegas", "newport news", "nampa",
    "omaha", "orlando", "oakland", "overland park", "oxnard", "odessa", "ontario", "oceanside", "orangetown", "o'fallon",
    "philadelphia", "phoenix", "pittsburgh", "plano", "portland", "pomona", "peoria", "pasadena", "providence", "pueblo",
    "plano", "portland", "pittsburgh", "provo", "plano", "palmdale", "pompano beach", "poughkeepsie", "peoria", "parsons",
    "queens", "quincy", "quakertown", "queen creek", "quincy", "quartzsite", "quincy", "quantico", "quakertown", "quinton",
    "raleigh", "riverside", "richmond", "rochester", "reno", "rochester", "round rock", "riverside", "rancho cucamonga", "rockford",
    "san antonio", "seattle", "san diego", "san francisco", "sacramento", "st. louis", "san jose", "st. paul", "st. petersburg", "syracuse",
    "salt lake city", "st. louis", "springfield", "saginaw", "santa clarita", "sparks", "sherman", "shreveport", "springfield", "sarasota",
    "sioux falls", "san mateo", "st. cloud", "south bend", "sun city", "salem", "santa barbara", "salinas", "south gate", "san marcos",
    "quincy", "queen creek", "quakertown", "quantico", "quinton", "queens", "quick city", "quincy", "quaker hill", "quitman",
    "raleigh", "riverside", "richmond", "rochester", "reno", "rockford", "round rock", "rancho cucamonga", "rochester", "rock hill",
    "st. louis", "san antonio", "san diego", "san francisco", "sacramento", "st. paul", "seattle", "san jose", "st. petersburg", "syracuse",
    "salt lake city", "st. louis", "springfield", "saginaw", "santa clarita", "sparks", "shreveport", "south bend", "salem", "santa barbara",
    "sioux falls", "san mateo", "st. cloud", "south gate", "santa rosa", "salinas", "south carolina", "san marcos", "sun valley", "simi valley",
    "tucson", "tampa", "toledo", "tulsa", "tallahassee", "tempe", "torrance", "tacoma", "thornton", "tustin",
    "texas city", "tallahassee", "the woodlands", "thousand oaks", "trenton", "toms river", "temecula", "topeka", "tucson", "tampa",
    "utica", "upland", "university city", "union city", "urbana", "upstate", "vallejo", "vancouver", "visalia", "virginia beach",
    "vero beach", "victorville", "valdosta", "vicksburg", "vail", "vacaville", "venice", "vancouver", "van nuys", "vicksburg",
    "wilmington", "washington", "worcester", "wichita", "west palm beach", "west covina", "wilmington", "waco", "waterloo", "westlake",
    "west hollywood", "woodbridge", "waukesha", "westland", "wayne", "wilmington", "wellington", "woodland", "woodbury", "westfield",
    "yonkers", "yuba city", "yorba linda", "yakima", "ypsilanti", "yuma", "youngstown", "zanesville", "zion", "zebulon",
    "zion", "zephyrhills", "zachary", "zanesville", "zavalla", "zebulon", "zion", "zionsville", "zapato", "zanesville",
    "zion", "zamora", "zia", "zuni", "zia", "zigler", "zachary", "zaragoza", "zedekiah", "zebulon"

                ,'developer', 'designer', 'engineer', 'manager', 'director', 'analyst', 'sales', 'marketing', 'HR', 'consultant', 'administrator', 'architect', 'specialist', 'assistant', 'technician', 'leader', 'executive',
                // Tech and IT
                'software engineer', 'frontend developer', 'backend developer', 'full-stack developer', 'data scientist', 'data analyst', 'web developer', 'mobile developer', 'app developer', 'cloud engineer', 'network administrator', 'systems architect', 'devops engineer', 'QA engineer', 'UI/UX designer', 'database administrator',
                
                // Business and Management
                'business analyst', 'project manager', 'product manager', 'operations manager', 'business consultant', 'supply chain manager', 'strategic planner', 'account manager', 'brand manager', 'team lead', 'program manager', 'sales manager', 'customer success manager',
                
                // Marketing and Sales
                'marketing manager', 'digital marketing strategist', 'SEO specialist', 'content marketer', 'sales representative', 'sales associate', 'inside sales', 'account executive', 'business development manager', 'social media manager', 'marketing director', 'growth hacker', 'advertising manager', 'media planner',
                
                // Finance and Accounting
                'financial analyst', 'accountant', 'financial advisor', 'tax consultant', 'auditor', 'controller', 'treasury manager', 'investment banker', 'credit analyst', 'portfolio manager', 'financial planner', 'risk manager', 'compliance officer',
                
                // Healthcare
                'nurse', 'doctor', 'surgeon', 'therapist', 'dentist', 'healthcare administrator', 'pharmacist', 'medical assistant', 'radiologist', 'physician assistant', 'nurse practitioner', 'health insurance agent',
                
                // Legal
                'lawyer', 'attorney', 'paralegal', 'legal consultant', 'judge', 'legal assistant', 'corporate lawyer', 'litigation attorney', 'contract manager', 'compliance officer', 'legal advisor',
                
                // Education
                'teacher', 'professor', 'education coordinator', 'principal', 'academic advisor', 'special education teacher', 'teaching assistant', 'school administrator', 'counselor', 'tutor',
                
                // Creative Arts
                'graphic designer', 'photographer', 'videographer', 'content creator', 'illustrator', 'animator', 'art director', 'fashion designer', 'music producer', 'editor', 'screenwriter', 'copywriter', 'web designer', '3D artist',
                
                // Customer Service
                'customer service representative', 'call center agent', 'support specialist', 'customer care agent', 'help desk technician', 'account coordinator', 'service manager', 'technical support specialist',
                
                // Human Resources
                'HR manager', 'recruiter', 'talent acquisition specialist', 'HR assistant', 'HR coordinator', 'HR business partner', 'compensation and benefits specialist', 'employee relations manager', 'HR director', 'training manager',
                
                // Manufacturing and Engineering
                'production manager', 'manufacturing engineer', 'quality control manager', 'plant manager', 'assembly line worker', 'machinist', 'mechanical engineer', 'electrical engineer', 'civil engineer', 'process engineer',
                
                // Retail and Hospitality
                'store manager', 'cashier', 'sales associate', 'barista', 'chef', 'waiter', 'hotel manager', 'housekeeper', 'concierge', 'event planner', 'bartender', 'restaurant manager', 'retail assistant',
                
                // Science and Research
                'research scientist', 'biologist', 'chemist', 'physicist', 'lab technician', 'medical researcher', 'clinical trial manager', 'environmental scientist', 'data scientist', 'geologist', 'statistician',
                
                // Logistics and Transportation
                'logistics coordinator', 'supply chain analyst', 'truck driver', 'forklift operator', 'shipping coordinator', 'warehouse manager', 'delivery driver', 'logistics manager', 'transportation planner', 'inventory manager',
                
                // Real Estate
                'real estate agent', 'real estate broker', 'property manager', 'real estate consultant', 'leasing agent', 'mortgage broker', 'real estate analyst', 'real estate developer', 'construction manager',
                
                // IT Support
                'IT support specialist', 'help desk technician', 'network support', 'technical support engineer', 'systems administrator', 'IT coordinator', 'IT manager', 'IT consultant',
                
                // Other Miscellaneous
                'event coordinator', 'security officer', 'facility manager', 'driver', 'chef', 'personal assistant', 'delivery manager', 'receptionist', 'janitor', 'event planner', 'office manager', 'project coordinator'
            ];

// Global variable to track whether the process is running
let isProcessing = false;
let processTimeout;

// Function to automate querying and clicking "selectAll"
function queryAndClick(valuesArray) {
    let index = 0;

    async function processNext() {
        if (!isProcessing) {
            showToast("Process stopped.");
            return; // Exit if process is stopped
        }

        if (index >= valuesArray.length) {
            showToast("All values processed.");
            return; // Exit if we've processed all values
        }

        const queryInput = document.getElementById("query"); // Target query input field
const selectAllButton = document.getElementById("selectAll"); // Target button to click
const addJobButton = document.getElementById("addJobButton"); // Target button to click for adding jobs

if (queryInput && selectAllButton && addJobButton) {
    const queryValue = valuesArray[index];

    // Set query input value to one of the elements from the array (state, city, or occupation)
    queryInput.value = queryValue;
    showToast(`Processing: ${queryValue}`);

    // Run fetchJobs() to retrieve the jobs (assuming this function is defined elsewhere)
    await fetchJobs(queryValue); // Assuming fetchJobs takes the query value and processes it

    // Wait for 5 seconds before clicking selectAll button
    setTimeout(() => {
        // If the selectAll button is already checked, click it twice
        if (selectAllButton.checked) {
            selectAllButton.click(); // Click once
            setTimeout(() => {
                selectAllButton.click(); // Click again after a short delay
            }, 500); // Delay before clicking again
        } else {
            selectAllButton.click(); // Click the "selectAll" button if it's not already checked
        }

        // Wait for another 5 seconds before clicking the addJobButton
        setTimeout(() => {
            addJobButton.click(); // Click the "addJobButton" to add the jobs
            index++; // Increment index for the next value in the array

            // Process the next value after a 5-second delay
            setTimeout(() => {
                processNext();
            }, 5000);
        }, 5000);
    }, 5000);


        } else {
            showToast("Required elements not found: Check 'query' input, 'selectAll' button, and 'addJobButton' IDs.");
        }
    }

    processNext(); // Start processing
}


// Start button handler
document.getElementById("startButton").addEventListener("click", () => {
    if (isProcessing) return; // Prevent starting if already processing
    isProcessing = true;
    document.getElementById("stopButton").disabled = false; // Enable stop button
    queryAndClick(values);
});

// Stop button handler
document.getElementById("stopButton").addEventListener("click", () => {
    isProcessing = false;
    document.getElementById("stopButton").disabled = true; // Disable stop button after stopping
    clearTimeout(processTimeout); // Clear the timeout to stop the process
    showToast("Process stopped manually.");
});



let TotalJobsAdded = 0;






        // Add Selected Jobs  window.addSelectedJobs = addSelectedJobs;
        async function addSelectedJobs() {
    const selectedJobs = document.querySelectorAll(".job-item.selected");
    if (selectedJobs.length === 0) {
        showToast("No jobs selected.", true);
        return;
    }

    const batch = writeBatch(db);  // Initialize batch operation
    let count = 0;

    selectedJobs.forEach((jobRow) => {
        let job = null;

        // Safely parse JSON and skip on error
        try {
            const jobData = jobRow.querySelector('input[type="hidden"]').value;
            job = JSON.parse(decodeURIComponent(jobData));
        } catch (error) {
            console.error("Invalid job data, skipping:", error);
            return; // Skip this job and continue to the next
        }

        const jobRef = collection(db, "Jobs");  // Reference to the Jobs collection

        // Searchable Title
        const searchableTitle = job.title
            .toLowerCase()
            .replace(/[^a-z0-9\s]/g, "")  // Remove special characters
            .split(" ")  // Split into words
            .filter(Boolean);  // Remove empty strings

        // Process Tags
        let tags = job.category && job.category.tag
            ? job.category.tag.split('-').map(word => word.trim())
            : [];

        const searchableTags = tags
            .map(tag => tag.toLowerCase())           // Convert each tag to lowercase
            .map(tag => tag.replace(/[^a-z0-9\s]/g, "")) // Remove special characters
            .filter(Boolean);  // Ensure no empty strings in the array

        function cleanCategory(category) {
            if (!category) return '';
            let parts = category.split('-');
            let result = parts.join('-');
            if (result.endsWith('-jobs')) result = result.slice(0, -5);
            else if (result.endsWith('jobs')) result = result.slice(0, -4);
            return result;
        }

        // Adding job data to batch with auto-generated document ID
        const newJobRef = doc(collection(db, 'Jobs'));  // Firestore will generate the doc ID

        batch.set(newJobRef, {
            title: (job.title || '').toLowerCase(),
            searchableTitle: searchableTitle,
            recrecruiterID: '',
            company: job.company.display_name || "N/A",
            description: job.description || '',
            location: job.location.area || '',
            city: parseCityFromLocationNew(job.location.display_name) || '',
            county: parseStateFromLocation(job.location.display_name) || '',
            state: job.location.area[1] || '',
            country: job.location.area[0] || 'US',
            type: job.contract_time || 'Full-time',
            salaryMin: parseFloat(job.salary_min) || 0,
            salaryMax: parseFloat(job.salary_max) || 0,
            salary: (parseFloat(job.salary_min) + parseFloat(job.salary_max)) / 2 || 0,
            contractToHire: 'No',
            immediateHire: 'No',
            industry: '',
            category: cleanCategory(job.category.label) || '',
            benefits: [],
            tags: searchableTags || '',
            boosted: "None",
            boostExpiration: "None",
            boostExpiresAt: "None",
            boostedByID: "None",
            status: "active",
            createdAt: new Date(job.created),
            applicantsViewed: 0,
            savedForLater: 0,
            applicationWebsite: job.redirect_url || '',
            applicationAvailableBool: false,
            submittedBy: "Adzuna",
            searchableRequirements: ''
        });

        count++;  // Increment the count for successful jobs processed
    });

    // Commit the batch operation after processing all jobs
    await batch.commit();
    showToast(`${count} jobs added successfully.`);

    TotalJobsAdded += count;
   document.getElementById("TotalJobsAdded").innerText = `Total Jobs Added: ${TotalJobsAdded}`;

}


        const addJobButton = document.getElementById("addJobButton");
    addJobButton.addEventListener("click", () => {
        addSelectedJobs()
    });


    });



    
        // Add Job (simplified)
        function addJob(jobId) {
            console.log(`Job ID: ${jobId} has been added.`);
        }





    </script>
</body>
