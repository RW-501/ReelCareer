<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Helper</title>
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Scroll-up button */
        #scrollUpBtn {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 30px;
            z-index: 99;
            font-size: 18px;
            border: none;
            outline: none;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            padding: 15px;
            border-radius: 50%;
        }
        #scrollUpBtn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center">SEO Helper Tool</h1>
        <div class="text-center mb-4">
            <button id="startButton" class="btn btn-primary">Start SEO Check</button>
        </div>
        <h4 id="pageCount" class="text-center"></h4>
        <div id="seo-container"></div>
    </div>

    <!-- Scroll-up button -->
    <button id="scrollUpBtn" onclick="scrollToTop()">⬆</button>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        let pageCount = 0; // Variable to keep track of the number of pages checked

        // Function to get internal links
        function getInternalLinks() {
            const allLinks = document.querySelectorAll('a');  // Select all anchor tags
            const internalLinks = [];
            const currentDomain = window.location.hostname;   // Get the current domain name

            allLinks.forEach(link => {
                const linkHostname = new URL(link.href).hostname;  // Extract hostname from the link
                if (linkHostname === currentDomain && link.href !== '' && link.href !== '#') {
                    internalLinks.push(link.href);  // Add the internal link to the array
                }
            });

            return internalLinks;  // Return the array of internal links
        }

        // Check if a link resolves and return the status
        async function checkLinkStatus(url) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                return response.status; // Return the HTTP status code
            } catch (error) {
                console.error(`Error fetching ${url}:`, error);
                return null; // Return null if there's an error
            }
        }

        // Fetch title, meta tags, and check for Schema Markup for each internal link
        async function fetchPageSEOData(url) {
            try {
                const response = await fetch(url);
                const text = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                
                // Get title
                const title = doc.querySelector('title') ? doc.querySelector('title').innerText : 'No title found';
                
                // Get meta tags
                const metaTags = Array.from(doc.querySelectorAll('meta')).map(meta => {
                    return `${meta.getAttribute('name') || meta.getAttribute('property')}: ${meta.getAttribute('content')}`;
                }).join('\n');

                // Check for Schema Markup
                const hasSchema = doc.querySelector('script[type="application/ld+json"]') !== null;

                return { title, metaTags, hasSchema };
            } catch (error) {
                console.error(`Failed to fetch SEO data for ${url}:`, error);
                return { title: 'Error fetching title', metaTags: 'Error fetching meta tags', hasSchema: false };
            }
        }

        // Create a form for SEO details
        async function createSEOForm(url) {
            const seoData = await fetchPageSEOData(url);
            const statusCode = await checkLinkStatus(url); // Get the link status code

            const container = document.getElementById('seo-container');
            const cardDiv = document.createElement('div');
            cardDiv.classList.add('card', 'mb-3');

            const collapsible = document.createElement('div');
            collapsible.classList.add('card-header', 'd-flex', 'justify-content-between', 'align-items-center', 'cursor-pointer');
            collapsible.textContent = `SEO Details for ${url}`;
            const toggleIcon = document.createElement('span');
            toggleIcon.textContent = '▼';
            collapsible.appendChild(toggleIcon);
            cardDiv.appendChild(collapsible);

            const contentDiv = document.createElement('div');
            contentDiv.classList.add('collapse');
            const cardBody = document.createElement('div');
            cardBody.classList.add('card-body');

            // Title
            const titleLabel = document.createElement('label');
            titleLabel.textContent = `Title for ${url}:`;
            const titleInput = document.createElement('input');
            titleInput.type = 'text';
            titleInput.classList.add('form-control');
            titleInput.value = seoData.title;

            // Meta Tags
            const metaLabel = document.createElement('label');
            metaLabel.textContent = `Meta Tags for ${url}:`;
            const metaTextarea = document.createElement('textarea');
            metaTextarea.rows = 5;
            metaTextarea.classList.add('form-control');
            metaTextarea.value = seoData.metaTags;

            // URL
            const urlParagraph = document.createElement('p');
            urlParagraph.textContent = `Page URL: ${url}`;
            urlParagraph.classList.add('mt-2');

            // Status
            const statusParagraph = document.createElement('p');
            statusParagraph.textContent = `Status: ${statusCode === 200 ? 'OK' : statusCode === 404 ? 'Broken Link' : 'Error fetching status'}`;
            statusParagraph.classList.add('mt-2', statusCode === 200 ? 'text-success' : 'text-danger');

            // Schema Markup
            const schemaParagraph = document.createElement('p');
            schemaParagraph.textContent = `Schema Markup: ${seoData.hasSchema ? 'Present' : 'Not Present'}`;
            schemaParagraph.classList.add('mt-2', seoData.hasSchema ? 'text-success' : 'text-danger');

            // Append elements to the card body
            cardBody.appendChild(titleLabel);
            cardBody.appendChild(titleInput);
            cardBody.appendChild(metaLabel);
            cardBody.appendChild(metaTextarea);
            cardBody.appendChild(urlParagraph);
            cardBody.appendChild(statusParagraph);
            cardBody.appendChild(schemaParagraph);
            contentDiv.appendChild(cardBody);
            cardDiv.appendChild(contentDiv);

            container.appendChild(cardDiv);

            // Collapsible functionality
            collapsible.addEventListener('click', function() {
                contentDiv.classList.toggle('show');
                toggleIcon.textContent = toggleIcon.textContent === '▼' ? '▲' : '▼';
            });

            pageCount++; // Increment the page count
            document.getElementById('pageCount').textContent = `Pages Checked: ${pageCount}`; // Update the page count display
        }

        // Main function to populate SEO data
        async function populateSEOHelper() {
            const internalLinks = getInternalLinks();
            for (const link of internalLinks) {
                await createSEOForm(link);
            }
        }

        // Start button functionality
        document.getElementById('startButton').addEventListener('click', function() {
            pageCount = 0; // Reset the page count
            document.getElementById('seo-container').innerHTML = ''; // Clear previous results
            populateSEOHelper(); // Start the SEO check
        });

        // Scroll-up button functionality
        const scrollUpBtn = document.getElementById('scrollUpBtn');
        window.onscroll = function() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                scrollUpBtn.style.display = 'block';
            } else {
                scrollUpBtn.style.display = 'none';
            }
        };

        function scrollToTop() {
            document.body.scrollTop = 0;
            document.documentElement.scrollTop = 0;
        }
    </script>
    <!-- Footer -->
    <footer id="dynamic-footer"></footer>
    <!-- Firebase configuration/ Login& Out -->
    <script type="module" src="../public/js/main.js"></script> 
</body>
</html>
