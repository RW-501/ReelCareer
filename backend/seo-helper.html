<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Helper</title>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f9f9f9;
            color: #333;
        }
        main   h1, h4 {
            color: #007bff;
        }
        main   .container {
            padding: 20px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        main  .btn {
            border-radius: 25px;
            padding: 10px 20px;
            transition: background-color 0.3s;
        }

        main      .btn {
    transition: background-color 0.3s, transform 0.2s;
}
.btn:hover {
    background-color: #0056b3; /* Darker shade */
    transform: translateY(-2px); /* Lift effect */
}

        .card {
            border: none;
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.2s;
        }
        .card:hover {
            transform: scale(1.01);
        }
        
        .card {
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    transition: box-shadow 0.3s;
}
.card:hover {
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
}


main   .dropdown-menu {
            max-height: 300px;
            overflow-y: auto;
        }
        /* Scroll-up button */
        #scrollUpBtn {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 30px;
            z-index: 99;
            font-size: 18px;
            border: none;
            outline: none;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            padding: 15px;
            border-radius: 50%;
        }
        #scrollUpBtn:hover {
            background-color: #0056b3;
        }
        /* Progress bar */
        #progressBar {
            height: 20px;
        }
        #progressBar {
    background: linear-gradient(to right, #4caf50, #81c784);
}



        @media (max-width: 768px) {
    .card-body {
        font-size: 14px; /* Smaller font for mobile */
    }
}



#seo-container {
    max-height: 400px; /* Set a maximum height */
    overflow-y: auto;  /* Enable vertical scrolling */
    overflow-x: hidden; /* Disable horizontal scrolling if desired */
    border: 1px solid #ccc; /* Optional: Add a border for visibility */
    padding: 10px; /* Optional: Add padding for better aesthetics */
    background-color: #f9f9f9; /* Optional: Set a background color */
}







    </style>

    
<script src="../public/js/scripts.js"></script>
<script src="../public/js/loadScripts.js"></script>
<link rel="stylesheet" href="../public/css/styles.css">

</head>


<body>
    <script src="../public/js/bodyload.js"></script>
    
    <nav2 class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Reelcareer Admin</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                <li class="nav-item"><a class="nav-link" href="user-management.html">User Management</a></li>
                <li class="nav-item"><a class="nav-link" href="job-management.html">Job Management</a></li>
                <li class="nav-item"><a class="nav-link" href="application-management.html">Application Management</a></li>
                <li class="nav-item"><a class="nav-link" href="content-management.html">Content Management</a></li>
                <li class="nav-item"><a class="nav-link" href="settings.html">Settings</a></li>
                <li class="nav-item"><a class="nav-link" href="analytics.html">Analytics</a></li>
                <li class="nav-item"><a class="nav-link" href="chatbot.html">Chatbot</a></li>
                <li class="nav-item"><a class="nav-link" href="support.html">Support</a></li>
            </ul>
        </div>
    </nav2>





    <main>
        <div class="container mt-4">
            <h1 class="text-center">SEO Helper Tool</h1>
          
            <div class="container mt-4">
                <h2>Check Internal Links</h2>
                <div class="input-group mb-3">
                    <input type="url" id="urlInput" class="form-control" placeholder="Enter a URL" aria-label="URL input" required>
                    <button id="startButton" class="btn btn-primary">Start</button>
                </div>
     </div>
    
            <h4 id="pageCount" class="text-center"></h4>
            <div id="progress-container" class="mt-4">
                <div class="progress">
                    <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>
    
            <div class="mt-5 form-control">
                <h4>Pages with Errors:</h4>
                <h4 id="errorCount" class="text-center text-danger">404 Count: 0</h4>
               
           <hr>
           <div  class="mt-5 form-control">
    
                <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" type="button" id="errorDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-bs-toggle="modal" data-bs-target="#errorModal">View Errors
                    </button>
                    <div class="dropdown-menu" id="errorList" aria-labelledby="errorDropdown"></div>
                </div>
            </div>
    
    
            </div>
            <hr>
    
            <div id="seo-container" class="mt-5 form-control-lg">
                <!-- Your content goes here -->
            </div>
            
        </div>
    </main>


    
<!-- Modal for Detailed Error Reporting -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="errorModalLabel">404 Error Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul id="errorListModal" class="list-group"></ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

    <!-- Scroll-up button -->
    <button id="scrollUpBtn" onclick="scrollToTop()">â¬†</button>
  <!-- Footer -->
  <footer id="dynamic-footer"></footer>
    <!-- Firebase configuration/ Login & Out -->
    <script type="module" src="../public/js/main.js"></script>


    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        let pageCount = 0; // Variable to keep track of the number of pages checked
        let totalPages = 0; // Total pages to check
        let errorPages = []; // Array to keep track of pages with errors

        let errorCount = 0; // Initialize a count for 404 errors
let errorUrls = []; // Array to keep track of URLs with 404 errors



/*
// Start checking pages when the button is clicked
document.getElementById('startButton').addEventListener('click', () => {
    // Sample array of URLs to check
    const urlsToCheck = [
        'https://example.com/page1',
        'https://example.com/page2',
        // Add more URLs here
    ];
    errorCount = 0; // Reset error count
    errorUrls = []; // Reset error URLs
    updateErrorCount(); // Update count display
    document.getElementById('errorList').innerHTML = ''; // Clear previous errors


    urlsToCheck.forEach(url => getInternalLinks(url));
});
*/

// Function to open the error modal and populate it with URLs
function openErrorModal() {
    const errorListModal = document.getElementById('errorListModal');
    errorListModal.innerHTML = ''; // Clear previous error list

    errorUrls.forEach(url => {
        const listItem = document.createElement('li');
        listItem.classList.add('list-group-item');
        listItem.textContent = url; // Display URL
        errorListModal.appendChild(listItem);
    });
}

// Function to show "Bad" on the collapsible button
function showBadOnCollapseButton() {
    const dropdownToggle = document.getElementById('errorDropdown');
    dropdownToggle.innerText = 'Bad';
    dropdownToggle.classList.add('btn-danger'); // Optional: Change button color
}

// Function to update the 404 count in the UI
function updateErrorCount() {
    document.getElementById('errorCount').innerText = `404 Count: ${errorCount}`;
}

        // Function to get internal links
        function getInternalLinks(currentDomain) {
            console.log("currentDomain   ",currentDomain);
            console.log("window.location.hostname   ",window.location.hostname);

            const allLinks = document.querySelectorAll('a');  // Select all anchor tags
            const internalLinks = [];
          //  const currentDomain = window.location.hostname;   // Get the current domain name
          //  const currentDomain = "https://reelcareer.co/";   // Get the current domain name

            allLinks.forEach(link => {
                const linkHostname = new URL(link.href).hostname;  // Extract hostname from the link
                if (linkHostname === currentDomain && link.href !== '' && link.href !== '#') {
                    internalLinks.push(link.href);  // Add the internal link to the array
                }
            });

            return internalLinks;  // Return the array of internal links
        }

        // Check if a link resolves and return the status
        async function checkLinkStatus(url) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                if (response.status === 404) {
                    errorCount++;
                    errorUrls.push(url); // Add URL to errorUrls array                updateErrorCount();
                showBadOnCollapseButton(); // Function to update the button state
                return response.status; // Return the HTTP status code

            } else {
                // Handle other responses
            //   return response.status; // Return the HTTP status code

            }
            
            
            
            
            
            } catch (error) {
                console.error(`Error fetching ${url}:`, error);
                return null; // Return null if there's an error
            }
        }

        // Fetch title, meta tags, check for Schema Markup, and extract styles for each internal link
        async function fetchPageSEOData(url) {
            try {
                const response = await fetch(url);
                const text = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');

                // Get title
                const title = doc.querySelector('title') ? doc.querySelector('title').innerText : 'No title found';

                // Get meta tags
                const metaTags = Array.from(doc.querySelectorAll('meta')).map(meta => {
                    return `${meta.getAttribute('name') || meta.getAttribute('property')}: ${meta.getAttribute('content')}`;
                }).join('\n');

                // Check for Schema Markup
                const hasSchema = doc.querySelector('script[type="application/ld+json"]') !== null;

                // Get style tag contents
                const styleTags = Array.from(doc.querySelectorAll('style')).map(style => style.innerText).join('\n\n') || 'No style tags found';

                // Get word count
                const wordCount = text.split(/\s+/).filter(word => word.length > 0).length;

                // Get heading tags (H1, H2, etc.)
                const headings = {
                    H1: doc.querySelectorAll('h1').length,
                    H2: doc.querySelectorAll('h2').length,
                    H3: doc.querySelectorAll('h3').length,
                    H4: doc.querySelectorAll('h4').length,
                    H5: doc.querySelectorAll('h5').length,
                    H6: doc.querySelectorAll('h6').length
                };

                // Get image alt attributes
                const imgTags = Array.from(doc.querySelectorAll('img'));
                const imgAltAttributes = imgTags.map(img => ({
                    src: img.src,
                    alt: img.alt || 'No alt attribute'
                }));

                // Get canonical tags
                const canonicalTags = Array.from(doc.querySelectorAll('link[rel="canonical"]')).map(link => link.href);

                // Get Open Graph tags
                const ogTags = Array.from(doc.querySelectorAll('meta[property^="og:"]')).map(meta => ({
                    property: meta.getAttribute('property'),
                    content: meta.getAttribute('content')
                }));

                // Get Twitter Card tags
                const twitterTags = Array.from(doc.querySelectorAll('meta[name^="twitter:"]')).map(meta => ({
                    name: meta.getAttribute('name'),
                    content: meta.getAttribute('content')
                }));

                return {
                    title,
                    metaTags,
                    hasSchema,
                    styleTags,
                    wordCount,
                    headings,
                    imgAltAttributes,
                    canonicalTags,
                    ogTags,
                    twitterTags
                };
            } catch (error) {
                console.error(`Failed to fetch SEO data for ${url}:`, error);
                return {
                    title: 'Error fetching title',
                    metaTags: 'Error fetching meta tags',
                    hasSchema: false,
                    styleTags: 'Error fetching style tags',
                    wordCount: 0,
                    headings: {},
                    imgAltAttributes: [],
                    canonicalTags: [],
                    ogTags: [],
                    twitterTags: []
                };
            }
        }

        // Create a form for SEO details
        async function createSEOForm(url) {
            const seoData = await fetchPageSEOData(url);
            const statusCode = await checkLinkStatus(url); // Get the link status code

            const container = document.getElementById('seo-container');
            const cardDiv = document.createElement('div');
            cardDiv.classList.add('card', 'mb-3');

            const collapsible = document.createElement('div');
            collapsible.classList.add('card-header', 'd-flex', 'justify-content-between', 'align-items-center', 'cursor-pointer');
            collapsible.textContent = `SEO Details for ${url}`;
            const toggleIcon = document.createElement('span');
            toggleIcon.textContent = 'â–¼';
            collapsible.appendChild(toggleIcon);
            cardDiv.appendChild(collapsible);

            const contentDiv = document.createElement('div');
            contentDiv.classList.add('collapse');
            const cardBody = document.createElement('div');
            cardBody.classList.add('card-body');

            // Title
            const titleLabel = document.createElement('label');
            titleLabel.textContent = `Title for ${url}:`;
            const titleInput = document.createElement('input');
            titleInput.type = 'text';
            titleInput.classList.add('form-control');
            titleInput.value = seoData.title;

            // Meta Tags
            const metaLabel = document.createElement('label');
            metaLabel.textContent = `Meta Tags for ${url}:`;
            const metaTextarea = document.createElement('textarea');
            metaTextarea.rows = 5;
            metaTextarea.classList.add('form-control');
            metaTextarea.value = seoData.metaTags;

            // Style Tags
            const styleLabel = document.createElement('label');
            styleLabel.textContent = `Style Tags for ${url}:`;
            const styleTextarea = document.createElement('textarea');
            styleTextarea.rows = 10;
            styleTextarea.classList.add('form-control');
            styleTextarea.value = seoData.styleTags;

            // Word Count
            const wordCountLabel = document.createElement('label');
            wordCountLabel.textContent = `Word Count for ${url}: ${seoData.wordCount}`;

            // Heading Tags
            const headingLabel = document.createElement('label');
            headingLabel.textContent = `Heading Tags for ${url}:`;
            const headingsText = `H1: ${seoData.headings.H1}, H2: ${seoData.headings.H2}, H3: ${seoData.headings.H3}, H4: ${seoData.headings.H4}, H5: ${seoData.headings.H5}, H6: ${seoData.headings.H6}`;
            const headingsDiv = document.createElement('div');
            headingsDiv.textContent = headingsText;

            // Image Alt Attributes
            const imgAltLabel = document.createElement('label');
            imgAltLabel.textContent = `Image Alt Attributes for ${url}:`;
            const imgAltDiv = document.createElement('div');
            seoData.imgAltAttributes.forEach(img => {
                const imgAltText = document.createElement('div');
                imgAltText.textContent = `Image: ${img.src}, Alt: ${img.alt}`;
                imgAltDiv.appendChild(imgAltText);
            });

            // Canonical Tags
            const canonicalLabel = document.createElement('label');
            canonicalLabel.textContent = `Canonical Tags for ${url}:`;
            const canonicalDiv = document.createElement('div');
            seoData.canonicalTags.forEach(canonical => {
                const canonicalText = document.createElement('div');
                canonicalText.textContent = `Canonical: ${canonical}`;
                canonicalDiv.appendChild(canonicalText);
            });

            // Open Graph Tags
            const ogLabel = document.createElement('label');
            ogLabel.textContent = `Open Graph Tags for ${url}:`;
            const ogDiv = document.createElement('div');
            seoData.ogTags.forEach(og => {
                const ogText = document.createElement('div');
                ogText.textContent = `${og.property}: ${og.content}`;
                ogDiv.appendChild(ogText);
            });

            // Twitter Card Tags
            const twitterLabel = document.createElement('label');
            twitterLabel.textContent = `Twitter Card Tags for ${url}:`;
            const twitterDiv = document.createElement('div');
            seoData.twitterTags.forEach(twitter => {
                const twitterText = document.createElement('div');
                twitterText.textContent = `${twitter.name}: ${twitter.content}`;
                twitterDiv.appendChild(twitterText);
            });

            // Add elements to the card body
            cardBody.appendChild(titleLabel);
            cardBody.appendChild(titleInput);
            cardBody.appendChild(metaLabel);
            cardBody.appendChild(metaTextarea);
            cardBody.appendChild(styleLabel);
            cardBody.appendChild(styleTextarea);
            cardBody.appendChild(wordCountLabel);
            cardBody.appendChild(headingLabel);
            cardBody.appendChild(headingsDiv);
            cardBody.appendChild(imgAltLabel);
            cardBody.appendChild(imgAltDiv);
            cardBody.appendChild(canonicalLabel);
            cardBody.appendChild(canonicalDiv);
            cardBody.appendChild(ogLabel);
            cardBody.appendChild(ogDiv);
            cardBody.appendChild(twitterLabel);
            cardBody.appendChild(twitterDiv);

            contentDiv.appendChild(cardBody);
            cardDiv.appendChild(contentDiv);
            container.appendChild(cardDiv);

            // Update error pages
            if (statusCode !== 200) {
                errorPages.push(url); // Add the URL to errorPages array
                const errorItem = document.createElement('a');
                errorItem.classList.add('dropdown-item');
                errorItem.href = url;
                errorItem.textContent = `Error ${statusCode}: ${url}`;
                errorItem.target = "_blank"; // Open in a new tab
                document.getElementById('errorList').appendChild(errorItem);
            }

            pageCount++;
            updateProgressBar();
        }

        // Update the progress bar
        function updateProgressBar() {
            const progressBar = document.getElementById('progressBar');
            const progressPercentage = (pageCount / totalPages) * 100; // Calculate percentage
            progressBar.style.width = `${progressPercentage}%`; // Update progress bar width
            progressBar.setAttribute('aria-valuenow', progressPercentage); // Set aria-valuenow for accessibility
            document.getElementById('pageCount').innerText = `Checked ${pageCount} out of ${totalPages} pages.`;
        }

        // Main function to start checking pages
        async function startChecking(url) {
            const internalLinks = getInternalLinks(url);  // Get internal links from the page
            totalPages = internalLinks.length;  // Set total pages to check
            pageCount = 0;  // Reset page count
            errorPages = [];  // Reset error pages

            errorCount = 0; // Reset error count
        errorUrls = []; // Reset error URLs
        updateErrorCount(); // Update count display
  
        // Clear previous results
            document.getElementById('seo-container').innerHTML = '';
            document.getElementById('errorList').innerHTML = '';
            document.getElementById('progressBar').style.width = '0%'; // Reset progress bar

            // Check each link one by one
            for (const url of internalLinks) {
                await createSEOForm(url);
                await new Promise(resolve => setTimeout(resolve, 2000)); // Wait 2 seconds before checking the next page
            }
        }

        // Button click event
        document.getElementById('startButton').addEventListener('click', startChecking);

        // Scroll to top function
        window.onscroll = function() {
            const scrollUpBtn = document.getElementById("scrollUpBtn");
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                scrollUpBtn.style.display = "block";
            } else {
                scrollUpBtn.style.display = "none";
            }
        };

        function scrollToTop() {
            document.body.scrollTop = 0; // For Safari
            document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
        }

// Start checking the URL when the button is clicked
document.getElementById('startButton').addEventListener('click', () => {
    const url = document.getElementById('urlInput').value;
    if (url) {
        startChecking(url);
     } else {
        alert('Please enter a valid URL.');
    }
});

// Add event listener for modal opening
document.getElementById('errorDropdown').addEventListener('click', openErrorModal);
    </script>
</body>
</html>
