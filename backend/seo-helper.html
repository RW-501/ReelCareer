<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Helper</title>
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Scroll-up button */
        #scrollUpBtn {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 30px;
            z-index: 99;
            font-size: 18px;
            border: none;
            outline: none;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            padding: 15px;
            border-radius: 50%;
        }
        #scrollUpBtn:hover {
            background-color: #0056b3;
        }
    </style>

    <!-- Bootstrap CSS -->
    <script src="../public/js/scripts.js"></script>
    <script src="../public/js/loadScripts.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../public/css/styles.css">

</head>


<body>
    <script src="../public/js/bodyload.js"></script>
    

    <div class="container mt-4">
        <h1 class="text-center">SEO Helper Tool</h1>
        <div class="text-center mb-4">
            <button id="startButton" class="btn btn-primary">Start SEO Check</button>
        </div>
        <h4 id="pageCount" class="text-center"></h4>
        <div id="seo-container"></div>
    </div>

    <!-- Scroll-up button -->
    <button id="scrollUpBtn" onclick="scrollToTop()">⬆</button>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        let pageCount = 0; // Variable to keep track of the number of pages checked

        // Function to get internal links
        function getInternalLinks() {
            const allLinks = document.querySelectorAll('a');  // Select all anchor tags
            const internalLinks = [];
            const currentDomain = window.location.hostname;   // Get the current domain name

            allLinks.forEach(link => {
                const linkHostname = new URL(link.href).hostname;  // Extract hostname from the link
                if (linkHostname === currentDomain && link.href !== '' && link.href !== '#') {
                    internalLinks.push(link.href);  // Add the internal link to the array
                }
            });

            return internalLinks;  // Return the array of internal links
        }

        // Fetch title and meta tags for each internal link
        async function fetchPageSEOData(url) {
            try {
                const response = await fetch(url);
                const text = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                
                // Get title
                const title = doc.querySelector('title') ? doc.querySelector('title').innerText : 'No title found';
                
                // Get meta tags
                const metaTags = Array.from(doc.querySelectorAll('meta')).map(meta => {
                    return `${meta.getAttribute('name') || meta.getAttribute('property')}: ${meta.getAttribute('content')}`;
                }).join('\n');

                return { title, metaTags };
            } catch (error) {
                console.error(`Failed to fetch SEO data for ${url}:`, error);
                return { title: 'Error fetching title', metaTags: 'Error fetching meta tags' };
            }
        }

        // Create a form for SEO details
        function createSEOForm(url, title, metaTags) {
            const container = document.getElementById('seo-container');

            // Create a card for each SEO form
            const cardDiv = document.createElement('div');
            cardDiv.classList.add('card', 'mb-3');

            // Create a collapsible button
            const collapsible = document.createElement('div');
            collapsible.classList.add('card-header', 'd-flex', 'justify-content-between', 'align-items-center', 'cursor-pointer');
            collapsible.textContent = `SEO Details for ${url}`;
            const toggleIcon = document.createElement('span');
            toggleIcon.textContent = '▼';
            collapsible.appendChild(toggleIcon);
            cardDiv.appendChild(collapsible);

            // Create a collapsible content section
            const contentDiv = document.createElement('div');
            contentDiv.classList.add('collapse');
            const cardBody = document.createElement('div');
            cardBody.classList.add('card-body');

            // Create label and input for title
            const titleLabel = document.createElement('label');
            titleLabel.textContent = `Title for ${url}:`;
            const titleInput = document.createElement('input');
            titleInput.type = 'text';
            titleInput.classList.add('form-control');
            titleInput.value = title;

            // Create label and textarea for meta tags
            const metaLabel = document.createElement('label');
            metaLabel.textContent = `Meta Tags for ${url}:`;
            const metaTextarea = document.createElement('textarea');
            metaTextarea.rows = 5;
            metaTextarea.classList.add('form-control');
            metaTextarea.value = metaTags;

            // Create a paragraph to display the URL
            const urlParagraph = document.createElement('p');
            urlParagraph.textContent = `Page URL: ${url}`;
            urlParagraph.classList.add('mt-2');

            // Append elements to the card body
            cardBody.appendChild(titleLabel);
            cardBody.appendChild(titleInput);
            cardBody.appendChild(metaLabel);
            cardBody.appendChild(metaTextarea);
            cardBody.appendChild(urlParagraph);
            contentDiv.appendChild(cardBody);
            cardDiv.appendChild(contentDiv);

            // Append the card div to the container
            container.appendChild(cardDiv);

            // Collapsible functionality
            collapsible.addEventListener('click', function() {
                contentDiv.classList.toggle('show');
                toggleIcon.textContent = toggleIcon.textContent === '▼' ? '▲' : '▼';
            });

            pageCount++; // Increment the page count
            document.getElementById('pageCount').textContent = `Pages Checked: ${pageCount}`; // Update the page count display
        }

        // Main function to populate SEO data
        async function populateSEOHelper() {
            const internalLinks = getInternalLinks();
            for (const link of internalLinks) {
                const seoData = await fetchPageSEOData(link);
                createSEOForm(link, seoData.title, seoData.metaTags);
            }
        }

        // Start button functionality
        document.getElementById('startButton').addEventListener('click', function() {
            pageCount = 0; // Reset the page count
            document.getElementById('seo-container').innerHTML = ''; // Clear previous results
            populateSEOHelper(); // Start the SEO check
        });

        // Scroll-up button functionality
        const scrollUpBtn = document.getElementById('scrollUpBtn');
        window.onscroll = function() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                scrollUpBtn.style.display = 'block';
            } else {
                scrollUpBtn.style.display = 'none';
            }
        };

        function scrollToTop() {
            document.body.scrollTop = 0;
            document.documentElement.scrollTop = 0;
        }
    </script>
        <!-- Footer -->
        <footer id="dynamic-footer"></footer>
    
        <!-- Firebase configuration/ Login& Out -->
        <script type="module" src="../public/js/main.js"></script> 
    
        <!-- Dynamic Schema Markup -->
        <script type="module">
        import { db, storage, analytics, app  } from '../public/js/main.js'; // Adjust the path based on your structure
        import { query, where, orderBy, limit,  collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
        
    
        </script>
    
</body>
</html>
