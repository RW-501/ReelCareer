<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Your ReelCareer Account">
    <meta property="og:description" content="Manage your ReelCareer account. View your balance, request payouts, check transactions, and update your membership information.">
    <meta property="og:image" content="https://reelcareer.co/images/8pic_rc.png">
    <meta property="og:url" content="https://reelcareer.co/account">
    <meta property="og:type" content="website">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Your ReelCareer Account">
    <meta name="twitter:description" content="Manage your ReelCareer account. View your balance, request payouts, check transactions, and update your membership information.">
    <meta name="twitter:image" content="https://reelcareer.co/images/8pic_rc.png">
    <meta name="twitter:url" content="https://reelcareer.co/account">

    <!-- General Meta Tags -->
    <meta name="description" content="Access your ReelCareer account dashboard. Track your balance, manage membership, view transactions, and request payouts.">
    <meta name="keywords" content="account management, payout request, membership, balance, transactions, ReelCareer">
    <meta name="author" content="ReelCareer">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#ffffff">

    <!-- Canonical Tag for SEO -->
    <link rel="canonical" href="https://reelcareer.co/account">

    <!-- Standard Favicon -->
    <link rel="icon" type="image/x-icon" href="https://reelcareer.co/images/favicons/favicon.ico">

    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "url": "https://reelcareer.co/account",
      "name": "Your ReelCareer Account",
      "description": "Manage your ReelCareer account. View your balance, request payouts, check transactions, and update your membership information.",
      "author": {
        "@type": "Organization",
        "name": "ReelCareer",
        "url": "https://reelcareer.co/"
      },
      "publisher": {
        "@type": "Organization",
        "name": "ReelCareer",
        "url": "https://reelcareer.co/",
        "logo": {
          "@type": "ImageObject",
          "url": "https://reelcareer.co/images/8pic_rc.png",
          "width": 200,
          "height": 60
        }
      },
      "image": {
        "@type": "ImageObject",
        "url": "https://reelcareer.co/images/8pic_rc.png",
        "width": 1200,
        "height": 630
      }
    }
    </script>

    <title>Your ReelCareer Account | ReelCareer</title>
</head>


<!-- Main Script Loader -->
<script src="https://reelcareer.co/scripts/js/loader.js"></script>
<style>
  main {


    
    .content-card {
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
  }


#guestbook-list {
    overflow-y: auto;
    max-height: 500px;
}

#processPayoutArea {
    padding: 20px;

}


.action-btn {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    margin: auto;
  }
  .action-btn:hover {
    background-color: #0056b3;
  }

  .popup {
   
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1050;
    display: none;
    width: 100%;
    height: 100%;
    overflow: hidden;
    outline: 0;
    background-color: #9e9a9a82;
  }

.open {
  display: block;
}

.popup-content {
    position: absolute;
    display: grid;
    width: 90%;
    pointer-events: auto;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid rgba(0,0,0,.2);
    border-radius: .3rem;
    outline: 0;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    margin: 2rem auto;
    max-height: 500px;
    padding: 1rem;
    overflow-y: scroll;
    align-content: stretch;
    align-items: center;
    justify-items: stretch;
    gap: .5rem;
}

.popup-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.highlighted-amount {
  color: #28a745;
  font-weight: bold;
}
.button-group {
  display: flex;
  gap: 10px;
}

.btn {
  flex: 1;
  padding: 10px;
  cursor: pointer;
  border-radius: 4px;
}
.confirm-btn {
  color: white;
  border: none;
}
.cancel-btn {
  background: #dc3545;
  color: white;
  border: none;
}




.totalPayout {
    margin: 1rem auto;
}


.transaction-entry {
    background-color: #f3f3f3;
    padding: .5rem;
    border-radius: 10px;
    margin: 1.5rem;
}
.transaction-details p {

  margin-top: 0;
  margin-bottom: 0;
}



#profileComplete {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

#profileCompletionChart {
    width: 100%;
    max-width: 400px;
    margin-bottom: 20px;
}

#profileCompletionList {
    width: 100%;
    max-width: 400px;
    list-style-type: none;
    padding: 0;
}

#profileCompletionList li {
    margin: 8px 0;
    font-size: 16px;
}







}    
  </style>
  
</head>
<body>

  <!-- Navigation Bar -->
  <nav id="Main-Nav_bar" class="navbar navbar-expand-lg main-navbar-light shadow-sm sticky-top" role="navigation">
    <div class="container d-flex align-items-center justify-content-between">
      <!-- Logo -->
      <a class="navbar-brand embossed" id="MAIN-LOGO-Reel-Career" href="https://reelcareer.co/" aria-label="Go to home page">
        ReelCareer
      </a>

      <!-- Always-visible Icons -->
      <ul class="navbar-nav d-flex flex-row justify-content-center flex-grow-1" id="iconBar">
        
      <li class="nav-item mx-2">
        <a class="nav-link" href="https://reelcareer.co/job-listings" aria-label="Go to job listings page">
          <i class="fa fa-briefcase"></i>
        </a>
      </li>
      <li class="nav-item mx-2">
        <a class="nav-link" href="https://reelcareer.co/reels" aria-label="Go to reels page">
          <i class="fa fa-video"></i>
        </a>
      </li>
      <li class="nav-item mx-2">
        <a class="nav-link" href="https://reelcareer.co/views/membership" aria-label="Go to membership page">
          <i class="fa fa-user"></i>
        </a>
      </li>
      <li class="nav-item mx-2">
        <a class="nav-link" href="https://reelcareer.co/views/blogs" aria-label="Go to blogs page">
          <i class="fa fa-pencil-alt"></i>
        </a>
      </li>
      </ul>

      <!-- Auth Section -->
      <div id="authSection" class="d-flex align-items-center"><button class="btn btn-primary" id="loginButton">Login / Create Account</button></div>
    </div>
  </nav>



   <!-- Breadcrumb Section -->

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
      <li id="lastBreadcrumb_home" class="breadcrumb-item"><a href="https://reelcareer.co/">Home</a></li>
    <li class="breadcrumb-item active" aria-current="page">Account</li>
  </ol>
</nav>

    <!-- Main Content Section -->
    <main id="main-content">

      <section id="user-info-section" class="content-card">
        <h3>User Information</h3>
        <div id="user-main-info" class="flex-wrap">

        <div id="userMainInfo" class="account-card">
          <p id="user-name" class="user-detail"><strong>Name:</strong> <span>User Name</span></p>
          <p id="user-display-name" class="user-detail"><strong>Display Name:</strong> <span>Display Name</span></p>
          <p id="user-email" class="user-detail"><strong>Email:</strong> <span>user@example.com</span></p>
          <p id="user-phone" class="user-detail"><strong>Phone Number:</strong> <span>(123) 456-7890</span></p>
          <p id="user-ip-address" class="user-detail"><strong>IP Address:</strong> <span>000.000.0.1</span></p>
          <p id="user-verified" class="user-detail"><strong>Verified:</strong> <span>Yes</span></p>
          <div class="mb-3">
            <label for="userID-profile" class="form-label">User ID</label>
            <input type="text" class="form-control" id="userID-profile" disabled value="12345" aria-describedby="userIDHelp">
          </div>
          <p id="join-date" class="user-detail"><strong>Join Date:</strong> MM/DD/YYYY</p>
          <p id="loggedin-method" class="user-detail"><strong>Logged in with:</strong> <span>email</span></p>
          <p id="lastLogin-date" class="user-detail"><strong>Last Login:</strong> <span>MM/DD/YYYY</span></p>

          <p id="user-membershipType" class="user-detail"><strong>Membership Type:</strong> <span>Basic</span></p>
          <p id="user-membershipExpiryDate" class="user-detail"><strong>Membership Expiry:</strong><span>MM/DD/YYYY</span></p>
        </div>
        <div id="userMainInfoStats" class="account-card">

          <div id="profileComplete" style="width: 500px; height: auto; margin: auto;">
            <canvas id="profileCompletionChart" width="500" height="500"></canvas>
        
            <div id="profileCompletionList">
              <h5>Profile Completion Status</h5>
              <ul id="profile-completion-items">
                <!-- List of complete/incomplete fields will be inserted here -->
              </ul>
            </div>
          </div>
          

          </div>
        <button id="view-user-profile" class="btn action-btn" aria-label="Update User Profile">Update Profile</button>
      </section>
      
      
      <section id="membership-section" class="content-card">
        <h3>Membership</h3>
        <div class="account-card">
          <p id="user-membershipType" class="user-detail"><strong>Type:</strong> <span>Basic</span></p>
          <p id="user-membershipExpiryDate" class="user-detail"><strong>Expires:</strong><span>MM/DD/YYYY</span></p>
        </div>
        <button id="view-membership" class="btn action-btn" aria-label="Change Membership Plan">Change Membership</button>
      </section>
      
      <section id="payment-plan-section" class="content-card">
        <h3>Payment Plan</h3>
        <div class="account-card">
          <button id="payment-month-to-month" class="btn payment-option" aria-label="Select Monthly Plan">Monthly Plan</button>
          <button id="payment-yearly" class="btn payment-option" aria-label="Select Yearly Plan">Yearly Plan</button>
          <p id="user-membershipDuedate" class="user-detail"><strong>Due Date:</strong><span>MM/DD/YYYY</span></p>
          <p id="user-membershipTimeLeft" class="user-detail"><span>0</span><strong> Days Left</strong></p>

      
          <div id="payment-history" class="history-container" aria-live="polite">
            <!-- Payment history dynamically inserted here -->
          </div>
        </div>
        <button id="make-payment-btn" class="btn action-btn" aria-label="Make Payment">Make Payment</button>
      </section>
      
      <section id="referral-program-section" class="content-card">
        <h3>Referral Program</h3>
        <div class="account-card">
          <div class="referral-code-group">
            <input id="referral-code" class="referral-input" placeholder="Your referral code" aria-describedby="referralCodeHelp">
            <button id="copy-referral-code-btn" class="btn action-btn" aria-label="Copy Referral Code">Copy</button>
          </div>
          <p id="referrals-count" class="user-detail"><strong>Referrals Count:</strong> 0</p>
          <p id="referrals-earned" class="user-detail"><strong>Earned:</strong> $0</p>
          <p id="referrals-pending" hidden><strong>Pending:</strong> 0</p>
        </div>
        <button id="view-referral" class="btn action-btn" aria-label="View Referrals">View Referrals</button>
      </section>
      
      <section id="obituary-management-section" class="content-card">
        <h3>Obituary Management</h3>
        <div class="account-card">
          <p class="user-detail"><strong>Total Obituaries:</strong> <span id="total-Obituaries">0</span></p>
          <p class="user-detail"><strong>Total Gifts:</strong> <span id="total-Obituaries-gifts">0</span></p>
          <div id="user-Obituaries" class="history-container" aria-live="polite">
            <!-- Dynamic Obituaries history -->
          </div>
        </div>
        <button id="view-obituary-account" class="btn action-btn" aria-label="View Obituary Account">View Obituaries Account</button>
        <button id="view-create-obituary" class="btn action-btn" aria-label="Create New Obituary">Create New Obituary</button>
      </section>
      
      <section id="video-reels-management-section" class="content-card">
        <h3>Video Reels Management</h3>
        <div class="account-card">
          <p class="user-detail"><strong>Total Video Reels:</strong> <span id="total-video-reels">0</span></p>
          <p class="user-detail"><strong>Total Gifts:</strong> <span id="total-video-reel-gifts">0</span></p>
          <p class="user-detail"><strong>Total Views:</strong> <span id="total-video-reel-views">0</span></p>
          <p class="user-detail"><strong>Total Likes:</strong> <span id="total-video-reel-likes">0</span></p>
          <p class="user-detail"><strong>Total Video Resumes:</strong> <span id="total-video-resumes">0</span></p>
          <div id="user-video-reels" class="history-container" aria-live="polite">
            <!-- Dynamic Video Reels history -->
          </div>
        </div>
        <button id="view-video-reels-account" class="btn action-btn" aria-label="View Video Reels Account">View Video Reels Account</button>
        <button id="create-new-video-reel" class="btn action-btn" aria-label="Create New Video Reel">Create New Video Reel</button>
      </section>
      
      <section id="transactions-section" class="content-card">
        <h3>Transactions</h3>
        <div class="account-card">
          <p class="user-detail"><strong>Total Available for Payout:</strong> <span id="total-payout" class="highlighted-amount">$0.00</span></p>
          <div id="transactions-log" class="history-container" aria-live="polite">
            <!-- Transaction history dynamically inserted here -->
          </div>
          <p id="last-request-date" class="info-text"></p>
          <p id="request-note" class="info-text"></p>
          <label for="requested-amount" class="input-label" aria-describedby="requestedAmountHelp">Enter Amount to Request:</label>
          <input type="number" id="requested-amount" class="input-box" placeholder="Enter amount">
          <p class="info-text">* Minimum payout amount is $25.</p>
          <p class="info-text">* Payouts are available via Visa Gift Card through Amazon. Processing time is 2-3 business days.</p>
          <p class="info-text">* For more information on payout options, <a href="/u/payout" id="view-payout">view payout details</a>.</p>

          <button id="confirmPayout" class="btn action-btn confirm-btn" aria-label="Process Payout">Process Payout</button>
        </div>
      </section>
      
      <section id="notifications-section" class="content-card" hidden>
        <h3>Notifications</h3>
        <div id="notifications-toolbar">
          <button id="job-application-notifications" class="btn notification-btn" aria-label="Job Application Updates Notifications">Job Application Updates</button>
          <button id="new-job-listings-notifications" class="btn notification-btn" aria-label="New Job Listings Notifications">New Job Listings</button>
          <button id="membership-expiry-notifications" class="btn notification-btn" aria-label="Membership Expiry Reminder Notifications">Membership Expiry Reminder</button>
          <button id="gift-received-notifications" class="btn notification-btn" aria-label="Gift Notifications">Gifts Received</button>
          <button id="resume-views-notifications" class="btn notification-btn" aria-label="Resume Views and Insights Notifications">Resume Views and Insights</button>
          <button id="recommendations-notifications" class="btn notification-btn" aria-label="Recommendations and Suggestions Notifications">Recommendations and Suggestions</button>
          <button id="obituary-engagement-notifications" class="btn notification-btn" aria-label="Obituary Engagements Notifications">Obituary Engagements</button>
          <button id="reel-analytics-notifications" class="btn notification-btn" aria-label="Reel and Video Analytics Notifications">Reel and Video Analytics</button>
          <button id="payment-status-notifications" class="btn notification-btn" aria-label="Payment and Transaction Updates Notifications">Payment and Transaction Updates</button>
        </div>
      </section>
      
      <section id="help-section" class="content-card">
        <h3>Support</h3>
        <div id="support-area">
          <div class="div-group">
            <h5>Contact</h5>
            <a href="https://reelcareer.co/views/contact" title="Contact Us">Contact Us</a>
          </div>
      
          <div class="div-group">
            <h5>Bot</h5>
            <a href="https://reelcareer.co/bot" title="Chatbot Help and Information">Chatbot Support</a>
          </div>
      
          <div class="div-group">
            <h5>Support</h5>
            <a href="https://reelcareer.co/support" title="Customer Support">Customer Support</a>
          </div>
      
          <div class="div-group">
            <h5>Privacy</h5>
            <a href="https://reelcareer.co/views/privacy" title="Privacy Policy - How We Protect Your Data">Privacy Policy</a>
          </div>
      
          <div class="div-group">
            <h5>Terms</h5>
            <a href="https://reelcareer.co/views/terms" title="Terms of Use - Website User Agreement and Guidelines">Terms of Use</a>
          </div>
        </div>
      </section>
      
      <section id="faq-section" class="content-card">
        <h3>FAQs</h3>
        <div id="faqs-area">
          <!-- FAQ content dynamically inserted here -->
        </div>
      </section>
      
      <section id="danger-section" class="content-card">
        <h3>Danger Zone</h3>
        <div id="danger-area">
          <div class="div-group">
            <p><strong>Change Password</strong></p>
            <p class="warning-text">This option is unavailable for users logged in with Google or Facebook.</p>
            <label for="old-password" class="label">Old Password</label>
            <input type="password" id="old-password" class="form-control" placeholder="Enter old password" aria-describedby="oldPasswordHelp">
            <label for="new-password" class="label">New Password</label>
            <input type="password" id="new-password" class="form-control" placeholder="Enter new password" aria-describedby="newPasswordHelp">
            <button type="button" class="btn btn-danger" id="change-password-button" aria-label="Change Password">Change Password</button>
          </div>
          <div class="div-group">
            <p><strong>Reset Security Questions</strong></p>
            <p class="warning-text">Update your security questions for improved account recovery options.</p>
            <button type="button" class="btn btn-secondary" id="reset-security-questions" aria-label="Reset Security Questions">Reset Security Questions</button>
          </div>
          <div class="div-group">
            <p><strong>Delete Account</strong></p>
            <p class="warning-text">This action is permanent and cannot be undone.</p>
            <button type="button" class="btn btn-danger" id="delete-account" aria-label="Delete Account">Delete Account</button>
          </div>
        </div>
      </section>
      

      <div id="user-toolbar" class="toolbar">
        <!-- Toolbar buttons will be injected here -->
    </div>
    


















    
      </main>
      
      <script>



// Define the functions outside the listener
function updateUserProfile() {
  console.log('User profile update triggered');
  // Add logic for updating the user profile here
  window.location = "https://reelcareer.co/u/#settings"

}

function changeMembershipPlan() {
  console.log('Change membership plan triggered');
  // Add logic to change membership plan
  window.location = "https://reelcareer.co/views/membership"

}

function selectMonthlyPlan() {
  console.log('Monthly plan selected');
  // Add logic for selecting the monthly plan
}

function selectYearlyPlan() {
  console.log('Yearly plan selected');
  // Add logic for selecting the yearly plan
}

function makePayment() {
  console.log('Make payment triggered');
  // Add logic for making a payment
}

function copyReferralCode() {
  const referralCodeInput = document.getElementById('referral-code');
  referralCodeInput.select();
  document.execCommand('copy');
  console.log('Referral code copied');
}

function viewReferrals() {
  console.log('View referrals triggered');
  // Add logic for viewing referrals
  window.location = "https://reelcareer.co/referral/"
}

function viewObituaryAccount() {
  console.log('View obituary account triggered');
  // Add logic for viewing obituary account
  window.location = "https://reelcareer.co/obituaries/"

}

function createNewObituary() {
  console.log('Create new obituary triggered');
  // Add logic for creating a new obituary
  window.location = "https://reelcareer.co/obituaries/create"

}

function viewVideoReelsAccount() {
  console.log('View video reels account triggered');
  // Add logic for viewing video reels account
  window.location = "https://reelcareer.co/u/reels"

}

function createNewVideoReel() {
  console.log('Create new video reel triggered');
  // Add logic for creating a new video reel
  window.location = "https://reelcareer.co/u/create"

}


 

function jobApplicationNotifications() {
  console.log('Job application updates notifications triggered');
  // Add logic for job application updates notifications
}

function newJobListingsNotifications() {
  console.log('New job listings notifications triggered');
  // Add logic for new job listings notifications
}

function membershipExpiryNotifications() {
  console.log('Membership expiry reminder triggered');
  // Add logic for membership expiry reminder notifications
}

function giftNotifications() {
  console.log('Gift notifications triggered');
  // Add logic for gift notifications
}

function resumeViewsNotifications() {
  console.log('Resume views notifications triggered');
  // Add logic for resume views notifications
}

function recommendationsNotifications() {
  console.log('Recommendations notifications triggered');
  // Add logic for recommendations notifications
}

function obituaryEngagementNotifications() {
  console.log('Obituary engagement notifications triggered');
  // Add logic for obituary engagement notifications
}

function reelAnalyticsNotifications() {
  console.log('Reel and video analytics notifications triggered');
  // Add logic for reel and video analytics notifications
}

function paymentStatusNotifications() {
  console.log('Payment and transaction updates notifications triggered');
  // Add logic for payment and transaction updates notifications
}




      </script>


   <!-- Footer -->
   <footer id="dynamic-footer">
    <div class="footerMainContainer text-center">
    <p class="footerSocialMedia"></p>
    <nav class="footerNavContainer">
    
    <div class="footerNavItems">
    <h5>General</h5>
    <a href="/" title="ReelCareer - #1 Job Board - Find a job today">ReelCareer</a><a href="/views/about" title="About ReelCareer - Who We Are and Our Mission">About ReelCareer</a><a href="/views/contact" title="Contact ReelCareer - Get in Touch for Support and Inquiries">Contact Us</a><a href="/job-listings" title="Job Listings - Search and Apply for Job Openings">Job Listings</a><a href="/membership" title="Membership - Unlock Premium Features and Job Opportunities">Membership</a>
    </div>
    
    <div class="footerNavItems">
    <h5>Legal</h5>
    <a href="/views/privacy" title="Privacy Policy - How We Protect Your Data">Privacy Policy</a><a href="/views/terms" title="Terms of Use - Website User Agreement and Guidelines">Terms of Use</a>
    </div>
    
    <div class="footerNavItems">
    <h5>Content</h5>
    <a href="/views/blogs" title="ReelCareer Blog - Career Advice, News, and Insights">Blogs</a><a href="/views/news" title="ReelCareer News - Latest Updates and Industry Trends">News</a><a href="/views/Personality-&-Trait-Tests" title="Personality & Trait Tests - Discover Your Strengths and Work Style">Personality & Trait Tests</a><a href="/reels" title="Video Reels - Showcase Your Resume with a Personal Touch">Video Reels</a>
    </div>
    
    <div class="footerNavItems">
    <h5>Support</h5>
    <a href="/views/faq" title="Frequently Asked Questions - Get Answers to Common Queries">FAQs</a><a href="/bot" title="Chat Bot - Get Instant Assistance with Your Job Search">Chat Bot</a><a href="/support" title="Support - Get Help with Your Job Search and Account">Support</a>
    </div>
    
    <div class="footerNavItems">
    <h5>Marketing</h5>
    <a href="/views/referral" title="Join the ReelCareer Affiliate Program and Earn Rewards">Affiliate Program</a>
    </div>
    
    <div class="footerNavItems">
    <h5>Admin</h5>
    <a href="/backend/dashboard" title="Admin Dashboard - Manage Users, Jobs, and Content">Admin</a>
    </div>
    
    <div class="footerNavItems">
    <h5>Features</h5>
    <a href="/jobs/city" title="City Jobs - Find Career Opportunities by Location">City Jobs</a><a href="/jobs/state" title="State Jobs - Explore Job Listings by State">State Jobs</a><a href="/jobs/locations" title="Job Locations - Browse Jobs in Your Area">Job Locations</a>
    </div>
    </nav>
    <p class="footerCopyWrite">© 2024 ReelCareer</p>
    
    </div>
    <button id="backToTop" title="Go to top">↑</button>
    
    </footer>
    
    
    
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script> <!-- For fetching IP -->

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    

        <!-- Include Firebase SDK as a module -->
<script type="module">
    import {
        db, getStorage, ref, uploadBytes, getDownloadURL, limit,
  doc, arrayUnion, RecaptchaVerifier, increment, getDoc, arrayRemove, signInWithPhoneNumber,
  query, updateDoc, setDoc, addDoc, signInAnonymously, orderBy, onAuthStateChanged,
  uploadBytesResumable, signInWithPopup, FacebookAuthProvider, GoogleAuthProvider, startAfter,
  OAuthProvider, signOut, deleteDoc, getFirestore, serverTimestamp,
  createUserWithEmailAndPassword, signInWithEmailAndPassword, deleteObject,
  where, getDocs, storage, getAuth, collection, auth, analytics,
  googleProvider,onSnapshot , linkWithCredential, EmailAuthProvider ,
  getUserId // Export the function
    } from 'https://reelcareer.co/scripts/js/load/module.js';

    
        // Listen for authentication state changes to get the user ID
        let userID = '';
        let pageID = '';
        let pageName = '';
        document.addEventListener('DOMContentLoaded', async () => {
    try {
        let userID = await getUserId(); // Await inside the function to ensure the user ID is fetched
        console.log("User ID fetched during DOMContentLoaded:", userID);

        if (!userID || userID.trim() === "") {
            const userDataSaved = getUserData() || []; // Assume getUserData() fetches stored user data
            if (userDataSaved.length > 0) {
                const user = userDataSaved[0];
                userID = user.uid; // Retrieve the userID from the saved user object
                console.log("Retrieved User ID from stored data:", userID);
                populateUserInfo(userID); // Populate user info based on userID
            } else {
                console.warn('No user data found in storage.');
                return;
            }
        } else {
            populateUserInfo(userID); // Directly populate user info if userID is valid
        }
    } catch (error) {
        console.error("Error checking page ownership:", error);
    }
});

        // Fetch user's IP address using an external service
        async function getUserIP() {
            try {
                const response = await axios.get('https://api.ipify.org?format=json');
                return response.data.ip;
            } catch (error) {
                console.error('Error fetching IP address:', error);
                return 'Unknown IP';
            }
        }



// Utility: Format Timestamp
function formatTimestamp(timestamp) {
  if (!timestamp || typeof timestamp.seconds !== 'number' || typeof timestamp.nanoseconds !== 'number') {
    console.error('Invalid timestamp format:', timestamp);
    return 'Invalid date';  // Graceful fallback if timestamp is incorrect
  }

  // Convert Firebase Timestamp to milliseconds
  const date = new Date(timestamp.seconds * 1000 + Math.floor(timestamp.nanoseconds / 1e6));

  // Format the date as MM/DD/YYYY
  return `${date.getMonth() + 1}/${date.getDate()}/${date.getFullYear()}`;
}



// Function to fetch and populate dynamic info
async function populateUserInfo(userId) {
    try {
        const userDocRef = doc(db, 'Users', userId);
        const userDoc = await getDoc(userDocRef);

        if (userDoc.exists()) {
            const userData = userDoc.data();
            console.log("userData", userData);

            // Populate user details (existing code)
            document.getElementById('user-name').querySelector('span').textContent = userData.name || 'N/A';
            document.getElementById('user-display-name').querySelector('span').textContent = userData.displayName || 'N/A';
            document.getElementById('user-email').querySelector('span').textContent = userData.email || 'N/A';
            document.getElementById('user-phone').querySelector('span').textContent = userData.phoneNumber || 'N/A';
            document.getElementById('user-ip-address').querySelector('span').textContent = userData.ipAddress || 'N/A';
            document.getElementById('user-verified').querySelector('span').textContent = userData.verified ? 'Yes' : 'No';
            document.getElementById('join-date').textContent = `Join Date: ${formatTimestamp(userData.joinDate) || 'MM/DD/YYYY'}`;
            document.getElementById('loggedin-method').querySelector('span').textContent = userData.loginMethod || 'email';
            document.getElementById('lastLogin-date').querySelector('span').textContent = formatTimestamp(userData.lastLogin) || 'MM/DD/YYYY';
            document.getElementById('user-membershipType').querySelector('span').textContent = userData.membershipType || 'Basic';
            document.getElementById('user-membershipExpiryDate').querySelector('span').textContent = formatTimestamp(userData.membershipExpiry) || 'MM/DD/YYYY';

            // Define the profile fields and their status
            const profileFields = [
                { field: 'name', label: 'Name' },
                { field: 'displayName', label: 'Display Name' },
                { field: 'email', label: 'Email' },
                { field: 'phoneNumber', label: 'Phone Number' },
                { field: 'ipAddress', label: 'IP Address' },
                { field: 'verified', label: 'Verified' },
                { field: 'joinDate', label: 'Join Date' },
                { field: 'loginMethod', label: 'Login Method' },
                { field: 'lastLogin', label: 'Last Login' },
                { field: 'membershipType', label: 'Membership Type' },
                { field: 'membershipExpiry', label: 'Membership Expiry Date' }
            ];

            // Count completed fields
            let completedFields = 0;
            profileFields.forEach(field => {
                if (userData[field.field]) completedFields++;
            });

            // Calculate the profile completion percentage
            const totalFields = profileFields.length;
            const profileCompletionPercentage = Math.round((completedFields / totalFields) * 100);

            // Render the pie chart
            const ctx = document.getElementById('profileCompletionChart').getContext('2d');
const profileCompletionChart = new Chart(ctx, {
    type: 'pie',
    data: {
        labels: ['Completed', 'Incomplete'],
        datasets: [{
            data: [profileCompletionPercentage, 100 - profileCompletionPercentage],
            backgroundColor: ['#4caf50', '#f44336'],
            borderColor: ['#fff', '#fff'],
            borderWidth: 2
        }]
    },
    options: {
        responsive: false, // Disable responsiveness to respect custom dimensions
        plugins: {
            tooltip: {
                callbacks: {
                    label: function(tooltipItem) {
                        return `${tooltipItem.label}: ${tooltipItem.raw}%`;
                    }
                }
            }
        }
    }
});

            // Render the profile completion list
            const profileCompletionList = document.getElementById('profile-completion-items');
            profileCompletionList.innerHTML = ''; // Clear the previous list

            profileFields.forEach(field => {
                const listItem = document.createElement('li');
                listItem.textContent = `${field.label}: ${userData[field.field] ? 'Complete' : 'Incomplete'}`;
                listItem.style.color = userData[field.field] ? '#4caf50' : '#f44336';
                profileCompletionList.appendChild(listItem);
            });
        


            function updateMembershipStatus(userData) {
                const membershipDueDate = new Date(userData.membershipExpiry); // Ensure it's a Date object
                const currentDate = new Date();
                const timeLeft = Math.ceil((membershipDueDate - currentDate) / (1000 * 60 * 60 * 24)); // Calculate days left

                const dueDateElement = document.getElementById('membershipDueDate').querySelector('span');
                const timeLeftElement = document.getElementById('membershipTimeLeft').querySelector('span');
                const paymentButton = document.getElementById('make-payment-btn');

                // Format date as 'MM/DD/YYYY'
                const formattedDueDate = membershipDueDate instanceof Date && !isNaN(membershipDueDate) 
                    ? membershipDueDate.toLocaleDateString('en-US') 
                    : 'MM/DD/YYYY';

                // Display formatted due date
                dueDateElement.textContent = formattedDueDate;

                // Display time left or fallback text
                timeLeftElement.textContent = timeLeft >= 0 ? `${timeLeft} day${timeLeft !== 1 ? 's' : ''} left` : 'Expired';

                // Apply visual cues for expiring or expired membership
                if (timeLeft <= 3 && timeLeft > 0) {
                    timeLeftElement.style.color = 'orange'; // Warning color for imminent expiration
                    paymentButton.style.color = 'orange';
                } else if (timeLeft <= 0) {
                    timeLeftElement.style.color = 'red'; // Critical color for expired membership
                    paymentButton.style.color = 'red';
                    alert("Your membership has expired. Please renew to continue enjoying premium features.");
                } else {
                    timeLeftElement.style.color = 'green'; // Positive status for valid membership
                    paymentButton.style.color = 'green';
                }
            }

            updateMembershipStatus(userData);
        }

        // Fetch user referral data from the UserReferral collection
        let pendingReferral = 0;
        let referralEarned = 0;
        let completedReferral = 0;

        const referralQuery = query(collection(db, 'UserReferral'), where('referredBy', '==', userId));
        const referralSnapshot = await getDocs(referralQuery);

        if (referralSnapshot.empty) {
            console.log("No referrals found.");
        } else {
            referralSnapshot.forEach(doc => {
                const referralData = doc.data();
                const referredUser = referralData.referredUser;
                const referType = referralData.referType;
                const referMembershipBool = referralData.referMembershipBool;
                const referObituariesBool = referralData.referObituariesBool;
                const status = referralData.status;

                // Count pending referrals for membership and obituaries
                if (status === "pending") {
                    if (referObituariesBool) {
                        pendingReferral += 1;
                    }
                    if (referMembershipBool) {
                        pendingReferral += 1;
                    }
                }

                // Count completed referrals for membership and obituaries
                if (status === "complete") {
                    if (referObituariesBool) {
                        completedReferral += 1;
                    }
                    if (referMembershipBool) {
                        completedReferral += 1;
                    }
                }
            });

            // Referral earnings calculation (completed referrals + bonus)
            referralEarned = completedReferral * 5;

            // Update the DOM with referral data
            let referralsCount = referralSnapshot.size; // Using snapshot.size for number of documents
            document.getElementById('referrals-count').querySelector('span').textContent = referralsCount || 0;
            document.getElementById('referrals-earned').querySelector('span').textContent = `$${referralEarned || 0}`;
            document.getElementById('referrals-pending').textContent = pendingReferral || 0;
        }
    } catch (error) {
        console.error("Error fetching user data:", error);
    }

    // Fetch obituary data from the Obituaries collection
  
// Fetch obituary data
const fetchObituaryData = async () => {
  try {
    const obituaryQuery = query(collection(db, 'A_Obituaries'), where('userID', '==', userId));
    const querySnapshot = await getDocs(obituaryQuery);
    const obituaryData = querySnapshot.docs.map(doc => doc.data());

    console.log("obituaryData", obituaryData);
    
    const totalObituaries = obituaryData.length;
    const totalGifts = obituaryData.reduce((sum, obit) => sum + (obit.gifts || 0), 0);

    document.getElementById('total-Obituaries').textContent = totalObituaries;
    document.getElementById('total-Obituaries-gifts').textContent = `$${totalGifts}`;

    const obituaryHistory = document.getElementById('user-Obituaries');
    obituaryHistory.innerHTML = '';
    obituaryData.forEach(obit => {
      const obituaryElement = document.createElement('div');
      obituaryElement.classList.add('history-item');
      obituaryElement.innerHTML = `<p><strong>Obituary ID:</strong> ${obit.id} | <strong>Title:</strong> ${obit.title}</p>`;
      obituaryHistory.appendChild(obituaryElement);
    });
  } catch (error) {
    console.error("Error fetching obituary data:", error);
  }
};

// Fetch video resume data
const fetchVideoResumeData = async () => {
  try {
    const videoResumeQuery = query(collection(db, 'VideoResumes'), where('userID', '==', userId));
    const querySnapshot = await getDocs(videoResumeQuery);
    const videoResumeData = querySnapshot.docs.map(doc => doc.data());

    const totalVideoResumes = videoResumeData.length;
    const totalLikes = videoResumeData.reduce((sum, resume) => sum + (resume.likes || 0), 0);
    const totalViews = videoResumeData.reduce((sum, resume) => sum + (resume.views || 0), 0);
    const totalGifts = videoResumeData.reduce((sum, resume) => sum + ((resume.gifts || []).length || 0), 0);
    const totalLoves = videoResumeData.reduce((sum, resume) => sum + (resume.loves || 0), 0);
    const totalShares = videoResumeData.reduce((sum, resume) => sum + (resume.shares || 0), 0);

    document.getElementById('total-video-reels').textContent = totalVideoResumes;
    document.getElementById('total-video-reel-likes').textContent = totalLikes;
    document.getElementById('total-video-reel-views').textContent = totalViews;
    document.getElementById('total-video-reel-gifts').textContent = `$${totalGifts}`;
    document.getElementById('total-video-resumes').textContent = totalVideoResumes;

    const videoReelHistory = document.getElementById('user-video-reels');
    videoReelHistory.innerHTML = '';
    videoResumeData.forEach(resume => {
      const resumeElement = document.createElement('div');
      resumeElement.classList.add('history-item');
      resumeElement.innerHTML = `<p><strong>Title:</strong> ${resume.videoResumeCaptions}</p> <p><strong>Video created Date:</strong> ${formatTimestamp(resume.createdAt)}</p>`;
      videoReelHistory.appendChild(resumeElement);
    });
  } catch (error) {
    console.error("Error fetching video resume data:", error);
  }
};

// Referral link
const referralLink = `https://reelcareer.co/referral/?r=${userId}`;
console.log("referralLink", referralLink);
document.getElementById('referral-code').value = referralLink;

// Initialize fetch functions
fetchObituaryData();
fetchVideoResumeData();

}



// Wait for the DOM to fully load before adding event listeners
document.addEventListener('DOMContentLoaded', () => {
  // User Information Section
  document.getElementById('view-user-profile').addEventListener('click', updateUserProfile);

  // Membership Section
  document.getElementById('view-membership').addEventListener('click', changeMembershipPlan);

  // Payment Plan Section
  document.getElementById('payment-month-to-month').addEventListener('click', selectMonthlyPlan);
  document.getElementById('payment-yearly').addEventListener('click', selectYearlyPlan);
  document.getElementById('make-payment-btn').addEventListener('click', makePayment);

  // Referral Program Section
  document.getElementById('copy-referral-code-btn').addEventListener('click', copyReferralCode);
  document.getElementById('view-referral').addEventListener('click', viewReferrals);

  // Obituary Management Section
  document.getElementById('view-obituary-account').addEventListener('click', viewObituaryAccount);
  document.getElementById('view-create-obituary').addEventListener('click', createNewObituary);

  // Video Reels Management Section
  document.getElementById('view-video-reels-account').addEventListener('click', viewVideoReelsAccount);
  document.getElementById('create-new-video-reel').addEventListener('click', createNewVideoReel);

  // Transactions Section
  document.getElementById('confirmPayout').addEventListener('click', confirmPayout);

  // Notifications Section
  document.getElementById('job-application-notifications').addEventListener('click', jobApplicationNotifications);
  document.getElementById('new-job-listings-notifications').addEventListener('click', newJobListingsNotifications);
  document.getElementById('membership-expiry-notifications').addEventListener('click', membershipExpiryNotifications);
  document.getElementById('gift-received-notifications').addEventListener('click', giftNotifications);
  document.getElementById('resume-views-notifications').addEventListener('click', resumeViewsNotifications);
  document.getElementById('recommendations-notifications').addEventListener('click', recommendationsNotifications);
  document.getElementById('obituary-engagement-notifications').addEventListener('click', obituaryEngagementNotifications);
  document.getElementById('reel-analytics-notifications').addEventListener('click', reelAnalyticsNotifications);
  document.getElementById('payment-status-notifications').addEventListener('click', paymentStatusNotifications);


});







document.getElementById('delete-account').addEventListener('click', async () => {
      const userDataSaved = getUserData() || [];
      const userDocRef = doc(db, 'Users', userDataSaved.userID);
      try {
        // Check if user ID is valid
        const userId = await getUserId(); // Await if getUserId is asynchronous
        if (!userId) {
          alert('Invalid user ID. Please log in again.');
          return;
        }
        // Fetch current user status
        const userDoc = await getDoc(userDocRef);
        if (!userDoc.exists()) {
          alert('User not found! Please contact support.');
          return;
        }
        const currentStatus = userDoc.data().status;
        if (!currentStatus) {
          alert('Unable to retrieve account status. Please try again.');
          return;
        }
        const isCurrentlyActive = currentStatus === 'active';
        // Confirmation message based on current status
        const action = isCurrentlyActive ? 'deactivate' : 'reactivate';
        const confirmToggle = confirm(`Are you sure you want to ${action} your account?`);
        if (!confirmToggle) {
          console.log(`${action.charAt(0).toUpperCase() + action.slice(1)} canceled by the user.`);
          return;
        }
        // Toggle status
        const newStatus = isCurrentlyActive ? 'inactive' : 'active';
        // Update user's status
        await updateDoc(userDocRef, {
          status: newStatus
        });
        console.log(`User account status updated to ${newStatus}`);
        // Update job posts' status
        try {
          const jobsQuery = query(
            collection(db, 'Jobs'),
            where('createdBy', '==', userId)
          );
          const jobDocs = await getDocs(jobsQuery);
          if (!jobDocs.empty) {
            jobDocs.forEach(async (jobDoc) => {
              const jobRef = doc(db, 'Jobs', jobDoc.id);
              await updateDoc(jobRef, {
                status: newStatus
              });
              console.log(`Job post ${jobDoc.id} status updated to ${newStatus}`);
            });
          } else {
            console.log('No job posts found for the user.');
          }
        } catch (jobError) {
          console.error('Error updating job posts status:', jobError);
          alert('An error occurred while updating job posts. Please try again later.');
        }
        // Update applications' status
        try {
          const applicationsQuery = query(
            collection(db, 'Applications'),
            where('userId', '==', userId)
          );
          const applicationDocs = await getDocs(applicationsQuery);
          if (!applicationDocs.empty) {
            applicationDocs.forEach(async (appDoc) => {
              const appRef = doc(db, 'Applications', appDoc.id);
              await updateDoc(appRef, {
                status: newStatus
              });
              console.log(`Application ${appDoc.id} status updated to ${newStatus}`);
            });
          } else {
            console.log('No applications found for the user.');
          }
        } catch (appError) {
          console.error('Error updating applications status:', appError);
          alert('An error occurred while updating applications. Please try again later.');
        }
        // Update button text
        const button = document.getElementById('deactivateAccountBtn-profile');
        button.textContent = isCurrentlyActive ? 'Reactivate Account' : 'Deactivate Account';
        // Notify user of successful update
        alert(`Your account and related data have been successfully ${action}d.`);
      } catch (error) {
        console.error('Error during toggle process:', error);
        alert('An unexpected error occurred. Please try again later.');
      }
    });
  








function createTransactionElement(doc, transactionData) {
    const transactionElement = document.createElement("div");
    transactionElement.classList.add("transaction-entry");

    const timestamp = transactionData.timestamp 
        ? new Date(transactionData.timestamp.seconds * 1000).toLocaleString() 
        : 'No date';
    
    const fee = calculateFee(transactionData.amount);
    const netAmount = transactionData.amount - fee;
    
    const { transactionDetails, suggestionText } = getTransactionDetails(transactionData, fee, netAmount);
    
    transactionElement.innerHTML = `
        <div class="transaction-details">
            <p><strong>Transaction ID:</strong> ${doc.id}</p>
            <p><strong>Date:</strong> ${timestamp}</p>
            ${transactionDetails}
        </div>
        <hr>
        <p><strong>Status:</strong> ${transactionData.status || 'Active'}</p>
        ${suggestionText}
    `;
    
    return transactionElement;
}

function calculateFee(amount) {
    return amount ? amount * 0.10 : 0;
}

function getTransactionDetails(transactionData, fee, netAmount) {
    let transactionDetails = '';
    let suggestionText = '';
    
    switch (transactionData.transactionType) {
        case 'job_post_boost':
            transactionDetails = getBoostTransactionDetails(transactionData, fee, netAmount);
            suggestionText = "<p><em>Consider boosting your job posts periodically to maintain visibility among job seekers!</em></p>";
            break;

        case 'profile_boost':
            transactionDetails = getBoostTransactionDetails(transactionData, fee, netAmount, 'profile boost');
            suggestionText = "<p><em>Profile boosts help increase visibility to recruiters. Keep your profile active!</em></p>";
            break;

        case 'video_reel_gift':
            transactionDetails = getGiftTransactionDetails(transactionData, fee, netAmount);
            suggestionText = "<p><em>Gifting can help engage others in your network—consider sending more gifts to boost interactions!</em></p>";
            break;

        case 'withdraw':
            transactionDetails = getWithdrawTransactionDetails(transactionData);
            suggestionText = "<p><em>Ensure you have sufficient balance before making withdrawals to avoid disruptions.</em></p>";
            break;

        default:
            transactionDetails = getGenericTransactionDetails(transactionData, fee, netAmount);
            suggestionText = "<p><em>Stay on top of your transaction details to maintain a healthy account balance!</em></p>";
            break;
    }

    return { transactionDetails, suggestionText };
}

function getBoostTransactionDetails(transactionData, fee, netAmount, type = 'Job post boost') {
    return `
        <p><strong>Amount Paid:</strong> $${transactionData.amount.toFixed(2)}</p>
        <p><strong>Fee (10%):</strong> $${fee.toFixed(2)}</p>
        <p><strong>Net Amount:</strong> $${netAmount.toFixed(2)}</p>
        <p><strong>Note:</strong> ${type} for ID: ${transactionData.pageID || transactionData.userID}</p>
    `;
}

function getGiftTransactionDetails(transactionData, fee, netAmount) {
    return `
        <p><strong>Gift Type:</strong> ${transactionData.giftType || 'Video Reel'}</p>
        <p><strong>Amount Given:</strong> $${transactionData.amount.toFixed(2)}</p>
        <p><strong>Fee (10%):</strong> $${fee.toFixed(2)}</p>
        <p><strong>Net Amount:</strong> $${netAmount.toFixed(2)}</p>
        <p><strong>Note:</strong> Gift given for Video Reel for User ID: ${transactionData.userID}</p>
    `;
}

function getWithdrawTransactionDetails(transactionData) {
    return `
        <p><strong>Withdraw Amount:</strong> $${transactionData.withdraw_amount.toFixed(2)}</p>
        <p><strong>Available Amount:</strong> $${(transactionData.availableAmount - transactionData.withdraw_amount).toFixed(2)}</p>
        <p><strong>Note:</strong> Withdraw request for Page: ${transactionData.pageID}</p>
    `;
}

function getGenericTransactionDetails(transactionData, fee, netAmount) {
    return `
        <p><strong>Amount:</strong> $${transactionData.amount.toFixed(2)}</p>
        <p><strong>Fee (10%):</strong> $${fee.toFixed(2)}</p>
        <p><strong>Net Amount:</strong> $${netAmount.toFixed(2)}</p>
        <p><strong>Note:</strong> ${transactionData.note}</p>
    `;
}

// Calculate the total payout (refactored)
async function calculateTotalPayout() {
    try {
        const transactionsRef = collection(db, 'A_Transactions');
        const transactionsQuery = query(transactionsRef, where('userID', '==', userID));
        const transactionSnapshot = await getDocs(transactionsQuery);
        
        const sortedTransactions = transactionSnapshot.docs.sort((a, b) => {
            return new Date(b.data().requestDate) - new Date(a.data().requestDate);
        });

        let totalGifts = 0;
        let withdrawnPayouts = 0;
        const transactionsLog = document.getElementById("transactions-log");
        transactionsLog.innerHTML = ''; 

        let latestTransactionDate = null;

        sortedTransactions.forEach(doc => {
            const transactionData = doc.data();
            const isWithdraw = transactionData.transactionType === "withdraw";
            const payPalPayStatus = transactionData.paymentDetails?.purchase_units?.[0]?.payments?.captures?.[0]?.status || 'Unknown';

            if (payPalPayStatus === "COMPLETED" && !isWithdraw) {
                const fee = transactionData.amount * 0.10;
                totalGifts += (transactionData.amount - fee);
            } else if (isWithdraw) {
                withdrawnPayouts += transactionData.withdraw_amount || 0;
            }

            if (!latestTransactionDate || new Date(transactionData.requestDate) > new Date(latestTransactionDate)) {
                latestTransactionDate = transactionData.requestDate;
            }

            const transactionElement = createTransactionElement(doc, transactionData);
            transactionsLog.appendChild(transactionElement);
        });

        handleRequestCooldown(latestTransactionDate);

        const availablePayout = totalGifts - withdrawnPayouts;
        return availablePayout;
    } catch (error) {
        console.error("Error calculating total payout:", error);
        return 0;
    }
}

window.calculateTotalPayout = calculateTotalPayout;

// Handling payout cooldown (refactored)
function handleRequestCooldown(latestTransactionDate) {
    const lastRequestDate = new Date(latestTransactionDate || 0);
    const sevenDaysLater = new Date(lastRequestDate.getTime() + 7 * 24 * 60 * 60 * 1000);
    const now = new Date();

    requestPayoutBool = now >= sevenDaysLater;
    const requestNote = requestPayoutBool
        ? "You can request funds."
        : `You can request funds on ${sevenDaysLater.toLocaleDateString()}.`;
    document.getElementById("request-note").textContent = requestNote;
    document.getElementById("last-request-date").textContent = `Last Request: ${lastRequestDate.toLocaleDateString()}`;
}

// Confirm payout (refactored)
async function confirmPayout() {
    const MINIMUM_PAYOUT = 25;
    const requestedAmount = parseFloat(document.getElementById("requested-amount").value) || 0;

    const availableAmount = await calculateTotalPayout();

    if (!requestPayoutBool) {
        showToast("Request can only be made once every 7 days", 'error');
        return;
    }

    if (requestedAmount <= 0) {
        showToast("Please enter a valid payout amount.", 'error');
    } else if (requestedAmount < MINIMUM_PAYOUT) {
        showToast(`Minimum payout amount is $${MINIMUM_PAYOUT}. Please enter a valid amount.`, 'error');
    } else if (requestedAmount > availableAmount) {
        showToast("Requested amount exceeds the available balance.", 'error');
    } else {
        await createPayoutTransaction(requestedAmount, availableAmount);
        showToast("Payout request confirmed. Your payout is being processed.", 'success');
    }
}
window.confirmPayout = confirmPayout;

// Create payout transaction (refactored)
async function createPayoutTransaction(amount, availableAmount) {
    try {
      const transactionsRef = collection(db, 'A_Transactions');
const transactionData = {
  userID,
  transactionType: "withdraw",
  availableAmount,
  withdraw_amount: amount,
  fee: amount * 0.10,  // 10% service fee
  netAmount: amount - (amount * 0.10),  // Net amount after fee
  note: `Withdraw Request`,
  status: "Pending",  // Mark as pending until processed
  timestamp: serverTimestamp(),
};

const transactionDocRef = await addDoc(transactionsRef, transactionData);  // Add transaction
const transactionID = transactionDocRef.id;  // Capture the transaction ID

// Optionally, update the transaction record with its ID if necessary
await setDoc(transactionDocRef, { transactionID }, { merge: true });


        getUserContactDetails(transactionData, transactionID);
    } catch (error) {
        console.error("Error creating payout transaction:", error);
        showToast("An error occurred while creating the payout transaction.", 'error');
    }
}



let requestPayoutBool = false;



async function viewTransactions() {
  const availableAmount = await calculateTotalPayout();
  document.getElementById("total-payout").textContent = availableAmount.toFixed(2);



  showToast(`Total available payout: $${availableAmount.toFixed(2)}`, 'success');

  if (!requestPayoutBool) {
    showToast("Request can only be made once every 7 days", 'error');
    return;
  }
}





window.viewTransactions = viewTransactions;

viewTransactions();





// Function to get user's email and phone number
async function getUserContactDetails(transactionData, transactionID) {
    try {
        const userRef = doc(db, "Users", userID);
        const userDoc = await getDoc(userRef);
        if (!userDoc.exists()) throw new Error('User document not found.');
        
        const userData = userDoc.data();
        const userEmail = userData.email || "N/A";
        const userPhone = userData.phone || "N/A";

        const confirmationText = `Would you like to send the payout details to this contact information?\nEmail: ${userEmail}\nPhone: ${userPhone}`;

        const sendToContact = confirm(confirmationText);
        if (sendToContact) {
            processPayoutTransaction(userEmail, userPhone, transactionData, transactionID);
        } else {
            const alternativeContact = prompt("Please enter an alternative email or phone number:");
            processPayoutTransaction(alternativeContact, '', transactionData, transactionID);
        }
    } catch (error) {
        console.error("Error getting user contact details:", error);
        showToast("An error occurred while fetching user contact details.", 'error');
    }
}

// Function to process the payout transaction
async function processPayoutTransaction(contact, contact2, transactionData, transactionID) {
    try {
        const payoutRef = collection(db, "A_Payouts");  // Ensure db is initialized properly
        if (!payoutRef) throw new Error('Failed to get payouts collection reference.');
        
        const payoutDoc = await addDoc(payoutRef, {
            obituaryPage: `https://reelcareer.co/obituaries/celebrating/${pageName}`,
            userPage: `https://reelcareer.co/u/${userID}`,
            transactionData: transactionData,
            transactionID: transactionID,
            contact,
            contact2,
            note: `Process Payout: User: ${userID}`,
            status: "Pending",
            userID: userID,
            userIP: getUserIP(),
            timestamp: serverTimestamp(),
            requestDate: new Date().toISOString(),  // Properly formatted date
        });

        console.log("Payout initiated:", payoutDoc.id);
    } catch (error) {
        console.error("Error processing payout transaction:", error);
        showToast("An error occurred while processing the payout transaction.", 'error');
    }
}





function createToolbar(pageID, pageName) {
    const toolbar = document.createElement('div');
    toolbar.className = 'controls';
    toolbar.innerHTML = `
        <button id="edit_${pageID}">Edit</button>
        <button id="analytics_${pageID}">Analytics</button>
        <button id="view_${pageID}">View</button>
        <button id="userAccount_${pageID}">Account</button>
    `;

    // Append the toolbar to the desired container
    document.getElementById('user-toolbar').appendChild(toolbar);

    // Add event listeners for the buttons
    toolbar.querySelector(`#edit_${pageID}`).addEventListener("click", () => goToEditPage(pageID, pageName));
    toolbar.querySelector(`#analytics_${pageID}`).addEventListener("click", () => goToAnalyticsPage(pageID, pageName));
    toolbar.querySelector(`#view_${pageID}`).addEventListener("click", () => goToViewPage(pageID, pageName));
    toolbar.querySelector(`#userAccount_${pageID}`).addEventListener("click", () => loadUserAccount(pageID, pageName));
}


// Functions to handle button actions
function goToEditPage(pageID, pageName) {
    window.location.href = `https://reelcareer.co/obituaries/edit.html?pageID=${encodeURIComponent(pageID)}&pageName=${encodeURIComponent(pageName)}`;
}
window.goToEditPage = goToEditPage;

function goToAnalyticsPage(pageID, pageName) {
    window.location.href = `https://reelcareer.co/obituaries/analytics.html?pageID=${encodeURIComponent(pageID)}&pageName=${encodeURIComponent(pageName)}`;
}
window.goToAnalyticsPage = goToAnalyticsPage;

function goToViewPage(pageID, pageName) {
    window.location.href = `https://reelcareer.co/obituaries/celebrating/${encodeURIComponent(pageName)}`;
}
window.goToViewPage = goToViewPage;

function loadUserAccount(pageID, pageName) {
    window.location.href = `https://reelcareer.co/obituaries/account.html?pageID=${encodeURIComponent(pageID)}&pageName=${encodeURIComponent(pageName)}`;
}
window.loadUserAccount = loadUserAccount;


</script>


    </body>
    
    
    
    </html>
      